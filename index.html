<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.18">
<meta name="description" content="A size-optimized, customizable and highly extensible MCU-class 32-bit RISC-V soft-core CPU and microcontroller-like SoC written in platform-independent VHDL.">
<meta name="keywords" content="neorv32, risc-v, riscv, rv32, fpga, soft-core, vhdl, microcontroller, cpu, soc, processor, gcc, openocd, gdb">
<meta name="author" content="Stephan Nolting (M.Sc.)">
<link rel="icon" type="image/png" href="img/icon.png">
<title>[Datasheet] The NEORV32 RISC-V Processor</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The NEORV32 RISC-V Processor: Datasheet</h1>
<div class="details">
<span id="author" class="author">Stephan Nolting (M.Sc.)</span><br>
<span id="revnumber">version v1.7.9-r85-g7e385d1f</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_overview">1. Overview</a>
<ul class="sectlevel2">
<li><a href="#_rationale">1.1. Rationale</a>
<ul class="sectlevel3">
<li><a href="#_why_did_you_make_this">Why did you make this?</a></li>
<li><a href="#_why_a_soft_core_processor">Why a <em>soft-core</em> processor?</a></li>
<li><a href="#_why_risc_v">Why RISC-V?</a></li>
<li><a href="#_yet_another_risc_v_core_what_makes_it_special">Yet another RISC-V core? What makes it special?</a></li>
<li><a href="#_a_multi_cycle_architecture">A multi-cycle architecture?!?!</a></li>
</ul>
</li>
<li><a href="#_project_key_features">1.2. Project Key Features</a></li>
<li><a href="#_project_folder_structure">1.3. Project Folder Structure</a></li>
<li><a href="#_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</a></li>
<li><a href="#_fpga_implementation_results">1.5. FPGA Implementation Results</a>
<ul class="sectlevel3">
<li><a href="#_cpu">1.5.1. CPU</a></li>
<li><a href="#_processor_modules">1.5.2. Processor - Modules</a></li>
<li><a href="#_processor_exemplary_setups">1.5.3. Processor - Exemplary Setups</a></li>
</ul>
</li>
<li><a href="#_cpu_performance">1.6. CPU Performance</a></li>
</ul>
</li>
<li><a href="#_neorv32_processor_soc">2. NEORV32 Processor (SoC)</a>
<ul class="sectlevel2">
<li><a href="#_processor_top_entity_signals">2.1. Processor Top Entity - Signals</a></li>
<li><a href="#_processor_top_entity_generics">2.2. Processor Top Entity - Generics</a>
<ul class="sectlevel3">
<li><a href="#_general">2.2.1. General</a>
<ul class="sectlevel4">
<li><a href="#_clock_frequency"><em>CLOCK_FREQUENCY</em></a></li>
<li><a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a></li>
<li><a href="#_hw_thread_id"><em>HW_THREAD_ID</em></a></li>
<li><a href="#_custom_id"><em>CUSTOM_ID</em></a></li>
<li><a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a></li>
</ul>
</li>
<li><a href="#_risc_v_cpu_extensions">2.2.2. RISC-V CPU Extensions</a>
<ul class="sectlevel4">
<li><a href="#_cpu_extension_riscv_b"><em>CPU_EXTENSION_RISCV_B</em></a></li>
<li><a href="#_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></a></li>
<li><a href="#_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></a></li>
<li><a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a></li>
<li><a href="#_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></a></li>
<li><a href="#_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></a></li>
<li><a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a></li>
<li><a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a></li>
<li><a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a></li>
<li><a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a></li>
<li><a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a></li>
<li><a href="#_cpu_extension_riscv_zxcfu"><em>CPU_EXTENSION_RISCV_Zxcfu</em></a></li>
</ul>
</li>
<li><a href="#_tuning_options">2.2.3. Tuning Options</a>
<ul class="sectlevel4">
<li><a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a></li>
<li><a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a></li>
<li><a href="#_cpu_ipb_entries"><em>CPU_IPB_ENTRIES</em></a></li>
</ul>
</li>
<li><a href="#_physical_memory_protection_pmp">2.2.4. Physical Memory Protection (PMP)</a>
<ul class="sectlevel4">
<li><a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a></li>
<li><a href="#_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></a></li>
</ul>
</li>
<li><a href="#_hardware_performance_monitors_hpm">2.2.5. Hardware Performance Monitors (HPM)</a>
<ul class="sectlevel4">
<li><a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a></li>
<li><a href="#_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></a></li>
</ul>
</li>
<li><a href="#_internal_instruction_memory">2.2.6. Internal Instruction Memory</a>
<ul class="sectlevel4">
<li><a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a></li>
<li><a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a></li>
</ul>
</li>
<li><a href="#_internal_data_memory">2.2.7. Internal Data Memory</a>
<ul class="sectlevel4">
<li><a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a></li>
<li><a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a></li>
</ul>
</li>
<li><a href="#_internal_cache_memory">2.2.8. Internal Cache Memory</a>
<ul class="sectlevel4">
<li><a href="#_icache_en"><em>ICACHE_EN</em></a></li>
<li><a href="#_icache_num_blocks"><em>ICACHE_NUM_BLOCKS</em></a></li>
<li><a href="#_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></a></li>
<li><a href="#_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></a></li>
</ul>
</li>
<li><a href="#_external_memory_interface">2.2.9. External Memory Interface</a>
<ul class="sectlevel4">
<li><a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a></li>
<li><a href="#_mem_ext_timeout"><em>MEM_EXT_TIMEOUT</em></a></li>
<li><a href="#_mem_ext_pipe_mode"><em>MEM_EXT_PIPE_MODE</em></a></li>
<li><a href="#_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></a></li>
<li><a href="#_mem_ext_async_rx"><em>MEM_EXT_ASYNC_RX</em></a></li>
<li><a href="#_mem_ext_async_tx"><em>MEM_EXT_ASYNC_TX</em></a></li>
</ul>
</li>
<li><a href="#_stream_link_interface">2.2.10. Stream Link Interface</a>
<ul class="sectlevel4">
<li><a href="#_slink_num_tx"><em>SLINK_NUM_TX</em></a></li>
<li><a href="#_slink_num_rx"><em>SLINK_NUM_RX</em></a></li>
<li><a href="#_slink_tx_fifo"><em>SLINK_TX_FIFO</em></a></li>
<li><a href="#_slink_rx_fifo"><em>SLINK_RX_FIFO</em></a></li>
</ul>
</li>
<li><a href="#_external_interrupt_controller">2.2.11. External Interrupt Controller</a>
<ul class="sectlevel4">
<li><a href="#_xirq_num_ch"><em>XIRQ_NUM_CH</em></a></li>
<li><a href="#_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></a></li>
<li><a href="#_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></a></li>
</ul>
</li>
<li><a href="#_processor_peripheralio_modules">2.2.12. Processor Peripheral/IO Modules</a>
<ul class="sectlevel4">
<li><a href="#_io_gpio_en"><em>IO_GPIO_EN</em></a></li>
<li><a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a></li>
<li><a href="#_io_uart0_en"><em>IO_UART0_EN</em></a></li>
<li><a href="#_io_uart0_rx_fifo"><em>IO_UART0_RX_FIFO</em></a></li>
<li><a href="#_io_uart0_tx_fifo"><em>IO_UART0_TX_FIFO</em></a></li>
<li><a href="#_io_uart1_en"><em>IO_UART1_EN</em></a></li>
<li><a href="#_io_uart1_rx_fifo"><em>IO_UART1_RX_FIFO</em></a></li>
<li><a href="#_io_uart1_tx_fifo"><em>IO_UART1_TX_FIFO</em></a></li>
<li><a href="#_io_spi_en"><em>IO_SPI_EN</em></a></li>
<li><a href="#_io_spi_fifo"><em>IO_SPI_FIFO</em></a></li>
<li><a href="#_io_twi_en"><em>IO_TWI_EN</em></a></li>
<li><a href="#_io_pwm_num_ch"><em>IO_PWM_NUM_CH</em></a></li>
<li><a href="#_io_wdt_en"><em>IO_WDT_EN</em></a></li>
<li><a href="#_io_trng_en"><em>IO_TRNG_EN</em></a></li>
<li><a href="#_io_trng_fifo"><em>IO_TRNG_FIFO</em></a></li>
<li><a href="#_io_cfs_en"><em>IO_CFS_EN</em></a></li>
<li><a href="#_io_cfs_config"><em>IO_CFS_CONFIG</em></a></li>
<li><a href="#_io_cfs_in_size"><em>IO_CFS_IN_SIZE</em></a></li>
<li><a href="#_io_cfs_out_size"><em>IO_CFS_OUT_SIZE</em></a></li>
<li><a href="#_io_neoled_en"><em>IO_NEOLED_EN</em></a></li>
<li><a href="#_io_neoled_tx_fifo"><em>IO_NEOLED_TX_FIFO</em></a></li>
<li><a href="#_io_gptmr_en"><em>IO_GPTMR_EN</em></a></li>
<li><a href="#_io_xip_en"><em>IO_XIP_EN</em></a></li>
<li><a href="#_io_onewire_en"><em>IO_ONEWIRE_EN</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processor_clocking">2.3. Processor Clocking</a></li>
<li><a href="#_processor_reset">2.4. Processor Reset</a></li>
<li><a href="#_processor_interrupts">2.5. Processor Interrupts</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</a></li>
<li><a href="#_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</a></li>
<li><a href="#_platform_external_interrupts">2.5.3. Platform External Interrupts</a></li>
</ul>
</li>
<li><a href="#_address_space">2.6. Address Space</a>
<ul class="sectlevel3">
<li><a href="#_physical_memory_attributes_pmas">2.6.1. Physical Memory Attributes (PMAs)</a></li>
<li><a href="#_cpu_data_and_instruction_access">2.6.2. CPU Data and Instruction Access</a></li>
<li><a href="#_address_space_layout">2.6.3. Address Space Layout</a></li>
<li><a href="#_memory_configuration">2.6.4. Memory Configuration</a>
<ul class="sectlevel4">
<li><a href="#_internal_memories">Internal Memories</a></li>
<li><a href="#_external_memories">External Memories</a></li>
</ul>
</li>
<li><a href="#_boot_configuration">2.6.5. Boot Configuration</a>
<ul class="sectlevel4">
<li><a href="#_indirect_boot">Indirect Boot</a></li>
<li><a href="#_direct_boot">Direct Boot</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_processor_internal_modules">2.7. Processor-Internal Modules</a>
<ul class="sectlevel3">
<li><a href="#_instruction_memory_imem">2.7.1. Instruction Memory (IMEM)</a></li>
<li><a href="#_data_memory_dmem">2.7.2. Data Memory (DMEM)</a></li>
<li><a href="#_bootloader_rom_bootrom">2.7.3. Bootloader ROM (BOOTROM)</a></li>
<li><a href="#_processor_internal_instruction_cache_icache">2.7.4. Processor-Internal Instruction Cache (iCACHE)</a></li>
<li><a href="#_processor_external_memory_interface_wishbone_axi4_lite">2.7.5. Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a></li>
<li><a href="#_internal_bus_monitor_buskeeper">2.7.6. Internal Bus Monitor (BUSKEEPER)</a></li>
<li><a href="#_stream_link_interface_slink">2.7.7. Stream Link Interface (SLINK)</a></li>
<li><a href="#_general_purpose_input_and_output_port_gpio">2.7.8. General Purpose Input and Output Port (GPIO)</a></li>
<li><a href="#_watchdog_timer_wdt">2.7.9. Watchdog Timer (WDT)</a></li>
<li><a href="#_machine_system_timer_mtime">2.7.10. Machine System Timer (MTIME)</a></li>
<li><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.7.11. Primary Universal Asynchronous Receiver and Transmitter (UART0)</a></li>
<li><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.7.12. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a></li>
<li><a href="#_serial_peripheral_interface_controller_spi">2.7.13. Serial Peripheral Interface Controller (SPI)</a></li>
<li><a href="#_two_wire_serial_interface_controller_twi">2.7.14. Two-Wire Serial Interface Controller (TWI)</a></li>
<li><a href="#_one_wire_serial_interface_controller_onewire">2.7.15. One-Wire Serial Interface Controller (ONEWIRE)</a></li>
<li><a href="#_pulse_width_modulation_controller_pwm">2.7.16. Pulse-Width Modulation Controller (PWM)</a></li>
<li><a href="#_true_random_number_generator_trng">2.7.17. True Random-Number Generator (TRNG)</a></li>
<li><a href="#_custom_functions_subsystem_cfs">2.7.18. Custom Functions Subsystem (CFS)</a></li>
<li><a href="#_smart_led_interface_neoled">2.7.19. Smart LED Interface (NEOLED)</a></li>
<li><a href="#_external_interrupt_controller_xirq">2.7.20. External Interrupt Controller (XIRQ)</a></li>
<li><a href="#_general_purpose_timer_gptmr">2.7.21. General Purpose Timer (GPTMR)</a></li>
<li><a href="#_execute_in_place_module_xip">2.7.22. Execute In Place Module (XIP)</a></li>
<li><a href="#_system_configuration_information_memory_sysinfo">2.7.23. System Configuration Information Memory (SYSINFO)</a>
<ul class="sectlevel4">
<li><a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a></li>
<li><a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</a>
<ul class="sectlevel2">
<li><a href="#_risc_v_compatibility">3.1. RISC-V Compatibility</a>
<ul class="sectlevel3">
<li><a href="#_risc_v_incompatibility_issues_and_limitations">3.1.1. RISC-V Incompatibility Issues and Limitations</a></li>
</ul>
</li>
<li><a href="#_architecture">3.2. Architecture</a>
<ul class="sectlevel3">
<li><a href="#_cpu_register_file">3.2.1. CPU Register File</a></li>
<li><a href="#_cpu_arithmetic_logic_unit">3.2.2. CPU Arithmetic Logic Unit</a></li>
<li><a href="#_cpu_bus_unit">3.2.3. CPU Bus Unit</a></li>
<li><a href="#_cpu_control_unit">3.2.4. CPU Control Unit</a></li>
</ul>
</li>
<li><a href="#_sleep_mode">3.3. Sleep Mode</a></li>
<li><a href="#_full_virtualization">3.4. Full Virtualization</a></li>
<li><a href="#_cpu_top_entity_signals">3.5. CPU Top Entity - Signals</a></li>
<li><a href="#_cpu_top_entity_generics">3.6. CPU Top Entity - Generics</a>
<ul class="sectlevel3">
<li><a href="#_cpu_boot_addr"><em>CPU_BOOT_ADDR</em></a></li>
<li><a href="#_cpu_debug_park_addr"><em>CPU_DEBUG_PARK_ADDR</em></a></li>
<li><a href="#_cpu_debug_exc_addr"><em>CPU_DEBUG_EXC_ADDR</em></a></li>
<li><a href="#_cpu_extension_riscv_sdext"><em>CPU_EXTENSION_RISCV_Sdext</em></a></li>
<li><a href="#_cpu_extension_riscv_sdtrig"><em>CPU_EXTENSION_RISCV_Sdtrig</em></a></li>
</ul>
</li>
<li><a href="#_instruction_sets_and_extensions">3.7. Instruction Sets and Extensions</a>
<ul class="sectlevel3">
<li><a href="#_b_bit_manipulation_operations">3.7.1. <strong><code>B</code></strong> - Bit-Manipulation Operations</a></li>
<li><a href="#_c_compressed_instructions">3.7.2. <strong><code>C</code></strong> - Compressed Instructions</a></li>
<li><a href="#_e_embedded_cpu">3.7.3. <strong><code>E</code></strong> - Embedded CPU</a></li>
<li><a href="#_i_base_integer_isa">3.7.4. <strong><code>I</code></strong> - Base Integer ISA</a></li>
<li><a href="#_m_integer_multiplication_and_division">3.7.5. <strong><code>M</code></strong> - Integer Multiplication and Division</a></li>
<li><a href="#_zmmul_integer_multiplication">3.7.6. <strong><code>Zmmul</code></strong> - Integer Multiplication</a></li>
<li><a href="#_u_less_privileged_user_mode">3.7.7. <strong><code>U</code></strong> - Less-Privileged User Mode</a></li>
<li><a href="#_x_neorv32_specific_custom_extensions">3.7.8. <strong><code>X</code></strong> - NEORV32-Specific (Custom) Extensions</a></li>
<li><a href="#_zfinx_single_precision_floating_point_operations">3.7.9. <strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a></li>
<li><a href="#_zicsr_control_and_status_register_access_privileged_architecture">3.7.10. <strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a></li>
<li><a href="#_zicntr_cpu_base_counters">3.7.11. <strong><code>Zicntr</code></strong> CPU Base Counters</a></li>
<li><a href="#_zihpm_hardware_performance_monitors">3.7.12. <strong><code>Zihpm</code></strong> Hardware Performance Monitors</a></li>
<li><a href="#_zifencei_instruction_stream_synchronization">3.7.13. <strong><code>Zifencei</code></strong> Instruction Stream Synchronization</a></li>
<li><a href="#_zxcfu_custom_instructions_extension_cfu">3.7.14. <strong><code>Zxcfu</code></strong> Custom Instructions Extension (CFU)</a></li>
<li><a href="#_pmp_physical_memory_protection">3.7.15. <strong><code>PMP</code></strong> Physical Memory Protection</a></li>
</ul>
</li>
<li><a href="#_sdext_external_debug_support">3.8. <strong>`Sdext</strong> External Debug Support</a></li>
<li><a href="#_sdtrig_trigger_module">3.9. <strong><code>Sdtrig</code></strong> Trigger Module</a></li>
<li><a href="#_custom_functions_unit_cfu">3.10. Custom Functions Unit (CFU)</a>
<ul class="sectlevel3">
<li><a href="#_cfu_instruction_formats">3.10.1. CFU Instruction Formats</a></li>
<li><a href="#_cfu_r3_type_instructions">3.10.2. CFU R3-Type Instructions</a></li>
<li><a href="#_cfu_r4_type_instructions">3.10.3. CFU R4-Type Instructions</a></li>
<li><a href="#_cfu_r5_type_instructions">3.10.4. CFU R5-Type Instructions</a></li>
<li><a href="#_using_custom_instructions_in_software">3.10.5. Using Custom Instructions in Software</a></li>
<li><a href="#_custom_instructions_hardware">3.10.6. Custom Instructions Hardware</a></li>
</ul>
</li>
<li><a href="#_instruction_timing">3.11. Instruction Timing</a></li>
<li><a href="#_control_and_status_registers_csrs">3.12. Control and Status Registers (CSRs)</a>
<ul class="sectlevel3">
<li><a href="#_floating_point_csrs">3.12.1. Floating-Point CSRs</a>
<ul class="sectlevel4">
<li><a href="#_fflags"><strong><code>fflags</code></strong></a></li>
<li><a href="#_frm"><strong><code>frm</code></strong></a></li>
<li><a href="#_fcsr"><strong><code>fcsr</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_configuration_csrs">3.12.2. Machine Configuration CSRs</a>
<ul class="sectlevel4">
<li><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></li>
<li><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_trap_setup_csrs">3.12.3. Machine Trap Setup CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mstatus"><strong><code>mstatus</code></strong></a></li>
<li><a href="#_misa"><strong><code>misa</code></strong></a></li>
<li><a href="#_mie"><strong><code>mie</code></strong></a></li>
<li><a href="#_mtvec"><strong><code>mtvec</code></strong></a></li>
<li><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></li>
<li><a href="#_mstatush"><strong><code>mstatush</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_trap_handling_csrs">3.12.4. Machine Trap Handling CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mscratch"><strong><code>mscratch</code></strong></a></li>
<li><a href="#_mepc"><strong><code>mepc</code></strong></a></li>
<li><a href="#_mcause"><strong><code>mcause</code></strong></a></li>
<li><a href="#_mtval"><strong><code>mtval</code></strong></a></li>
<li><a href="#_mip"><strong><code>mip</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_physical_memory_protection_csrs">3.12.5. Machine Physical Memory Protection CSRs</a>
<ul class="sectlevel4">
<li><a href="#_pmpcfg"><strong><code>pmpcfg</code></strong></a></li>
<li><a href="#_pmpaddr"><strong><code>pmpaddr</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_counter_and_timer_csrs">3.12.6. (Machine) Counter and Timer CSRs</a>
<ul class="sectlevel4">
<li><a href="#_cycleh"><strong><code>cycle[h]</code></strong></a></li>
<li><a href="#_timeh"><strong><code>time[h]</code></strong></a></li>
<li><a href="#_instreth"><strong><code>instret[h]</code></strong></a></li>
<li><a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a></li>
<li><a href="#_minstreth"><strong><code>minstret[h]</code></strong></a></li>
</ul>
</li>
<li><a href="#_hardware_performance_monitors_hpm_csrs">3.12.7. Hardware Performance Monitors (HPM) CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mhpmevent"><strong><code>mhpmevent</code></strong></a></li>
<li><a href="#_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_counter_setup_csrs">3.12.8. Machine Counter Setup CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></li>
</ul>
</li>
<li><a href="#_machine_information_csrs">3.12.9. Machine Information CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></li>
<li><a href="#_marchid"><strong><code>marchid</code></strong></a></li>
<li><a href="#_mimpid"><strong><code>mimpid</code></strong></a></li>
<li><a href="#_mhartid"><strong><code>mhartid</code></strong></a></li>
<li><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></li>
</ul>
</li>
<li><a href="#_neorv32_specific_csrs">3.12.10. NEORV32-Specific CSRs</a>
<ul class="sectlevel4">
<li><a href="#_mxisa"><strong><code>mxisa</code></strong></a></li>
</ul>
</li>
<li><a href="#_traps_exceptions_and_interrupts">3.12.11. Traps, Exceptions and Interrupts</a>
<ul class="sectlevel4">
<li><a href="#_memory_access_exceptions">Memory Access Exceptions</a></li>
<li><a href="#_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</a></li>
<li><a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></li>
</ul>
</li>
<li><a href="#_bus_interface">3.12.12. Bus Interface</a>
<ul class="sectlevel4">
<li><a href="#_protocol">Protocol</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_software_framework">4. Software Framework</a>
<ul class="sectlevel2">
<li><a href="#_compiler_toolchain">4.1. Compiler Toolchain</a></li>
<li><a href="#_core_libraries">4.2. Core Libraries</a></li>
<li><a href="#_application_makefile">4.3. Application Makefile</a>
<ul class="sectlevel3">
<li><a href="#_targets">4.3.1. Targets</a></li>
<li><a href="#_configuration">4.3.2. Configuration</a></li>
<li><a href="#_default_compiler_flags">4.3.3. Default Compiler Flags</a></li>
<li><a href="#_custom_compiler_flags">4.3.4. Custom (Compiler) Flags</a></li>
</ul>
</li>
<li><a href="#_executable_image_format">4.4. Executable Image Format</a>
<ul class="sectlevel3">
<li><a href="#_linker_script">4.4.1. Linker Script</a></li>
<li><a href="#_ram_layout">4.4.2. RAM Layout</a></li>
<li><a href="#_c_standard_library">4.4.3. C Standard Library</a></li>
<li><a href="#_executable_image_generator">4.4.4. Executable Image Generator</a></li>
<li><a href="#_start_up_code_crt0">4.4.5. Start-Up Code (crt0)</a>
<ul class="sectlevel4">
<li><a href="#_after_main_handler">After-Main Handler</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_bootloader">4.5. Bootloader</a>
<ul class="sectlevel3">
<li><a href="#_bootloader_soccpu_requirements">4.5.1. Bootloader SoC/CPU Requirements</a></li>
<li><a href="#_bootloader_flash_requirements">4.5.2. Bootloader Flash Requirements</a></li>
<li><a href="#_bootloader_console">4.5.3. Bootloader Console</a></li>
<li><a href="#_auto_boot_sequence">4.5.4. Auto Boot Sequence</a></li>
<li><a href="#_bootloader_error_codes">4.5.5. Bootloader Error Codes</a></li>
</ul>
</li>
<li><a href="#_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</a>
<ul class="sectlevel3">
<li><a href="#_rte_operation">4.6.1. RTE Operation</a></li>
<li><a href="#_using_the_rte">4.6.2. Using the RTE</a></li>
<li><a href="#_default_rte_trap_handlers">4.6.3. Default RTE Trap Handlers</a>
<ul class="sectlevel4">
<li><a href="#_bus_access_faults">Bus Access Faults</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</a>
<ul class="sectlevel2">
<li><a href="#_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</a></li>
<li><a href="#_debug_module_dm">5.2. Debug Module (DM)</a>
<ul class="sectlevel3">
<li><a href="#_dm_registers">5.2.1. DM Registers</a>
<ul class="sectlevel4">
<li><a href="#_data"><strong><code>data</code></strong></a></li>
<li><a href="#_dmcontrol"><strong><code>dmcontrol</code></strong></a></li>
<li><a href="#_dmstatus"><strong><code>dmstatus</code></strong></a></li>
<li><a href="#_hartinfo"><strong><code>hartinfo</code></strong></a></li>
<li><a href="#_abstracts"><strong><code>abstracts</code></strong></a></li>
<li><a href="#_command"><strong><code>command</code></strong></a></li>
<li><a href="#_abstractauto"><strong><code>abstractauto</code></strong></a></li>
<li><a href="#_progbuf"><strong><code>progbuf</code></strong></a></li>
</ul>
</li>
<li><a href="#_dm_cpu_access">5.2.2. DM CPU Access</a>
<ul class="sectlevel4">
<li><a href="#_code_rom_entry_points">Code ROM Entry Points</a></li>
<li><a href="#_status_register">Status Register</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_cpu_debug_mode">5.3. CPU Debug Mode</a>
<ul class="sectlevel3">
<li><a href="#_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</a>
<ul class="sectlevel4">
<li><a href="#_dcsr"><strong><code>dcsr</code></strong></a></li>
<li><a href="#_dpc"><strong><code>dpc</code></strong></a></li>
<li><a href="#_dscratch0"><strong><code>dscratch0</code></strong></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_trigger_module">5.4. Trigger Module</a>
<ul class="sectlevel3">
<li><a href="#_trigger_module_csrs">5.4.1. Trigger Module CSRs</a>
<ul class="sectlevel4">
<li><a href="#_tselect"><strong><code>tselect</code></strong></a></li>
<li><a href="#_tdata1"><strong><code>tdata1</code></strong></a></li>
<li><a href="#_tdata2"><strong><code>tdata2</code></strong></a></li>
<li><a href="#_tdata3"><strong><code>tdata3</code></strong></a></li>
<li><a href="#_tinfo"><strong><code>tinfo</code></strong></a></li>
<li><a href="#_tcontrol"><strong><code>tcontrol</code></strong></a></li>
<li><a href="#_mcontext"><strong><code>mcontext</code></strong></a></li>
<li><a href="#_scontext"><strong><code>scontext</code></strong></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#_legal">6. Legal</a>
<ul class="sectlevel2">
<li><a href="#_license">License</a></li>
<li><a href="#_proprietary_notice">Proprietary Notice</a></li>
<li><a href="#_disclaimer">Disclaimer</a></li>
<li><a href="#_limitation_of_liability_for_external_links">Limitation of Liability for External Links</a></li>
<li><a href="#_citing">Citing</a></li>
<li><a href="#_acknowledgments">Acknowledgments</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_logo_transparent.png" alt="neorv32 logo transparent">
</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/riscv_logo.png" alt="riscv logo" width="350">
</div>
</div>
<div class="paragraph text-center">
<p><a href="https://github.com/stnolting/neorv32"><span class="image"><img src="https://img.shields.io/badge/GitHub-stnolting%2Fneorv32-ffbd00?style=flat-square&amp;logo=github&amp;" alt="GitHub stnolting%2Fneorv32 ffbd00?style=flat square&amp;logo=github&amp;" title="homepage"></span></a>
<a href="https://github.com/stnolting/neorv32/blob/main/LICENSE"><span class="image"><img src="https://img.shields.io/github/license/stnolting/neorv32?longCache=true&amp;style=flat-square" alt="neorv32?longCache=true&amp;style=flat square" title="license"></span></a>
<a href="https://gitter.im/neorv32/community"><span class="image"><img src="https://img.shields.io/badge/Chat-on%20gitter-4db797.svg?longCache=true&amp;style=flat-square&amp;logo=gitter&amp;logoColor=e8ecef" alt="Chat on%20gitter 4db797" title="chat on gitter"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/data%20sheet-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="data%20sheet PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="datasheet (pdf)"></span></a>
<a href="https://github.com/stnolting/neorv32/releases/tag/nightly"><span class="image"><img src="https://img.shields.io/badge/user%20guide-PDF-ffbd00?longCache=true&amp;style=flat-square&amp;logo=asciidoctor" alt="user%20guide PDF ffbd00?longCache=true&amp;style=flat square&amp;logo=asciidoctor" title="userguide (pdf)"></span></a>
<a href="https://stnolting.github.io/neorv32/ug"><span class="image"><img src="https://img.shields.io/badge/-HTML-ffbd00?longCache=true&amp;style=flat-square" alt=" HTML ffbd00?longCache=true&amp;style=flat square" title="userguide (html)"></span></a>
<a href="https://stnolting.github.io/neorv32/sw/files.html"><span class="image"><img src="https://img.shields.io/badge/doxygen-HTML-ffbd00?longCache=true&amp;style=flat-square&amp;logo=Doxygen" alt="doxygen HTML ffbd00?longCache=true&amp;style=flat square&amp;logo=Doxygen" title="doxygen"></span></a><br>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/v/release/stnolting/neorv32?longCache=true&amp;style=flat-square&amp;logo=GitHub" alt="neorv32?longCache=true&amp;style=flat square&amp;logo=GitHub" title="release"></span></a>
<a href="https://github.com/stnolting/neorv32/releases"><span class="image"><img src="https://img.shields.io/github/commits-since/stnolting/neorv32/latest?longCache=true&amp;style=flat-square&amp;logo=GitHub" alt="latest?longCache=true&amp;style=flat square&amp;logo=GitHub" title="release-commits"></span></a></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_overview">1. Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> is an open-source
RISC-V compatible processor system that is intended as <strong>ready-to-go</strong> auxiliary processor within a larger SoC
designs or as stand-alone custom / customizable microcontroller.</p>
</div>
<div class="paragraph">
<p>The system is highly configurable and provides optional common peripherals like embedded memories,
timers, serial interfaces, general purpose IO ports and an external bus interface to connect custom IP like
memories, NoCs and other peripherals. On-line and in-system debugging is supported by an OpenOCD/gdb
compatible on-chip debugger accessible via JTAG.</p>
</div>
<div class="paragraph">
<p>Special focus is paid on <strong>execution safety</strong> to provide defined and predictable behavior at any time.
Therefore, the CPU ensures that all memory access are acknowledged and no invalid/malformed instructions
are executed. Whenever an unexpected situation occurs, the application code is informed via hardware exceptions.</p>
</div>
<div class="paragraph">
<p>The software framework of the processor comes with application makefiles, software libraries for all CPU
and processor features, a bootloader, a runtime environment and several example programs - including a port
of the CoreMark MCU benchmark and the official RISC-V architecture test suite. RISC-V GCC is used as
default toolchain (<a href="https://github.com/stnolting/riscv-gcc-prebuilt">prebuilt toolchains are also provided</a>).</p>
</div>
<div class="paragraph">
<p>Check out the processor&#8217;s <strong><a href="https://stnolting.github.io/neorv32/ug">online User Guide</a></strong>
that provides hands-on tutorials to get you started.</p>
</div>
<div class="paragraph">
<p><strong>Structure</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p><a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a></p>
</li>
<li>
<p><a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a></p>
</li>
<li>
<p><a href="#_software_framework">Software Framework</a></p>
</li>
<li>
<p><a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
<li>
<p><a href="#_legal">Legal</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Annotations</strong></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Warning
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Important
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Tip
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_rationale">1.1. Rationale</h3>
<div class="sect3">
<h4 id="_why_did_you_make_this">Why did you make this?</h4>
<div class="paragraph">
<p>Processor and CPU architecture designs are fascinating things: they are the magic frontier where software meets hardware.
This project started as something like a <em>journey</em> into this magic realm to understand how things actually work
down on this very low level and evolved over time to a capable system on chip.</p>
</div>
<div class="paragraph">
<p>But there is more: when I started to dive into the emerging RISC-V ecosystem I felt overwhelmed by the complexity.
As a beginner it is hard to get an overview - especially when you want to setup a minimal platform to tinker with&#8230;&#8203;
Which core to use? How to get the right toolchain? What features do I need? How does booting work? How do I
create an actual executable? How to get that into the hardware? How to customize things? <strong><em>Where to start???</em></strong></p>
</div>
<div class="paragraph">
<p>This project aims to provide a <em>simple to understand</em> and <em>easy to use</em> yet <em>powerful</em> and <em>flexible</em> platform
that targets FPGA and RISC-V beginners as well as advanced users.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_a_soft_core_processor">Why a <em>soft-core</em> processor?</h4>
<div class="paragraph">
<p>As a matter of fact soft-core processors <em>cannot</em> compete with discrete (like FPGA hard-macro) processors in terms
of performance, energy efficiency and size. But they do fill a niche in FPGA design space: for example, soft-core processors
allow to implement the <em>control flow part</em> of certain applications (e.g. communication protocol handling) using
software like plain C. This provides high flexibility as software can be easily changed, re-compiled and
re-uploaded again.</p>
</div>
<div class="paragraph">
<p>Furthermore, the concept of flexibility applies to all aspects of a soft-core processor. The user can add
<em>exactly</em> the features that are required by the application: additional memories, custom interfaces, specialized
co-processors and even user-defined instructions.</p>
</div>
</div>
<div class="sect3">
<h4 id="_why_risc_v">Why RISC-V?</h4>
<div class="imageblock text-left">
<div class="content">
<img src="img/riscv_logo.png" alt="riscv logo" width="250">
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RISC-V is a free and open ISA enabling a new era of processor innovation through open standard collaboration.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; RISC-V International<br>
<cite>https://riscv.org/about/</cite>
</div>
</div>
<div class="paragraph">
<p>Open-source is a great thing!
While open-source has already become quite popular in <em>software</em>, hardware-focused projects still need to catch up.
Admittedly, there has been quite a development, but mainly in terms of <em>platforms</em> and <em>applications</em> (so
schematics, PCBs, etc.). Although processors and CPUs are the heart of almost every digital system, having a true
open-source silicon is still a rarity. RISC-V aims to change that - and even it is <em>just one approach</em>, it helps paving
the road for future development.</p>
</div>
<div class="paragraph">
<p>Furthermore, I highly appreciate the community aspect of RISC-V. The ISA and everything beyond is developed in direct
contact with the community: this includes businesses and professionals but also hobbyist, amateurs and people
that are just curious. Everyone can join discussions and contribute to RISC-V in their very own way.</p>
</div>
<div class="paragraph">
<p>Finally, I really like the RISC-V ISA itself. It aims to be a clean, orthogonal and "intuitive" ISA that
resembles with the basic concepts of <em>RISC</em>: simple yet effective.</p>
</div>
</div>
<div class="sect3">
<h4 id="_yet_another_risc_v_core_what_makes_it_special">Yet another RISC-V core? What makes it special?</h4>
<div class="paragraph">
<p>The NEORV32 is not based on another RISC-V core. It was build entirely from ground up (just following the official
ISA specs). The project does not intend to replace certain RISC-V cores or
just beat existing ones like <a href="https://github.com/SpinalHDL/VexRiscv">VexRISC</a> in terms of performance or
<a href="https://github.com/olofk/serv">SERV</a> in terms of size. It was build having a different design goal in mind.</p>
</div>
<div class="paragraph">
<p>The project aims to provide <em>another option</em> in the RISC-V / soft-core design space with a different performance
vs. size trade-off and a different focus: <em>embrace</em> concepts like documentation, platform-independence / portability,
RISC-V compatibility, <em>extensibility &amp; customization</em> and <em>ease of use</em> (see the <a href="#_project_key_features">Project Key Features</a> below).</p>
</div>
<div class="paragraph">
<p>Furthermore, the NEORV32 pays special focus on <em>execution safety</em> using <a href="#_full_virtualization">Full Virtualization</a>. The CPU aims to
provide fall-backs for <em>everything that could go wrong</em>. This includes malformed instruction words, privilege escalations
and even memory accesses that are checked for address space holes and deterministic response times of memory-mapped
devices. Precise exceptions allow a defined and fully-synchronized state of the CPU at every time an in every situation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_a_multi_cycle_architecture">A multi-cycle architecture?!?!</h4>
<div class="paragraph">
<p>Most mainstream CPUs out there are pipelined architectures to increase throughput. In contrast, most CPUs used for
teaching are single-cycle designs since they are probably the most easiest to understand. But what about the
multi-cycle architectures?</p>
</div>
<div class="paragraph">
<p>In terms of energy, throughput, area and maximal clock frequency multi-cycle architectures are somewhere in between
single-cycle and fully-pipelined designs: they provide higher throughput and clock speed when compared to their
single-cycle counterparts while having less hardware complexity (= area) then a fully-pipelined designs. I decided to use the
multi-cycle approach because of the following reasons:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Multi-cycle architecture are quite small! There is no need for pipeline hazard detection and resolution logic
(e.g. forwarding). Furthermore, you can "re-use" parts of the core to do several tasks (e.g. the ALU is used for the actual data
processing, but also for address generation, branch condition check and branch target computation).</p>
</li>
<li>
<p>Single-cycle architectures require memories that can be read asynchronously - a thing that is not feasible to implement
in real world applications (i.e. FPGA block RAM is entirely synchronous). Furthermore, such design usually have a very (very!!!)
long critical path tremendously reducing maximal operating frequency.</p>
</li>
<li>
<p>Pipelined designs increase performance by having several instruction "in fly" at the same time. But this also means
there is some kind of "out-of-order" behavior: if an instruction at the end of the pipeline causes an exception
all the instructions in earlier stages have to be invalidated. Potential architecture state changes have to be made <em>undone</em>
requiring additional (exception-handling) logic. In a multi-cycle architecture this situation cannot occur because only a
single instruction is "in fly" at a time.</p>
</li>
<li>
<p>Having only a single instruction in fly does not only reduce hardware costs, it also simplifies simulation/verification/debugging,
state preservation/restoring during exceptions and extensibility (no need to care about pipeline hazards) - but of course at the
cost of reduced throughput.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To counteract the loss of performance implied by a <em>pure</em> multi-cycle architecture, the NEORV32 CPU uses a <em>mixed</em> approach: instruction fetch
(front-end) and instruction execution (back-end) are de-coupled to operate independently of each other. Data is interchanged via a queue
building a simple 2-stage pipeline. Each "pipeline" stage in terms is implemented as multi-cycle architecture to simplify
the hardware and to provide <em>precise</em> state control (e.g. during exceptions).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CPU Architecture Details</div>
Want to know more? Check out the description in the CPU&#8217;s <a href="#_architecture">Architecture</a> section.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_project_key_features">1.2. Project Key Features</h3>
<div class="paragraph">
<p><strong>Project</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>all-in-one package: <strong>CPU</strong> + <strong>SoC</strong> + <strong>Software Framework &amp; Tooling</strong></p>
</li>
<li>
<p>completely described in behavioral, platform-independent VHDL - no vendor- or technology-specific primitives, attributes, macros, libraries, etc. are used at all</p>
</li>
<li>
<p>all-Verilog "version" <a href="https://github.com/stnolting/neorv32-verilog">available</a> (auto-generated netlist)</p>
</li>
<li>
<p>extensive configuration options for adapting the processor to the requirements of the application</p>
</li>
<li>
<p>highly <a href="https://stnolting.github.io/neorv32/ug/#_comparative_summary">extensible hardware</a> - on CPU, SoC and system level</p>
</li>
<li>
<p>aims to be as small as possible while being as RISC-V-compliant as possible - with a reasonable area-vs-performance trade-off</p>
</li>
<li>
<p>FPGA friendly (e.g. <em>all</em> internal memories can be mapped to block RAM - including the register file)</p>
</li>
<li>
<p>optimized for high clock frequencies to ease timing closure and integration</p>
</li>
<li>
<p>from zero to <em>"hello world!"</em> - completely open source and documented</p>
</li>
<li>
<p>easy to use even for FPGA/RISC-V starters  intended to <em>work out of the box</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 CPU (the core)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit <code>rv32i</code> RISC-V CPU</p>
</li>
<li>
<p>fully RISC-V ISA compatible - checked by the <a href="https://github.com/stnolting/neorv32-riscof">official RISCOF architecture tests</a></p>
</li>
<li>
<p>base ISA + privileged ISA (optional) + several ISA extensions (optional)</p>
</li>
<li>
<p>option to add custom RISC-V instructions as custom ISA extension</p>
</li>
<li>
<p>rich set of customization options (ISA extensions, design goal: performance / area (/ energy), &#8230;&#8203;)</p>
</li>
<li>
<p>aims to support <a href="#_full_virtualization">Full Virtualization</a> capabilities to increase execution safety</p>
</li>
<li>
<p>official <a href="https://github.com/riscv/riscv-isa-manual/blob/master/marchid.md">RISC-V open source architecture ID</a>: decimal <strong>19</strong>; hexadecimal <code>0x00000013</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>NEORV32 Processor (the SoC)</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>highly-configurable full-scale microcontroller-like processor system</p>
</li>
<li>
<p>based on the NEORV32 CPU</p>
</li>
<li>
<p>optional standard serial interfaces (UART, TWI, SPI, 1-Wire)</p>
</li>
<li>
<p>optional timers and counters (watchdog, system timer)</p>
</li>
<li>
<p>optional general purpose IO and PWM; a native NeoPixel(c)-compatible smart LED interface</p>
</li>
<li>
<p>optional embedded memories / caches for data, instructions and bootloader</p>
</li>
<li>
<p>optional external memory interface (Wishbone / AXI4-Lite) and stream link interface (AXI4-Stream) for custom connectivity</p>
</li>
<li>
<p>optional execute_in_place (XIP) module to execute code <em>directly</em> form external SPI flash</p>
</li>
<li>
<p>on-chip debugger compatible with OpenOCD and gdb including hardware trigger module</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Software framework</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>GCC-based toolchain - <a href="https://github.com/stnolting/riscv-gcc-prebuilt">prebuilt toolchains available</a>; application compilation based on GNU makefiles</p>
</li>
<li>
<p>internal bootloader with serial user interface (via UART)</p>
</li>
<li>
<p>core libraries and HAL for high-level usage of the provided functions and peripherals</p>
</li>
<li>
<p>processor-specific runtime environment and several example programs</p>
</li>
<li>
<p>doxygen-based documentation of the software framework; a deployed version is available at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a></p>
</li>
<li>
<p>FreeRTOS port + demos available</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more in-depth details regarding the feature provided by he hardware see the according sections:
<a href="#_neorv32_central_processing_unit_cpu">NEORV32 Central Processing Unit (CPU)</a> and <a href="#_neorv32_processor_soc">NEORV32 Processor (SoC)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Extensibility and Customization</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 processor was designed to ease customization and extensibility and provides several options for adding
application-specific custom hardware modules and accelerators. The three most common options for adding custom
on-chip modules are listed below.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a> for processor-external modules</p>
</li>
<li>
<p><a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> for tightly-coupled processor-internal co-processors</p>
</li>
<li>
<p><a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> for custom RISC-V instructions</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A more detailed comparison of the extension/customization options can be found in section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>
of the user guide.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_project_folder_structure">1.3. Project Folder Structure</h3>
<div class="literalblock">
<div class="content">
<pre>neorv32                - Project home folder

docs                  - Project documentation
datasheet            - AsciiDoc sources for the NEORV32 data sheet
figures              - Figures and logos
icons                - Misc. symbols
references           - Data sheets and RISC-V specs.
userguide            - AsciiDoc sources for the NEORV32 user guide

rtl                   - VHDL sources
core                 - Core sources of the CPU &amp; SoC
mem                 - SoC-internal memories (default architectures)
processor_templates  - Pre-configured SoC wrappers
system_integration   - System wrappers for advanced connectivity
test_setups          - Minimal test setup "SoCs" used in the User Guide

sim                   - Simulation files (see User Guide)

sw                    - Software framework
 bootloader           - Sources of the processor-internal bootloader
 common               - Linker script, crt0.S start-up code and central makefile
 example              - Example programs for the core and the SoC modules
 ...
 lib                  - Processor core library
 include             - Header files (*.h)
 source              - Source files (*.c)
 image_gen            - Helper program to generate NEORV32 executables
 ocd_firmware         - Firmware for the on-chip debugger's "park loop"
 openocd              - OpenOCD configuration files
 svd                  - Processor system view description file (CMSIS-SVD)</pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_vhdl_file_hierarchy">1.4. VHDL File Hierarchy</h3>
<div class="paragraph">
<p>All necessary VHDL hardware description files are located in the project&#8217;s <code>rtl/core</code> folder. The top entity
of the entire processor including all the required configuration generics is <strong><code>neorv32_top.vhd</code></strong>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
All core VHDL files from the list below have to be assigned to a new design library named <strong><code>neorv32</code></strong>. Additional
files, like alternative top entities, can be assigned to any library.
</td>
</tr>
</table>
</div>
<div class="literalblock">
<div class="content">
<pre>neorv32_top.vhd                  - NEORV32 Processor top entity

neorv32_fifo.vhd                - General purpose FIFO component
neorv32_package.vhd             - Processor/CPU main VHDL package file

neorv32_cpu.vhd                 - NEORV32 CPU top entity
neorv32_cpu_alu.vhd            - Arithmetic/logic unit
neorv32_cpu_cp_bitmanip.vhd   - Bit-manipulation co-processor (B ext.)
neorv32_cpu_cp_cfu.vhd        - Custom functions (instruction) co-processor (Zxcfu ext.)
neorv32_cpu_cp_fpu.vhd        - Floating-point co-processor (Zfinx ext.)
neorv32_cpu_cp_muldiv.vhd     - Mul/Div co-processor (M ext.)
neorv32_cpu_cp_shifter.vhd    - Bit-shift co-processor (base ISA)
neorv32_cpu_bus.vhd            - Load/store unit + physical memory protection
neorv32_cpu_control.vhd        - CPU control, exception system and CSRs
neorv32_cpu_decompressor.vhd  - Compressed instructions decoder
neorv32_cpu_regfile.vhd        - Data register file

neorv32_boot_rom.vhd            - Bootloader ROM
neorv32_bootloader_image.vhd   - Bootloader ROM memory image
neorv32_busswitch.vhd           - Processor bus switch for CPU buses (I&amp;D)
neorv32_bus_keeper.vhd          - Processor-internal bus monitor
neorv32_cfs.vhd                 - Custom functions subsystem
neorv32_debug_dm.vhd            - on-chip debugger: debug module
neorv32_debug_dtm.vhd           - on-chip debugger: debug transfer module
neorv32_dmem.entity.vhd         - Processor-internal data memory (entity-only!)
neorv32_gpio.vhd                - General purpose input/output port unit
neorv32_gptmr.vhd               - General purpose 32-bit timer
neorv32_icache.vhd              - Processor-internal instruction cache
neorv32_imem.entity.vhd         - Processor-internal instruction memory (entity-only!)
neor32_application_image.vhd   - IMEM application initialization image
neorv32_mtime.vhd               - Machine system timer
neorv32_neoled.vhd              - NeoPixel (TM) compatible smart LED interface
neorv32_onewire.vhd             - One-Wire serial interface controller
neorv32_pwm.vhd                 - Pulse-width modulation controller
neorv32_slink.vhd               - Stream link controller
neorv32_spi.vhd                 - Serial peripheral interface controller
neorv32_sysinfo.vhd             - System configuration information memory
neorv32_trng.vhd                - True random number generator
neorv32_twi.vhd                 - Two wire serial interface controller
neorv32_uart.vhd                - Universal async. receiver/transmitter
neorv32_wdt.vhd                 - Watchdog timer
neorv32_wishbone.vhd            - External (Wishbone) bus interface
neorv32_xip.vhd                 - Execute in place module
neorv32_xirq.vhd                - External interrupt controller

mem/neorv32_dmem.default.vhd    - _Default_ data memory (architecture-only)
mem/neorv32_imem.default.vhd    - _Default_ instruction memory (architecture-only)</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The processor-internal instruction and data memories (IMEM and DMEM) are split into two design files each:
a plain entity definition (<code>neorv32_*mem.entity.vhd</code>) and the actual architecture definition
(<code>mem/neorv32_*mem.default.vhd</code>). The <code>*.default.vhd</code> architecture definitions from <code>rtl/core/mem</code> provide a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory blocks. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_fpga_implementation_results">1.5. FPGA Implementation Results</h3>
<div class="paragraph">
<p>This section shows <em>exemplary</em> FPGA implementation results for the NEORV32 CPU and NEORV32 Processor modules.
Note that certain configuration options might also have an impact on other configuration options. Furthermore,
this report cannot cover all possible option combinations. Hence, the presented implementation results are
just <em>exemplary</em>. If not otherwise mentioned all implementations use the default generic configurations.</p>
</div>
<div class="sect3">
<h4 id="_cpu">1.5.1. CPU</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.7.8.5</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_cpu.vhd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPGA:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Cyclone IV E <code>EP4CE22F17C6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quartus Prime Lite 21.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>no timing constraints</strong>, "<em>balanced optimization</em>", f<sub>max</sub> from "<em>Slow 1200mV 0C Model</em>"</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 54.5454%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU ISA Configuration</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
<th class="tableblock halign-right valign-top"><em>f<sub>max</sub></em></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32e</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">720</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">360</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">512</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">724</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">364</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i_Zicsr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1223</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">607</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32i_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1578</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">773</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32im_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2087</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">983</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imc_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2338</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">992</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcb_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3175</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1247</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3186</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1254</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3187</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1254</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">130 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei_Zfinx</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4450</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1906</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123 MHz</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcbu_Zicsr_Zicntr_Zifencei_Zfinx_DebugMode</code></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4825</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2018</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">123 MHz</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><strong>RISC-V Compliance</strong></div>
The <code>Zicsr</code> ISA extension implements the privileged machine architecture
(see <a href="#_zicsr_control_and_status_register_access_privileged_architecture"><strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a>). The <code>Zicntr</code> ISA
extension implements the basic counters and timers (see <a href="#_zicntr_cpu_base_counters"><strong><code>Zicntr</code></strong> CPU Base Counters</a>). Both
extensions are <em>mandatory</em> in order to comply with the RISC-V architecture specifications.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The table above does not show <em>all</em> CPU ISA extensions. More sophisticated and application-specific
options like PMP and HMP are not included in this overview.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Goal-Driven Optimization</div>
The CPU provides further options to reduce the area footprint (for example by constraining the CPU-internal
counter sizes) or to increase performance (for example by using a barrel-shifter; at cost of extra hardware).
See section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a> for more information. Also, take a look at the User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_application_specific_processor_configuration">Application-Specific Processor Configuration</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processor_modules">1.5.2. Processor - Modules</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.6.8.3++</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rtl/core/neorv32_top.vhd</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPGA:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Cyclone IV E <code>EP4CE22F17C6</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Quartus Prime Lite 21.1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>no timing constraints</strong>, "<em>balanced optimization</em>"</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 1. Hardware utilization by processor module (mandatory modules highlighted in <strong>bold</strong>)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 53.3333%;">
<col style="width: 6.6666%;">
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Module</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-right valign-top">LEs</th>
<th class="tableblock halign-right valign-top">FFs</th>
<th class="tableblock halign-right valign-top">MEM bits</th>
<th class="tableblock halign-right valign-top">DSPs</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Boot ROM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader ROM (4kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">32768</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BUSKEEPER</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal bus monitor</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BUSSWITCH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus multiplexer for CPU instr. and data interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">69</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom functions subsystem <sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnotedef_2" title="View footnote.">2</a>]</sup></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug module</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">391</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">220</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DTM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-chip debugger - debug transfer module (JTAG)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">259</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">221</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal data memory (8kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">65536</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPIO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose input/output ports</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">102</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">98</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPTMR</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General Purpose Timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">153</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">105</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">iCACHE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction cache (2x4 blocks, 64 bytes per block)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">417</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">297</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">4096</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal instruction memory (16kB)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">131072</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MTIME</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine system timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">345</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">166</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Smart LED Interface (NeoPixel/WS28128) (FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">227</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">184</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONEWIRE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">107</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pulse_width modulation controller (8 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">117</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stream link interface (2xRX, 2xTX, FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">136</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">116</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial peripheral interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">114</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">94</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SYSINFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System configuration information memory</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True random number generator</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">89</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">79</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Two-wire interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">77</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">43</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0, UART1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Universal asynchronous receiver/transmitter 0/1 (FIFO_depth=1)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">195</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">143</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WDT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Watchdog timer</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">61</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">46</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WISHBONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External memory interface</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">120</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">112</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute in place module</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">318</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">244</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller (32 channels)</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">245</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock">0</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that not all IOs were actually connected to FPGA pins (for example some GPIO inputs and outputs)
when generating these reports.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processor_exemplary_setups">1.5.3. Processor - Exemplary Setups</h4>
<table class="tableblock frame-all grid-topbot stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.7.7.3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rv32imcu_Zicsr_Zicnt_DEBUG</code> + <code>FST_MUL</code> + <code>FAST_SHIFT</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Peripherals:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>UART0</code> + <code>MTIME</code> + <code>GPIO</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FPGA:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xilinx Artix-7 <code>xc7a35ticsg324-1L</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Toolchain:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Xilinx Vivado 2019.2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constraints:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock constrained to 150 MHz, default/standard synthesis &amp; implementation settings</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">LUTs</th>
<th class="tableblock halign-center valign-top">FFs</th>
<th class="tableblock halign-center valign-top">BRAMs</th>
<th class="tableblock halign-center valign-top">DSPs</th>
<th class="tableblock halign-center valign-top">Clock</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2488</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1807</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">150 MHz</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Exemplary Setups</div>
Check out the <code>neorv32-setups</code> repository (on GitHub: <a href="https://github.com/stnolting/neorv32-setups" class="bare">https://github.com/stnolting/neorv32-setups</a>),
which provides several demo setups and community projects for various FPGA boards and toolchains.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_performance">1.6. CPU Performance</h3>
<div class="paragraph">
<p>The performance of the NEORV32 was tested and evaluated using the <a href="https://www.eembc.org/coremark/">Core Mark CPU benchmark</a>.
This benchmark focuses on testing the capabilities of the CPU core itself rather than the performance of the whole
system. The according sources can be found in the <code>sw/example/coremark</code> folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Dhrystone</div>
A very simple port of the Dhrystone benchmark is also available in <code>sw/example/dhrystone</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resulting CoreMark score is defined as CoreMark iterations per second.
The execution time is determined via the RISC-V <code>[m]cycle[h]</code> CSRs. The relative CoreMark score is
defined as CoreMark score divided by the CPU&#8217;s clock frequency in MHz.</p>
</div>
<table class="tableblock frame-all grid-topbot stretch">
<caption class="title">Table 2. Configuration</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW version:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1.5.7.10</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32kB int. IMEM, 16kB int. DMEM, no caches, 100MHz clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CoreMark:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2000 iterations, MEM_METHOD is MEM_STACK</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISCV32-GCC 10.2.0 (compiled with <code>march=rv32i mabi=ilp32</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compiler flags:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default (with <code>-O3</code>), see makefile</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 3. CoreMark results</caption>
<colgroup>
<col style="width: 57.1428%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">CPU</th>
<th class="tableblock halign-center valign-top">CoreMark Score</th>
<th class="tableblock halign-center valign-top">CoreMarks/MHz</th>
<th class="tableblock halign-center valign-top">Average CPI</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>small</em> (<code>rv32i_Zicsr</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">33.89</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.3389</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>4.04</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>medium</em> (<code>rv32imc_Zicsr</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">62.50</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.6250</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>5.34</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>performance</em> (<code>rv32imc_Zicsr</code> + perf. options)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">95.23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>0.9523</strong></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>3.54</strong></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The "<em>performance</em>" CPU configuration uses the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> and <a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> options.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 CPU is based on a multi-cycle architecture. Each instruction is executed in a sequence of
several consecutive micro operations.
The average CPI (cycles per instruction) depends on the instruction mix of a specific applications and also on
the available CPU extensions. The average CPI is computed by dividing the total number of required clock cycles
(only the timed core to avoid distortion due to IO wait cycles) by the number of executed instructions
(<code>[m]instret[h]</code> CSRs). More information regarding the execution time of each implemented instruction can be found in
chapter <a href="#_instruction_timing">Instruction Timing</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_processor_soc">2. NEORV32 Processor (SoC)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor is based on the NEORV32 CPU. Together with common peripheral
interfaces and embedded memories it provides a RISC-V-based full-scale microcontroller-like SoC platform.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_processor.png" alt="neorv32 processor">
</div>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_processor_top_entity_signals">Processor Top Entity - Signals</a> and <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a></p>
</li>
<li>
<p><a href="#_processor_interrupts">Processor Interrupts</a></p>
</li>
<li>
<p><a href="#_address_space">Address Space</a> and <a href="#_boot_configuration">Boot Configuration</a></p>
</li>
<li>
<p><a href="#_processor_internal_modules">Processor-Internal Modules</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>optional</em> processor-internal data and instruction memories (<a href="#_data_memory_dmem"><strong>DMEM</strong></a>/<a href="#_instruction_memory_imem"><strong>IMEM</strong></a>) + cache (<a href="#_processor_internal_instruction_cache_icache"><strong>iCACHE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> internal bootloader (<a href="#_bootloader_rom_bootrom"><strong>BOOTROM</strong></a>) with UART console &amp; SPI flash boot option</p>
</li>
<li>
<p><em>optional</em> machine system timer (<a href="#_machine_system_timer_mtime"><strong>MTIME</strong></a>), RISC-V-compatible</p>
</li>
<li>
<p><em>optional</em> two independent universal asynchronous receivers and transmitters (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0"><strong>UART0</strong></a>, <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1"><strong>UART1</strong></a>) with optional hardware flow control (RTS/CTS) and optional RX/TX FIFOs</p>
</li>
<li>
<p><em>optional</em> 8/16/24/32-bit serial peripheral interface controller (<a href="#_serial_peripheral_interface_controller_spi"><strong>SPI</strong></a>) with 8 dedicated CS lines</p>
</li>
<li>
<p><em>optional</em> two wire serial interface controller (<a href="#_two_wire_serial_interface_controller_twi"><strong>TWI</strong></a>), compatible to the IC standard</p>
</li>
<li>
<p><em>optional</em> general purpose parallel IO port (<a href="#_general_purpose_input_and_output_port_gpio"><strong>GPIO</strong></a>), 64xOut, 64xIn</p>
</li>
<li>
<p><em>optional</em> 32-bit external bus interface, Wishbone b4 / AXI4-Lite compatible (<a href="#_processor_external_memory_interface_wishbone_axi4_lite"><strong>WISHBONE</strong></a>)</p>
</li>
<li>
<p><em>optional</em> 32-bit stream link interface with up to 8 independent links, AXI4-Stream compatible (<a href="#_stream_link_interface_slink"><strong>SLINK</strong></a>)</p>
</li>
<li>
<p><em>optional</em> watchdog timer (<a href="#_watchdog_timer_wdt"><strong>WDT</strong></a>)</p>
</li>
<li>
<p><em>optional</em> PWM controller with up to 60 channels &amp; 8-bit duty cycle resolution (<a href="#_pulse_width_modulation_controller_pwm"><strong>PWM</strong></a>)</p>
</li>
<li>
<p><em>optional</em> ring-oscillator-based true random number generator (<a href="#_true_random_number_generator_trng"><strong>TRNG</strong></a>)</p>
</li>
<li>
<p><em>optional</em> custom functions subsystem for custom co-processor extensions (<a href="#_custom_functions_subsystem_cfs"><strong>CFS</strong></a>)</p>
</li>
<li>
<p><em>optional</em> NeoPixel&#8482;/WS2812-compatible smart LED interface (<a href="#_smart_led_interface_neoled"><strong>NEOLED</strong></a>)</p>
</li>
<li>
<p><em>optional</em> external interrupt controller with up to 32 channels (<a href="#_external_interrupt_controller_xirq"><strong>XIRQ</strong></a>)</p>
</li>
<li>
<p><em>optional</em> general purpose 32-bit timer (<a href="#_general_purpose_timer_gptmr"><strong>GPTMR</strong></a>)</p>
</li>
<li>
<p><em>optional</em> execute in place module (<a href="#_execute_in_place_module_xip"><strong>XIP</strong></a>)</p>
</li>
<li>
<p><em>optional</em> 1-wire serial interface controller (<a href="#_one_wire_serial_interface_controller_onewire"><strong>ONEWIRE</strong></a>), compatible to the 1-wire standard</p>
</li>
<li>
<p><em>optional</em> on-chip debugger with JTAG TAP (<a href="#_on_chip_debugger_ocd"><strong>OCD</strong></a>)</p>
</li>
<li>
<p>bus keeper to monitor processor-internal bus transactions (<a href="#_internal_bus_monitor_buskeeper"><strong>BUSKEEPER</strong></a>)</p>
</li>
<li>
<p>system configuration information memory to check HW configuration via software (<a href="#_system_configuration_information_memory_sysinfo"><strong>SYSINFO</strong></a>)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_processor_top_entity_signals">2.1. Processor Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the processor top entity (<code>rtl/core/neorv32_top.vhd</code>).
The type of all signals is <code>std_ulogic</code> or <code>std_ulogic_vector</code> (or arrays of those) - the bi-directional signals are of type
<code>std_logic</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Default Values of Inputs</div>
All input signals provide default values in case they are not explicitly assigned during instantiation.
For control signals the value <code>L</code> (weak pull-down) is used. For serial and parallel data signals
the value <code>U</code> (unknown) is used.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Configurable Amount of Channels</div>
Some peripherals allow to configure the number of channels to-be-implemented by a generic (for example the number
of PWM channels). The according input/output signals have a fixed sized regardless of the actually configured
amount of channels. If less than the maximum number of channels is configured, only the LSB-aligned channels are used:
in case of an <em>input port</em> the remaining bits/channels are left unconnected; in case of an <em>output port</em> the remaining
bits/channels are hardwired to zero.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 11.1111%;">
<col style="width: 11.1111%;">
<col style="width: 61.1112%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Global Control (<a href="#_processor_clocking">Processor Clocking</a> and <a href="#_processor_reset">Processor Reset</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, asynchronous, <strong>low-active</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>JTAG Access Port for <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset, low-active (optional <sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnotedef_3" title="View footnote.">3</a>]</sup>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output <sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnotedef_4" title="View footnote.">4</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>External Bus Interface (<a href="#_processor_external_memory_interface_wishbone_axi4_lite">WISHBONE</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tag (access type identifier)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">destination address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable ('0' = read transfer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_lock_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">exclusive access request</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer acknowledge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer error</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Advanced Memory Control Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fence</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fencei_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <em>fencei</em> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Execute In Place Interface (<a href="#_execute_in_place_module_xip"></strong>XIP<strong></a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chi select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_clk_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_sdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_sdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Stream Link Interface (<a href="#_stream_link_interface_slink">SLINK</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8x32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> end of packet</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8x32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> data valid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> end of packet</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>General Purpose Inputs &amp; Outputs (<a href="#_general_purpose_input_and_output_port_gpio">GPIO</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">general purpose parallel input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Primary Universal Asynchronous Receiver/Transmitter (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Primary Universal Asynchronous Receiver/Transmitter (<a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX ready to receive new char</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX allowed to start sending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Serial Peripheral Interface Controller (<a href="#_serial_peripheral_interface_controller_spi">SPI</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sck_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">controller clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dedicated chip select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Two-Wire Interface Controller (<a href="#_two_wire_serial_interface_controller_twi">TWI</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_io</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">inout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_io</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">inout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>1-Wire Interface Controller (<a href="#_one_wire_serial_interface_controller_twi">ONEWIRE</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_io</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">inout</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data line</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Pulse-Width Modulation Channels (<a href="#_pulse_width_modulation_controller_pwm">PWM</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">60</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pulse-width modulated channels</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Custom Functions Subsystem (<a href="#_custom_functions_subsystem_cfs">CFS</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS input signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS output signal conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Smart LED Interface - NeoPixel&#8482; compatible (<a href="#_smart_led_interface_neoled">NEOLED</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">asynchronous serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>System time (<a href="#_machine_system_timer_mtime">MTIME</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer time from <em>external MTIME</em> unit if the processor-internal <em>MTIME</em> unit is not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer time from <em>internal MTIME</em> unit if the processor-internal <em>MTIME</em> unit is implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>External Interrupts (<a href="#_processor_interrupts">XIRQ</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">external interrupt requests</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>RISC-V Machine-Level <a href="#_processor_interrupts">CPU Interrupts</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (RISC-V), high-level-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (RISC-V), high-level-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (RISC-V), high-level-active</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_top_entity_generics">2.2. Processor Top Entity - Generics</h3>
<div class="paragraph">
<p>This section lists all configuration generics of the NEORV32 processor top entity (<code>rtl/neorv32_top.vhd</code>).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEORV32 generics allow to configure the system according to your needs. The generics are
used to control implementation of certain CPU extensions and peripheral modules and even allow to
optimize the system for certain design goals like minimal area or maximum performance.<br>
<br>
More information can be found in the user guide section
<a href="https://stnolting.github.io/neorv32/ug/#_application_specific_processor_configuration">Application-Specific Processor Configuration</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Software can determine the actual CPU and processor configuration via the <a href="#_misa"><strong><code>misa</code></strong></a> and <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs (CPU)
and the <a href="#_system_configuration_information_memory_sysinfo">SYSINFO</a> memory-mapped registers (processor).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If optional modules (like CPU extensions or peripheral devices) are <strong>not enabled</strong> the according circuitry
<strong>will not be synthesized at all</strong>. Hence, the disabled modules do not increase area and power requirements
and do not impact the timing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Not all configuration combinations are valid. The processor RTL code provides sanity checks to inform the user
during synthesis/simulation if an invalid combination has been detected.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Run a quick simulation using the provided simulation/GHDL scripts (<a href="https://stnolting.github.io/neorv32/ug/#_hello_world" class="bare">https://stnolting.github.io/neorv32/ug/#_hello_world</a>)
to verify the configuration of the processor generics is valid.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Generic Description</strong></p>
</div>
<div class="paragraph">
<p>The description of each generic uses the following scheme:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 4. Generic description</caption>
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Generic name</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>type</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Short description and link(s) for further information.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_general">2.2.1. General</h4>
<div class="sect4">
<h5 id="_clock_frequency"><em>CLOCK_FREQUENCY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CLOCK_FREQUENCY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>none</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The clock frequency of the processor&#8217;s <code>clk_i</code> input port in Hertz (Hz). Software can retrieve this value from the
<a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module to make clock-specific configurations (like timer values,
interface timing).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>INT_BOOTLOADER_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a>, pre-initialized with the default <a href="#_bootloader">Bootloader</a> image when true
This will also change the CPU&#8217;s boot address. See section <a href="#_boot_configuration">Boot Configuration</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hw_thread_id"><em>HW_THREAD_ID</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HW_THREAD_ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The hart ID of the CPU. Software can retrieve this value from the <a href="#_mhartid"><strong><code>mhartid</code></strong></a> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_custom_id"><em>CUSTOM_ID</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CUSTOM_ID</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x00000000</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">User-defined identifier to identify a certain setup or to pass user-defined flags.
Software can retrieve this value from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ON_CHIP_DEBUGGER_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the on-chip debugger (OCD) and the CPU debug mode when true. This generic is directly passed
to the CPU&#8217;s <a href="#_cpu_extension_riscv_sdext"><em>CPU_EXTENSION_RISCV_Sdext</em></a> and <a href="#_cpu_extension_riscv_sdtrig"><em>CPU_EXTENSION_RISCV_Sdtrig</em></a> generics.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_risc_v_cpu_extensions">2.2.2. RISC-V CPU Extensions</h4>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Discovering ISA Extensions</div>
The configuration of the RISC-V ISA extensions (like <code>M</code>) can be determined via the <a href="#_misa"><strong><code>misa</code></strong></a> CSR. The configuration of
ISA <em>sub-extensions</em> (like <code>Zicsr</code>) and <em>tuning options</em> can be determined via the NEORV32-specific <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_b"><em>CPU_EXTENSION_RISCV_B</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_B</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>B</code> bit-manipulation ISA extension when true.
See section <a href="#_b_bit_manipulation_operations"><strong><code>B</code></strong> - Bit-Manipulation Operations</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_C</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>C</code> compressed instructions ISA extension when true.
See section <a href="#_c_compressed_instructions"><strong><code>C</code></strong> - Compressed Instructions</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_E</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>E</code> embedded CPU ISA extension when true.
See section <a href="#_e_embedded_cpu"><strong><code>E</code></strong> - Embedded CPU</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_M</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>M</code> hardware accelerators for integer multiplication and division ISA extension when true.
Multiplication can also be mapped to DSP slices via the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> generic.
See section <a href="#_m_integer_multiplication_and_division"><strong><code>M</code></strong> - Integer Multiplication and Division</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_U</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the less-privileged <code>U</code> user mode ISA extension when true.
See section <a href="#_u_less_privileged_user_mode"><strong><code>U</code></strong> - Less-Privileged User Mode</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zfinx</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zfinx</code> 32-bit single-precision floating-point ISA extension (using integer registers) when true.
See section <a href="#_zfinx_single_precision_floating_point_operations"><strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zicsr</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zicsr</code> control and status register (CSR) access ISA extension when true.
See section <a href="#_zicsr_control_and_status_register_access_privileged_architecture"><strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zicntr</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zicntr</code> basic CPU <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> ISA extension when true.
See section <a href="#_zicntr_cpu_base_counters"><strong><code>Zicntr</code></strong> CPU Base Counters</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zihpm</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zihpm</code> hardware performance monitor ISA extension when true.
See section <a href="#_zihpm_hardware_performance_monitors"><strong><code>Zihpm</code></strong> Hardware Performance Monitors</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zifencei</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zifencei</code> instruction fetch synchronization instruction ISA extension when true.
See section <a href="#_zifencei_instruction_stream_synchronization"><strong><code>Zifencei</code></strong> Instruction Stream Synchronization</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zmmul</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <code>Zmmul</code> integer multiplication-only ISA extension when true. This is a sub-extension of the <code>M</code> ISA extension.
See section <a href="#_zmmul_integer_multiplication"><strong><code>Zmmul</code></strong> - Integer Multiplication</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_extension_riscv_zxcfu"><em>CPU_EXTENSION_RISCV_Zxcfu</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Zxcfu</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the NEORV32-specific <code>Zxcfu</code> "custom RISC-V" ISA extension when true.
See section <a href="#_zxcfu_custom_instructions_extension_cfu"><strong><code>Zxcfu</code></strong> Custom Instructions Extension (CFU)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_tuning_options">2.2.3. Tuning Options</h4>
<div class="sect4">
<h5 id="_fast_mul_en"><em>FAST_MUL_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FAST_MUL_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">If this generic is enabled, the multiplier of the <code>M</code> extension is implemented using DSPs blocks instead of an
iterative bit-serial approach. Performance will be increased and LUT utilization will be reduced at the cost of DSP slice
utilization. This generic is only relevant when a hardware multiplier CPU extension is
enabled (<a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a> or <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> is <em>true</em>). Note that the multipliers of the
<a href="#_zfinx_single_precision_floating_point_operations"><strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</a> extension are always mapped to DSP block (if available).
The state of this generic can be retrieved by software via the <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_fast_shift_en"><em>FAST_SHIFT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FAST_SHIFT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">If this generic is enabled, the shifter unit of the CPU&#8217;s ALU is implemented as fast barrel shifter (requiring
more hardware resources but completing within two clock cycles). If disabled, the CPU uses a serial shifter
that only performs a single bit shift per cycle (requiring less hardware resources, but requires up to 32 clock
cycles). Note that this option also implements barrel shifters for <em>all</em> shift-related operations of the
<a href="#_b_bit_manipulation_operations"><strong><code>B</code></strong> - Bit-Manipulation Operations</a> extension.
The state of this generic can be retrieved by software via the <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_cpu_ipb_entries"><em>CPU_IPB_ENTRIES</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_IPB_ENTRIES</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This generic configures the number of entries in the CPU&#8217;s instruction prefetch buffer.
The value has to be a power of two and has to be greater than or equal to one (&gt;= 1). The
IPB can help improving memory access latency. Furthermore, long linear code sequences will
benefit from an increased IPB size.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the compressed ISA extension <code><em>CPU_EXTENSION_RISCV_C</em></code> (<a href="#_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></a>) is enabled and the IPB depth
is set to 1, this configuration is internally overridden and the IPB will be implemented with <strong>2</strong> entries. This is required
for handling unaligned 32-bit instructions.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_physical_memory_protection_pmp">2.2.4. Physical Memory Protection (PMP)</h4>
<div class="sect4">
<h5 id="_pmp_num_regions"><em>PMP_NUM_REGIONS</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PMP_NUM_REGIONS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Total number of implemented PMP regions (0..16). If this generics is zero no physical memory
protection logic will be implemented at all. See section <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PMP_MIN_GRANULARITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Minimal region granularity in bytes. Has to be a power of two and has to be at least 4 bytes. A larger granularity
will reduce hardware utilization and impact on critical path but will also reduce the minimal region size.
See section <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm">2.2.5. Hardware Performance Monitors (HPM)</h4>
<div class="sect4">
<h5 id="_hpm_num_cnts"><em>HPM_NUM_CNTS</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM_NUM_CNTS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Total number of implemented hardware performance monitor counters (0..29). If this generics is zero, no
hardware performance monitor logic will be implemented at all. Only relevant if <a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> is enabled.
See section <a href="#_zihpm_hardware_performance_monitors"><strong><code>Zihpm</code></strong> Hardware Performance Monitors</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPM_CNT_WIDTH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This generic defines the total LSB-aligned size of each HPM counter. The maximum value is 64, the minimal is 0.
If the size is less than 64-bit, the unused MSB-aligned counter bits are hardwired to zero. Only relevant if
<a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> is enabled. See section <a href="#_zihpm_hardware_performance_monitors"><strong><code>Zihpm</code></strong> Hardware Performance Monitors</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_instruction_memory">2.2.6. Internal Instruction Memory</h4>
<div class="sect4">
<h5 id="_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_IMEM_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement processor-internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> when true.
See sections <a href="#_address_space">Address Space</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_IMEM_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16*1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of the processor internal instruction memory (IMEM).
Has no effect when <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> is false.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_data_memory">2.2.7. Internal Data Memory</h4>
<div class="sect4">
<h5 id="_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_DMEM_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement processor-internal <a href="#_data_memory_dmem">Data Memory (DMEM)</a> when true.
See sections <a href="#_address_space">Address Space</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_INT_DMEM_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8*1024</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of the processor-internal data memory (DMEM).
Has no effect when <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> is false.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_internal_cache_memory">2.2.8. Internal Cache Memory</h4>
<div class="sect4">
<h5 id="_icache_en"><em>ICACHE_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a> when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_num_blocks"><em>ICACHE_NUM_BLOCKS</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_NUM_BLOCKS</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of blocks (cache "pages" or "lines") in the instruction cache. Has to be a power of two. Has no
effect when <a href="#_icache_en"><em>ICACHE_EN</em></a> is false.
Software can retrieve this value from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_BLOCK_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Size in bytes of each block in the instruction cache. Has to be a power of two. Has no effect when
<a href="#_icache_en"><em>ICACHE_EN</em></a> is false.
Software can retrieve this value from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ICACHE_ASSOCIATIVITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Associativity (= number of sets) of the instruction cache. Has to be a power of two. Allowed configurations:
<code>1</code> = 1 set, direct mapped; <code>2</code> = 2-way set-associative. Has no effect when <a href="#_icache_en"><em>ICACHE_EN</em></a> is false.
Software can retrieve this value from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> module.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_external_memory_interface">2.2.9. External Memory Interface</h4>
<div class="sect4">
<h5 id="_mem_ext_en"><em>MEM_EXT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a> when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_timeout"><em>MEM_EXT_TIMEOUT</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_TIMEOUT</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Clock cycles after which a pending external bus access will auto-terminate and raise a bus fault exception.
If set to zero, there will be no auto-timeout and no bus fault exception (might permanently stall system!).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_pipe_mode"><em>MEM_EXT_PIPE_MODE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_PIPE_MODE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Use <em>standard</em> ("classic") Wishbone protocol for external bus when false.
Use <em>pipelined</em> Wishbone protocol when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_BIG_ENDIAN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Use BIG endian interface for external bus when true. Use little endian interface when false.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_async_rx"><em>MEM_EXT_ASYNC_RX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_ASYNC_RX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolen</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">By default, <em>MEM_EXT_ASYNC_RX</em> = <em>false</em> implements a registered read-back path (RX) for incoming data in the bus interface
in order to shorten the critical path. By setting <em>MEM_EXT_ASYNC_RX</em> = <em>true</em> an <em>asynchronous</em> ("direct") read-back path is
implemented reducing access latency by one cycle but eventually increasing the critical path.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mem_ext_async_tx"><em>MEM_EXT_ASYNC_TX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEM_EXT_ASYNC_TX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolen</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">By default, <em>MEM_EXT_ASYNC_TX</em> = <em>false</em> implements register for all outgoing (TX) signals
in order to shorten the critical path. By setting <em>MEM_EXT_ASYNC_TX</em> = <em>true</em> an <em>asynchronous</em> ("direct") path is
implemented reducing access latency by one cycle but eventually increasing the critical path.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface">2.2.10. Stream Link Interface</h4>
<div class="sect4">
<h5 id="_slink_num_tx"><em>SLINK_NUM_TX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_NUM_TX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of TX (send) <a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> channels to implement. Valid values are 0..8.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_num_rx"><em>SLINK_NUM_RX</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_NUM_RX</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of RX (receive) <a href="#_stream_link_interface_slink">Stream Link Interface (SLINK)</a> channels to implement. Valid values are 0..8.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_tx_fifo"><em>SLINK_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Internal FIFO depth for all implemented TX links. Valid values are 1..32k and have to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_slink_rx_fifo"><em>SLINK_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>SLINK_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Internal FIFO depth for all implemented RX links. Valid values are 1..32k and have to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_external_interrupt_controller">2.2.11. External Interrupt Controller</h4>
<div class="sect4">
<h5 id="_xirq_num_ch"><em>XIRQ_NUM_CH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_NUM_CH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of channels of the <a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a>. Valid values are 0..32.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_TRIGGER_TYPE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Interrupt trigger type configuration (one bit for each IRQ channel): <code>0</code> = level-triggered, '1' = edge triggered.
<a href="#_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></a> generic is used to specify the actual level (high/low) or edge (falling/rising).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_xirq_trigger_polarity"><em>XIRQ_TRIGGER_POLARITY</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>XIRQ_TRIGGER_POLARITY</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Interrupt trigger polarity configuration (one bit for each IRQ channel): <code>0</code> = low-level/falling-edge,
'1' = high-level/rising-edge. <a href="#_xirq_trigger_type"><em>XIRQ_TRIGGER_TYPE</em></a> generic is used to specify the actual type (level or edge).</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_processor_peripheralio_modules">2.2.12. Processor Peripheral/IO Modules</h4>
<div class="sect4">
<h5 id="_io_gpio_en"><em>IO_GPIO_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_GPIO_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_mtime_en"><em>IO_MTIME_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_MTIME_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_en"><em>IO_UART0_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_rx_fifo"><em>IO_UART0_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART0 receiver FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart0_tx_fifo"><em>IO_UART0_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART0_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART0 transmitter FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_en"><em>IO_UART1_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">Secondary Universal Asynchronous Receiver and Transmitter (UART1)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_rx_fifo"><em>IO_UART1_RX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_RX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART1 receiver FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_uart1_tx_fifo"><em>IO_UART1_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_UART1_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">UART1 transmitter FIFO depth, has to be a power of two, minimum value is 1 (implementing simple double-buffering).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_spi_en"><em>IO_SPI_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_SPI_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_spi_fifo"><em>IO_SPI_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_SPI_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Depth of the <a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a> FIFO. Has to be zero or a power of two.
Maximum value is 32*1024.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_twi_en"><em>IO_TWI_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_TWI_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_two_wire_serial_interface_controller_twi">Two-Wire Serial Interface Controller (TWI)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_pwm_num_ch"><em>IO_PWM_NUM_CH</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_PWM_NUM_CH</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Number of channels of the <a href="#_pulse_width_modulation_controller_pwm">Pulse-Width Modulation Controller (PWM)</a> to implement (0..60)
The PWM controller is <em>not</em> implemented if zero.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_wdt_en"><em>IO_WDT_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_WDT_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a> module when true,</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_trng_en"><em>IO_TRNG_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_TRNG_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_true_random_number_generator_trng">True Random-Number Generator (TRNG)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_trng_fifo"><em>IO_TRNG_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_TRNG_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Defines the depth of the TRNG data FIFO. Minimal value is 1;, has to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_en"><em>IO_CFS_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_config"><em>IO_CFS_CONFIG</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_CONFIG</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x"00000000"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This is a "conduit" generic that can be used to pass user-defined <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> implementation flags to the custom
functions subsystem entity.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_in_size"><em>IO_CFS_IN_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_IN_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>positive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Defines the size of the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> input signal conduit (<code>cfs_in_i</code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_cfs_out_size"><em>IO_CFS_OUT_SIZE</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_CFS_OUT_SIZE</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>positive</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Defines the size of the <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a> output signal conduit (<code>cfs_out_o</code>).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_neoled_en"><em>IO_NEOLED_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_NEOLED_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> module (WS2812 / NeoPixel&#8482;-compatible) when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_neoled_tx_fifo"><em>IO_NEOLED_TX_FIFO</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_NEOLED_TX_FIFO</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>natural</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">TX FIFO depth of the the <a href="#_smart_led_interface_neoled">Smart LED Interface (NEOLED)</a> module. Minimal value is 1, maximal value is 32k, has to be a power of two.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_gptmr_en"><em>IO_GPTMR_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_GPTMR_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement <a href="#_general_purpose_timer_gptmr">General Purpose Timer (GPTMR)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_xip_en"><em>IO_XIP_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_XIP_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> module when true.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_io_onewire_en"><em>IO_ONEWIRE_EN</em></h5>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IO_ONE_EN</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement the <a href="#_one_wire_serial_interface_controller_onewire">One-Wire Serial Interface Controller (ONEWIRE)</a> module when true.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_clocking">2.3. Processor Clocking</h3>
<div class="paragraph">
<p>The processor is implemented as fully-synchronous logic design using a <em>single clock domain</em> that is driven by the top&#8217;s
<code>clk_i</code> signal. This clock signal is used by all internal registers and memories, which trigger on the rising edge of
this clock signal. External "clocks" like the OCD&#8217;s JTAG clock or the TWI&#8217;s serial clock are synchronized into the
processor&#8217;s clock domain before being further processed.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The registers of the <a href="#_processor_reset">Processor Reset</a> system trigger on a falling clock edge.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Many processor modules like the UARTs or the timers require a programmable time base for operations. In order to simplify
the hardware, the processor implements a global "clock generator" that provides <em>clock enables</em> for certain frequencies.
These clock enable signals are synchronous to the system&#8217;s main clock and will be high for only a single cycle of this main
clock. Hence, processor modules can use these signals for sub-main-clock operations while still having a single clock domain
only.</p>
</div>
<div class="paragraph">
<p>In total, 8 sub-main-clock signals are available. All processor modules, which feature a time-based configuration, provide a
programmable three-bit prescaler select in their according control register to select one of the 8 available clocks. The
mapping of the prescaler select bits to the according clock source is shown in the table below. Here, <em>f</em> represents the
processor main clock from the top entity&#8217;s <code>clk_i</code> signal.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 27.2727%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.0909%;">
<col style="width: 9.091%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Prescaler bits:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b010</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b011</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b100</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b101</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b110</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0b111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting clock:</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/8</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/64</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/128</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/1024</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/2048</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>f/4096</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The software framework provides pre-defined aliases for the prescaler select bits:</p>
</div>
<div class="listingblock">
<div class="title">Listing 1. Prescaler Aliases from <code>neorv32.h</code></div>
<div class="content">
<pre class="highlight"><code>enum NEORV32_CLOCK_PRSC_enum {
  CLK_PRSC_2    = 0, /**&lt; CPU_CLK (from clk_i top signal) / 2 */
  CLK_PRSC_4    = 1, /**&lt; CPU_CLK (from clk_i top signal) / 4 */
  CLK_PRSC_8    = 2, /**&lt; CPU_CLK (from clk_i top signal) / 8 */
  CLK_PRSC_64   = 3, /**&lt; CPU_CLK (from clk_i top signal) / 64 */
  CLK_PRSC_128  = 4, /**&lt; CPU_CLK (from clk_i top signal) / 128 */
  CLK_PRSC_1024 = 5, /**&lt; CPU_CLK (from clk_i top signal) / 1024 */
  CLK_PRSC_2048 = 6, /**&lt; CPU_CLK (from clk_i top signal) / 2048 */
  CLK_PRSC_4096 = 7  /**&lt; CPU_CLK (from clk_i top signal) / 4096 */
};</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If no peripheral modules requires a clock signal from the internal generator (all available modules disabled by clearing the
<em>enable</em> bit in the according module&#8217;s control register), it is automatically deactivated to reduce dynamic power consumption.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_reset">2.4. Processor Reset</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Processor Reset Signal</div>
Always make sure to connect the processor&#8217;s reset signal <code>rstn_i</code> to a valid reset source (a button, the "locked"
signal of a PLL, a dedicated reset controller, etc.). <strong>Do not assign a static value / connect a static signal to it!</strong>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The processor-wide reset can be triggered at any of the following sources:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the asynchronous low-active <code>rstn_i</code> top entity input signal</p>
</li>
<li>
<p>the <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a></p>
</li>
<li>
<p>the <a href="#_watchdog_timer_wdt">Watchdog Timer (WDT)</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If any of these sources trigger a reset, the internal reset will be triggered for at least clock cycles resetting
the CPU, the <a href="#_processor_clocking">Processor Clocking</a> system and the IO/peripheral devices. The internal reset is asserted
<em>aysynchronoulsy</em> if triggered by the external <code>rstn_i</code> signal. For internal sources, the global reset is asserted
<em>synchronously</em>. If the reset cause gets inactive the internal reset is de-asserted <em>synchronously</em> at a falling
clock edge.</p>
</div>
<div class="paragraph">
<p>Internally, all processor registers that actually do provide a hardware reset use an <strong>asynchronous reset</strong>. Using a
synchronous reset might increase logic utilization (and might increase the critical path) for FPGAs that do not provide a
"native" synchronous reset for their flip flops. Furthermore, an asynchronous reset ensures that the
entire processor logic is reset to a defined state even if the main clock is not yet operational.</p>
</div>
<div class="paragraph">
<p>In order to reduce routing constraints (and by this the actual hardware requirements), some <em>uncritical registers</em>
of the NEORV32 CPU as well as many registers of the entire NEORV32 Processor <strong>do not use a dedicated hardware reset</strong>.
For example there are several pipeline registers and "buffer" registers that do not require a defined
initial state to ensure correct operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The system reset will only reset the control registers of each implemented IO/peripheral module. This control register
reset will also reset the according "module enable flag" to zero, which - in turn - will cause a <em>synchronous</em>
module-internal reset of the remaining logic.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_processor_interrupts">2.5. Processor Interrupts</h3>
<div class="paragraph">
<p>The NEORV32 Processor provides several interrupt request signals (IRQs) for custom platform use.</p>
</div>
<div class="sect3">
<h4 id="_risc_v_standard_interrupts">2.5.1. RISC-V Standard Interrupts</h4>
<div class="paragraph">
<p>The processor setup features the standard machine-level RISC-V interrupt lines for "machine timer interrupt", "machine
software interrupt" and "machine external interrupt". Their usage is defined by the RISC-V privileged architecture
specifications. However, bare-metal system can also repurpose these interrupts. See CPU section
<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 12.5%;">
<col style="width: 68.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine timer interrupt from <em>processor-external</em> MTIME unit (<em>MTI</em>). This IRQ is only available if the processor-internal MTIME unit is not used (<a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a> = false).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine software interrupt (<em>MSI</em>). This interrupt is used for inter-processor interrupts in multi-core systems. However, it can also be used for any custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine external interrupt (<em>MEI</em>). This interrupt is used for any processor-external interrupt source (like a platform interrupt controller).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
The RISC-V standard interrupts are <strong>level-triggered and high-active</strong>. Once set the signal has to stay high until
the interrupt request is explicitly acknowledged (e.g. writing to a memory-mapped register). The RISC-V standard interrupts
can <strong>NOT</strong> be acknowledged by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_fast_interrupt_requests">2.5.2. NEORV32-Specific Fast Interrupt Requests</h4>
<div class="paragraph">
<p>As part of the NEORV32-specific CPU extensions, the CPU core features 16 fast interrupt request signals
(<code>FIRQ0</code> - <code>FIRQ15</code>) with dedicated bits in the <a href="#_mip"><strong><code>mip</code></strong></a> and <a href="#_mie"><strong><code>mie</code></strong></a> CSRs and custom <a href="#_mcause"><strong><code>mcause</code></strong></a> trap codes.
The FIRQ signals are reserved for <em>processor-internal</em> modules only (for example for the communication
interfaces to signal "available incoming data" or "ready to send new data").</p>
</div>
<div class="paragraph">
<p>The mapping of the 16 FIRQ channels and the according processor-internal modules is shown in the following
table (the channel number also corresponds to the according FIRQ priority: 0 = highest, 15 = lowest):</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 5. NEORV32 Fast Interrupt Request (FIRQ) Mapping</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 20%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Channel</th>
<th class="tableblock halign-left valign-top">Source</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_watchdog_timer_wdt">WDT</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timeout interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_custom_functions_subsystem_cfs">CFS</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom functions subsystem (CFS) interrupt (user-defined)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 data received interrupt (RX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART0 sending done interrupt (TX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 data received interrupt (RX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_secondary_universal_asynchronous_receiver_and_transmitter_uart1">UART1</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART1 sending done interrupt (TX complete)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_serial_peripheral_interface_controller_spi">SPI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI transmission done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_two_wire_serial_interface_controller_twi">TWI</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI transmission done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_external_interrupt_controller_xirq">XIRQ</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External interrupt controller interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_smart_led_interface_neoled">NEOLED</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED TX buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">SLINK</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_stream_link_interface_slink">SLINK</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data buffer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_general_purpose_timer_gptmr">GPTMR</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">General purpose timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_one_wire_serial_interface_controller_onewire">ONEWIRE</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-wire operation done interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, will never fire</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
The fast interrupt request channels become pending after being triggering by <strong>a rising edge</strong>. A pending FIRQ has to
be explicitly cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_platform_external_interrupts">2.5.3. Platform External Interrupts</h4>
<div class="paragraph">
<p>The processor provides an optional interrupt controller for up to 32 user-defined external interrupts
(see section <a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a>). These external IRQs are mapped to a <em>single</em> CPU
fast interrupt request so a software handler is required to differentiate / prioritize these interrupts.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 18.75%;">
<col style="width: 12.5%;">
<col style="width: 68.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Top signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">up to 32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">External platform interrupts (user-defined).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Trigger Type</div>
The trigger for these interrupt can be defined via generics. See section
<a href="#_external_interrupt_controller_xirq">External Interrupt Controller (XIRQ)</a> for more information. Depending on the trigger type, users can
implement custom acknowledge mechanisms. All <em>external interrupts</em> are mapped to a single processor-internal
<em>fast interrupt request</em> (see below).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_address_space">2.6. Address Space</h3>
<div class="paragraph">
<p>As a 32-bit architecture the NEORV32 provides a 4GB physical address space. By default, this address space is
divided into five main regions with each region having a specific function:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Instruction address space</strong>: memory address space for instructions (=code) and constants.
A configurable section of this address space can used by the <em>instruction memory</em> (<a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a>).</p>
</li>
<li>
<p><strong>Data address space</strong>: memory address space for application runtime data (heap, stack, etc.).
A configurable section of this address space can be used by the <em>data memory</em> (<a href="#_data_memory_dmem">Data Memory (DMEM)</a>).</p>
</li>
<li>
<p><strong>Bootloader address space</strong>: a <em>fixed</em> section of this address space is used by the
internal <em>bootloader memory</em> (BOOTLDROM).</p>
</li>
<li>
<p><strong>On-Chip Debugger address space</strong>: this <em>fixed</em> section is entirely used by the processor&#8217;s <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>.</p>
</li>
<li>
<p><strong>IO/peripheral address space</strong>: also a <em>fixed</em> section used for the processor-internal memory-mapped IO/peripheral devices (e.g., UART).</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/address_space.png" alt="900">
</div>
<div class="title">Figure 1. NEORV32 processor - address space (default configuration)</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Region Overlap</div>
By default, there is no overlap between the different regions. However, the NEORV32 is a modified Harvard Architecture (same address space
for instructions and data) so the instruction and data address spaces may also overlap. See section <a href="#_address_space_layout">Address Space Layout</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">RAM Layout - Usage of the Data Address Space</div>
The actual usage of the data address space by the software/executables (stack, heap, &#8230;&#8203;) is
illustrated in section <a href="#_ram_layout">RAM Layout</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_physical_memory_attributes_pmas">2.6.1. Physical Memory Attributes (PMAs)</h4>
<div class="paragraph">
<p>Each default region of the NEORV32 address space provides specific physical memory attributes that define the allowed access types
to each of these regions. These "access permission" are enforced by the hardware and cannot be changed. If an access violates the
PMA&#8217;s permissions an exception is raised. The access permissions can be further constrained using the CPU&#8217;s <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a>.</p>
</div>
<div class="paragraph">
<p>The following access types are checked by the hardware (if an access type is present in a region&#8217;s PMA the access is permitted):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>r</code> - data read access</p>
</li>
<li>
<p><code>w</code> - data write access</p>
</li>
<li>
<p><code>x</code> - instruction fetch access ("execute")</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 28.5714%;">
<col style="width: 14.2857%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">#</th>
<th class="tableblock halign-center valign-top">Region Description</th>
<th class="tableblock halign-center valign-top">PMAs</th>
<th class="tableblock halign-left valign-top">Note</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Instruction address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r(w)x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Write accesses to the the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> can be disabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Data address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rwx</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code can also be executed from data memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Bootloader address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>r-x</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read-only memory.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">On-Chip Debugger address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>---</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Not accessible at all by "normal" software - accessible only when the CPU is in <a href="#_cpu_debug_mode">CPU Debug Mode</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">IO/peripheral address space</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rw-</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Read/write accesses only.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_data_and_instruction_access">2.6.2. CPU Data and Instruction Access</h4>
<div class="paragraph">
<p>The CPU can access all of the 32-bit address space from the instruction fetch interface (<strong>I</strong>) and also from the
data access interface (<strong>D</strong>). These two CPU interfaces are multiplexed by a simple bus switch
(<code>rtl/core/neorv32_busswitch.vhd</code>) into a <em>single</em> processor-internal bus. All processor-internal
memories, peripherals and also the external memory interface are connected to this bus. Hence, both CPU
interfaces (instruction fetch &amp; data access) have access to the same (<em>identical!</em>) address space making the
setup a <strong>modified von-Neumann architecture</strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_bus.png" alt="1300">
</div>
<div class="title">Figure 2. Processor-internal bus architecture</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The internal processor bus might appear as bottleneck. In order to reduce traffic jam on this bus
(when instruction fetch and data interface access the bus at the same time) the instruction fetch of
the CPU is equipped with a prefetch buffer. Instruction fetches can be further buffered using the i-cache.
Furthermore, data accesses (loads and stores) have higher priority than instruction fetch
accesses.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See sections <a href="#_architecture">Architecture</a> and <a href="#_bus_interface">Bus Interface</a> for more information regarding the CPU bus accesses.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_address_space_layout">2.6.3. Address Space Layout</h4>
<div class="paragraph">
<p>The general address space layout consists of two main configuration constants: <code>ispace_base_c</code> defining
the base address of the <em>instruction memory address space</em> and <code>dspace_base_c</code> defining the base address of
the <em>data memory address space</em>. Both constants are defined in the NEORV32 VHDL package file
<code>rtl/core/neorv32_package.vhd</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">-- Architecture Configuration ----------------------------------------------------
-- ----------------------------------------------------------------------------------
constant ispace_base_c : std_ulogic_vector(31 downto 0) := x"00000000";
constant dspace_base_c : std_ulogic_vector(31 downto 0) := x"80000000";</code></pre>
</div>
</div>
<div class="paragraph">
<p>The default configuration assumes the <em>instruction memory address space</em> starting at address <em>0x00000000</em>
and the <em>data memory address space</em> starting at <em>0x80000000</em>. Both values can be modified for a specific
setup and the address space may overlap or can be completely identical. Make sure that both base addresses
are <em>aligned</em> to a 4-byte boundary.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The base address of the internal bootloader (at <em>0xFFFF0000</em>) and the internal IO region (at <em>0xFFFFFE00</em>) for
peripheral devices are also defined in the package and are fixed. These address regions cannot not be used for other
applications - even if the bootloader or all IO devices are not implemented - without modifying the core&#8217;s
hardware sources.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_memory_configuration">2.6.4. Memory Configuration</h4>
<div class="paragraph">
<p>The NEORV32 Processor was designed to provide maximum flexibility for the memory configuration.
The processor can populate the <em>instruction address space</em> and/or the <em>data address space</em> with <strong>internal memories</strong>
for instructions (IMEM) and data (DMEM). Processor <strong>external memories</strong> can be used as an <em>alternative</em> or even <em>in combination</em> with
the internal ones. The figure below show some exemplary memory configurations.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_memory_configurations.png" alt="800">
</div>
<div class="title">Figure 3. Exemplary memory configurations</div>
</div>
<div class="sect4">
<h5 id="_internal_memories">Internal Memories</h5>
<div class="paragraph">
<p>The processor-internal memories (<a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> and <a href="#_data_memory_dmem">Data Memory (DMEM)</a>) are enabled (=implemented)
via the <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> and <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> generics. Their sizes are configures via the according
<a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> and <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generics.</p>
</div>
<div class="paragraph">
<p>If the processor-internal IMEM is implemented, it is located right at the base address of the instruction
address space (default <code>ispace_base_c</code> = <em>0x00000000</em>). Vice versa, the processor-internal data memory is
located right at the beginning of the data address space (default <code>dspace_base_c</code> = <em>0x80000000</em>) when
implemented.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the IMEM (internal or external) is less than the (default) maximum size (2GB), there is
a "dead address space" between it and the DMEM. This provides an additional safety feature
since data corrupting scenarios like stack overflow cannot directly corrupt the content of the IMEM:
any access to the "dead address space" in between will raise an exception that can be caught
by the runtime environment.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_external_memories">External Memories</h5>
<div class="paragraph">
<p>If external memories (or further IP modules) shall be connected via the <em>processor&#8217;s external bus interface</em>,
the interface has to be enabled via <a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a> generic (=<em>true</em>). More information regarding this interface can be
found in section <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>.</p>
</div>
<div class="paragraph">
<p>Any CPU access (data or instructions), which does not fulfill <em>at least one</em> of the following conditions, is forwarded
via the processor&#8217;s bus interface to external components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>access to the processor-internal IMEM and processor-internal IMEM is implemented</p>
</li>
<li>
<p>access to the processor-internal DMEM and processor-internal DMEM is implemented</p>
</li>
<li>
<p>access to the bootloader ROM and beyond &#8594; addresses &gt;= <em>BOOTROM_BASE</em> (default 0xFFFF0000) will never be forwarded to the external memory interface</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the Execute In Place module (XIP) is implemented accesses map to this module are not forwarded to the
external memory interface. See section <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If no (or not all) processor-internal memories are implemented, the according base addresses are mapped to external memories.
For example, if the processor-internal IMEM is not implemented (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>), the processor will forward
any access to the instruction address space (starting at <code>ispace_base_c</code>) via the external bus interface to the external
memory system.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the external interface is deactivated, any access exceeding the internal memory address space (instruction, data, bootloader) or
the internal peripheral address space will trigger a bus access fault exception.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_boot_configuration">2.6.5. Boot Configuration</h4>
<div class="paragraph">
<p>Due to the flexible memory configuration concept, the NEORV32 Processor provides several different boot concepts.
The figure below shows the exemplary concepts for the two most common boot scenarios.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/neorv32_boot_configurations.png" alt="800">
</div>
<div class="title">Figure 4. NEORV32 boot configurations</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration of internal or external data memory (DMEM; <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> = <em>true</em> / <em>false</em>) is not
relevant for the boot configuration itself. Hence, it is not further illustrated here.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>There are two general boot scenarios: <em>Indirect Boot</em> (1a and 1b) and <em>Direct Boot</em> (2a and 2b) configured via the
<a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic. If this generic is set <strong>true</strong> the <em>indirect</em> boot scenario is used. This is also the
default boot configuration of the processor. If <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> is set <strong>false</strong> the <em>direct</em> boot scenario is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Please note that the provided boot scenarios are just exemplary setups that (should) fit most common requirements.
Much more sophisticated boot scenarios are possible by combining internal and external memories. For example, the default
internal bootloader could be used as first-level bootloader that loads (from extern SPI flash) a second-level bootloader
that is placed and execute in internal IMEM. This second-level bootloader could then fetch the actual application and
store it to external <em>data</em> memory and transfers CPU control to that.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_indirect_boot">Indirect Boot</h5>
<div class="paragraph">
<p>The <em>indirect</em> boot scenarios <strong>1a</strong> and <strong>1b</strong> use the processor-internal <a href="#_bootloader">Bootloader</a>. This boot setup is enabled
by setting the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic to <em>true</em>, which will implement the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a>.
This read-only memory is pre-initialized during synthesis with the default bootloader firmware.
The bootloader provides several options to upload an executable (via UART or from external SPI flash) and copies it to
the beginning of the <em>instruction address space</em> so the CPU can execute it.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>1a</strong> uses the processor-internal IMEM
(<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>true</em>). This scenario implements the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> as non-initialized
RAM so the bootloader can copy the actual executable to it.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>1b</strong> uses a processor-external IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>) that is connected via the processor&#8217;s
bus interface. In this scenario the internal <a href="#_instruction_memory_imem">Instruction Memory (IMEM)</a> is not implemented at all and the bootloader will
copy the executable to the processor-external memory. Hence, the external memory has to be implemented as RAM.</p>
</div>
</div>
<div class="sect4">
<h5 id="_direct_boot">Direct Boot</h5>
<div class="paragraph">
<p>The <em>direct</em> boot scenarios <strong>2a</strong> and <strong>2b</strong> do not use the processor-internal bootloader since the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a>
generic is set <em>false</em>. In this configuration the <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> is not implemented at all and the CPU will
directly begin executing code from the beginning of the instruction address space after reset. An application-specific
"pre-initialization" mechanism is required in order to provide an executable <em>in</em> memory.</p>
</div>
<div class="paragraph">
<p>Boot scenario <strong>2a</strong> uses the processor-internal IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>true</em>) that is implemented as <em>read-only memory</em>
in this scenario. It is pre-initialized (by the bitstream) with the actual application executable during synthesis.</p>
</div>
<div class="paragraph">
<p>In contrast, boot scenario <strong>2b</strong> uses a processor-external IMEM (<a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> = <em>false</em>). In this scenario the
system designer is responsible for providing an initialized external memory that contains the actual application to be executed.
If the external memory is not already initialized after reset, a simple ROM containing a "polling loop" can be implemented that is
exited as soon as the application logic has finished initializing the memory with the actual application code.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_processor_internal_modules">2.7. Processor-Internal Modules</h3>
<div class="paragraph">
<p>Basically, the NEORV32 processor is a SoC consisting of the NEORV32 CPU, peripheral/IO devices, embedded
memories, an external memory interface and a bus infrastructure to interconnect all units. Additionally, the
system implements an internal reset generator (&#8594; <a href="#_processor_reset">Processor Reset</a>) and a global clock system (&#8594; <a href="#_processor_clocking">Processor Clocking</a>).</p>
</div>
<div class="paragraph">
<p><strong>Peripheral / IO Devices</strong></p>
</div>
<div class="paragraph">
<p>The processor-internal peripheral/IO devices are located at the end of the 32-bit address space at base
address <em>0xFFFFFE00</em>. A region of 512 bytes is reserved for this devices. Hence, all peripheral/IO devices are
accessed using a memory-mapped scheme. A special linker script as well as the NEORV32 core software
library abstract the specific memory layout for the user.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Module Address Space Mapping</div>
The base address of each component/module has to be aligned to the
total size of the module&#8217;s occupied address space! The occupied address space
has to be a power of two (minimum 4 bytes)! Address spaces must not overlap!
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Full-Word Write Accesses Only</div>
All peripheral/IO devices can only be written in full-word mode (i.e. 32-bit). Byte or half-word
(8/16-bit) writes will trigger a store access fault exception. Read accesses are not size constrained.
Processor-internal memories as well as modules connected to the external memory interface can still
be written with a byte-wide granularity.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unimplemented Modules / "Address Holes"</div>
When accessing an IO device that hast not been implemented (disabled via the according generic)
or when accessing an address that is <em>unused</em>, a load or store access fault exception is raise.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Module Reset</div>
All processor-internal modules provide a dedicated hardware reset, which is triggered by the <a href="#_processor_reset">Processor Reset</a>
system. When active, the system-wide reset will reset all module&#8217;s <em>control registers</em> to all-zero. Note that this
hardware reset does not <em>directly</em> reset the remaining module&#8217;s logic - the internal logic is reset <em>synchronously</em> when the
enable bit in the according unit&#8217;s control register is cleared. Software can trigger a module reset
by clearing the enable bit of the module&#8217;s control register. See section <a href="#_processor_reset">Processor Reset</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Latency of Processor-Internal Modules</div>
By default all processor internal modules (memories and peripherals) have a fixed access latency of one clock cycle.
However, a custom version of any module may also have higher access latency. See section <a href="#_bus_interface">Bus Interface</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Access</div>
Use the provided <a href="#_core_libraries">Core Libraries</a> to interact with the peripheral devices. This
prevents incompatibilities with future versions, since the hardware driver functions handle all the
register and register bit accesses.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CMSIS System Description View (SVD)</div>
A CMSIS-SVD-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupts of Processor-Internal Modules</strong></p>
</div>
<div class="paragraph">
<p>Most peripheral/IO devices provide some kind of interrupt (for example to signal available incoming data). These
interrupts are entirely mapped to the CPU&#8217;s <a href="#_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</a>. Note that all these
interrupt lines are high-active and are permanently triggered until the IRQ-causing condition is resolved.
See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.</p>
</div>
<div class="paragraph">
<p><strong>Nomenclature for Peripheral / IO Devices Listing</strong></p>
</div>
<div class="paragraph">
<p>Each peripheral device chapter features a register map showing accessible control and data registers of the
according device including the implemented control and status bits. C-language code can directly interact with these
registers via pre-defined <code>struct</code>. Each IO/peripheral module provides a unique <code>struct</code>. All accessible
interface registers of this module are defined as members of this <code>struct</code>. The pre-defined <code>struct</code> are defined int the
main processor core library include file <code>sw/lib/include/neorv32.h</code>.</p>
</div>
<div class="paragraph">
<p>The naming scheme of these low-level hardware access structs is <code>NEORV32_&lt;module_name&gt;.&lt;register_name&gt;</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 2. Low-level hardware access example in C using the pre-defined <code>struct</code></div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// Read from SYSINFO "CLK" register
uint32_t temp = NEORV32_SYSINFO.CLK;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The registers and/or register bits, which can be accessed directly using plain C-code, are marked with a "[C]".
Not all registers or register bits can be arbitrarily read/written. The following read/write access types are
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>r/w</code> registers / bits can be read and written</p>
</li>
<li>
<p><code>r/-</code> registers / bits are read-only; any write access to them has no effect</p>
</li>
<li>
<p><code>-/w</code> these registers / bits are write-only; they auto-clear in the next cycle and are always read as zero</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bits / registers that are not listed in the register map tables are not (yet) implemented. These registers
/ bits are always read as zero. A write access to them has no effect, but user programs should only
write zero to them to keep compatible with future extension.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When writing to read-only registers, the access is nevertheless acknowledged, but no actual data is
written. When reading data from a write-only register the result is undefined.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_instruction_memory_imem">2.7.1. Instruction Memory (IMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_imem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_imem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_IMEM_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal IMEM when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_IMEM_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM size in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>INT_BOOTLOADER_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use internal bootloader when <em>true</em> (implements IMEM as <em>uninitialized</em> RAM, otherwise the IMEM is implemented an <em>pre-intialized</em> ROM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Implementation of the processor-internal instruction memory is enabled via the processor&#8217;s
<em>MEM_INT_IMEM_EN</em> generic. The size in bytes is defined via the <em>MEM_INT_IMEM_SIZE</em> generic. If the
IMEM is implemented, the memory is mapped into the instruction memory space and located right at the
beginning of the instruction memory space (default <code>ispace_base_c</code> = 0x00000000).</p>
</div>
<div class="paragraph">
<p>By default the IMEM is implemented as true RAM so the content can be modified during run time. This is
required when using a bootloader that can update the content of the IMEM at any time. If you do not need
the bootloader anymore - since your application development has completed and you want the program to
permanently reside in the internal instruction memory - the IMEM is automatically implemented as <em>pre-intialized</em>
ROM when the processor-internal bootloader is disabled (<em>INT_BOOTLOADER_EN</em> = <em>false</em>).</p>
</div>
<div class="paragraph">
<p>When the IMEM is implemented as ROM, it will be initialized during synthesis (actually, by the bitstream)
with the actual application program image. The compiler toolchain will generate a VHDL initialization
file <code>rtl/core/neorv32_application_image.vhd</code>, which is automatically inserted into the IMEM. If
the IMEM is implemented as RAM (default), the memory will <strong>not be initialized at all</strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Latency</div>
By default, the IMEM has a fixed access latency of one clock cycle (like all other processor-internal
modules). However, custom versions of this module may also have higher access latency. See section <a href="#_bus_interface">Bus Interface</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">VHDL Source File</div>
The actual IMEM is split into two design files: a plain entity definition (<code>neorv32_imem.entity.vhd</code>) and the actual
architecture definition (<code>mem/neorv32_imem.default.vhd</code>). This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory block. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read-Only Access</div>
If the IMEM is implemented as true ROM any write attempt to it will raise a <em>store access fault</em> exception.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_data_memory_dmem">2.7.2. Data Memory (DMEM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_dmem.entity.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entity-only definition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mem/neorv32_dmem.default.vhd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default <em>platform-agnostic</em> memory architecture</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_DMEM_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal DMEM when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_INT_DMEM_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM size in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Implementation of the processor-internal data memory is enabled via the processor&#8217;s <em>MEM_INT_DMEM_EN</em>
generic. The size in bytes is defined via the <em>MEM_INT_DMEM_SIZE</em> generic. If the DMEM is implemented,
the memory is mapped into the data memory space and located right at the beginning of the data memory
space (default <code>dspace_base_c</code> = 0x80000000). The DMEM is always implemented as true RAM.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Latency</div>
By default, the DMEM has a fixed access latency of one clock cycle (like all other processor-internal
modules). However, custom versions of this module may also have higher access latency. See section <a href="#_bus_interface">Bus Interface</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">VHDL Source File</div>
The actual DMEM is split into two design files: a plain entity definition (<code>neorv32_dmem.entity.vhd</code>) and the actual
architecture definition (<code>mem/neorv32_dmem.default.vhd</code>). This <strong>default architecture</strong> provides a <em>generic</em> and
<em>platform independent</em> memory design that (should) infers embedded memory block. You can replace/modify the architecture
source file in order to use platform-specific features (like advanced memory resources) or to improve technology mapping
and/or timing.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Execute from RAM</div>
The CPU is capable of executing code also from DMEM.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_bootloader_rom_bootrom">2.7.3. Bootloader ROM (BOOTROM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_boot_rom.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>INT_BOOTLOADER_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal bootloader when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default <code>neorv32_boot_rom.vhd</code> HDL source file provides a <em>generic</em> memory design that infers embedded
memory for <em>larger</em> memory configurations. You might need to replace/modify the source file in order to use
platform-specific features (like advanced memory resources) or to improve technology mapping and/or timing.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This HDL modules provides a read-only memory that contain the executable code image of the bootloader.
If the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic is <em>true</em> this module will be implemented and the CPU boot address
is modified to directly execute the code from the bootloader ROM after reset.</p>
</div>
<div class="paragraph">
<p>The bootloader ROM is located at address <code>0xFFFF0000</code> and can occupy a address space of up to 32kB. The base
address as well as the maximum address space size are fixed and cannot (should not!) be modified as this
might address collision with other processor modules.</p>
</div>
<div class="paragraph">
<p>The bootloader memory is <em>read-only</em> and is automatically initialized with the bootloader executable image
<code>rtl/core/neorv32_bootloader_image.vhd</code> during synthesis. The actual <em>physical</em> size of the ROM is also
determined via synthesis and expanded to the next power of two. For example, if the bootloader code requires
10kB of storage, a ROM with 16kB will be generated. The maximum size must not exceed 32kB.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Latency</div>
By default, the bootloader ROM has a fixed access latency of one clock cycle (like all other processor-internal
modules). However, custom versions of this module may also have higher access latency. See section <a href="#_bus_interface">Bus Interface</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read-Only Access</div>
Any write access to the BOOTROM will raise a <em>store access fault</em> exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Bootloader - Software</div>
See section <a href="#_bootloader">Bootloader</a> for more information regarding the actual bootloader software/executable itself.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Boot Configuration</div>
See section <a href="#_boot_configuration">Boot Configuration</a> for more information regarding the processor&#8217;s different boot scenarios.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_internal_instruction_cache_icache">2.7.4. Processor-Internal Instruction Cache (iCACHE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_icache.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement processor-internal instruction cache when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_NUM_BLOCKS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of cache blocks (pages/lines)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_BLOCK_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of a cache block in bytes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>ICACHE_ASSOCIATIVITY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">associativity / number of sets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The processor features an optional cache for instructions to improve performance when using memories with high
access latencies. The cache is directly connected to the CPU&#8217;s instruction fetch interface and provides
full-transparent buffering of instruction fetch accesses to the entire address space.</p>
</div>
<div class="paragraph">
<p>The cache is implemented if the <em>ICACHE_EN</em> generic is true. The size of the cache memory is defined via
<em>ICACHE_BLOCK_SIZE</em> (the size of a single cache block/page/line in bytes; has to be a power of two and &gt;=
4 bytes), <em>ICACHE_NUM_BLOCKS</em> (the total amount of cache blocks; has to be a power of two and &gt;= 1) and
the actual cache associativity <em>ICACHE_ASSOCIATIVITY</em> (number of sets; 1 = direct-mapped, 2 = 2-way set-associative,
has to be a power of two and &gt;= 1). If the cache associativity (<em>ICACHE_ASSOCIATIVITY</em>) is greater than one
the LRU replacement policy (least recently used) is used.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Cache Memory HDL</div>
The default <code>neorv32_icache.vhd</code> HDL source file provides a <em>generic</em> memory design that infers embedded
memory. You might need to replace/modify the source file in order to use platform-specific features
(like advanced memory resources) or to improve technology mapping and/or timing. Also, keep the features
of the targeted FPGA&#8217;s memory resources (block RAM) in mind when configuring
the cache size/layout to maximize and optimize resource utilization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Caching Internal Memories</div>
The instruction cache is intended to accelerate instruction fetches from <em>processor-external</em> memories
(via the external bus interface or via the XIP module).
Since all processor-internal memories provide an access latency of one cycle (by default), caching
internal memories does not bring a relevant performance gain. However, it will slightly reduce traffic on the
processor-internal bus.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Manual Cache Clear/Reload</div>
By executing the <code>ifence.i</code> instruction (<code>Zifencei</code> CPU extension) the cache is cleared and a reload from
main memory is triggered. This also allows to implement self-modifying code.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Retrieve Cache Configuration from Software</div>
Software can retrieve the cache configuration/layout from the <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a> register.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Bus Access Fault Handling</strong></p>
</div>
<div class="paragraph">
<p>The cache always loads a complete cache block (<em>ICACHE_BLOCK_SIZE</em> bytes; aligned to the block size) every time a
cache miss is detected. Each cached word from this block provides a single status bit that indicates if the
according bus access was successful or caused a bus error. Hence, the whole cache block remains valid even
if certain addresses inside caused a bus error. If the CPU accesses any of the faulty cache words, an
instruction access error exception is raised.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_processor_external_memory_interface_wishbone_axi4_lite">2.7.5. Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wishbone.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>implicitly used</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_tag_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request tag output (3-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_adr_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">address output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_we_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write enable (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_sel_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable (4-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_stb_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">strobe (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_cyc_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">valid cycle (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_ack_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">acknowledge (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>wb_err_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus error (1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fence_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fencei_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">an executed <code>fence.i</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable external memory interface when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_TIMEOUT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of clock cycles after which an unacknowledged external bus access will auto-terminate (0 = disabled)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_PIPE_MODE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when <em>false</em> (default): classic/standard Wishbone protocol; when <em>true</em>: pipelined Wishbone protocol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_BIG_ENDIAN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte-order (Endianness) of external memory interface; true=BIG, false=little (default)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_ASYNC_RX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use registered RX path when <em>false</em> (default); use async/direct RX path when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>MEM_EXT_ASYNC_TX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">use registered TX path when <em>false</em> (default); use async/direct TX path when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The external memory interface provides a Wishbone b4-compatible on-chip bus interface. The bus interface is
implemented if the <em>MEM_EXT_EN</em> generic is <em>true</em>. This interface can be used to attach external memories,
custom hardware accelerators, additional IO devices or all other kinds of IP blocks to the processor.</p>
</div>
<div class="paragraph">
<p>The external interface is <em>not</em> mapped to a <em>specific</em> address space region. Instead, all CPU memory accesses that
do not target a processor-internal module are delegated to the external memory interface. In summary, a CPU load/store
access is delegated via the external bus interface if&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it does not target the internal instruction memory IMEM (if implemented at all).</p>
</li>
<li>
<p><strong>and</strong> it does not target the internal data memory DMEM (if implemented at all).</p>
</li>
<li>
<p><strong>and</strong> it does not target the internal bootloader ROM or any of the IO devices - regardless if one or more of these components are
actually implemented or not.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Address Space Layout</div>
See section <a href="#_address_space">Address Space</a> for more information.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Execute-in-Place Module</div>
If the Execute In Place module (XIP) is implemented accesses targeting the XIP memory-mapped-region will not be forwarded to the
external memory interface. See section <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Wishbone Bus Protocol</strong></p>
</div>
<div class="paragraph">
<p>The external memory interface either uses the <strong>standard</strong> (also called "classic") Wishbone protocol (default) or
<strong>pipelined</strong> Wishbone protocol. The protocol to be used is configured via the <a href="#_mem_ext_pipe_mode"><em>MEM_EXT_PIPE_MODE</em></a> generic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>MEM_EXT_PIPE_MODE</em> is <em>false</em>, all bus control signals including <code>wb_stb_o</code> are active and remain stable until the
transfer is acknowledged/terminated.</p>
</li>
<li>
<p>If <em>MEM_EXT_PIPE_MODE</em> is <em>true</em>, all bus control except <code>wb_stb_o</code> are active and remain until the transfer is
acknowledged/terminated. In this case, <code>wb_stb_o</code> is asserted only during the very first bus clock cycle.</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 6. Exemplary Wishbone bus accesses using "classic" and "pipelined" protocol</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_classic_read.png" alt="700" width="300">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/wishbone_pipelined_write.png" alt="700" width="300">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Classic</strong> Wishbone read access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>Pipelined</strong> Wishbone write access</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Wishbone Specs.</div>
A detailed description of the implemented Wishbone bus protocol and the according interface signals
can be found in the data sheet "Wishbone B4 - WISHBONE System-on-Chip (SoC) Interconnection
Architecture for Portable IP Cores". A copy of this document can be found in the <code>docs</code> folder of this
project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Bus Access</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 Wishbone gateway does not support burst transfer yet, so there is always just a single transfer in "in fly".
Hence, the Wishbone <code>STALL</code> signal is not implemented. An accessed Wishbone device does not have to respond immediately to a bus
request by sending an ACK. Instead, there is a <em>time window</em> where the device has to acknowledge the transfer. This time window
id configured by the <em>MEM_EXT_TIMEOUT</em> top generic that defines the maximum time (in clock cycles) a bus access can be pending
before it is automatically terminated with an error condition. If <em>MEM_EXT_TIMEOUT</em> is set to zero, the timeout disabled
an a bus access can take an arbitrary number of cycles to complete (this is <strong>not recommended</strong>!).</p>
</div>
<div class="paragraph">
<p>When <em>MEM_EXT_TIMEOUT</em> is greater than zero, the Wishbone gateway starts an internal countdown whenever the CPU
accesses an address via the external memory interface. If the accessed device does not acknowledge (via <code>wb_ack_i</code>)
or terminate (via <code>wb_err_i</code>) the transfer within <em>MEM_EXT_TIMEOUT</em> clock cycles, the bus access is automatically canceled
setting <code>wb_cyc_o</code> low again and a CPU load/store/instruction fetch bus access fault exception is raised.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">External "Address Space Holes"</div>
Setting <em>MEM_EXT_TIMEOUT</em> to zero will permanently stall the CPU if the targeted Wishbone device never responds. Hence,
<em>MEM_EXT_TIMEOUT</em> should be always set to a value greater than zero.<br>
<br>
This feature can be used as <strong>safety guard</strong> if the external memory system does not check for "address space holes". That means
that accessing addresses, which do not belong to a certain memory or device, do not permanently stall the processor due to an
unacknowledged/unterminated bus access. If the external memory system can guarantee to acknowledge <strong>any</strong> bus accesses
(even if targeting an unimplemented address) the timeout feature can be safely disabled (<em>MEM_EXT_TIMEOUT</em> = 0).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Wishbone Tag</strong></p>
</div>
<div class="paragraph">
<p>The 3-bit wishbone <code>wb_tag_o</code> signal provides additional information regarding the access type. This signal
is compatible to the AXI4 <code>AxPROT</code> signal.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>wb_tag_o(0)</code> 1: privileged access (CPU is in machine mode); 0: unprivileged access (CPU is not in machine mode)</p>
</li>
<li>
<p><code>wb_tag_o(1)</code> always zero (indicating "secure access")</p>
</li>
<li>
<p><code>wb_tag_o(2)</code> 1: instruction fetch access, 0: data access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Endianness</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 CPU and the Processor setup are <strong>little-endian</strong> architectures. To allow direct connection
to a big-endian memory system the external bus interface provides an <em>Endianness configuration</em>. The
Endianness of the external memory interface can be configured via the <em>MEM_EXT_BIG_ENDIAN</em> generic.
By default, the external memory interface uses little-endian byte-order.</p>
</div>
<div class="paragraph">
<p>Application software can check the Endianness configuration of the external bus interface via the
SYSINFO module (see section <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a> for more information).</p>
</div>
<div class="paragraph">
<p><strong>Access Latency</strong></p>
</div>
<div class="paragraph">
<p>By default, the Wishbone gateway introduces two additional latency cycles: processor-outgoing (<code>*_o</code>) and
processor-incoming (<code>*_i</code>) signals are fully registered. Thus, any access from the CPU to a processor-external devices
via Wishbone requires 2 additional clock cycles. This can ease timing closure when using large (combinatorial) Wishbone
interconnection networks.</p>
</div>
<div class="paragraph">
<p>Optionally, the latency of the Wishbone gateway can be reduced by removing the input and output register stages.
Enabling the <em>MEM_EXT_ASYNC_RX</em> option will remove the input register stage; enabling <em>MEM_EXT_ASYNC_TX</em> option will
remove the output register stages. Each enabled option reduces access latency by 1 cycle.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Output Gating</div>
All outgoing Wishbone signals use a "gating mechanism" so they only change if there is a actual Wishbone transaction being in
progress. This can reduce dynamic switching activity in the external bus system and also simplifies simulation-based
inspection of the Wishbone transactions. Note that this output gating is only available if the output register buffer is not
disabled (<em>MEM_EXT_ASYNC_TX</em> = <em>false</em>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>AXI4-Lite Connectivity</strong></p>
</div>
<div class="paragraph">
<p>The AXI4-Lite wrapper (<code>rtl/system_integration/neorv32_SystemTop_axi4lite.vhd</code>) provides a Wishbone-to-
AXI4-Lite bridge, compatible with Xilinx Vivado (IP packager and block design editor). All entity signals of
this wrapper are of type <em>std_logic</em> or <em>std_logic_vector</em>, respectively. See The USer Guide for more
information: <a href="https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_ip_block_for_xilinx_vivado_block_designer" class="bare">https://stnolting.github.io/neorv32/ug/#_packaging_the_processor_as_ip_block_for_xilinx_vivado_block_designer</a></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Using the auto-termination timeout feature (<em>MEM_EXT_TIMEOUT</em> greater than zero) is <strong>not AXI4 compliant</strong> as
the AXI protocol does not support "aborting" bus transactions. Therefore, the NEORV32 top wrapper with AXI4-Lite interface
(<code>rtl/system_integration/neorv32_SystemTop_axi4lite</code>) configures <em>MEM_EXT_TIMEOUT</em> = 0 by default.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_internal_bus_monitor_buskeeper">2.7.6. Internal Bus Monitor (BUSKEEPER)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_buskeeper.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Package constants:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>max_proc_int_response_time_c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Access time window (#cycles)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The Bus Keeper is a fundamental component of the processor&#8217;s internal bus system that ensures correct bus operations
to maintain execution safety. The Bus Keeper monitors every single bus transactions that is intimated by the CPU.
If an accessed device responds with an error condition or do not respond within a specific <em>access time window</em>,
the according bus access fault exception is raised. The following exceptions can be raised by the Bus Keeper
(see section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for all available CPU traps):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>TRAP_CODE_I_ACCESS</code>: error during instruction fetch bus access</p>
</li>
<li>
<p><code>TRAP_CODE_S_ACCESS</code>: error during data store bus access</p>
</li>
<li>
<p><code>TRAP_CODE_L_ACCESS</code>: error during data load bus access</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <strong>access time window</strong>, in which an accessed device has to respond, is defined by the <code>max_proc_int_response_time_c</code>
constant from the processor&#8217;s VHDL package file (<code>rtl/neorv32_package.vhd</code>). The default value is <strong>15 clock cycles</strong>.</p>
</div>
<div class="paragraph">
<p>In case of a bus access fault exception application software can evaluate the Bus Keeper&#8217;s control register
<code>NEORV32_BUSKEEPER.CTRL</code> to retrieve further details of the bus exception. The <em>BUSKEEPER_ERR_FLAG</em> bit indicates
that an actual bus access fault has occurred. The bit is sticky once set and is automatically cleared when reading or
writing the <code>NEORV32_BUSKEEPER.CTRL</code> register. The <em>BUSKEEPER_ERR_TYPE</em> bit defines the type of the bus fault:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0</code> - "Device Error": The bus access exception was cause by the memory-mapped device that
has been accessed (the device asserted it&#8217;s <code>err_o</code>).</p>
</li>
<li>
<p><code>1</code> - "Timeout Error": The bus access exception was caused by the Bus Keeper because the
accessed memory-mapped device did not respond within the access time window. Note that this error type can also be raised
by the optional timeout feature of the <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>).</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bus access fault exceptions are also raised if a physical memory protection (PMP) rule is violated. In this case
the <em>BUSKEEPER_ERR_FLAG</em> bit remains zero (since the error signal is not triggered by the BUSKEEPER but by
the CPU&#8217;s PMP logic).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. BUSKEEPER register map (<code>struct NEORV32_BUSKEEPER</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 7.6923%;">
<col style="width: 30.7693%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xffffff78</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>NEORV32_BUSKEEPER.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>  <em>BUSKEEPER_ERR_TYPE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bus error type, valid if <em>BUSKEEPER_ERR_FLAG</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>BUSKEEPER_ERR_FLAG</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sticky error flag, clears after read or write access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff7c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em> (mirrored access to <code>CTRL</code>)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_stream_link_interface_slink">2.7.7. Stream Link Interface (SLINK)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_slink.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_dat_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data (8x32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_val_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link data valid (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_rdy_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link allowed to send (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_tx_lst_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link end of packet (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_dat_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data (8x32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_val_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link data valid (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_rdy_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link ready to receive (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>slink_rx_lst_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link end of packet (8x1-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_NUM_TX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of TX links to implement (0..8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_NUM_RX</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of RX links to implement (0..8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth (1..32k) of TX links, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SLINK_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth (1..32k) of RX links, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK RX IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK TX IRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The SLINK component provides up to 8 independent RX (receiving) and TX (sending) links for moving
stream data. The interface provides higher bandwidth and less latency than the external memory bus
interface, which makes it ideally suited to couple custom stream processing units.</p>
</div>
<div class="paragraph">
<p>Each link provides an individual internal FIFO for data buffering. The FIFO depth is globally defined
for all TX links via the <em>SLINK_TX_FIFO</em> generic and for all RX links via the <em>SLINK_RX_FIFO</em> generic.
The FIFO depth has to be at least 1, which will implement a simple input/output register. The maximum
value is limited to 32768 entries. Note that the FIFO depth has to be a power of two.</p>
</div>
<div class="paragraph">
<p>The actual number of implemented RX/TX links is configured by the <em>SLINK_NUM_RX</em> and <em>SLINK_NUM_TX</em>
generics, respectively. The SLINK module will be synthesized only if at least one of these generics is greater than
zero. All unimplemented links are internally terminated and their according output signals are set to zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 stream link interfaces are compatible to the <em>AXI Stream</em> specs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Program</div>
An example program for the SLINK module is available in <code>sw/example/demo_slink</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SLINK provides eight data registers (<code>DATA[i]</code>) to access the links (read accesses will access the RX link FIFOs,
write accesses will access the TX link FIFOs), one control register (<code>CTRL</code>), one interrupt configuration register (<code>IRQ</code>)
and two status registers - one for the RX links (<code>RX_STATUS</code>) and one for the TX links (<code>TX_STATUS</code>).</p>
</div>
<div class="paragraph">
<p>The SLINK is globally activated by setting the control register&#8217;s enable bit <em>SLINK_CTRL_EN</em>. Clearing this
bit will reset all internal logic and will also clear all FIFOs. The actual data links are accessed by
reading or writing the according link data registers <code>DATA[0]</code> to <code>DATA[7]</code>. For example, writing to <code>DATA[0]</code>
will put the according data into the FIFO of TX link 0. Accordingly, reading from <code>DATA[0]</code> will return one data
word from the FIFO of RX link 0.</p>
</div>
<div class="paragraph">
<p>The current link status of each RX and TX channel is accessible via the <code>*X_STATUS</code> registers. The FIFO&#8217;s status
signals that represent the fill level (empty, at least half full, full) are exposed as read-only flags via those two
registers.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Writing to a TX link&#8217;s FIFO that is <em>full</em> will have no effect. Reading data from a RX link&#8217;s FIFO that is
<em>empty</em> will have no effect and will return the last valid data word.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The TX link&#8217;s "end of packet" signal <code>slink_tx_lst_o</code> is controlled by the <code>TX_STATUS</code> register&#8217;s <em>SLINK_TX_STATUS_LAST</em>
bits. Note that these bits are also buffered by the internal TX FIFOs, so setting one of these bits before writing data to
<code>DATA</code> will set the <code>slink_tx_lst_o</code> signal when the written data word is actually send from the FIFO. Vice versa, the
<em>SLINK_RX_STATUS_LAST</em> bits in <code>RX_STATUS</code> represent the level of the according <code>slink_rx_lst_i</code> input when a new data word
was samples. These bits are also buffered in the internal RX FIFOs.</p>
</div>
<div class="paragraph">
<p><strong>Data Transmission</strong></p>
</div>
<div class="paragraph">
<p>To send (TX) data the program should ensure there is at least one left in the according link&#8217;s FIFO by checking
<em>SLINK_CTRL_TX_FREE</em>. To mark the current data word to-be-send as "end of packet" the according <em>SLINK_TX_STATUS_LAST</em>
bit has to be set <em>before</em> writing <code>DATA</code>.</p>
</div>
<div class="paragraph">
<p>Received data (RX) is available when the according link&#8217;s <em>SLINK_RX_STATUS_EMPTY</em> bit is cleared. To check if the received
data is marked as "end of packet" the according <em>SLINK_RX_STATUS_LAST</em> bit has to be examined <em>before</em> reading <code>DATA</code>.</p>
</div>
<div class="paragraph">
<p><strong>Interface &amp; Protocol</strong></p>
</div>
<div class="paragraph">
<p>The SLINK interface consists of four signals <code>dat</code>, <code>val</code>, <code>rdy</code> and <code>lst</code> for each RX and TX link.
Each signal is constructed as an "array" with eight entries - one for each link. Note that an entry in <code>slink_*x_dat</code> is 32-bit
wide while entries in <code>slink_*x_val</code>, <code>slink_*x_rdy</code> and <code>slink_*x_lst</code> are are just 1-bit wide.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>dat</code> contains the actual data word</p>
</li>
<li>
<p><code>val</code> marks the current transmission cycle as valid</p>
</li>
<li>
<p><code>rdy</code> indicates that the receiving part is ready to receive</p>
</li>
<li>
<p><code>lst</code> marks the current data word as "end of packet"</p>
</li>
</ul>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/stream_link_interface.png" alt="stream link interface" width="560">
</div>
<div class="title">Figure 5. Exemplary Stream Link Transfer (transferring 5 elements, element "E" is marked as "end of packet")</div>
</div>
<div class="paragraph">
<p><strong>SLINK Interrupts</strong></p>
</div>
<div class="paragraph">
<p>The stream interface provides two independent CPU interrupt channels - one for RX conditions and one
for TX conditions. These IRQs can be used to signal specific FIFO conditions (e.g. "data available") to the
CPU. The specific interrupt conditions are programmed per-link via the <code>IRQ</code> register.
A 2-bit-coded value is used to enable the according link&#8217;s interrupt and to specify the actual condition.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that all enabled interrupt configurations are logically OR-ed for the CPU RX and TX interrupts, respectively.
Hence, if <strong>any</strong> link fulfills the according interrupt configuration the according RX/TX interrupt request is
sent to the CPU.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>For the TX links (in <code>IRQ</code> <em>SLINK_IRQ_TX</em>) the following interrupt conditions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0-</code>: off, no interrupt from link</p>
</li>
<li>
<p><code>10</code>: interrupt fires if FIFO <em>becomes</em> not empty</p>
</li>
<li>
<p><code>11</code>: interrupt fires if FIFO <em>becomes</em> at least half full</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the RX links (in <code>IRQ</code> <em>SLINK_IRQ_RX</em>) the following interrupt conditions are supported:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0-</code>: off, no interrupt from link</p>
</li>
<li>
<p><code>10</code>: interrupt fires if FIFO <em>becomes</em> empty</p>
</li>
<li>
<p><code>11</code>: interrupt fires if FIFO <em>becomes</em> less than half full</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the SLINK&#8217;s RX or TX CPU interrupt has become pending, it has to be explicitly cleared again by writing
zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit(s).</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. SLINK register map (<code>struct NEORV32_SLINK</code>)</caption>
<colgroup>
<col style="width: 14.8148%;">
<col style="width: 18.5185%;">
<col style="width: 7.4074%;">
<col style="width: 7.4074%;">
<col style="width: 51.8519%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xfffffec0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_SLINK.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <em>SLINK_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SLINK global enable/reset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:1</code>   <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, returns zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19:16</code> <em>SLINK_CTRL_RX_NUM_MSB</em>  : <em>SLINK_CTRL_RX_NUM_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of RX links (<em>SLINK_NUM_RX</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:20</code> <em>SLINK_CTRL_TX_NUM_MSB</em>  : <em>SLINK_CTRL_TX_NUM_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of TX links (<em>SLINK_NUM_TX</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27:24</code> <em>SLINK_CTRL_RX_FIFO_MSB</em> : <em>SLINK_CTRL_RX_FIFO_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth, log2(<em>SLINK_RX_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:28</code> <em>SLINK_CTRL_TX_FIFO_MSB</em> : <em>SLINK_CTRL_TX_FIFO_MSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth, log2(<em>SLINK_TX_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>0xfffffec4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>NEORV32_SLINK.IRQ</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:0</code>  <em>SLINK_IRQ_RX_MSB</em> : <em>SLINK_IRQ_RX_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> interrupt configuration (2 bits per link)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:16</code> <em>SLINK_IRQ_TX_MSB</em> : <em>SLINK_IRQ_TX_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> interrupt configuration (2 bits per link)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffec8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_SLINK.RX_STATUS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <em>SLINK_RX_STATUS_EMPTY_MSB</em> : <em>SLINK_RX_STATUS_EMPTY_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>  <em>SLINK_RX_STATUS_HALF_MSB</em>  : <em>SLINK_RX_STATUS_HALF_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code> <em>SLINK_RX_STATUS_FULL_MSB</em>  : <em>SLINK_RX_STATUS_FULL_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX link <em>i</em> FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code> <em>SLINK_RX_STATUS_LAST_MSB</em>  : <em>SLINK_RX_STATUS_LAST_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Current data word of RX link <em>i</em> is marked as "end of packet"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffecc</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_SLINK.TX_STATUS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code>   <em>SLINK_TX_STATUS_EMPTY_MSB</em> : <em>SLINK_TX_STATUS_EMPTY_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> FIFO empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code>  <em>SLINK_TX_STATUS_HALF_MSB</em>  : <em>SLINK_TX_STATUS_HALF_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> FIFO at least half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code> <em>SLINK_TX_STATUS_FULL_MSB</em>  : <em>SLINK_TX_STATUS_FULL_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX link <em>i</em> FIFO full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code> <em>SLINK_TX_STATUS_LAST_MSB</em>  : <em>SLINK_TX_STATUS_LAST_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set to mark next data word of TX link <em>i</em> is "end of packet"</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffed0</code> : <code>0xfffffedf</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, returns zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 0 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 1 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffee8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[2]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 2 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffeec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[3]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 3 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[4]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 4 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[5]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 5 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffef8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[6]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 6 RX/TX data</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffefc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SLINK.DATA[7]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link 7 RX/TX data</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_input_and_output_port_gpio">2.7.8. General Purpose Input and Output Port (GPIO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gpio.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel output port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>gpio_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">64-bit parallel input port</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_GPIO_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement GPIO port when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The general purpose parallel IO port unit provides a simple 64-bit parallel input port and a 64-bit parallel
output port. These ports can be used chip-externally (for example to drive status LEDs, connect buttons, etc.)
or chip-internally to provide control signals for other IP modules. The component is disabled for
implementation when the <em>IO_GPIO_EN</em> generic is set <em>false</em>. In this case the GPIO output port <code>gpio_o</code> is tied to all-zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Atomicity</div>
The GPIO modules uses two memory-mapped registers (each 32-bit) each for accessing the input and
output signals. Since the CPU can only process 32-bit "at once" updating the entire output cannot
be performed within a single clock cycle.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">INPUT is read-only</div>
Write accesses to the <code>NEORV32_GPIO.INPUT_LO</code> and <code>NEORV32_GPIO.INPUT_HI</code> registers will raise a store bus
error exception. The BUSKEEPER will indicate a "DEVICE_ERR" in this case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 9. GPIO unit register map (<code>struct NEORV32_GPIO</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.INPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 31:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.INPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel input port pins 63:32</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffc8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.OUTPUT_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 31:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPIO.OUTPUT_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">parallel output port pins 63:32</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_watchdog_timer_wdt">2.7.9. Watchdog Timer (WDT)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_wdt.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_WDT_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement watchdog when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog timeout (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The watchdog (WDT) provides a last resort for safety-critical applications. The WDT provides a "bark and bite"
concept. The timeout counter first triggers an optional CPU interrupt ("bark") when reaching half of the programmed
interval to inform the application of the imminent timeout. When the full timeout value is reached
a system-wide hardware reset is generated ("bite"). The internal counter has to be reset explicitly by the application
program every now and then to prevent a timeout.</p>
</div>
<div class="paragraph">
<p><strong>Configuration</strong></p>
</div>
<div class="paragraph">
<p>The watchdog is enabled by setting the control register&#8217;s `WDT_CTRL_EN_ bit. When this bit is cleared, the internal
timeout counter is reset to zero and no interrupt and no system reset can be triggered.</p>
</div>
<div class="paragraph">
<p>The internal 32-bit timeout counter is clocked at 1/4096th of the processor&#8217;s main clock (f<sub>WDT</sub>[Hz] = f<sub>main</sub>[Hz] / 4096).
Whenever this counter reaches the programmed timeout value (<em>WDT_CTRL_TIMEOUT</em> bits in the control register) a
hardware reset is triggered. In order to inform the application of an imminent timeout, an optional CPU interrupt is
triggered when the timeout counter reaches <strong>half</strong> of the programmed timeout value.</p>
</div>
<div class="paragraph">
<p>The watchdog is "fed" by writing <code>1</code> to the <em>WDT_CTRL_RESET</em> control register bit, which
will reset the internal timeout counter back to zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Writing all-zero to the <em>WDT_CTRL_TIMEOUT</em> bits will immediately trigger a system-wide reset.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Watchdog Interrupt</div>
A watchdog interrupt occurs when the watchdog is enabled and the internal counter reaches half of the programmed
timeout value. A triggered interrupt has to be explicitly cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Watchdog Operation during Debugging</div>
By default the watchdog stops operation when the CPU enters debug mode and will resume normal operation after
the CPU has left debug mode again. This will prevent an unintended watchdog timeout during a debug session. However,
the watchdog can also be configured to keep operating even when the CPU is in debug mode by setting the control
register&#8217;s <em>WDT_CTRL_DBEN</em> bit.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Watchdog Operation during CPU Sleep</div>
By default the watchdog stops operating when the CPU enters sleep mode. However, the watchdog can also be configured
to keep operating even when the CPU is in sleep mode by setting the control register&#8217;s <em>WDT_CTRL_SEN</em> bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Configuration Lock</strong></p>
</div>
<div class="paragraph">
<p>The watchdog control register can be locked to protect the current configuration from being modified. The lock is
activated by setting the <em>WDT_CTRL_LOCK</em> bit. In the locked state any write access to the control register is entirely
ignored (see table below, "writable if locked"). Read accesses to the control register as well as watchdog resets
(by setting the <em>WDT_CTRL_RESET</em> flag) are not affected.</p>
</div>
<div class="paragraph">
<p>The lock bit can only be set if the WDT is already enabled (<em>WDT_CTRL_EN</em> is set).
The lock bit can only be cleared again by a system-wide hardware reset.</p>
</div>
<div class="paragraph">
<p><strong>Cause of last Hardware Reset</strong></p>
</div>
<div class="paragraph">
<p>The cause of the last system hardware reset can be determined via the <em>WDT_CTRL_RCAUSE</em> flag. If this flag is
zero, the processor has been reset via the external reset signal (or the on-chip debugger). If this flag is set,
the last system reset was caused by the watchdog itself.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. WDT register map (<code>struct NEORV32_WDT</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 6.25%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-center valign-top">Reset value</th>
<th class="tableblock halign-center valign-top">Writable if locked</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock"><code>0xffffffbc</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="8"><p class="tableblock"><code>NEORV32_WDT.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>WDT_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">watchdog enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">`1  <em>WDT_CTRL_LOCK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">lock configuration when set, clears only on system reset, can only be set if enable bit is set already</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>WDT_CTRL_DBEN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to allow WDT to continue operation even when CPU is in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>WDT_CTRL_SEN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to allow WDT to continue operation even when CPU is in sleep mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>WDT_CTRL_RESET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reset watchdog when set, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>WDT_CTRL_RCAUSE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause of last system reset: <code>0</code>=caused by external reset signal, <code>1</code>=caused by watchdog</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:6</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, reads as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:8</code> <em>WDT_CTRL_TIMEOUT_MSB</em> : <em>WDT_CTRL_TIMEOUT_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">24-bit watchdog timeout value</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_machine_system_timer_mtime">2.7.10. Machine System Timer (MTIME)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_mtime.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time input from external MTIME</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time output (64-bit) for SoC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine time IRQ if MTIME is <strong>not</strong> implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_MTIME_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement MTIME when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The MTIME module implements the memory-mapped MTIME machine timer from the official RISC-V
specifications. This module features a 64-bit system timer incrementing with the primary processor clock.
Besides accessing the MTIME register via memory operation the current system time can also be obtained using
the <code>time[h]</code> CSRs. Furthermore, the current system time is made available for processor-external
usage via the top&#8217;s <code>mtime_o</code> signal.</p>
</div>
<div class="paragraph">
<p>The 64-bit system time can be accessed via the <code>TIME_LO</code> and <code>TIME_HI</code> memory-mapped registers (read/write) and also via
the CPU&#8217;s <code>time[h]</code> CSRs (read-only). A 64-bit time compare register - accessible via the memory-mapped <code>TIMECMP_LO</code> and <code>TIMECMP_HI</code>
registers - is used to configure the CPU&#8217;s MTI (machine timer interrupt). The interrupt is triggered
whenever <code>TIME</code> (high &amp; low part) is greater than or equal to <code>TIMECMP</code> (high &amp; low part).
The interrupt remain active (=pending) until <code>TIME</code> becomes less <code>TIMECMP</code> again (either by modifying <code>TIME</code> or <code>TIMECMP</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Reset</div>
After a hardware reset the <code>TIME</code> register is reset to <strong>all-zero</strong> and the <code>TIMECMP</code> register is reset to <strong>all-one</strong>
to prevent accidental interrupt requests during early boot phase.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">External MTIME Input</div>
If the processor-internal <strong>MTIME module is NOT implemented</strong>, the top&#8217;s <code>mtime_i</code> input signal is used to update the <code>time[h]</code> CSRs
and the <code>MTI</code> machine timer CPU interrupt (<code>MTI</code>) is directly connected to the top&#8217;s <code>mtime_irq_i</code> input. The <code>mtime_o</code> signal
is hardwired to zero in this case.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">External MTIME Interrupt</div>
The <code>mtime_irq_i</code> signal is level-triggered and high-active. Once set the signal has to stay high until
the interrupt request is explicitly acknowledged (e.g. writing to a memory-mapped register). All RISC-V standard interrupts
can <strong>NOT</strong> be acknowledged by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.<br>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. MTIME register map (<code>struct NEORV32_MTIME</code>)</caption>
<colgroup>
<col style="width: 21.4285%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 7.1428%;">
<col style="width: 42.8574%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bits</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff90</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIME_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine system time, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff94</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIME_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine system time, high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff98</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIMECMP_LO</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff9c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_MTIME.TIMECMP_HI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">time compare, high word</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_primary_universal_asynchronous_receiver_and_transmitter_uart0">2.7.11. Primary Universal Asynchronous Receiver and Transmitter (UART0)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input UART0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart0_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_UART0_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART0 when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART0_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART0_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The UART is a standard serial interface mainly used to establish a communication channel between a host computer
computer/user and an application running on the embedded processor.</p>
</div>
<div class="paragraph">
<p>The NEORV32 UARTs feature independent transmitter and receiver with a fixed frame configuration of 8 data bits,
an optional parity bit (even or odd) and a fixed stop bit. The actual transmission rate - the Baudrate - is
programmable via software. Optional FIFOs with custom sizes can be configured for the transmitter and receiver
independently.</p>
</div>
<div class="paragraph">
<p>The UART features two memory-mapped registers <code>CTRL</code> and <code>DATA</code>, which are used for configuration, status
check and data transfer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Console(s)</div>
Please note that <em>all</em> default example programs and software libraries of the NEORV32 software
framework (including the bootloader and the runtime environment) use the primary UART
(<em>UART0</em>) as default user console interface. Furthermore, UART0 is used to implement all the standard
input, output and error consoles (<code>STDIN</code>, <code>STDOUT</code> and <code>STDERR</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>UART0 is enabled by setting the <em>UART_CTRL_EN</em> bit in the UART0 control register <code>CTRL</code>. The Baud rate
is configured via a 12-bit <em>UART_CTRL_BAUDxx</em> baud prescaler (<code>baud_prsc</code>) and a 3-bit <em>UART_CTRL_PRSCx</em>
clock prescaler (<code>clock_prescaler</code>) that scales the processor&#8217;s primary clock (<em>f<sub>main</sub></em>).</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 12. UART0 prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>UART_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><em><strong>Baud rate</strong></em> = (<em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code>) / (<code>baud_prsc</code> + 1)</p>
</div>
<div class="paragraph">
<p>A new transmission is started by writing the data byte to be send to the lowest byte of the <code>DATA</code> register. The
transfer is completed when the <em>UART_CTRL_TX_BUSY</em> control register flag returns to zero. A new received byte
is available when the <em>UART_DATA_AVAIL</em> flag of the <code>DATA</code> register is set. A "frame error" in a received byte
(invalid stop bit) is indicated via the <em>UART_DATA_FERR</em> flag in the <code>DATA</code> register. The flag is cleared by
reading the <code>DATA</code> register.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission (RX or TX) can be terminated at any time by disabling the UART module
by clearing the <em>UART_CTRL_EN</em> control register bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>RX and TX FIFOs</strong></p>
</div>
<div class="paragraph">
<p>UART0 provides optional FIFO buffers for the transmitter and the receiver. The <em>UART0_RX_FIFO</em> generic defines
the depth of the RX FIFO (for receiving data) while the <em>UART0_TX_FIFO</em> defines the depth of the TX FIFO
(for sending data). Both generics have to be a power of two with a minimal allowed value of 1. This minimal
value will implement simple "double-buffering" instead of full-featured FIFOs.
Both FIFOs are cleared whenever UART0 is disabled (clearing <em>UART_CTRL_EN</em> in <code>CTRL</code>).</p>
</div>
<div class="paragraph">
<p>The state of both FIFO (<em>empty</em>, <em>at lest half-full</em>, <em>full</em>) is available via the <em>UART_CTRL</em>?X_EMPTY_,
 <em>UART_CTRL</em>?X_HALF_ and <em>UART_CTRL</em>*X_FULL_ flags in the <code>CTRL</code> register.</p>
</div>
<div class="paragraph">
<p>If the RX FIFO is already full and new data is received by the receiver unit, the <em>UART_DATA_OVERR</em> flag
in the <code>DATA</code> register is set indicating an "overrun". This flag is cleared by reading the <code>DATA</code> register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In contrast to other FIFO-equipped peripherals, software <strong>cannot</strong> determine the UART&#8217;s FIFO size configuration
by reading specific control register bits (simply because there are no bits left in the control register).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Hardware Flow Control - RTS/CTS</strong></p>
</div>
<div class="paragraph">
<p>UART0 supports optional hardware flow control using the standard CTS (clear to send) and/or RTS (ready to send
/ ready to receive "RTR") signals. Both hardware control flow mechanisms can be enabled individually.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <strong>RTS hardware flow control</strong> is enabled by setting the <em>UART_CTRL_RTS_EN</em> control register flag, the UART
will drive the <code>uart0_rts_o</code> signal low if the UART RX FIFO is less than half full. As long as this signal is low,
the connected device can send new data. <code>uart0_rts_o</code> is always low if the UART is disabled.</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
If the <em>UART0_RX_FIFO</em> configuration generic is set to it&#8217;s minimum (=1), the RTS signal already goes low
when a single character has been received by the UART that has not yet been read by the software.
</td>
</tr>
</table>
</div>
<div class="ulist">
<ul>
<li>
<p>If <strong>CTS hardware flow control</strong> is enabled by setting the <em>UART_CTRL_CTS_EN</em> control register flag, the UART&#8217;s
transmitter will not start sending a new data until the <code>uart0_cts_i</code> signal goes low. During this time, the UART busy flag
<em>UART_CTRL_TX_BUSY</em> remains set. If <code>uart0_cts_i</code> is asserted, no new data transmission will be started by the UART.
The state of the <code>uart0_cts_i</code> signal has no effect on a transmission being already in progress. Application software can check
the current state of the <code>uart0_cts_o</code> input signal via the <em>UART_CTRL_CTS</em> control register flag.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Parity Modes</strong></p>
</div>
<div class="paragraph">
<p>An optional parity bit can be added to the data stream if the <em>UART_CTRL_PMODE1</em> flag is set.
When <em>UART_CTRL_PMODE0</em> is zero, the UART operates in "even parity" mode. If this flag is set, the UART operates in "odd parity" mode.
Parity errors in received data are indicated via the <em>UART_DATA_PERR</em> flag in the <code>DATA</code> register. This flag is updated with each new
received character and is cleared by reading the <code>DATA</code> register.</p>
</div>
<div class="paragraph">
<p><strong>UART Interrupts</strong></p>
</div>
<div class="paragraph">
<p>UART0 features two independent interrupt for signaling certain RX and TX conditions. The behavior of these conditions differs
based on the configured FIFO sizes. If the according FIFO size is greater than 1, the <em>UART_CTRL_RX_IRQ</em> and <em>UART_CTRL_TX_IRQ</em>
<code>CTRL</code> flags allow a more fine-grained IRQ configuration. An interrupt can only become pending if the according interrupt
condition is fulfilled and the UART is enabled at all.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If <em>UART0_RX_FIFO</em> is exactly 1, the RX interrupt goes pending when data <em>becomes</em> available in the RX FIFO
(&#8594; <em>UART_CTRL_RX_EMPTY</em> clears). <em>UART_CTRL_RX_IRQ</em> is hardwired to <code>0</code> in this case.</p>
</li>
<li>
<p>If <em>UART0_TX_FIFO</em> is exactly 1, the TX interrupt goes pending when at least one entry in the TX FIFO <em>becomes</em> free
(&#8594; <em>UART_CTRL_TX_FULL</em> clears). <em>UART_CTRL_TX_IRQ</em> is hardwired to <code>0</code> in this case.</p>
</li>
<li>
<p>If <em>UART0_RX_FIFO</em> is greater than 1: If <em>UART_CTRL_RX_IRQ</em> is <code>0</code> the RX interrupt goes pending when data <em>becomes</em>
available in the RX FIFO (&#8594; <em>UART_CTRL_RX_EMPTY</em> clears). If <em>UART_CTRL_RX_IRQ</em> is <code>1</code> the RX interrupt becomes pending
the RX FIFO <em>becomes</em> at least half-full (&#8594; <em>UART_CTRL_RX_HALF</em> sets).</p>
</li>
<li>
<p>If <em>UART0_TX_FIFO</em> is greater than 1: If <em>UART_CTRL_TX_IRQ</em> is <code>0</code> the TX interrupt goes pending when at least one entry
in the TX FIFO <em>becomes</em> free (&#8594; <em>UART_CTRL_TX_FULL</em> clears). If <em>UART_CTRL_TX_IRQ</em> is <code>1</code> the TX interrupt goes pending
when the RX FIFO <em>becomes</em> less than half-full (&#8594; <em>UART_CTRL_TX_HALF</em> clears).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the RX or TX interrupt has become pending, it has to be explicitly cleared again by
writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The default UART0 operation will transmit any data written to the <code>DATA</code> register via the serial TX line at
the defined baud rate via the physical link. To accelerate UART0 output during simulation
(and also to dump large amounts of data) the UART0 features a <em>simulation mode</em>.</p>
</div>
<div class="paragraph">
<p>Simulation mode is enabled by setting the <em>UART_CTRL_SIM_MODE</em> bit in the UART0&#8217;s control register
<code>CTRL</code>. Any other UART0 configuration bits are irrelevant for this mode but UART0 has to be enabled via the
<em>UART_CTRL_EN</em> bit. There will be no physical UART0 transmissions via <code>uart0_txd_o</code> at all when
simulation mode is enabled. Furthermore, no interrupts (RX &amp; TX) will be triggered.</p>
</div>
<div class="paragraph">
<p>When the simulation mode is enabled any data written to <code>DATA[7:0]</code> is
directly output as ASCII char to the simulator console. Additionally, all chars are also stored to a text file
<code>neorv32.uart0.sim_mode.text.out</code> in the simulation home folder.</p>
</div>
<div class="paragraph">
<p>Furthermore, the whole 32-bit word written to <code>DATA[31:0]</code> is stored as plain 8-char hexadecimal value to a
second text file <code>neorv32.uart0.sim_mode.data.out</code> also located in the simulation home folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the simulation-mode of the UART0 can be found in the User Guide
section <a href="https://stnolting.github.io/neorv32/ug/#_simulating_the_processor">Simulating the Processor</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. UART0 register map (<code>struct NEORV32_UART0</code>)</caption>
<colgroup>
<col style="width: 13.9534%;">
<col style="width: 16.279%;">
<col style="width: 23.2558%;">
<col style="width: 4.6511%;">
<col style="width: 41.8607%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>0xffffffa0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>NEORV32_UART0.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:0</code> <em>UART_CTRL_BAUDxx</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit BAUD value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>UART_CTRL_SIM_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>UART_CTRL_RX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>UART_CTRL_RX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>UART_CTRL_RX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>UART_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>UART_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>UART_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>UART_CTRL_RTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>UART_CTRL_CTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable CTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>UART_CTRL_PMODE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">parity bit enable and configuration (<code>00</code>/<code>01</code>= no parity; <code>10</code>=even parity; <code>11</code>=odd parity)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>UART_CTRL_PMODE1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>UART_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit baudrate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code> <em>UART_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code> <em>UART_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>UART_CTRL_CTS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of UART&#8217;s CTS input signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_CTRL_RX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX IRQ mode: <code>1</code>=FIFO at least half-full; <code>0</code>=FIFO not empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_CTRL_TX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX IRQ mode: <code>1</code>=FIFO less than half-full; <code>0</code>=FIFO not full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmitter busy flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffffa4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_UART0.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>UART_DATA_MSB</em> : <em>UART_DATA_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>simulation data output</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_DATA_PERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX parity error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_DATA_FERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data frame error (stop bit nt set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_DATA_OVERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data overrun</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_DATA_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data available when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_secondary_universal_asynchronous_receiver_and_transmitter_uart1">2.7.12. Secondary Universal Asynchronous Receiver and Transmitter (UART1)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_uart.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_txd_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial transmitter output UART1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rxd_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial receiver input UART1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_rts_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: RX ready to receive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>uart1_cts_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flow control: TX allowed to send</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_UART1_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement UART1 when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART1_RX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>UART1_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (power of 2, min 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) is functional identical to the primary UART (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>).
Obviously, UART1 has different addresses for the control register (<code>CTRL</code>) and the data register (<code>DATA</code>) - see the register map below.
The register&#8217;s bits/flags use the same bit positions and naming as for the primary UART. The RX and TX interrupts of UART1 are
mapped to different CPU fast interrupt (FIRQ) channels.</p>
</div>
<div class="paragraph">
<p><strong>Simulation Mode</strong></p>
</div>
<div class="paragraph">
<p>The secondary UART (UART1) provides the same simulation options as the primary UART. However,
output data is written to UART1-specific files: <code>neorv32.uart1.sim_mode.text.out</code> is used to store
plain ASCII text and <code>neorv32.uart1.sim_mode.data.out</code> is used to store full 32-bit hexadecimal
data words.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. UART1 register map (<code>struct NEORV32_UART1</code>)</caption>
<colgroup>
<col style="width: 13.9534%;">
<col style="width: 16.279%;">
<col style="width: 23.2558%;">
<col style="width: 4.6511%;">
<col style="width: 41.8607%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>0xffffffd0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="21"><p class="tableblock"><code>NEORV32_UART1.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:0</code> <em>UART_CTRL_BAUDxx</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12-bit BAUD value configuration value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>UART_CTRL_SIM_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable <strong>simulation mode</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>UART_CTRL_RX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>UART_CTRL_RX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>UART_CTRL_RX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>UART_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>UART_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is at least half-full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>UART_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>UART_CTRL_RTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable RTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>UART_CTRL_CTS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable CTS hardware flow control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>UART_CTRL_PMODE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">parity bit enable and configuration (<code>00</code>/<code>01</code>= no parity; <code>10</code>=even parity; <code>11</code>=odd parity)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>UART_CTRL_PMODE1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>UART_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit baudrate clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code> <em>UART_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code> <em>UART_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>UART_CTRL_CTS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of UART&#8217;s CTS input signal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">UART enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_CTRL_RX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX IRQ mode: <code>1</code>=FIFO at least half-full; <code>0</code>=FIFO not empty; hardwired to zero if <em>UART0_RX_FIFO</em> = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_CTRL_TX_IRQ</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX IRQ mode: <code>1</code>=FIFO less than half-full; <code>0</code>=FIFO not full; hardwired to zero if <em>UART0_TX_FIFO</em> = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmitter busy flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>0xffffffd4</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="6"><p class="tableblock"><code>NEORV32_UART1.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>UART_DATA_MSB</em> : <em>UART_DATA_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>simulation data output</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>UART_DATA_PERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX parity error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>UART_DATA_FERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data frame error (stop bit nt set)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>UART_DATA_OVERR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data overrun</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>UART_DATA_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX data available when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_serial_peripheral_interface_controller_spi">2.7.13. Serial Peripheral Interface Controller (SPI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_spi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sck_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdo_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_sdi_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>spi_csn_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit dedicated chip select (low-active)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_SPI_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement SPI controller when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_SPI_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO size, has to be zero or a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>SPI is a synchronous serial transmission interface for fast on-board communications.
The NEORV32 SPI transceiver module supports 8-, 16-, 24- and 32-bit wide transmissions, all 4 standard clock modes
and 8 dedicated chip select signals via the top entity&#8217;s <code>spi_csn_o</code> signal, which are
directly controlled by the SPI module (no additional GPIOs required). An optional receive/transmit FIFO can be
implemented via the <em>IO_SPI_FIFO</em> generic to support block-based transmissions without CPU interaction.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Host-Mode Only</div>
The NEORV32 SPI module only supports <em>host mode</em>. Transmission are initiated only by the processor&#8217;s SPI module
and not by an external SPI module.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SPI module provides a single control register <code>CTRL</code> to configure the module and to check it&#8217;s status
and a single data register <code>DATA</code> for receiving/transmitting data. If the data FIFO is implemented, this register
is used to interface the FIFO.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SPI module is enabled by setting the <em>SPI_CTRL_EN</em> bit in the <code>CTRL</code> control register. No transfer can be initiated
and no interrupt request will be triggered if this bit is cleared. Clearing this bit will reset the module (also clearing
the FIFO if implemented) and will also terminate any transfer being in process.</p>
</div>
<div class="paragraph">
<p>The data quantity to be transferred within a single data transmission is defined via the <em>SPI_CTRL_SIZEx</em> bits.
The SPI module supports 8-bit (<code>00</code>), 16-bit (<code>01</code>), 24-bit (<code>10</code>) and 32-bit (<code>11</code>) transfers.</p>
</div>
<div class="paragraph">
<p>A transmission is started when writing data to the <code>DATA</code> register. The data must be LSB-aligned. So if
the SPI transceiver is configured for less than 32-bit transfer data quantity, the transmit data must be placed
into the lowest 8/16/24 bits of <code>DATA</code>. Vice versa, the received data is also always LSB-aligned. Application
software should only process the amount of bits that was configured using <em>SPI_CTRL_SIZEx</em> when
reading <code>DATA</code>.</p>
</div>
<div class="paragraph">
<p>The SPI operation is completed as soon as the <em>SPI_CTRL_BUSY</em> flag clears. If a FIFO size greater than zero is configured,
the busy flag clears when the current serial engine operation is completed and there is no data left in the send buffer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">MSB-first Only</div>
The NEORV32 SPI module only support MSB-first mode. Data can be reversed before writing <code>DATA</code> (for TX) / after
reading <code>DATA</code> (for RX) to implement LSB-first transmissions. Note that in both cases data in <code>DATA</code> still
needs to be LSB-aligned.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Arbitrary Transmission Length</div>
The total transmission length, which can be an arbitrary number of individual data transfers, is left to the user:
after asserting chip-select an arbitrary amount of transmission with arbitrary data quantity (<em>SPI_CTRL_SIZEx</em>) can
be made before de-asserting chip-select again.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The SPI controller features 8 dedicated chip-select lines. These lines are controlled via the control register&#8217;s
<em>SPI_CTRL_CS_SELx</em> and <em>SPI_CTRL_CS_EN</em> bits. The 3-bit <em>SPI_CTRL_CSx</em> bits are used to select one out of the eight
dedicated chip select line. As soon as <em>SPI_CTRL_CS_EN</em> is <em>set</em> the selected chip select line is activated (driven <em>low</em>).
Note that disabling the SPI module via the <em>SPI_CTRL_EN</em> bit will also deactivate any currently activated chip select line.</p>
</div>
<div class="paragraph">
<p><strong>SPI Clock Configuration</strong></p>
</div>
<div class="paragraph">
<p>The SPI module supports all <em>standard SPI clock modes</em> (0, 1, 2, 3), which are configured via the two control register bits
<em>SPI_CTRL_CPHA</em> and <em>SPI_CTRL_CPOL</em>. The <em>SPI_CTRL_CPHA</em> bit defines the <em>clock phase</em> and the <em>SPI_CTRL_CPOL</em>
bit defines the <em>clock polarity</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/SPI_timing_diagram2.wikimedia.png" alt="SPI timing diagram2.wikimedia">
</div>
<div class="title">Figure 6. SPI clock modes; image from <a href="https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg" class="bare">https://en.wikipedia.org/wiki/File:SPI_timing_diagram2.svg</a> (license: (Wikimedia) <a href="https://en.wikipedia.org/wiki/Creative_Commons">Creative Commons</a> <a href="https://creativecommons.org/licenses/by-sa/3.0/deed.en">Attribution-Share Alike 3.0 Unported</a>)</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 15. SPI standard clock modes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6669%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"></th>
<th class="tableblock halign-center valign-top">Mode 0</th>
<th class="tableblock halign-center valign-top">Mode 1</th>
<th class="tableblock halign-center valign-top">Mode 2</th>
<th class="tableblock halign-center valign-top">Mode 3</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SPI_CTRL_CPOL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SPI_CTRL_CPHA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The SPI clock frequency (<code>spi_sck_o</code>) is programmed by the 3-bit <em>SPI_CTRL_PRSCx</em> clock prescaler for a coarse selection
and a 4-bit clock divider <em>SPI_CTRL_CDIVx</em> for a fine selection.</p>
</div>
<div class="paragraph">
<p>The following pre-scalers (<em>SPI_CTRL_PRSCx</em>) are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 16. SPI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>SPI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the <em>SPI_CTRL_PRSCx</em> and <em>SPI_CTRL_CDIVx</em> configuration, the actual SPI clock frequency f<sub>SPI</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SPI</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code> * (1 + <em>SPI_CTRL_CDIVx</em>))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum SPI clock is f<sub>main</sub> / 4 and the lowest SPI clock is f<sub>main</sub> / 131072. The SPI clock is always
symmetric having a duty cycle of exactly 50%.</p>
</div>
<div class="paragraph">
<p><strong>SPI FIFO</strong></p>
</div>
<div class="paragraph">
<p>An optional FIFO buffer can be implemented by setting the <em>IO_SPI_FIFO</em> generic to a value greater than zero.
Implementing a data FIFO allows (more) CPU-independent operation of the SPI module.</p>
</div>
<div class="paragraph">
<p>Internally, two FIFOs are implemented: one for TX data and one for RX data. However, these two FIFOs are transparent for
the software and operate as a single, unified "ring buffer". The status signals of the TX FIFO ("empty", "at least half full",
"full") are exposed as read-only signals via the SPI control register. In contrast, the RX FIFO only provides a "data available"
flag (= RX FIFO not empty) also exposed via the SPI control register.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Double-Buffering</div>
Application programs can implement "double buffering" when using the "FIFO less than half full" interrupt configuration
option (see below).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SPI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The SPI module provides a single interrupt that can be used to signal certain transmission states to the CPU.
The actual interrupt condition is configured by the two <em>SPI_CTRL_IRQx</em> bits in the SPI module&#8217;s control register:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>00</code>, <code>01</code> : trigger interrupt when SPI serial engine <em>completes</em> current transmission</p>
</li>
<li>
<p><code>10</code> : trigger interrupt when TX FIFO <em>becomes</em> less than half full; this mode is not available if <em>IO_SPI_FIFO</em> is zero</p>
</li>
<li>
<p><code>11</code> : trigger interrupt when TX FIFO <em>becomes</em> empty; this mode is not available if <em>IO_SPI_FIFO</em> is zero</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Once the SPI CPU is triggered it has to be explicitly cleared again by writing zero to the according
<a href="#_mip"><strong><code>mip</code></strong></a> CSR bit inside the SPI trap handler.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If no FIFO is implemented (<em>IO_SPI_FIFO</em> = 0) the <em>SPI_CTRL_IRQx</em> are hardwired to <code>00</code> statically configuring
"SPI serial engine <em>completes</em> current transmission" as interrupt condition.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 17. SPI register map (<code>struct NEORV32_SPI</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>0xffffffa8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="16"><p class="tableblock"><code>NEORV32_SPI.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <em>SPI_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <em>SPI_CTRL_CPHA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock phase (<code>0</code>=sample RX on rising edge &amp; update TX on falling edge; <code>1</code>=sample RX on falling edge &amp; update TX on rising edge)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <em>SPI_CTRL_CPOL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4:3</code>   <em>SPI_CTRL_SIZE1</em> : <em>SPI_CTRL_SIZE0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer size (<code>00</code>=8-bit, <code>01</code>=16-bit, <code>10</code>=24-bit, <code>11</code>=32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:5</code>   <em>SPI_CTRL_CS_SEL2</em> : <em>SPI_CTRL_CS_SEL0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct chip-select 0..7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code>     <em>SPI_CTRL_CS_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct chip-select enable; setting <code>spi_csn_o(x)</code> low when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:9</code>  <em>SPI_CTRL_PRSC2</em> : <em>SPI_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:12</code> <em>SPI_CTRL_CDIV2</em> : <em>SPI_CTRL_CDIV0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17:16</code> <em>SPI_CTRL_IRQ1</em> : <em>SPI_CTRL_IRQ0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">interrupt configuration (<code>0-</code> = SPI serial engine becomes idle, <code>10</code> = TX FIFO <em>become</em> less than half full, <code>11</code> = TX FIFO <em>becomes</em> empty)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22:18</code> <em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26:23</code> <em>SPI_CTRL_FIFO_MSB</em> : <em>SPI_CTRL_FIFO_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FIFO depth; log2(<em>IO_SPI_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code>   <em>SPI_CTRL_RX_AVAIL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RX FIFO data available (RX FIFO not empty); zero if FIFO not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code>   <em>SPI_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO empty; zero if FIFO not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>   <em>SPI_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO at least half full; zero if FIFO not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>   <em>SPI_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO full; zero if FIFO not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>   <em>SPI_CTRL_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI module busy when set (serial engine operation in progress and TX FIFO not empty yet)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffac</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SPI.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (FIFO), LSB-aligned</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_two_wire_serial_interface_controller_twi">2.7.14. Two-Wire Serial Interface Controller (TWI)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_twi.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_sda_io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit bi-directional serial data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>twi_scl_io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit bi-directional serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_TWI_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TWI controller when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transmission done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The two wire interface - also called "IC" - is a quite famous interface for connecting several on-board
components. Since this interface only needs two signals (the serial data line <code>twi_sda_io</code> and the serial
clock line <code>twi_scl_io</code>) for an arbitrarily number of devices it allows easy interconnections of
several peripheral nodes.</p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI implements a <strong>TWI controller</strong>. Currently, <strong>no multi-controller
support</strong> is available. Furthermore, the NEORV32 TWI unit cannot operate in peripheral mode.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The serial clock (SCL) and the serial data (SDA) lines can only be actively driven low by the
controller. Hence, external pull-up resistors are required for these lines.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TWI Clock Speed</strong></p>
</div>
<div class="paragraph">
<p>The TWI clock frequency is programmed by the 3-bit <em>TWI_CTRL_PRSCx</em> clock prescaler for a coarse selection
and a 4-bit clock divider <em>TWI_CTRL_CDIVx</em> for a fine selection.</p>
</div>
<div class="paragraph">
<p>The following pre-scalers (<em>TWI_CTRL_PRSCx</em>) are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 18. TWI prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>TWI_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the <em>TWI_CTRL_PRSCx</em> and <em>TWI_CTRL_CDIVx</em> configuration, the actual TWI clock frequency f<sub>SCL</sub> is derived
from the processor&#8217;s main clock f<sub>main</sub> according to the following equation:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>SCL</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (4 * <code>clock_prescaler</code> * (1 + TWI_CTRL_CDIV))</p>
</div>
<div class="paragraph">
<p>Hence, the maximum TWI clock is f<sub>main</sub> / 8 and the lowest TWI clock is f<sub>main</sub> / 262144. The generated TWI clock is
always symmetric having a duty cycle of exactly 50%. However, an accessed peripheral can "slow down" the bus clock
by using <strong>clock stretching</strong> (= actively driving the SCL line low). The controller will pause operation in this case
if clock stretching is enabled via the <em>TWI_CTRL_CSEN</em> bit of the unit&#8217;s control register <code>CTRL</code></p>
</div>
<div class="paragraph">
<p><strong>TWI Transfers</strong></p>
</div>
<div class="paragraph">
<p>The TWI is enabled via the <em>TWI_CTRL_EN</em> bit in the <code>CTRL</code> control register. The user program can start / stop a
transmission by issuing a START or STOP condition. These conditions are generated by setting the
according bits (<em>TWI_CTRL_START</em> or <em>TWI_CTRL_STOP</em>) in the control register.</p>
</div>
<div class="paragraph">
<p>Data is transferred via the TWI bus by writing a byte to the <code>DATA</code> register. The written byte is send via the TWI bus
and the received byte from the bus is also available in this register after the transmission is completed.</p>
</div>
<div class="paragraph">
<p>The TWI operation (transmitting data or performing a START or STOP condition) is in progress as long as the
control register&#8217;s <em>TWI_CTRL_BUSY</em> bit is set.</p>
</div>
<div class="paragraph">
<p><strong>TWI ACK/NACK and MACK</strong></p>
</div>
<div class="paragraph">
<p>An accessed TWI peripheral has to acknowledge each transferred byte. When the <em>TWI_CTRL_ACK</em> bit is set after a
completed transmission the accessed peripheral has send an <em>acknowledge</em>. If this bit is cleared after a completed
transmission, the peripheral has send a <em>not-acknowledge</em> (NACK).</p>
</div>
<div class="paragraph">
<p>The NEORV32 TWI controller can also send an ACK generated by itself ("controller acknowledge <em>MACK</em>") right after
transmitting a byte by driving SDA low during the ACK time slot. Some TWI modules require this MACK to acknowledge
certain data movement operations.</p>
</div>
<div class="paragraph">
<p>The control register&#8217;s <em>TWI_CTRL_MACK</em> bit has to be set to make the TWI module automatically generate a MACK after
the byte transmission has been completed. If this bit is cleared, the ACK/NACK generated by the peripheral is sampled
in this time slot instead (normal mode).</p>
</div>
<div class="paragraph">
<p><strong>TWI Bus Status</strong></p>
</div>
<div class="paragraph">
<p>The TWI controller can check if the TWI bus is currently claimed (SCL and SDA both low). The bus can be claimed by the
NEORV32 TWI itself or by any other controller. Bit <em>TWI_CTRL_CLAIMED</em> of the control register will be set if the bus
is currently claimed.</p>
</div>
<div class="paragraph">
<p><strong>Summary</strong></p>
</div>
<div class="paragraph">
<p>In summary, a complete TWI transfer is based on the following elementary operation:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>generate START condition by setting <em>TWI_CTRL_START</em></p>
</li>
<li>
<p>wait until <em>TWI_CTRL_BUSY</em> has cleared (start condition completed)</p>
</li>
<li>
<p>transfer one byte while also sampling one byte from the bus (this also samples ACK/NACK or generates a
controller ACK "MACK" if <em>TWI_CTRL_MACK</em> is set) by writing data to <code>NEORV32_TWI.DATA</code>; this step can be repeated to
send/receive an arbitrary number of bytes</p>
</li>
<li>
<p>wait until <em>TWI_CTRL_BUSY</em> has cleared (data transfer completed)</p>
</li>
<li>
<p>optionally generate another START condition (as REPEATED-START condition) by setting <em>TWI_CTRL_START</em> again</p>
</li>
<li>
<p>wait until <em>TWI_CTRL_BUSY</em> has cleared (repeated-start condition completed)</p>
</li>
<li>
<p>generate STOP condition by setting <em>TWI_CTRL_STOP</em></p>
</li>
<li>
<p>wait until <em>TWI_CTRL_BUSY</em> has cleared (stop condition completed)</p>
</li>
</ol>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A transmission can be terminated at any time by disabling the TWI module
by clearing the <em>TWI_CTRL_EN</em> control register bit. This will also reset the whole module.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When reading data from a device, an all-one byte (<code>0xFF</code>) has to be written to TWI data register <code>NEORV32_TWI.DATA</code>
so the accessed device can actively pull-down SDA when required.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TWI Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The TWI module provides a single interrupt to signal "transmission done" to the CPU. Whenever the TWI
module completes the current transmission of one byte the interrupt is triggered. Note the the interrupt
is <strong>not</strong> triggered when completing a START or STOP condition. Once triggered, the interrupt has to be
explicitly cleared again by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 19. TWI register map (<code>struct NEORV32_TWI</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xffffffb0</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>NEORV32_TWI.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <em>TWI_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TWI enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>     <em>TWI_CTRL_START</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate START condition, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>     <em>TWI_CTRL_STOP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate STOP condition, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>     <em>TWI_CTRL_MACK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">generate controller-ACK for each transmission ("MACK")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>     <em>TWI_CTRL_CSEN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">allow clock stretching when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:5</code>   <em>TWI_CTRL_PRSC2</em> : <em>TWI_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11:8</code>  <em>TWI_CTRL_CDIV3</em> : <em>TWI_CTRL_CDIV0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4-bit clock divider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:12</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <em>TWI_CTRL_CLAIMED</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI bus is claimed by any controller</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <em>TWI_CTRL_ACK</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ACK received when set, NACK received when cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <em>TWI_CTRL_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">transfer/START/STOP in progress when set</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffffb4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_TWI.DATA</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_one_wire_serial_interface_controller_onewire">2.7.15. One-Wire Serial Interface Controller (ONEWIRE)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_onewire.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>onewire_io</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit bi-directional serial data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_ONEWIRE_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement ONEWIRE interface controller when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation done interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 ONEWIRE module implements a single-wire interface controller that is compatible to the
<em>Dallas/Maxim 1-Wire</em> protocol, which is an asynchronous half-duplex bus requiring only a single signal wire
connected to <code>onewire_io</code> (plus ground).
The 1-Wire protocol allows an (nearly) arbitrary number of devices but only a single controller that initiates all transfers.</p>
</div>
<div class="paragraph">
<p>The bus is based on a single tristate signal. The controller and all the devices can only pull-down the bus actively.
Hence, an external pull-up resistor is required. Recommended values are between 1k and 4k depending on the bus
characteristics (wire length, number of devices, etc.). Furthermore, a series resistor (~100) at the controller side
is recommended to control the slew rate and to reduce signal reflections. Also, additional external ESD protection clamp diodes
should be added to the <code>onewire_io</code> bus line.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more information regarding the 1-Wire bus and the device access mechanism
see the Application Notes provided by Maxim Integrated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The ONEWIRE controller provides two interface registers: <code>CTRL</code> and <code>DATA.</code> The control registers (<code>CTRL</code>)
is used to configure the module, to trigger bus transactions and to monitor the current state of the module.
The <code>DATA</code> register is used to read/write data from/to the bus.</p>
</div>
<div class="paragraph">
<p>The module is enabled by setting the <em>ONEWIRE_CTRL_EN</em> bit in the control register. If this bit is cleared, the
module is automatically reset and the bus is brought to high-impedance (tristate) state.
The basic timing configuration is programmed via the clock prescaler bits <em>ONEWIRE_CTRL_PRSCx</em> and the
clock divider bits <em>ONEWIRE_CTRL_CLKDIVx</em> (see next section).</p>
</div>
<div class="paragraph">
<p>The controller can execute three basic bus operations, which are triggered by setting one out of three specific
control register bits (the bits auto-clear):</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>generate reset pulse and check for device presence; triggered when setting <em>ONEWIRE_CTRL_TRIG_RST</em></p>
</li>
<li>
<p>transfer a single-bit (read-while-write); triggered when setting <em>ONEWIRE_CTRL_TRIG_BIT</em></p>
</li>
<li>
<p>transfer a full-byte (read-while-write); triggered when setting <em>ONEWIRE_CTRL_TRIG_BYTE</em></p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Only one trigger bit may be set at once, otherwise undefined behavior might occur.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>When a single-bit operation has been triggered, the data previously written to <code>DATA[0]</code> will be send to the bus
and <code>DATA[7]</code> will be sampled from the bus. Accordingly, a full-byte transmission will send the previously
byte written to <code>DATA[7:0]</code> to the bus and will update <code>DATA[7:0]</code> with the data read from the bus (LSB-first).
The triggered operation has completed when the module&#8217;s busy flag <em>ONEWIRE_CTRL_BUSY</em> has cleared again.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read from Bus</div>
In order to read a single bit from the bus <code>DATA[0]</code> has to set to <code>1</code> before triggering the bit transmission
operation to allow the accessed device to pull-down the bus. Accordingly, <code>DATA</code> has to be set to <code>0xFF</code> before
triggering the byte transmission operation when the controller shall read a byte from the bus.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <em>ONEWIRE_CTRL_PRESENCE</em> bit gets set if at least one device has send a "presence" signal right after the
reset pulse.</p>
</div>
<div class="paragraph">
<p><strong>Bus Timing</strong></p>
</div>
<div class="paragraph">
<p>The control register provides a 2-bit clock prescaler select (<em>ONEWIRE_CTRL_PRSCx</em>) and a 8-bit clock divider
(<em>ONEWIRE_CTRL_CLKDIVx</em>) for timing configuration. Both are used to define the elementary <strong>base time T<sub>base</sub></strong>.
All bus operations are timed using <em>multiples</em> of this elementary base time.</p>
</div>
<div class="paragraph">
<p>The following clock prescalers are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 20. ONEWIRE clock prescaler configurations</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>ONEWIRE_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b00</code></th>
<th class="tableblock halign-center valign-top"><code>0b01</code></th>
<th class="tableblock halign-center valign-top"><code>0b10</code></th>
<th class="tableblock halign-center valign-top"><code>0b11</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Together with the clock divider value (<em>ONEWIRE_CTRL_PRSCx</em> bits = <code>clock_divider</code>) the base time is defined by the
following formula:</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / <em>f<sub>main</sub>[Hz]</em>) * <code>clock_prescaler</code> * (<code>clock_divider</code> + 1)</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>f<sub>main</sub></em> = 100MHz</p>
</li>
<li>
<p>clock prescaler select = <code>0b01</code> &#8594; <code>clock_prescaler</code> = 4</p>
</li>
<li>
<p>clock divider <code>clock_divider</code> = 249</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>T<sub>base</sub></strong></em> = (1 / 100000000Hz) * 4 * (249 + 1) = 10000ns = <strong>10s</strong></p>
</div>
<div class="paragraph">
<p>The base time is used to coordinate all bus interactions. Hence, all delays, time slots and points in time are
quantized as multiples of the base time. The following images show the two basic operations of the ONEWIRE
controller: single-bit (0 or 1) transaction and reset with presence detect. The relevant points in time are
shown as <em>absolute</em> time (in multiples of the time base) with the bus' falling edge as reference point.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="img/onewire_data.png" alt="onewire data">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock text-center">
<div class="content">
<img src="img/onewire_reset.png" alt="onewire reset">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Single-bit data transmission (not to scale)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Reset pulse and presence detect (not to scale)</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 21. Data Transmission Timing</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 42.8571%;">
<col style="width: 21.4285%;">
<col style="width: 21.4287%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Symbol</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-center valign-top">Multiples of T<sub>base</sub></th>
<th class="tableblock halign-center valign-top">Time when T<sub>base</sub> = 10s</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Single-bit data transmission</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t0</code> (a&#8594;b)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active low-phase when writing a <code>'1'</code> or when reading</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">10s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t1</code> (a&#8594;c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus state (read operation)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">20s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t2</code> (a&#8594;d)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of bit time slot (when writing a <code>'0'</code> or when reading)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">70s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t3</code> (a&#8594;e)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of inter-slot pause (= total duration of one bit)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">90s</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Reset pulse and presence detect</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t4</code> (f&#8594;g)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of active reset pulse</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">48</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">480s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t5</code> (f&#8594;h)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until controller samples bus presence</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">55</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">550s</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>t6</code> (f&#8594;i)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time until end of presence phase</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">96</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">960s</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default values for base time multiples were chosen to for stable and reliable bus
operation (not for maximum throughput).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The absolute points in time are hardwired by the VHDL code and cannot be changed during runtime.
However, the timing parameter can be customized by editing the ONEWIRE&#8217;s VHDL source file:</p>
</div>
<div class="listingblock">
<div class="title">Listing 3. Hardwired time configuration in <code>neorv32_onewire.vhd</code></div>
<div class="content">
<pre class="highlight"><code class="language-VHDL" data-lang="VHDL">-- timing configuration (absolute time in multiples of the base tick time t_base) --
constant t_write_one_c       : unsigned(6 downto 0) := to_unsigned( 1, 7); -- t0
constant t_read_sample_c     : unsigned(6 downto 0) := to_unsigned( 2, 7); -- t1
constant t_slot_end_c        : unsigned(6 downto 0) := to_unsigned( 7, 7); -- t2
constant t_pause_end_c       : unsigned(6 downto 0) := to_unsigned( 9, 7); -- t3
constant t_reset_end_c       : unsigned(6 downto 0) := to_unsigned(48, 7); -- t4
constant t_presence_sample_c : unsigned(6 downto 0) := to_unsigned(55, 7); -- t5
constant t_presence_end_c    : unsigned(6 downto 0) := to_unsigned(96, 7); -- t6</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Overdrive</div>
The ONEWIRE controller does not support the <em>overdrive</em> mode. However, it can be implemented by reducing the base
time <strong>T<sub>base</sub></strong> (and by eventually changing the hardwired timing configuration in the VHDL source file).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Interrupt</strong></p>
</div>
<div class="paragraph">
<p>A single interrupt is provided by the ONEWIRE module to signal "operation done" condition to the CPU. Whenever the
controller completes a "generate reset pulse", a "transfer single-bit" or a "transfer full-byte" operation the
interrupt is triggered. Once triggered, the interrupt has to be <em>explicitly</em> cleared again by writing zero to the
according <a href="#_mip"><strong><code>mip</code></strong></a> CSR FIRQ bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 22. ONEWIRE register map (<code>struct NEORV32_ONEWIRE</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>0xffffff70</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="10"><p class="tableblock"><code>NEORV32_ONEWIRE.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>     <em>ONEWIRE_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ONEWIRE enable, reset if cleared</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2:1</code>   <em>ONEWIRE_CTRL_PRSC1</em>   : <em>ONEWIRE_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10:3</code>  <em>ONEWIRE_CTRL_CLKDIV7</em> : <em>ONEWIRE_CTRL_CLKDIV0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit clock divider value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code>    <em>ONEWIRE_CTRL_TRIG_RST</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger reset pulse, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code>    <em>ONEWIRE_CTRL_TRIG_BIT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger single bit transmission, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code>    <em>ONEWIRE_CTRL_TRIG_BYTE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger full-byte transmission, auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28:14</code> -</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code>    <em>ONEWIRE_CTRL_SENSE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current state of the bus line</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code>    <em>ONEWIRE_CTRL_PRESENCE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">device presence detected after reset pulse</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code>    <em>ONEWIRE_CTRL_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">operation in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff74</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_ONEWIRE.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>ONEWIRE_DATA_MSB</em> : <em>ONEWIRE_DATA_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">receive/transmit data (8-bit)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_pulse_width_modulation_controller_pwm">2.7.16. Pulse-Width Modulation Controller (PWM)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_pwm.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pwm_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">up to 60 PWM output channels (60-bit, fixed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_PWM_NUM_CH</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of PWM channels to implement (0..60)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The PWM controller implements a pulse-width modulation controller with up to 60 independent channels and 8-
bit resolution per channel. The actual number of implemented channels is defined by the <em>IO_PWM_NUM_CH</em> generic.
Setting this generic to zero will completely remove the PWM controller from the design.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>pwm_o</code> has a static size of 60-bit. Is less than 60 PWM channels are configured, only the LSB-aligned channels
(bits) are used while the remaining bits are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The PWM controller is based on an 8-bit base counter with a programmable threshold comparators for each channel
that defines the actual duty cycle. The controller can be used to drive fancy RGB-LEDs with 24-
bit true color, to dim LCD back-lights or even for "analog" control. An external integrator (RC low-pass filter)
can be used to smooth the generated "analog" signals.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The PWM controller is activated by setting the <em>PWM_CTRL_EN</em> bit in the module&#8217;s control register <code>CTRL</code>. When this
bit is cleared, the unit is reset and all PWM output channels are set to zero.
The 8-bit duty cycle for each channel, which represents the channel&#8217;s "intensity", is defined via an 8-bit value. The module
provides up to 15 duty cycle registers <code>DUTY[0]</code> to <code>DUTY[14]</code> (depending on the number of implemented channels).
Each register contains the duty cycle configuration for 4 consecutive channels. For example, the duty cycle of channel 0
is defined via bits 7:0 in <code>DUTY[0]</code>. The duty cycle of channel 2 is defined via bits 15:0 in <code>DUTY[0]</code>.
Channel 4&#8217;s duty cycle is defined via bits 7:0 in <code>DUTY[1]</code> and so on.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless of the configuration of <em>IO_PWM_NUM_CH</em> all module registers can be accessed without raising an exception.
Software can discover the number of available channels by writing 0xff to all duty cycle configuration bytes and
reading those values back. The duty-cycle of channels that were not implemented always reads as zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Based on the configured duty cycle the according intensity of the channel can be computed by the following formula:</p>
</div>
<div class="paragraph">
<p><em><strong>Intensity<sub>x</sub></strong></em> = <code>DUTY[y](i*8+7 downto i*8)</code> / (2<sup>8</sup>)</p>
</div>
<div class="paragraph">
<p>The base frequency of the generated PWM signals is defined by the PWM core clock. This clock is derived
from the main processor clock and divided by a prescaler via the 3-bit PWM_CTRL_PRSCx in the unit&#8217;s control
register. The following pre-scalers are available:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 23. PWM prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>PWM_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The resulting PWM base frequency is defined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>PWM</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2<sup>8</sup> * <code>clock_prescaler</code>)</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 24. PWM register map (<code>struct neorv32_pwm_t</code>)</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 8.3333%;">
<col style="width: 33.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffe80</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>PWM_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PWM enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>PWM_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>PWM_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>PWM_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffe84</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.DUTY[0]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>0xfffffebc</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock"><code>NEORV32_PWM.DUTY[14]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 56</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15:8</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 57</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23:16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 58</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:24</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit duty cycle for channel 59</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_true_random_number_generator_trng">2.7.17. True Random-Number Generator (TRNG)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_trng.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_TRNG_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement TRNG when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_TRNG_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data FIFO depth, min 1, has to be a power of two</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The NEORV32 true random number generator provides <em>physically</em> true random numbers.
Instead of using a pseudo RNG like a LFSR, the TRNG uses a simple, straight-forward ring
oscillator concept as physical entropy source. Hence, voltage, thermal and also semiconductor manufacturing
fluctuations are used to provide a true physical entropy source.</p>
</div>
<div class="paragraph">
<p>The TRNG features a platform independent architecture without FPGA-specific primitives, macros or
attributes so it can be synthesized for <em>any</em> FPGA. Ir is based on the <strong>neoTRNG V2</strong>, which is a "spin-off project" of the
NEORV32 processor. More detailed information about the neoTRNG, its architecture and a
detailed evaluation of the random number quality can be found it the neoTRNG repository: <a href="https://github.com/stnolting/neoTRNG" class="bare">https://github.com/stnolting/neoTRNG</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Inferring Latches</div>
The synthesis tool might emit a warning like <em>"inferring latches for &#8230;&#8203; neorv32_trng &#8230;&#8203;"</em>. This is no problem
as this is what we actually want: the TRNG is based on latches, which implement the inverters of the ring oscillators.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Simulation</div>
When simulating the processor the NEORV32 TRNG is automatically set to "simulation mode". In this mode, the physical entropy
sources (= the ring oscillators) are replaced by a simple <strong>pseudo RNG (LFSR)</strong> providing weak pseudo-random data only.
The <em>TRNG_CTRL_SIM_MODE</em> flag of the control register is set if simulation mode is active.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Using the TRNG</strong></p>
</div>
<div class="paragraph">
<p>The TRNG features a single control register <code>CTRL</code> for control, status check and data access. When the <em>TRNG_CTRL_EN</em>
bit is set, the TRNG is enabled and starts operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">TRNG Reset</div>
The TRNG core does not provide a dedicated reset. In order to ensure correct operations, the TRNG should be
disabled (=reset) by clearing the <em>TRNG_CTRL_EN</em> and waiting some 1000s clock cycles before re-enabling it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As soon as the <em>TRNG_CTRL_VALID</em> bit is set a new random data byte is available and can be obtained from the lowest 8 bits
of the <code>CTRL</code> register (<em>TRNG_CTRL_DATA_MSB</em> : <em>TRNG_CTRL_DATA_LSB</em>). If this bit is cleared, there is no valid data available
and the lowest 8 bit of the <code>CTRL</code> register are set to all-zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Read Access Security</div>
The random data byte (<em>TRNG_CTRL_DATA</em>) in the control register is automatically cleared after each read access
to prevent software from reading the <em>same</em> random data byte more than once.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>An optional random data FIFO can be configured using the <a href="#_io_trng_fifo"><em>IO_TRNG_FIFO</em></a> generic. This FIFO automatically samples
new random data from the TRNG to provide some kind of <em>random data pool</em> for applications, which require a large number
of RND data in a short time. The minimal and default value for <a href="#_io_trng_fifo"><em>IO_TRNG_FIFO</em></a> is 1 (implementing a register rather
than a real FIFO); the generic has to be a power of two.</p>
</div>
<div class="paragraph">
<p>The random data FIFO can be cleared at any time either by disabling the TRNG via the <em>TRNG_CTRL_EN</em> flag or by
setting the <em>TRNG_CTRL_FIFO_CLR</em> flag. Note that this flag is write-only and auto clears after being set.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 25. TRNG register map (<code>struct NEORV32_TRNG</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>0xffffffb8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>NEORV32_TRNG.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7:0</code> <em>TRNG_CTRL_DATA_MSB</em> : <em>TRNG_CTRL_DATA_MSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8-bit random data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>TRNG_CTRL_FIFO_CLR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">flush random data FIFO when set (auto clears)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>TRNG_CTRL_SIM_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">simulation mode (PRNG!)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>TRNG_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TRNG enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>TRNG_CTRL_VALID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random data is valid when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_custom_functions_subsystem_cfs">2.7.18. Custom Functions Subsystem (CFS)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_cfs.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_in_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom input conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cfs_out_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom output conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement CFS when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_CONFIG</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom generic conduit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_IN_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_in_i</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_CFS_OUT_SIZE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">size of <code>cfs_out_o</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CFS interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The custom functions subsystem is meant for implementing custom and application-specific logic.
The CFS provides up to 32x 32-bit memory-mapped read/write
registers (<code>REG</code>, see register map below) that can be accessed by the CPU via normal load/store operations.
The actual functionality of these register has to be defined by the hardware designer. Furthermore, the CFS
provides two IO conduits to implement custom on-chip or off-chip interfaces.</p>
</div>
<div class="paragraph">
<p>In contrast to connecting custom hardware accelerators via external memory interfaces (like SPI or the processor&#8217;s
external bus interface), the CFS provide a convenient, low-latency and tightly-coupled extension and
customization option.</p>
</div>
<div class="paragraph">
<p>Just like any other externally-connected IP, logic implemented within the custom functions subsystem can operate
<em>independently</em> of the CPU providing true parallel processing capabilities. Potential use cases might include
dedicated hardware accelerators for en-/decryption (AES), signal processing (FFT) or AI applications
(CNNs) as well as custom IO systems like fast memory interfaces (DDR) and mass storage (SDIO), networking (CAN)
or real-time data transport (I2S).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If you like to implement <em>custom instructions</em> that are executed right within the CPU&#8217;s ALU
see the <a href="#_zxcfu_custom_instructions_extension_cfu"><strong><code>Zxcfu</code></strong> Custom Instructions Extension (CFU)</a> and the according <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Take a look at the template CFS VHDL source file (<code>rtl/core/neorv32_cfs.vhd</code>). The file is highly
commented to illustrate all aspects that are relevant for implementing custom CFS-based co-processor designs.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CFS can also be used to <em>replicate</em> existing NEORV32 modules - for example to implement several TWI controllers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CFS Software Access</strong></p>
</div>
<div class="paragraph">
<p>The CFS memory-mapped registers can be accessed by software using the provided C-language aliases (see
register map table below). Note that all interface registers are declared as 32-bit words of type <code>uint32_t</code>.</p>
</div>
<div class="listingblock">
<div class="title">Listing 4. CFS Software Access Example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// C-code CFS usage example
NEORV32_CFS.REG[0] = (uint32_t)some_data_array(i); // write to CFS register 0
int temp = (int)NEORV32_CFS.REG[20]; // read from CFS register 20</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
A very simple example program that uses the <em>default</em> CFS hardware module can be found in <code>sw/example/cfs_demo</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>CFS Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The CFS provides a single high-level-triggered interrupt request signal mapped to the CPU&#8217;s fast interrupt channel 1.
Once triggered, the interrupt becomes pending (if enabled in the <code>mis</code> CSR) and has to be explicitly cleared again by
writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit. See section <a href="#_processor_interrupts">Processor Interrupts</a> for more information.</p>
</div>
<div class="paragraph">
<p><strong>CFS Configuration Generic</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS provides a single 32-bit <code>std_(u)logic_vector</code> configuration generic <em>IO_CFS_CONFIG</em>
that is available in the processor&#8217;s top entity. This generic can be used to pass custom configuration options
from the top entity directly down to the CFS. The actual definition of the generic and it&#8217;s usage inside the
CFS is left to the hardware designer.</p>
</div>
<div class="paragraph">
<p><strong>CFS Custom IOs</strong></p>
</div>
<div class="paragraph">
<p>By default, the CFS also provides two unidirectional input and output conduits <code>cfs_in_i</code> and <code>cfs_out_o</code>.
These signals are directly propagated to the processor&#8217;s top entity. These conduits can be used to implement
application-specific interfaces like memory or peripheral connections. The actual use case of these signals
has to be defined by the hardware designer.</p>
</div>
<div class="paragraph">
<p>The size of the input signal conduit <code>cfs_in_i</code> is defined via the top&#8217;s <em>IO_CFS_IN_SIZE</em> configuration
generic (default = 32-bit). The size of the output signal conduit <code>cfs_out_o</code> is defined via the top&#8217;s
<em>IO_CFS_OUT_SIZE</em> configuration generic (default = 32-bit). If the custom function subsystem is not implemented
(<em>IO_CFS_EN</em> = false) the <code>cfs_out_o</code> signal is tied to all-zero.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 26. CFS register map (<code>struct NEORV32_CFS</code>)</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 17.8571%;">
<col style="width: 7.1428%;">
<col style="width: 10.7142%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe00</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe04</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe78</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[30]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 30</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffffe7c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_CFS.REG[31]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(r)/(w)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom CFS interface register 31</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_smart_led_interface_neoled">2.7.19. Smart LED Interface (NEOLED)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_neoled.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neoled_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_NEOLED_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement NEOLED when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_NEOLED_TX_FIFO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO depth (1..32k, has to be a power of two)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED module provides a dedicated interface for "smart RGB LEDs" like the WS2812 or WS2811.
These LEDs provide a single interface wire that uses an asynchronous serial protocol for transmitting color
data. Basically, data is transferred via LED-internal shift registers, which allows to cascade an unlimited
number of smart LEDs. The protocol provides a RESET command to strobe the transmitted data into the
LED PWM driver registers after data has shifted throughout all LEDs in a chain.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEOLED interface is compatible to the "Adafruit Industries NeoPixel" products, which feature
WS2812 (or older WS2811) smart LEDs (see link:https://learn.adafruit.com/adafruit-neopixel-uberguide).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The interface provides a single 1-bit output <code>neoled_o</code> to drive an arbitrary number of cascaded LEDs. Since the
NEOLED module provides 24-bit and 32-bit operating modes, a mixed setup with RGB LEDs (24-bit color)
and RGBW LEDs (32-bit color including a dedicated white LED chip) is possible.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation - NEOLED Module</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules provides two accessible interface registers: the control register <code>CTRL</code> and the
TX data register <code>DATA</code>. The NEOLED module is globally enabled via the control register&#8217;s
<em>NEOLED_CTRL_EN</em> bit. Clearing this bit will terminate any current operation, clear the TX buffer, reset the module
and set the <code>neoled_o</code> output to zero. The precise timing (implementing the <strong>WS2812</strong> protocol) and transmission
mode are fully programmable via the <code>CTRL</code> register to provide maximum flexibility.</p>
</div>
<div class="paragraph">
<p><strong>RGB / RGBW Configuration</strong></p>
</div>
<div class="paragraph">
<p>NeoPixel are available in two "color" version: LEDs with three chips providing RGB color and LEDs with
four chips providing RGB color plus a dedicated white LED chip (= RGBW). Since the intensity of every
LED chip is defined via an 8-bit value the RGB LEDs require a frame of 24-bit per module and the RGBW
LEDs require a frame of 32-bit per module.</p>
</div>
<div class="paragraph">
<p>The data transfer quantity of the NEOLED module can be configured via the <em>NEOLED_MODE_EN</em> control
register bit. If this bit is cleared, the NEOLED interface operates in 24-bit mode and will transmit bits <code>23:0</code> of
the data written to <code>DATA</code> to the LEDs. If <em>NEOLED_MODE_EN</em> is set, the NEOLED interface operates in 32-bit
mode and will transmit bits <code>31:0</code> of the data written to <code>DATA</code> to the LEDs.</p>
</div>
<div class="paragraph">
<p>The mode bit can be configured before writing each new data word in order to support
an arbitrary setup of RGB and RGBW LEDs.</p>
</div>
<div class="paragraph">
<p><strong>Protocol</strong></p>
</div>
<div class="paragraph">
<p>The interface of the WS2812 LEDs uses an 800kHz carrier signal. Data is transmitted in a serial manner
starting with LSB-first. The intensity for each R, G &amp; B (&amp; W) LED chip (= color code) is defined via an 8-bit
value. The actual data bits are transferred by modifying the duty cycle of the signal (the timings for the
WS2812 are shown below). A RESET command is "send" by pulling the data line LOW for at least 50s.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neopixel.png" alt="neopixel">
</div>
<div class="title">Figure 7. WS2812 bit-level protocol - taken from the "Adafruit NeoPixel berguide"</div>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 27. WS2812 interface timing</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 60%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>total</sub> (T<sub>carrier</sub>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.25s +/- 300ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">period for a single bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.4s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>0L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.8s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1H</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.85s +/- 150ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">high-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">T<sub>1L</sub></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0.45s +/- 150 ns</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a <code>0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RESET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Above 50s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">low-time for sending a RESET command</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Timing Configuration</strong></p>
</div>
<div class="paragraph">
<p>The basic carrier frequency (800kHz for the WS2812 LEDs) is configured via a 3-bit main clock prescaler (<em>NEOLED_CTRL_PRSCx</em>, see table below)
that scales the main processor clock f<sub>main</sub> and a 5-bit cycle multiplier <em>NEOLED_CTRL_T_TOT_x</em>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 28. NEOLED prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>NEOLED_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The duty-cycles (or more precisely: the high- and low-times for sending either a '1' bit or a '0' bit) are
defined via the 5-bit <em>NEOLED_CTRL_T_ONE_H_x</em> and <em>NEOLED_CTRL_T_ZERO_H_x</em> values, respectively. These programmable
timing constants allow to adapt the interface for a wide variety of smart LED protocol (for example WS2812 vs.
WS2811).</p>
</div>
<div class="paragraph">
<p><strong>Timing Configuration - Example (WS2812)</strong></p>
</div>
<div class="paragraph">
<p>Generate the base clock f<sub>TX</sub> for the NEOLED TX engine:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>processor clock f<sub>main</sub> = 100 MHz</p>
</li>
<li>
<p><em>NEOLED_CTRL_PRSCx</em> = <code>0b001</code> = f<sub>main</sub> / 4</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>f<sub>TX</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / <code>clock_prescaler</code> = 100MHz / 4 = 25MHz</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>TX</sub></strong></em> = 1 / <em><strong>f<sub>TX</sub></strong></em> = 40ns</p>
</div>
<div class="paragraph">
<p>Generate carrier period (T<sub>carrier</sub>) and <strong>high-times</strong> (duty cycle) for sending <code>0</code> (T<sub>0H</sub>) and <code>1</code> (T<sub>1H</sub>) bits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>NEOLED_CTRL_T_TOT</em> = <code>0b11110</code> (= decimal 30)</p>
</li>
<li>
<p><em>NEOLED_CTRL_T_ZERO_H</em> = <code>0b01010</code> (= decimal 10)</p>
</li>
<li>
<p><em>NEOLED_CTRL_T_ONE_H</em> = <code>0b10100</code> (= decimal 20)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em><strong>T<sub>carrier</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_TOT</em> = 40ns * 30 = 1.4s</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>0H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_ZERO_H</em> = 40ns * 10 = 0.4s</p>
</div>
<div class="paragraph">
<p><em><strong>T<sub>1H</sub></strong></em> = <em><strong>T<sub>TX</sub></strong></em> * <em>NEOLED_CTRL_T_ONE_H</em> = 40ns * 20 = 0.8s</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The NEOLED SW driver library (<code>neorv32_neoled.h</code>) provides a simplified configuration
function that configures all timing parameters for driving WS2812 LEDs based on the processor
clock frequency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>TX Data FIFO</strong></p>
</div>
<div class="paragraph">
<p>The interface features a TX data buffer (a FIFO) to allow more CPU-independent operation. The buffer depth
is configured via the <em>IO_NEOLED_TX_FIFO</em> top generic (default = 1 entry).
The FIFO size configuration can be read via the <em>NEOLED_CTRL_BUFS_x</em>
control register bits, which result log2(<em>IO_NEOLED_TX_FIFO</em>).</p>
</div>
<div class="paragraph">
<p>When writing data to the <code>DATA</code> register the data is automatically written to the TX buffer. Whenever
data is available in the buffer the serial transmission engine will take it and transmit it to the LEDs.
The data transfer size (<em>NEOLED_MODE_EN</em>) can be modified at every time since this control register bit is also buffered
in the FIFO. This allows to arbitrarily mixing RGB and RGBW LEDs in the chain.</p>
</div>
<div class="paragraph">
<p>Software can check the FIFO fill level via the control register&#8217;s <em>NEOLED_CTRL_TX_EMPTY</em>, <em>NEOLED_CTRL_TX_HALF</em>
and <em>NEOLED_CTRL_TX_FULL</em> flags. The <em>NEOLED_CTRL_TX_BUSY</em> flags provides additional information if the the TX unit is
still busy sending data.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Please note that the timing configurations (<em>NEOLED_CTRL_PRSCx</em>, <em>NEOLED_CTRL_T_TOT_x</em>,
<em>NEOLED_CTRL_T_ONE_H_x</em> and <em>NEOLED_CTRL_T_ZERO_H_x</em>) are <strong>NOT</strong> stored to the buffer. Changing
these value while the buffer is not empty or the TX engine is still busy will cause data corruption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Strobe Command ("RESET")</strong></p>
</div>
<div class="paragraph">
<p>According to the WS2812 specs the data written to the LED&#8217;s shift registers is strobed to the actual PWM driver
registers when the data line is low for 50s ("RESET" command, see table above). This can be implemented
using busy-wait for at least 50s. Obviously, this concept wastes a lot of processing power.</p>
</div>
<div class="paragraph">
<p>To circumvent this, the NEOLED module provides an option to automatically issue an idle time for creating the RESET
command. If the <em>NEOLED_CTRL_STROBE</em> control register bit is set, <em>all</em> data written to the data FIFO (via <code>DATA</code>,
the actually written data is irrelevant) will trigger an idle phase (<code>neoled_o</code> = zero) of 127 periods (= <em><strong>T<sub>carrier</sub></strong></em>).
This idle time will cause the LEDs to strobe the color data into the PWM driver registers.</p>
</div>
<div class="paragraph">
<p>Since the <em>NEOLED_CTRL_STROBE</em> flag is also buffered in the TX buffer, the RESET command is treated just as another
data word being written to the TX buffer making busy wait concepts obsolete and allowing maximum refresh rates.</p>
</div>
<div class="paragraph">
<p><strong>NEOLED Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The NEOLED modules features a single interrupt that becomes pending based on the current TX buffer fill level.
The interrupt can only become pending if the NEOLED module is enabled. The specific interrupt condition
is configured via the <em>NEOLED_CTRL_IRQ_CONF</em> bit in the unit&#8217;s control register.</p>
</div>
<div class="paragraph">
<p>If <em>NEOLED_CTRL_IRQ_CONF</em> is cleared, an interrupt is generated whenever the TX FIFO <em>becomes</em> less than half-full.
In this case software can write up to <em>IO_NEOLED_TX_FIFO</em>/2 new data words to <code>DATA</code> without checking the FIFO
status flags. If <em>NEOLED_CTRL_IRQ_CONF</em> is set, an interrupt is generated whenever the TX FIFO <em>becomes</em> empty.</p>
</div>
<div class="paragraph">
<p>One the NEOLED interrupt has been triggered and became pending, it has to explicitly cleared again by
writing zero to according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <em>NEOLED_CTRL_IRQ_CONF</em> is hardwired to one if <em>IO_NEOLED_TX_FIFO</em> = 1 (&#8594; IRQ if FIFO is empty).
If the FIFO is configured to contain only a single entry (<em>IO_NEOLED_TX_FIFO</em> = 1) the interrupt
will become pending if the FIFO (which is just a single register providing simple <em>double-buffering</em>) is empty.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<div style="page-break-after: always;"></div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 29. NEOLED register map (<code>struct NEORV32_NEOLED</code>)</caption>
<colgroup>
<col style="width: 13.7931%;">
<col style="width: 17.2413%;">
<col style="width: 31.0344%;">
<col style="width: 6.8965%;">
<col style="width: 31.0347%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="30"><p class="tableblock"><code>0xffffffd8</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="30"><p class="tableblock"><code>NEORV32_NEOLED.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>NEOLED_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEOLED enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>NEOLED_CTRL_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data transfer size; <code>0</code>=24-bit; <code>1</code>=32-bit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>NEOLED_CTRL_STROBE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>=send normal color data; <code>1</code>=send RESET command on data write access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>NEOLED_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>NEOLED_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code> <em>NEOLED_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3-bit clock prescaler, bit 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>6</code> <em>NEOLED_CTRL_BUFS0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top" rowspan="4"><p class="tableblock">4-bit log2(<em>IO_NEOLED_TX_FIFO</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>7</code> <em>NEOLED_CTRL_BUFS1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>8</code> <em>NEOLED_CTRL_BUFS2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9</code> <em>NEOLED_CTRL_BUFS3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code> <em>NEOLED_CTRL_T_TOT_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per total single-bit period (T<sub>total</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>11</code> <em>NEOLED_CTRL_T_TOT_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12</code> <em>NEOLED_CTRL_T_TOT_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>13</code> <em>NEOLED_CTRL_T_TOT_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>14</code> <em>NEOLED_CTRL_T_TOT_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>15</code> <em>NEOLED_CTRL_T_ZERO_H_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a zero-bit (T<sub>0H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>16</code> <em>NEOLED_CTRL_T_ZERO_H_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>17</code> <em>NEOLED_CTRL_T_ZERO_H_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>18</code> <em>NEOLED_CTRL_T_ZERO_H_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>19</code> <em>NEOLED_CTRL_T_ZERO_H_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20</code> <em>NEOLED_CTRL_T_ONE_H_0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock">5-bit pulse clock ticks per high-time for sending a one-bit (T<sub>1H</sub>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>21</code> <em>NEOLED_CTRL_T_ONE_H_1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>22</code> <em>NEOLED_CTRL_T_ONE_H_2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>23</code> <em>NEOLED_CTRL_T_ONE_H_3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24</code> <em>NEOLED_CTRL_T_ONE_H_4</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>NEOLED_CTRL_IRQ_CONF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO interrupt configuration: <code>0</code>=IRQ if FIFO is less than half-full, <code>1</code>=IRQ if FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>28</code> <em>NEOLED_CTRL_TX_EMPTY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29</code> <em>NEOLED_CTRL_TX_HALF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is <em>at least</em> half full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>NEOLED_CTRL_TX_FULL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX FIFO is full</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>NEOLED_CTRL_TX_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX serial engine is busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffdc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_NEOLED.DATA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code> / <code>23:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TX data (32-/24-bit)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_external_interrupt_controller_xirq">2.7.20. External Interrupt Controller (XIRQ)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xirq.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xirq_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ input (32-bit, fixed)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_NUM_CH</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of IRQs to implement (0..32)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_TRIGGER_TYPE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger type configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>XIRQ_TRIGGER_POLARITY</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IRQ trigger polarity configuration</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIRQ (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The eXternal interrupt controller provides a simple mechanism to implement up to 32 processor-external interrupt
request signals. The external IRQ requests are prioritized, queued and signaled to the CPU via a
single <em>CPU fast interrupt request</em>.</p>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The XIRQ provides up to 32 interrupt <em>channels</em> (configured via the <em>XIRQ_NUM_CH</em> generic). Each bit in the <code>xirq_i</code>
input signal vector represents one interrupt channel. If less than 32 channels are configure, only the LSB-aligned channels
are used while the remaining bits are left unconnected. An interrupt channel is enabled by setting the according bit in the
interrupt enable register <code>IER</code>.</p>
</div>
<div class="paragraph">
<p>If the configured trigger (see below) of an enabled channel fires, the request is stored into an internal buffer.
This buffer is available via the interrupt pending register <code>IPR</code>. A <code>1</code> in this register indicates that the
corresponding interrupt channel has fired but has not yet been serviced (so it is pending). An interrupt channel can
become pending if the according <code>IER</code> bit is set. Pending IRQs can be cleared by writing <code>0</code> to the according <code>IPR</code>
bit. As soon as there is a least one pending interrupt in the buffer, an interrupt request is send to the CPU.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
A disabled interrupt channel can still be pending if it has been triggered before clearing the according <code>IER</code> bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU can determine active external interrupt request either by checking the bits in the <code>IPR</code> register, which show all
pending interrupt channels, or by reading the interrupt source register <code>SCR</code>.
This register provides a 5-bit wide ID (0..31) that shows the interrupt request with <em>highest priority</em>.
Interrupt channel <code>xirq_i(0)</code> has highest priority and <code>xirq_i(<em>XIRQ_NUM_CH</em>-1)</code> has lowest priority.
This priority assignment is fixed and cannot be altered by software.
The CPU can use the ID from <code>SCR</code> to service IRQ according to their priority. To acknowledge the according
interrupt the CPU can write <code>1 &lt;&lt; SCR</code> to <code>IPR</code>.</p>
</div>
<div class="paragraph">
<p>In order to clear a pending FIRQ interrupt from the external interrupt controller again, the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit has
to be cleared. Additionally, the XIRQ interrupt has to be acknowledged by writing <em>any</em>
value to the interrupt source register <code>SRC</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
An interrupt handler should clear the interrupt pending bit that caused the interrupt first before
acknowledging the interrupt by writing the <code>SCR</code> register.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>IRQ Trigger Configuration</strong></p>
</div>
<div class="paragraph">
<p>The controller does not provide a configuration option to define the IRQ triggers <em>during runtime</em>. Instead, two
generics are provided to configure the trigger of each interrupt channel before synthesis: the <em>XIRQ_TRIGGER_TYPE</em>
and <em>XIRQ_TRIGGER_POLARITY</em> generic. Both generics are 32 bit wide representing one bit per interrupt channel. If
less than 32 interrupt channels are implemented the remaining configuration bits are ignored.</p>
</div>
<div class="paragraph">
<p><em>XIRQ_TRIGGER_TYPE</em> is used to define the general trigger type. This can be either <em>level-triggered</em> (<code>0</code>) or
<em>edge-triggered</em> (<code>1</code>). <em>XIRQ_TRIGGER_POLARITY</em> is used to configure the polarity of the trigger: a <code>0</code> defines
low-level or falling-edge and a <code>1</code> defines high-level or rising-edge.</p>
</div>
<div class="listingblock">
<div class="title">Listing 5. Example trigger configuration: channel 0 for rising-edge, IRQ channels 1 to 31 for high-level</div>
<div class="content">
<pre class="highlight"><code class="language-vhdl" data-lang="vhdl">XIRQ_TRIGGER_TYPE     =&gt; x"00000001";
XIRQ_TRIGGER_POLARITY =&gt; x"ffffffff";</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 30. XIRQ register map (<code>struct NEORV32_XIRQ</code>)</caption>
<colgroup>
<col style="width: 14.8148%;">
<col style="width: 18.5185%;">
<col style="width: 7.4074%;">
<col style="width: 7.4074%;">
<col style="width: 51.8519%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff80</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.IER</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt enable register (one bit per channel, LSB-aligned)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff84</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.IPR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interrupt pending register (one bit per channel, LSB-aligned); writing 0 to a bit clears according pending interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff88</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIRQ.SCR</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Channel id (0..31) of firing IRQ (prioritized!); writing <em>any</em> value will acknowledge the current interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xffffff8c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_general_purpose_timer_gptmr">2.7.21. General Purpose Timer (GPTMR)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_gptmr.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_GPTMR_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement general purpose timer when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast IRQ channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timer interrupt (see <a href="#_processor_interrupts">Processor Interrupts</a>)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The general purpose timer module provides a simple yet universal 32-bit timer. The timer is implemented if
<em>IO_GPTMR_EN</em> top generic is set <em>true</em>. It provides a 32-bit counter register (<code>COUNT</code>) and a 32-bit threshold
register (<code>THRES</code>). An interrupt is generated whenever the value of the counter registers matches the one from
threshold register.</p>
</div>
<div class="paragraph">
<p>The timer is enabled by setting the <em>GPTMR_CTRL_EN</em> bit in the device&#8217;s control register <code>CTRL</code>. The <code>COUNT</code>
register will start incrementing at a programmable rate, which scales the main processor clock. The
pre-scaler value is configured via the three <em>GPTMR_CTRL_PRSCx</em> control register bits:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 31. GPTMR prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>GPTMR_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The timer provides two operation modes that are configured by the <em>GPTMR_CTRL_MODE</em> control register bit:
if <em>GPTMR_CTRL_MODE</em> is cleared (<code>0</code>) the timer operates in <em>single-shot mode</em>. As soon as <code>COUNT</code> matches
<code>THRES</code> an interrupt request is generated and the timer stops operation (i.e. it stops incrementing). If
<em>GPTMR_CTRL_MODE</em> is set (<code>1</code>) the timer operates in <em>continuous mode</em>. When <code>COUNT</code> matches <code>THRES</code> an interrupt
request is generated and <code>COUNT</code> is automatically reset to all-zero before continuing to increment.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the timer will not clear the <code>COUNT</code> register. However, it can be manually reset at any time by
writing zero to it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Timer Interrupt</strong></p>
</div>
<div class="paragraph">
<p>The timer interrupt is triggered when the timer is enabled and <code>COUNT</code> matches <code>THRES</code>. The interrupt
remains pending until explicitly cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 32. GPTMR register map (<code>struct NEORV32_GPTMR</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>0xffffff60</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="5"><p class="tableblock"><code>NEORV32_GPTMR.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> <em>GPTMR_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Timer enable flag</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> <em>GPTMR_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code> <em>GPTMR_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code> <em>GPTMR_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code> <em>GPTMR_CTRL_MODE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter mode: <code>0</code>=single-shot, <code>1</code>=continuous</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff64</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPTMR.THRES</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Threshold value register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff68</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_GPTMR.COUNT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Counter register</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_execute_in_place_module_xip">2.7.22. Execute In Place Module (XIP)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.c</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_xip.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_csn_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit chip select, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_clk_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial clock output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_sdi_i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xip_sdo_o</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-bit serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>IO_XIP_EN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">implement XIP module when <em>true</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Overview</strong></p>
</div>
<div class="paragraph">
<p>The execute in place (XIP) module is probably one of the more complicated modules of the NEORV32. The module
allows to execute code (and read constant data) directly from a SPI flash memory. Hence, it uses the standard
serial peripheral interface (SPI) as transfer protocol under the hood.</p>
</div>
<div class="paragraph">
<p>The XIP flash is not mapped to a specific region of the processor&#8217;s address space. Instead, the XIP module
provides a programmable mapping scheme to allow a flexible user-defined mapping of the flash to <em>any section</em>
of the address space.</p>
</div>
<div class="paragraph">
<p>From the CPU side, the modules provides two different interfaces: one for transparently accessing the XIP flash and another
one for accessing the module&#8217;s control and status registers. The first interface provides a <em>transparent</em>
gateway to the SPI flash, so the CPU can directly fetch and execute instructions (and/or read constant <em>data</em>).
Note that this interface is read-only. Any write access will raise a bus error exception.
The second interface is mapped to the processor&#8217;s IO space and allows data accesses to the XIP module&#8217;s
configuration registers.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Program</div>
An example program for the XIP module is available in <code>sw/example/demo_xip</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Compiling a Program for XIP Execution</div>
If you want to compile a program that shall be executed using the XIP module, the default NEORV32 linker script
(<code>sw/common/neorv32.ld</code>) has to be modified: the <code>ORIGIN</code> attribute of the <code>rom</code> section needs to be adapted to
the XIP page base address and the flash base address. For example if the XIP page is set to <code>0x20000000</code> and the
executable is placed in the flash as offset <code>0x00400000</code> the <code>ORIGIN</code> attribute has to be set to the sum of both
address offsets (<code>0x20000000 + 0x00400000 = 0x20400000</code> &#8594; <code>rom  (rx) : ORIGIN = DEFINED(make_bootloader) ? 0xFFFF0000 : 0x20400000</code>).
See sections <a href="#_linker_script">Linker Script</a>, <a href="#_application_makefile">Application Makefile</a> and <a href="#_executable_image_generator">Executable Image Generator</a> for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>SPI Protocol</strong></p>
</div>
<div class="paragraph">
<p>The XIP module accesses external flash using the standard SPI protocol. The module always sends data MSB-first and
provides all of the standard four clock modes (0..3), which are configured via the <em>XIP_CTRL_CPOL</em> (clock polarity)
and <em>XIP_CTRL_CPHA</em> (clock phase) control register bits, respectively. The clock speed of the interface (<code>xip_clk_o</code>)
is defined by a three-bit clock pre-scaler configured using the <em>XIP_CTRL_PRSCx</em> bits:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 33. XIP prescaler configuration</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 8.3336%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong><code>XIP_CTRL_PRSCx</code></strong></th>
<th class="tableblock halign-center valign-top"><code>0b000</code></th>
<th class="tableblock halign-center valign-top"><code>0b001</code></th>
<th class="tableblock halign-center valign-top"><code>0b010</code></th>
<th class="tableblock halign-center valign-top"><code>0b011</code></th>
<th class="tableblock halign-center valign-top"><code>0b100</code></th>
<th class="tableblock halign-center valign-top"><code>0b101</code></th>
<th class="tableblock halign-center valign-top"><code>0b110</code></th>
<th class="tableblock halign-center valign-top"><code>0b111</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resulting <code>clock_prescaler</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">128</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1024</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">2048</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4096</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Based on the <em>XIP_CTRL_PRSCx</em> configuration the actual XIP SPI clock frequency f<sub>XIP</sub> is derived from the processor&#8217;s
main clock f<sub>main</sub> and is determined by:</p>
</div>
<div class="paragraph">
<p><em><strong>f<sub>XIP</sub></strong></em> = <em>f<sub>main</sub>[Hz]</em> / (2 * <code>clock_prescaler</code>)</p>
</div>
<div class="paragraph">
<p>Hence, the maximum XIP clock speed is f<sub>main</sub> / 4.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">High-Speed SPI mode</div>
The module provides a "high-speed" SPI mode. In this mode the clock prescaler configuration (<em>XIP_CTRL_PRSCx</em>) is ignored
and the SPI clock operates at f<sub>main</sub> / 2 (half of the processor&#8217;s main clock). High speed SPI mode is enabled by setting
the control register&#8217;s <em>XIP_CTRL_HIGHSPEED</em> bit.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The flash&#8217;s "read command", which initiates a read access, is defined by the <em>XIP_CTRL_RD_CMD</em> control register bits.
For most SPI flash memories this is <code>0x03</code> for normal SPI mode.</p>
</div>
<div class="paragraph">
<p><strong>Direct SPI Access</strong></p>
</div>
<div class="paragraph">
<p>The XIP module allows to initiate <em>direct</em> SPI transactions. This feature can be used to configure the attached SPI
flash or to perform direct read and write accesses to the flash memory. Two data registers <code>NEORV32_XIP.DATA_LO</code> and
<code>NEORV32_XIP.DATA_HI</code> are provided to send up to 64-bit of SPI data. The <code>NEORV32_XIP.DATA_HI</code> register is write-only,
so a total of 32-bit receive data is provided. Note that the module handles the chip-select
line (<code>xip_csn_o</code>) by itself so it is not possible to construct larger consecutive transfers.</p>
</div>
<div class="paragraph">
<p>The actual data transmission size in bytes is defined by the control register&#8217;s <em>XIP_CTRL_SPI_NBYTES</em> bits.
Any configuration from 1 byte to 8 bytes is valid. Other value will result in unpredictable behavior.</p>
</div>
<div class="paragraph">
<p>Since data is always transferred MSB-first, the data in <code>DATA_HI:DATA_LO</code> also has to be MSB-aligned. Receive data is
available in <code>DATA_LO</code> only - <code>DATA_HI</code> is write-only. Writing to <code>DATA_HI</code> triggers the actual SPI transmission.
The <em>XIP_CTRL_PHY_BUSY</em> control register flag indicates a transmission being in progress.</p>
</div>
<div class="paragraph">
<p>The chip-select line of the XIP module (<code>xip_csn_o</code>) will only become asserted (enabled, pulled low) if the
<em>XIP_CTRL_SPI_CSEN</em> control register bit is set. If this bit is cleared, <code>xip_csn_o</code> is always disabled
(pulled high).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Direct SPI mode is only possible when the module is enabled (setting <em>XIP_CTRL_EN</em>) but <strong>before</strong> the actual
XIP mode is enabled via <em>XIP_CTRL_XIP_EN</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When the XIP mode is not enabled, the XIP module can also be used as additional general purpose SPI controller
with a transfer size of up to 64 bits per transmission.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Address Mapping</strong></p>
</div>
<div class="paragraph">
<p>The address mapping of the XIP flash is not fixed by design. It can be mapped to <em>any section</em> within the processor&#8217;s
address space. A <em>section</em> refers to one out of 16 naturally aligned 256MB wide memory segments. This segment
is defined by the four most significant bits of the address (<code>31:28</code>) and the XIP&#8217;s segment is programmed by the
four <em>XIP_CTRL_XIP_PAGE</em> bits in the unit&#8217;s control register. All accesses within this page will be mapped to the XIP flash.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Care must be taken when programming the page mapping to prevent access collisions with other modules (like internal memories
or modules attached to the external memory interface).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Example: to map the XIP flash to the address space starting at <code>0x20000000</code> write a "2" (<code>0b0010</code>) to the <em>XIP_CTRL_XIP_PAGE</em>
control register bits. Any access within <code>0x20000000 .. 0x2fffffff</code> will be forwarded to the XIP flash.
Note that the SPI access address might wrap around.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Using the FPGA Bitstream Flash also for XIP</div>
You can also use the FPGA&#8217;s bitstream SPI flash for storing XIP programs. To prevent overriding the bitstream,
a certain offset needs to be added to the executable (which might require linker script modifications).
To execute the program stored in the SPI flash simply jump to the according base address. For example
if the executable starts at flash offset <code>0x8000</code> and the XIP flash is mapped to the base address <code>0x20000000</code>
then add the offset to the base address and use that as jump/call destination (=<code>0x20008000</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Using the XIP Mode</strong></p>
</div>
<div class="paragraph">
<p>The XIP module is globally enabled by setting the <em>XIP_CTRL_EN</em> bit in the device&#8217;s <code>CTRL</code> control register.
Clearing this bit will reset the whole module and will also terminate any pending SPI transfer.</p>
</div>
<div class="paragraph">
<p>Since there is a wide variety of SPI flash components with different sizes, the XIP module allows to specify
the address width of the flash: the number of address bytes used for addressing flash memory content has to be
configured using the control register&#8217;s <em>XIP_CTRL_XIP_ABYTES</em> bits. These two bits contain the number of SPI
address bytes (<strong>minus one</strong>). For example for a SPI flash with 24-bit addresses these bits have to be set to
<code>0b10</code>.</p>
</div>
<div class="paragraph">
<p>The transparent XIP accesses are transformed into SPI transmissions with the following format (starting with the MSB):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>8-bit command: configured by the <em>XIP_CTRL_RD_CMD</em> control register bits ("SPI read command")</p>
</li>
<li>
<p>8 to 32 bits address: defined by the <em>XIP_CTRL_XIP_ABYTES</em> control register bits ("number of address bytes")</p>
</li>
<li>
<p>32-bit data: sending zeros and receiving the according flash word (32-bit)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Hence, the maximum XIP transmission size is 72-bit, which has to be configured via the <em>XIP_CTRL_SPI_NBYTES</em>
control register bits. Note that the 72-bit transmission size is only available in XIP mode. The transmission
size of the direct SPI accesses is limited to 64-bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When using four SPI flash address bytes, the most significant 4 bits of the address are always hardwired
to zero allowing a maximum <strong>accessible</strong> flash size of 256MB.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The XIP module always fetches a full naturally aligned 32-bit word from the SPI flash. Any sub-word data masking
or alignment will be performed by the CPU core logic.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The XIP mode requires the 4-byte data words in the flash to be ordered in <strong>little-endian</strong> byte order.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After the SPI properties (including the amount of address bytes <strong>and</strong> the total amount of SPI transfer bytes)
and XIP address mapping are configured, the actual XIP mode can be enabled by setting
the control register&#8217;s <em>XIP_CTRL_XIP_EN</em> bit. This will enable the "transparent SPI access port" of the module and thus,
the <em>transparent</em> conversion of access requests into proper SPI flash transmissions. Make sure <em>XIP_CTRL_SPI_CSEN</em>
is also set so the module can actually select/enable the attached SPI flash.
No more direct SPI accesses via <code>DATA_HI:DATA_LO</code> are possible when the XIP mode is enabled. However, the
XIP mode can be disabled at any time.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the XIP module is disabled (<em>XIP_CTRL_EN</em> = <code>0</code>) any accesses to the programmed XIP memory segment are ignored
by the module and might be forwarded to the processor&#8217;s external memory interface (if implemented) or will cause a bus
exception. If the XIP module is enabled (<em>XIP_CTRL_EN</em> = <code>1</code>) but XIP mode is not enabled yet (<em>XIP_CTRL_XIP_EN</em> = '0')
any access to the programmed XIP memory segment will raise a bus exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
It is highly recommended to enable the <a href="#_processor_internal_instruction_cache_icache">Processor-Internal Instruction Cache (iCACHE)</a> to cover some
of the SPI access latency.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>XIP Burst Mode</strong></p>
</div>
<div class="paragraph">
<p>By default, every XIP access to the flash transmits the read command and the word-aligned address before reading four consecutive
data bytes. Obviously, this introduces a certain transmission overhead. To reduces this overhead, the XIP mode allows to utilize
the flash&#8217;s <em>incrmental read</em> function, which will return consecutive bytes when continuing to send clock cycles after a read command.
Hence, the XIP module provides an optional "burst mode" to accelerate consecutive read accesses.</p>
</div>
<div class="paragraph">
<p>The XIP burst mode is enabled by setting the <em>XIP_CTRL_BURST_EN</em> bit in the module&#8217;s control register. The burst mode only affects
the actual XIP mode and <em>not</em> the direct SPI mode. Hence, it should be enabled right before enabling XIP mode only.
By using the XIP burst mode flash read accesses can be accelerated by up to 50%.</p>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 34. XIP Register Map (<code>struct NEORV32_XIP</code>)</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 6.25%;">
<col style="width: 43.75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Bit(s), Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" rowspan="17"><p class="tableblock"><code>0xffffff40</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="17"><p class="tableblock"><code>NEORV32_XIP.CTRL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>  <em>XIP_CTRL_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP module enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>  <em>XIP_CTRL_PRSC0</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top" rowspan="3"><p class="tableblock">3-bit SPI clock prescaler select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>2</code>  <em>XIP_CTRL_PRSC1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>3</code>  <em>XIP_CTRL_PRSC2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>4</code>  <em>XIP_CTRL_CPOL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock polarity</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>5</code>  <em>XIP_CTRL_CPHA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI clock phase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>9:6</code>  <em>XIP_CTRL_SPI_NBYTES_MSB</em> : <em>XIP_CTRL_SPI_NBYTES_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of bytes in SPI transaction (1..9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>10</code> <em>XIP_CTRL_XIP_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP mode enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>12:11</code> <em>XIP_CTRL_XIP_ABYTES_MSB</em> : <em>XIP_CTRL_XIP_ABYTES_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of address bytes for XIP flash (minus 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>20:13</code> <em>XIP_CTRL_RD_CMD_MSB</em> : <em>XIP_CTRL_RD_CMD_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Flash read command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>24:21</code> <em>XIP_CTRL_XIP_PAGE_MSB</em> : <em>XIP_CTRL_XIP_PAGE_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP memory page</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>25</code> <em>XIP_CTRL_SPI_CSEN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Allow SPI chip-select to be actually asserted when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>26</code> <em>XIP_CTRL_HIGHSPEED</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable SPI high-speed mode (ignoring <em>XIP_CTRL_PRSC</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>27</code> <em>XIP_CTRL_BURST_EN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable XIP burst mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>29:28</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>30</code> <em>XIP_CTRL_PHY_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SPI PHY busy when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31</code> <em>XIP_CTRL_XIP_BUSY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XIP access in progress when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff44</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff48</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIP.DATA_LO</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct SPI access - data register low</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffff4C</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_XIP.DATA_HI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>31:0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Direct SPI access - data register high; write access triggers SPI transfer</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
<div class="sect3">
<h4 id="_system_configuration_information_memory_sysinfo">2.7.23. System Configuration Information Memory (SYSINFO)</h4>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 30%;">
<col style="width: 30%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hardware source file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32_sysinfo.vhd</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software driver file(s):</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">neorv32.h</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Top entity port:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Configuration generics:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">most of the top&#8217;s configuration generics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU interrupts:</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">none</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>The SYSINFO allows the application software to determine the setting of most of the processor&#8217;s top entity
generics that are related to processor/SoC configuration. All registers of this unit are read-only.</p>
</div>
<div class="paragraph">
<p>This device is always implemented - regardless of the actual hardware configuration. The bootloader as well
as the NEORV32 software runtime environment require information from this device (like memory layout
and default clock speed) for correct operation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Any write access to the SYSINFO module will raise a store bus error exception. The <a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a>
will signal a "DEVICE ERROR" in this case.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Register Map</strong></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 35. SYSINFO register map (<code>struct NEORV32_SYSINFO</code>)</caption>
<colgroup>
<col style="width: 15.3846%;">
<col style="width: 30.7692%;">
<col style="width: 53.8462%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clock speed in Hz (via top&#8217;s <a href="#_clock_frequency"><em>CLOCK_FREQUENCY</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">`NEORV32_SYSINFO.CUSTOM_ID</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">custom user-defined ID (via top&#8217;s <a href="#_custom_id"><em>CUSTOM_ID</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffe8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">specific SoC configuration (see <a href="#_sysinfo_soc_configuration">SYSINFO - SoC Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xffffffec</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.CACHE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cache configuration information (see <a href="#_sysinfo_cache_configuration">SYSINFO - Cache Configuration</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.ISPACE_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address space base (via package&#8217;s <code>ispace_base_c</code> constant)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.IMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal IMEM size in bytes (via top&#8217;s <a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffff8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.DSPACE_BASE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data address space base (via package&#8217;s <code>sdspace_base_c</code> constant)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0xfffffffc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_SYSINFO.DMEM_SIZE</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">internal DMEM size in bytes (via top&#8217;s <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generic)</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_sysinfo_soc_configuration">SYSINFO - SoC Configuration</h5>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 36. <em>SYSINFO_SOC</em> bits</caption>
<colgroup>
<col style="width: 4.5454%;">
<col style="width: 45.4545%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_BOOTLOADER</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal bootloader is implemented (via top&#8217;s <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_EXT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the external Wishbone bus interface is implemented (via top&#8217;s <a href="#_mem_ext_en"><em>MEM_EXT_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_INT_IMEM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal DMEM implemented (via top&#8217;s <a href="#_mem_int_dmem_en"><em>MEM_INT_DMEM_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_INT_DMEM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the processor-internal IMEM is implemented (via top&#8217;s <a href="#_mem_int_imem_en"><em>MEM_INT_IMEM_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_MEM_EXT_ENDIAN</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if external bus interface uses BIG-endian byte-order (via top&#8217;s <a href="#_mem_ext_big_endian"><em>MEM_EXT_BIG_ENDIAN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_ICACHE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor-internal instruction cache is implemented (via top&#8217;s <a href="#_icache_en"><em>ICACHE_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>12:6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IS_SIM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if processor is being <strong>simulated</strong> ( not guaranteed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_OCD</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if on-chip debugger implemented (via top&#8217;s <a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_GPIO</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the GPIO is implemented (via top&#8217;s <a href="#_io_gpio_en"><em>IO_GPIO_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>17</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_MTIME</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the MTIME is implemented (via top&#8217;s <a href="#_io_mtime_en"><em>IO_MTIME_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>18</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_UART0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the primary UART0 is implemented (via top&#8217;s <a href="#_io_uart0_en"><em>IO_UART0_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>19</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_SPI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SPI is implemented (via top&#8217;s <a href="#_io_spi_en"><em>IO_SPI_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>20</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_TWI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TWI is implemented (via top&#8217;s <a href="#_io_twi_en"><em>IO_TWI_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>21</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_PWM</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the PWM is implemented (via top&#8217;s <a href="#_io_pwm_num_ch"><em>IO_PWM_NUM_CH</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>22</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_WDT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the WDT is implemented (via top&#8217;s <a href="#_io_wdt_en"><em>IO_WDT_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>23</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_CFS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the custom functions subsystem is implemented (via top&#8217;s <a href="#_io_cfs_en"><em>IO_CFS_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>24</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_TRNG</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the TRNG is implemented (via top&#8217;s <em>IO_TRNG_EN</em> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>25</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_SLINK</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the SLINK is implemented (via top&#8217;s <a href="#_slink_num_tx"><em>SLINK_NUM_TX</em></a> and/or <a href="#_slink_num_rx"><em>SLINK_NUM_RX</em></a> generics)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>26</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_UART1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the secondary UART1 is implemented (via top&#8217;s <a href="#_io_uart1_en"><em>IO_UART1_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>27</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_NEOLED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the NEOLED is implemented (via top&#8217;s <a href="#_io_neoled_en"><em>IO_NEOLED_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>28</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_XIRQ</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the XIRQ is implemented (via top&#8217;s <a href="#_xirq_num_ch"><em>XIRQ_NUM_CH</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>29</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_GPTMR</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the GPTMR is implemented (via top&#8217;s <a href="#_io_gptmr_en"><em>IO_GPTMR_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>30</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_XIP</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the XIP module is implemented (via top&#8217;s <a href="#_io_xip_en"><em>IO_XIP_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>31</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_SOC_IO_ONEWIRE</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if the ONEWIRE interface is implemented (via top&#8217;s <a href="#_io_onewire_en"><em>IO_ONEWIRE_EN</em></a> generic)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_sysinfo_cache_configuration">SYSINFO - Cache Configuration</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Bit fields in this register are set to all-zero if the according cache is not implemented.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 37. <em>SYSINFO_CACHE</em> bits</caption>
<colgroup>
<col style="width: 4.5454%;">
<col style="width: 45.4545%;">
<col style="width: 50.0001%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>3:0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_BLOCK_SIZE_3</em> : <em>SYSINFO_CACHE_IC_BLOCK_SIZE_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache block size in bytes), via top&#8217;s <a href="#_icache_block_size"><em>ICACHE_BLOCK_SIZE</em></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>7:4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_NUM_BLOCKS_3</em> : <em>SYSINFO_CACHE_IC_NUM_BLOCKS_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache number of cache blocks), via top&#8217;s <a href="#_icache_num_blocks"><em>ICACHE_NUM_BLOCKS</em></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>11:9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_ASSOCIATIVITY_3</em> : <em>SYSINFO_CACHE_IC_ASSOCIATIVITY_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>log2</em>(i-cache associativity), via top&#8217;s <a href="#_icache_associativity"><em>ICACHE_ASSOCIATIVITY</em></a> generic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>15:12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>SYSINFO_CACHE_IC_REPLACEMENT_3</em> : <em>SYSINFO_CACHE_IC_REPLACEMENT_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-cache replacement policy (<code>0001</code> = LRU if associativity &gt; 0)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>32:16</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">zero, reserved for d-cache</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_neorv32_central_processing_unit_cpu">3. NEORV32 Central Processing Unit (CPU)</h2>
<div class="sectionbody">
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_cpu_block.png" alt="neorv32 cpu block" width="600">
</div>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_architecture">Architecture</a>, <a href="#_full_virtualization">Full Virtualization</a> and <a href="#_risc_v_compatibility">RISC-V Compatibility</a></p>
</li>
<li>
<p><a href="#_cpu_top_entity_signals">CPU Top Entity - Signals</a> and <a href="#_cpu_top_entity_generics">CPU Top Entity - Generics</a></p>
</li>
<li>
<p><a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a>, <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> and <a href="#_instruction_timing">Instruction Timing</a></p>
</li>
<li>
<p><a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a></p>
</li>
<li>
<p><a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a></p>
</li>
<li>
<p><a href="#_bus_interface">Bus Interface</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>Key Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>32-bit little-endian, multi-cycle, in-order <code>rv32</code> RISC-V CPU</p>
</li>
<li>
<p>Compatible to the RISC-V. <strong>Privileged Architecture - Machine ISA Version 1.13</strong> specifications</p>
</li>
<li>
<p>Available <a href="#_instruction_sets_and_extensions">Instruction Sets and Extensions</a>:</p>
<div class="ulist">
<ul>
<li>
<p><code>B</code> - bit-manipulation instructions</p>
</li>
<li>
<p><code>C</code> - 16-bit compressed instructions</p>
</li>
<li>
<p><code>I</code> - integer base ISA (always enabled)</p>
</li>
<li>
<p><code>E</code> - embedded CPU version (reduced register file size)</p>
</li>
<li>
<p><code>M</code> - integer multiplication and division hardware</p>
</li>
<li>
<p><code>U</code> - less-privileged <em>user</em> mode</p>
</li>
<li>
<p><code>Zfinx</code> - single-precision floating-point unit</p>
</li>
<li>
<p><code>Zicsr</code> - control and status register access (privileged architecture)</p>
</li>
<li>
<p><code>Zicntr</code> - CPU base counters</p>
</li>
<li>
<p><code>Zihpm</code> - hardware performance monitors</p>
</li>
<li>
<p><code>Zifencei</code> - instruction stream synchronization</p>
</li>
<li>
<p><code>Zmmul</code> - integer multiplication hardware</p>
</li>
<li>
<p><code>Zxcfu</code> - custom instructions extension</p>
</li>
<li>
<p><code>PMP</code> - physical memory protection</p>
</li>
<li>
<p><code>Sdext</code> - external debug support</p>
</li>
<li>
<p><code>Sdtrig</code> - trigger module</p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#_risc_v_compatibility">RISC-V Compatibility</a>: Compatible to the RISC-V user specifications and a subset of the RISC-V privileged architecture specifications - passes the official RISC-V Architecture Tests (v2+)</p>
</li>
<li>
<p>Official <a href="https://github.com/riscv/riscv-isa-manual/blob/master/marchid.md">RISC-V open source architecture ID</a>: decimal <strong>19</strong>; hexadecimal <code>0x00000013</code></p>
</li>
<li>
<p>Supports <em>all</em> of the machine-level <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> from the RISC-V specifications (including bus access exceptions and all unimplemented/illegal/malformed instructions)</p>
<div class="ulist">
<ul>
<li>
<p>This is a special aspect on <em>execution safety</em> by <a href="#_full_virtualization">Full Virtualization</a></p>
</li>
<li>
<p>Standard RISC-V interrupts (<em>external</em>, <em>timer</em>, <em>software</em>) plus 16 custom <em>fast</em> interrupts</p>
</li>
</ul>
</div>
</li>
<li>
<p>Optional physical memory configuration (PMP)</p>
</li>
<li>
<p>Optional hardware performance monitors (HPM) for application benchmarking</p>
</li>
<li>
<p>Separated <a href="#_bus_interface">Bus Interface</a>s for instruction fetch and data access</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
It is recommended to use the <strong>NEORV32 Processor</strong> as default top instance even if you only want to use the actual
CPU. Simply disable all the processor-internal modules via the generics and you will get a "CPU
wrapper" that provides a minimal CPU environment and an external bus interface (like AXI4). This
setup also allows to further use the default bootloader and software framework. From this base you
can start building your own SoC. Of course you can also use the CPU in it&#8217;s true stand-alone mode.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This documentation assumes the reader is familiar with the official RISC-V "User" and "Privileged Architecture" specifications.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_risc_v_compatibility">3.1. RISC-V Compatibility</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISCOF</div>
<a href="https://github.com/stnolting/neorv32-riscof"><span class="image"><img src="https://github.com/stnolting/neorv32-riscof/actions/workflows/main.yml/badge.svg" alt="badge" title="github.com/stnolting/neorv32-riscof"></span></a><br>
The NEORV32 CPU passes the tests of the <strong>official RISCOF RISC-V Architecture Test Framework</strong>. This framework is used to check
RISC-V implementations for compatibility to the official RISC-V use/privileged ISA specifications. The NEORV32 port of this
test framework is available in a separate repository: <a href="https://github.com/stnolting/neorv32-riscof" class="bare">https://github.com/stnolting/neorv32-riscof</a>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_risc_v_incompatibility_issues_and_limitations">3.1.1. RISC-V Incompatibility Issues and Limitations</h4>
<div class="paragraph">
<p>This list shows the currently identified issues regarding full RISC-V-compatibility.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Read-Only "Read-Write" CSRs</div>
The NEORV32 <a href="#_misa"><strong><code>misa</code></strong></a> CSR is <em>read-only</em>. Hence, ISA capabilities are fixed at synthesis time and cannot be
enabled/disabled dynamically at runtime. Any machine-mode write access to this CSR is ignored and will <em>not</em>
cause any exceptions or side-effects to maintain RISC-V compatibility.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Physical Memory Protection (PMP)</div>
The RISC-V-compatible NEORV32 <a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a> only implements the <strong>TOR</strong>
(top of region) mode and only up to 16 PMP regions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">No Hardware Support of Misaligned Memory Accesses</div>
The CPU does not support resolving unaligned memory access by the hardware (this is not a
RISC-V-incompatibility issue but an important thing to know!). Any kind of unaligned memory access
will raise an exception to allow a <em>software-based</em> emulation provided by the application.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_architecture">3.2. Architecture</h3>
<div class="paragraph">
<p>The NEORV32 CPU was designed from scratch based only on the official base and privileged ISA
specifications. The following figure shows the simplified data path of the CPU.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_cpu.png" alt="neorv32 cpu">
</div>
</div>
<div class="paragraph">
<p>The CPU implements a pipelined <em>multi-cycle</em> architecture: each instruction is executed as a series of consecutive
micro-operations. In order to increase performance, the CPU&#8217;s front-end (instruction fetch) and back-end
(instruction execution) are de-couples via a FIFO. Therefore, the front-end can already fetch new instructions while
the back-end is still processing the previously-fetched instruction.</p>
</div>
<div class="paragraph">
<p>Basically, the CPU&#8217;s micro architecture is somewhere between a classical pipelined architecture, where each stage
requires exactly one processing cycle (if not stalled) and a classical multi-cycle architecture, which executes
every single instruction (<em>including</em> fetch) in a series of consecutive micro-operations. The combination of
these two design paradigms allows an increased instruction execution in contrast to a pure multi-cycle
approach (due to overlapping operation of fetch and execute) at a reduced hardware footprint (due to the
multi-cycle concept).</p>
</div>
<div class="paragraph">
<p>As a Von-Neumann machine, the CPU provides independent interfaces for instruction fetch and data access. However,
these two bus interfaces are merged into a single processor-internal bus via a prioritizing bus switch (data accesses
have higher priority). Hence, <em>all</em> memory addresses including peripheral devices are mapped to a single unified 32-bit
address space.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CPU does not perform any out-of-order operations. Hence, it is not vulnerable to security issues
caused by speculative execution (e.g. Spectre an Meltdown).
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_register_file">3.2.1. CPU Register File</h4>
<div class="paragraph">
<p>The data register file contains the general purpose &#8220;x&#8221; architecture registers. For <code>rv32i</code> ISA there are 32 32-bit registers
(= 1024 bit total capacity) and for the <code>rv32e</code> ISA there are 16 32-bit registers (= 512 bit total capacity). Register zero (<code>x0</code>/<code>zero</code>)
always read as zero and any write access to it is discarded.</p>
</div>
<div class="paragraph">
<p>The register file is implemented as synchronous memory with synchronous read and write accesses. Register <code>zero</code> is also mapped to
a <em>physical memory</em> in the register file. By this, there is no need to add a further multiplexer to "insert" zero if reading from
<code>zero</code> reducing logic requirements and shortening the critical path. Furthermore, the whole register file can be mapped to FPGA
block RAM(s).</p>
</div>
<div class="paragraph">
<p>The memory of the register file uses two access ports: a read-only port for reading register <code>rs2</code> (second source operand) and a
read/write port reading registers <code>rs1</code> (first source operand) or for writing processing results to register <code>rd</code> (destination register).
Hence, a <em>simple</em> dual-port RAM can be used to implement the register file. From a functional point of view, read and write accesses to
the register file do never occur in the same clock cycle, so no bypass logic is required at all.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_arithmetic_logic_unit">3.2.2. CPU Arithmetic Logic Unit</h4>
<div class="paragraph">
<p>The arithmetic/logic unit (ALU) is used for processing data from the register file and also for memory and branch address computations.
All simple <a href="#_i_base_integer_isa"><strong><code>I</code></strong> - Base Integer ISA</a> data processing operations (<code>add</code>, <code>and</code>, &#8230;&#8203;) are implemented as combinatorial logic requiring only a single cycle to
complete. More sophisticated instructions (shift operations from the base ISA and all further ISA extensions) are processed by so-called
"ALU co-processors".</p>
</div>
<div class="paragraph">
<p>The co-processors are implemented as iterative units that require several cycles to complete processing. Besides the base ISA&#8217;s shift instructions,
the co-processors are used to implement all further processing-based ISA extensions (e.g. <a href="#_m_integer_multiplication_and_division"><strong><code>M</code></strong> - Integer Multiplication and Division</a> and
<a href="#_b_bit_manipulation_operations"><strong><code>B</code></strong> - Bit-Manipulation Operations</a>). Custom RISC-V instructions (<a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>) are also implemented as ALU co-processor.</p>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_bus_unit">3.2.3. CPU Bus Unit</h4>
<div class="paragraph">
<p>The bus unit takes care of handling data memory accesses via the load and store instructions. It handles data adjustment when accessing
sub-word (16-bit or 8-bit) and performs sign-extension for singed load operations. The bus unit also includes the optional includes
<a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a> that performs permission checks for any data and instruction (!) access.</p>
</div>
<div class="paragraph">
<p>A list of the bus interface signals and a detailed description of the protocol can be found in section <a href="#_bus_interface">Bus Interface</a>.
All bus interface signals are driven/buffered by registers; so even a complex SoC interconnection bus network will not
effect maximal operation frequency.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Unaligned Accesses</div>
The CPU does not support a hardware-based handling of unaligned memory accesses! Any unaligned access will raise a bus load/store unaligned
address exception. The exception handler can be used to <em>emulate</em> unaligned memory accesses in software.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cpu_control_unit">3.2.4. CPU Control Unit</h4>
<div class="paragraph">
<p>The CPU control unit is the actual brain of the processor core as it generated all the control signals for the different CPU modules.
The control unit is based on several modules (also called "engines").</p>
</div>
<div class="paragraph">
<p><strong>Front-End</strong></p>
</div>
<div class="paragraph">
<p>The front-end is responsible for fetching instruction data in chunks of 32-bits. This can be a single aligned 32-bit instruction,
two aligned 16-bit instructions or a mixture of those. The instruction data including control and exception information is stored
to a FIFO queue - the instruction prefetch buffer (IPB). The depth of this FIFO can be configured by the <a href="#_cpu_ipb_entries"><em>CPU_IPB_ENTRIES</em></a> top
generic.</p>
</div>
<div class="paragraph">
<p>The FIFO allows the front-end to do "speculative" instruction fetches, as it keeps fetching the next consecutive instruction
all the time. This also allows to decouple front-end (instruction fetch) and back-end (instruction execution) so both modules
can operate in parallel to increase performance. However, all potential side effects that are caused by this "speculative"
instruction fetch are already handled by the CPU front-end ensuring a defined execution stage while preventing security
side attacks (like Spectre and Meltdown).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Branch Prediction</div>
The front-end implements a very simple branch prediction (predict = always taken) that <strong>stops</strong> fetching further instruction while
a branch/jump/call operation is in progress.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Back-End</strong></p>
</div>
<div class="paragraph">
<p>Instruction data from the instruction prefetch buffer is decompressed (if the <code>C</code> ISA extension is enabled) and sent to the
CPU back-end for actual execution. Execution is conducted by a state-machine that controls all of the CPU modules. The execution
time of a instruction depends on the complexity of required operations. The minimal time for executing is 2 cycles (simple ALU
operations) but can be significantly higher. The table in section <a href="#_instruction_timing">Instruction Timing</a> list the required execution times for
all instructions and extensions.</p>
</div>
<div class="paragraph">
<p><strong>Trap Controller</strong></p>
</div>
<div class="paragraph">
<p>The trap controller handles all exceptions (<em>synchronous</em> events caused by an instruction like an illegal instruction word)
and interrupts (<em>asynchronous</em> events triggered by hart-external hardware). A detailed overview of all traps can be found
in section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>.</p>
</div>
<div class="paragraph">
<p><strong>CSR System</strong></p>
</div>
<div class="paragraph">
<p>The CSR system implements all the <em>control and status registers</em> and also all hardware counters. See section
<a href="#_control_and_status_registers_csrs">Control and Status Registers (CSRs)</a> for a full overview of all available CSRs.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sleep_mode">3.3. Sleep Mode</h3>
<div class="paragraph">
<p>The NEORV32 CPU provides a single sleep mode that can be entered to power-down the core by reducing dynamic switching activity.</p>
</div>
<div class="paragraph">
<p>Sleep mode in entered by executing the <code>wfi</code> instruction from the <a href="#_zicsr_control_and_status_register_access_privileged_architecture"><strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a>
ISA extension. When the CPU is in sleep mode, all CPU-internal operations are stopped (execution, instruction fetch, &#8230;&#8203;).
Note that this does <em>not affect</em> the operation of any peripheral/IO modules like interfaces and timers. Furthermore,
the CPU will continue to buffer/enqueue all incoming interrupt requests.</p>
</div>
<div class="paragraph">
<p>The CPU will leave sleep mode as soon as any interrupt source becomes <em>pending</em>. This requires that interrupts are globally
enabled by setting <code><a href="#_mstatus"><strong><code>mstatus</code></strong></a>.mie</code> and that at least one interrupt source is enabled in <a href="#_mie"><strong><code>mie</code></strong></a>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If sleep mode is entered without at least one enabled interrupt source the CPU will be <em>permanently</em> halted.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CPU automatically wakes up from sleep mode if a debug session via the on-chip debugger is started.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_full_virtualization">3.4. Full Virtualization</h3>
<div class="paragraph">
<p>Just like the RISC-V ISA the NEORV32 aims to provide <em>maximum virtualization</em> capabilities on CPU and SoC level to
allow a high standard of <strong>execution safety</strong>. The CPU supports <strong>all</strong> traps specified by the official RISC-V specifications.
<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnotedef_5" title="View footnote.">5</a>]</sup>
Thus, the CPU provides defined hardware fall-backs via traps for any expected and unexpected situation (e.g. executing a
malformed instruction or accessing a non-allocated memory address). For any kind of trap the core is always in a
defined and fully synchronized state throughout the whole architecture (i.e. there are no out-of-order operations that
might have to be reverted). This allows a defined and predictable execution behavior at any time improving overall execution safety.</p>
</div>
<div class="paragraph">
<p><strong>Execution Safety - NEORV32 Virtualization Features</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Due to the acknowledged memory accesses the CPU is <em>always</em> sync with the memory system
(i.e. there is no speculative execution / no out-of-order states).</p>
</li>
<li>
<p>The CPU supports <em>all</em> RISC-V compatible bus exceptions including access exceptions, which are triggered if an
accessed address does not respond or encounters an internal device error during access.</p>
</li>
<li>
<p>Accessed memory addresses (plain memory, but also memory-mapped devices) need to respond within a fixed time
window. Otherwise a bus access exception is raised.</p>
</li>
<li>
<p>The RISC-V specs. state that executing an malformed instruction results in unpredictable behavior. As an additional
execution safety feature the NEORV32 CPU ensures that <em>all</em> unimplemented/malformed/illegal instructions do raise an
illegal instruction exceptions and do not commit any state-changing operation (like writing registers or triggering
memory operations).</p>
</li>
<li>
<p>To be continued&#8230;&#8203;</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_signals">3.5. CPU Top Entity - Signals</h3>
<div class="paragraph">
<p>The following table shows all interface signals of the CPU top entity <code>rtl/core/neorv32_cpu.vhd</code>. The
type of all signals is <em>std_ulogic</em> or <em>std_ulogic_vector</em>, respectively. The "Dir." column shows the signal
direction seen from the CPU.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 38. NEORV32 CPU top entity signals</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Dir.</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Global Signals</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>clk_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global clock line, all registers triggering on rising edge</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rstn_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global reset, low-active</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sleep_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU is in sleep mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>debug_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU is in debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Instruction <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read request (one-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer acknowledge from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer terminate from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <code>fence.i</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i_bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current <em>effective</em> CPU privilege level (<code>0</code> = user, <code>1</code> = machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Data <a href="#_bus_interface">Bus Interface</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_wdata_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_ben_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write request (one-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read request (one-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer acknowledge from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus transfer terminate from accessed peripheral</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">indicates an executed <code>fence</code> instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">current <em>effective</em> CPU privilege level (<code>0</code> = user, <code>1</code> = machine)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>System Time (for <a href="#_timeh"><strong><code>time[h]</code></strong></a> CSR)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">system time input from <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Interrupts, RISC-V-compatible (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>msw_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine software interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mext_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine external interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtime_irq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RISC-V machine timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Interrupts, NEORV32-specific (<a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>firq_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request signals</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="4"><p class="tableblock"><strong>Enter Debug Mode Request (<a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a>)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>db_halt_req_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request CPU to halt and enter debug mode</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Protocol</div>
See section <a href="#_bus_interface">Bus Interface</a> for the instruction fetch and data access protocol.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_cpu_top_entity_generics">3.6. CPU Top Entity - Generics</h3>
<div class="paragraph">
<p>Most of the CPU configuration generics are a subset of the actual Processor configuration generics (see section <a href="#_processor_top_entity_generics">Processor Top Entity - Generics</a>).
and are not listed here. However, the CPU provides some <em>specific</em> generics that are used to configure the CPU for the
NEORV32 processor setup. These generics are assigned by the processor setup only and are not available for user defined configuration.
The <em>specific</em> generics are listed below.</p>
</div>
<div class="sect3">
<h4 id="_cpu_boot_addr"><em>CPU_BOOT_ADDR</em></h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_BOOT_ADDR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This address defines the reset address at which the CPU starts fetching instructions after reset. In terms of the NEORV32 processor, this
generic is configured with the base address of the bootloader ROM (default) or with the base address of the processor-internal instruction
memory (IMEM) if the bootloader is disabled (<em>INT_BOOTLOADER_EN</em> = <em>false</em>). See section <a href="#_address_space">Address Space</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_debug_park_addr"><em>CPU_DEBUG_PARK_ADDR</em></h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_DEBUG_PARK_ADDR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This address defines the "park loop" entry address for the "execution based" on-chip debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_debug_exc_addr"><em>CPU_DEBUG_EXC_ADDR</em></h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_DEBUG_EXC_ADDR</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>std_ulogic_vector(31 downto 0)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This address defines the "exception" entry address for the "execution based" on-chip debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_extension_riscv_sdext"><em>CPU_EXTENSION_RISCV_Sdext</em></h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Sdext</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement RISC-V-compatible "debug" CPU operation mode required for the on-chip debugger.
See section <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_cpu_extension_riscv_sdtrig"><em>CPU_EXTENSION_RISCV_Sdtrig</em></h4>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 40%;">
<col style="width: 40%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CPU_EXTENSION_RISCV_Sdtrig</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>boolean</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>no default value</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Implement RISC-V-compatible trigger module. See section <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_instruction_sets_and_extensions">3.7. Instruction Sets and Extensions</h3>
<div class="paragraph">
<p>The basic NEORV32 is a RISC-V <code>rv32i</code> architecture that provides several <em>optional</em> RISC-V CPU and ISA
(instruction set architecture) extensions. For more information regarding the RISC-V ISA extensions please
see the the <em>RISC-V Instruction Set Manual - Volume I: Unprivileged ISA</em> and <em>The RISC-V Instruction Set Manual
Volume II: Privileged Architecture</em>, which are available in the projects <code>docs/references</code> folder.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Discovering ISA Extensions</div>
The CPU can discover available ISA extensions via the <a href="#_misa"><strong><code>misa</code></strong></a> &amp; <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSRs
or by executing an instruction and checking for an <em>illegal instruction exception</em>
(&#8594; <a href="#_full_virtualization">Full Virtualization</a>).<br>
<br>
Executing an instruction from an extension that is not supported yet or that is currently not enabled
(via the according top entity generic) will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_b_bit_manipulation_operations">3.7.1. <strong><code>B</code></strong> - Bit-Manipulation Operations</h4>
<div class="paragraph">
<p>The <code>B</code> ISA extension adds instructions for bit-manipulation operations. This extension is enabled if the
<a href="#_cpu_extension_riscv_b"><em>CPU_EXTENSION_RISCV_B</em></a> configuration generic is <em>true</em>.
The official RISC-V specifications can be found here: <a href="https://github.com/riscv/riscv-bitmanip" class="bare">https://github.com/riscv/riscv-bitmanip</a></p>
</div>
<div class="paragraph">
<p>The NEORV32 <code>B</code> ISA extension includes the following sub-extensions (according to the RISC-V
bit-manipulation spec. v.093) and their corresponding instructions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong><code>Zba</code> - Address-generation instructions</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>Zbb</code> - Basic bit-manipulation instructions</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>andn</code> <code>orn</code> <code>xnor</code></p>
</li>
<li>
<p><code>clz</code> <code>ctz</code> <code>cpop</code></p>
</li>
<li>
<p><code>max</code> <code>maxu</code> <code>min</code> <code>minu</code></p>
</li>
<li>
<p><code>sext.b</code> <code>sext.h</code> <code>zext.h</code></p>
</li>
<li>
<p><code>rol</code> <code>ror</code> <code>rori</code></p>
</li>
<li>
<p><code>orc.b</code> <code>rev8</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>Zbc</code> - Carry-less multiplication instructions</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>clmul</code> <code>clmulh</code> <code>clmulr</code></p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>Zbs</code> - Single-bit instructions</strong></p>
<div class="ulist">
<ul>
<li>
<p><code>bclr</code> <code>bclri</code></p>
</li>
<li>
<p><code>bext</code> <code>bexti</code></p>
</li>
<li>
<p><code>bext</code> <code>binvi</code></p>
</li>
<li>
<p><code>bset</code> <code>bseti</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
By default, the bit-manipulation unit uses an <em>iterative</em> approach to compute shift-related operations
like <code>clz</code> and <code>rol</code>. To increase performance (at the cost of additional hardware resources) the
<a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> generic can be enabled to implement full-parallel logic (like barrel shifters) for all
shift-related <code>B</code> instructions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_c_compressed_instructions">3.7.2. <strong><code>C</code></strong> - Compressed Instructions</h4>
<div class="paragraph">
<p>The <em>compressed</em> ISA extension provides 16-bit encodings of commonly used instructions to reduce code space size.
The <code>C</code> extension is available when the <a href="#_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></a> configuration generic is <em>true</em>.
In this case the following instructions are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>c.addi4spn</code> <code>c.lw</code> <code>c.sw</code> <code>c.nop</code> <code>c.addi</code> <code>c.jal</code> <code>c.li</code> <code>c.addi16sp</code> <code>c.lui</code> <code>c.srli</code> <code>c.srai</code> <code>c.andi</code> <code>c.sub</code>
<code>c.xor</code> <code>c.or</code> <code>c.and</code> <code>c.j</code> <code>c.beqz</code> <code>c.bnez</code> <code>c.slli</code> <code>c.lwsp</code> <code>c.jr</code> <code>c.mv</code> <code>c.ebreak</code> <code>c.jalr</code> <code>c.add</code> <code>c.swsp</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
When the compressed instructions extension is enabled, branches to an <em>unaligned</em> and <em>uncompressed</em> instruction require
an additional instruction fetch to load the according second half-word of that instruction. The performance can be increased
again by forcing a 32-bit alignment of branch target addresses. By default, this is enforced via the GCC <code>-falign-functions=4</code>,
<code>-falign-labels=4</code>, <code>-falign-loops=4</code> and <code>-falign-jumps=4</code> compile flags (via the makefile).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_e_embedded_cpu">3.7.3. <strong><code>E</code></strong> - Embedded CPU</h4>
<div class="paragraph">
<p>The embedded CPU extensions reduces the size of the general purpose register file from 32 entries to 16 entries to
decrease physical hardware requirements (for example block RAM). This extensions is enabled when the <a href="#_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></a>
configuration generic is <em>true</em>. Accesses to registers beyond <code>x15</code> will raise and <em>illegal instruction exception</em>.
This extension does not add any additional instructions or features.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Due to the reduced register file size an alternate toolchain ABI (<strong><code>ilp32e</code></strong>) is required.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_i_base_integer_isa">3.7.4. <strong><code>I</code></strong> - Base Integer ISA</h4>
<div class="paragraph">
<p>The CPU always supports the complete <code>rv32i</code> base integer instruction set. This base set is always enabled
regardless of the setting of the remaining exceptions. The base instruction set includes the following
instructions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>immediate: <code>lui</code> <code>auipc</code></p>
</li>
<li>
<p>jumps: <code>jal</code> <code>jalr</code></p>
</li>
<li>
<p>branches: <code>beq</code> <code>bne</code> <code>blt</code> <code>bge</code> <code>bltu</code> <code>bgeu</code></p>
</li>
<li>
<p>memory: <code>lb</code> <code>lh</code> <code>lw</code> <code>lbu</code> <code>lhu</code> <code>sb</code> <code>sh</code> <code>sw</code></p>
</li>
<li>
<p>alu: <code>addi</code> <code>slti</code> <code>sltiu</code> <code>xori</code> <code>ori</code> <code>andi</code> <code>slli</code> <code>srli</code> <code>srai</code> <code>add</code> <code>sub</code> <code>sll</code> <code>slt</code> <code>sltu</code> <code>xor</code> <code>srl</code> <code>sra</code> <code>or</code> <code>and</code></p>
</li>
<li>
<p>environment: <code>ecall</code> <code>ebreak</code> <code>fence</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In order to keep the hardware footprint low, the CPU&#8217;s shift unit uses a bit-serial approach. Hence, shift operations
take up to 32 cycles (plus overhead) depending on the actual shift amount. Alternatively, the shift operations can be processed
completely in parallel by a fast (but large) barrel shifter if the <code>FAST_SHIFT_EN</code> generic is <em>true</em>. In that case, shift operations
complete within 2 cycles (plus overhead) regardless of the actual shift amount.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Internally, the <code>fence</code> instruction does not perform any operation inside the CPU. It only sets the
top&#8217;s <code>d_bus_fence_o</code> signal high for one cycle to inform the memory system a <code>fence</code> instruction has been
executed. Any flags within the <code>fence</code> instruction word are ignore by the hardware.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_m_integer_multiplication_and_division">3.7.5. <strong><code>M</code></strong> - Integer Multiplication and Division</h4>
<div class="paragraph">
<p>Hardware-accelerated integer multiplication and division operations are available when the
<a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a> configuration generic is <em>true</em>. In this case the following instructions are
available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>multiplication: <code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p>
</li>
<li>
<p>division: <code>div</code> <code>divu</code> <code>rem</code> <code>remu</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default, multiplication and division operations are executed in a bit-serial approach.
Alternatively, the multiplier core can be implemented using DSP blocks if the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a>
generic is <em>true</em> allowing faster execution. Multiplications and divisions
always require a fixed amount of cycles to complete - regardless of the input operands.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Regardless of the setting of the <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> generic
multiplication and division instructions operate <em>independently</em> of the input operands.
Hence, there is <strong>no early completion</strong> of multiply by one/zero and divide by zero operations.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zmmul_integer_multiplication">3.7.6. <strong><code>Zmmul</code></strong> - Integer Multiplication</h4>
<div class="paragraph">
<p>This is a <em>sub-extension</em> of the <code>M</code> ISA extension. It implements the multiplication-only operations
of the <code>M</code> extensions and is intended for size-constrained setups that require hardware-based
integer multiplications but not hardware-based divisions, which will be computed entirely in software.
This extension requires only ~50% of the hardware utilization of the "full" <code>M</code> extension.
It is implemented if the <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> configuration generic is <em>true</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>multiplication: <code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If <code>Zmmul</code> is enabled, executing any division instruction from the <code>M</code> ISA extension (<code>div</code>, <code>divu</code>, <code>rem</code>, <code>remu</code>)
will raise an <em>illegal instruction exception</em>.</p>
</div>
<div class="paragraph">
<p>Note that <code>M</code> and <code>Zmmul</code> extensions <em>cannot</em> be enabled at the same time.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If your RISC-V GCC toolchain does not (yet) support the <code>_Zmmul</code> ISA extensions, it can be "emulated"
using a <code>rv32im</code> machine architecture and setting the <code>-mno-div</code> compiler flag
(example <code>$ make MARCH=rv32im USER_FLAGS+=-mno-div clean_all exe</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_u_less_privileged_user_mode">3.7.7. <strong><code>U</code></strong> - Less-Privileged User Mode</h4>
<div class="paragraph">
<p>In addition to the basic (and highest-privileged) machine-mode, the <em>user-mode</em> ISA extensions adds a second less-privileged
operation mode. It is implemented if the <a href="#_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></a> configuration generic is <em>true</em>.
Code executed in user-mode cannot access machine-mode CSRs. Furthermore, user-mode access to the address space (like
peripheral/IO devices) can be constrained via the physical memory protection (<em>PMP</em>).
Any kind of privilege rights violation will raise an exception to allow <a href="#_full_virtualization">Full Virtualization</a>.</p>
</div>
<div class="paragraph">
<p>Additional CSRs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a> - machine counter enable to constrain user-mode access to timer/counter CSRs</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_x_neorv32_specific_custom_extensions">3.7.8. <strong><code>X</code></strong> - NEORV32-Specific (Custom) Extensions</h4>
<div class="paragraph">
<p>The NEORV32-specific extensions are always enabled and are indicated by the set <code>X</code> bit in the <a href="#_misa"><strong><code>misa</code></strong></a> CSR.</p>
</div>
<div class="paragraph">
<p>The most important points of the NEORV32-specific extensions are:
* The CPU provides 16 <em>fast interrupt</em> interrupts (<code>FIRQ</code>), which are controlled via custom bits in the <a href="#_mie"><strong><code>mie</code></strong></a>
and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs. These extensions are mapped to CSR bits, that are available for custom use according to the
RISC-V specs. Also, custom trap codes for <a href="#_mcause"><strong><code>mcause</code></strong></a> are implemented.
* All undefined/unimplemented/malformed/illegal instructions do raise an illegal instruction exception (see <a href="#_full_virtualization">Full Virtualization</a>).
* There are <a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zfinx_single_precision_floating_point_operations">3.7.9. <strong><code>Zfinx</code></strong> Single-Precision Floating-Point Operations</h4>
<div class="paragraph">
<p>The <code>Zfinx</code> floating-point extension is an <em>alternative</em> of the standard <code>F</code> floating-point ISA extension.
The <code>Zfinx</code> extensions also uses the integer register file <code>x</code> to store and operate on floating-point data
instead of a dedicated floating-point register file (hence, <code>F-in-x</code>). Thus, the <code>Zfinx</code> extension requires
less hardware resources and features faster context changes. This also implies that there are NO dedicated <code>f</code>
register file-related load/store or move instructions.
The official RISC-V specifications can be found here: <a href="https://github.com/riscv/riscv-zfinx" class="bare">https://github.com/riscv/riscv-zfinx</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 floating-point unit used by the <code>Zfinx</code> extension is compatible to the <em>IEEE-754</em> specifications.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>Zfinx</code> extensions only supports single-precision (<code>.s</code> instruction suffix), so it is a direct alternative
to the <code>F</code> extension. The <code>Zfinx</code> extension is implemented when the <a href="#_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></a> configuration
generic is <em>true</em>. In this case the following instructions and CSRs are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>conversion: <code>fcvt.s.w</code> <code>fcvt.s.wu</code> <code>fcvt.w.s</code> <code>fcvt.wu.s</code></p>
</li>
<li>
<p>comparison: <code>fmin.s</code> <code>fmax.s</code> <code>feq.s</code> <code>flt.s</code> <code>fle.s</code></p>
</li>
<li>
<p>computational: <code>fadd.s</code> <code>fsub.s</code> <code>fmul.s</code></p>
</li>
<li>
<p>sign-injection: <code>fsgnj.s</code> <code>fsgnjn.s</code> <code>fsgnjx.s</code></p>
</li>
<li>
<p>number classification: <code>fclass.s</code></p>
</li>
<li>
<p>compressed instructions: <code>c.flw</code> <code>c.flwsp</code> <code>c.fsw</code> <code>c.fswsp</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additional CSRs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_fcsr"><strong><code>fcsr</code></strong></a> - FPU control register</p>
</li>
<li>
<p><a href="#_frm"><strong><code>frm</code></strong></a> - rounding mode control</p>
</li>
<li>
<p><a href="#_fflags"><strong><code>fflags</code></strong></a> - FPU status flags</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Fused multiply-add instructions <code>f[n]m[add/sub].s</code> are not supported!
Division <code>fdiv.s</code> and square root <code>fsqrt.s</code> instructions are not supported yet!
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Subnormal numbers ("de-normalized" numbers) are not supported by the NEORV32 FPU.
Subnormal numbers (exponent = 0) are <em>flushed to zero</em> setting them to +/- 0 before entering the
FPU&#8217;s processing core. If a computational instruction (like <code>fmul.s</code>) generates a subnormal result, the
result is also flushed to zero during normalization.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The <code>Zfinx</code> extension is not yet officially ratified, but is expected to stay unchanged. There is no
software support for the <code>Zfinx</code> extension in the upstream GCC RISC-V port yet. However, an
intrinsic library is provided to utilize the provided <code>Zfinx</code> floating-point extension from C-language
code (see <code>sw/example/floating_point_test</code>).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicsr_control_and_status_register_access_privileged_architecture">3.7.10. <strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</h4>
<div class="paragraph">
<p>The CSR access instructions as well as the exception and interrupt system (= the privileged architecture)
is implemented when the <a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a> configuration generic is <em>true</em>.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
If the <code>Zicsr</code> extension is disabled the CPU does not provide any <em>privileged architecture</em> features at all!
In order to provide the full set of privileged functions that are required to run more complex tasks like
operating system and to allow a secure execution environment the <code>Zicsr</code> extension should be always enabled.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In this case the following instructions are available:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>CSR access: <code>csrrw</code> <code>csrrs</code> <code>csrrc</code> <code>csrrwi</code> <code>csrrsi</code> <code>csrrci</code></p>
</li>
<li>
<p>environment: <code>mret</code> <code>wfi</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If <code>rd=x0</code> for the <code>csrrw[i]</code> instructions there will be no actual read access to the according CSR.
However, access privileges are still enforced so these instruction variants <em>do</em> cause side-effects
(the RISC-V spec. state that these combinations "<em>shall</em> not cause any side-effects").
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title"><code>wfi</code> Instruction</div>
The <code>wfi</code> instruction is used to enter <a href="#_sleep_mode">Sleep Mode</a>. Executing the <code>wfi</code> instruction in user-mode
will raise an illegal instruction exception if <a href="#_mstatus"><strong><code>mstatus</code></strong></a>`.TW` is set.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zicntr_cpu_base_counters">3.7.11. <strong><code>Zicntr</code></strong> CPU Base Counters</h4>
<div class="paragraph">
<p>The <code>Zicntr</code> ISA extension adds the basic cycle <code>[m]cycle[h]</code>), instruction-retired (<code>[m]instret[h]</code>) and time (<code>time[h]</code>)
counters. This extensions is stated as <em>mandatory</em> by the RISC-V spec. However, area-constrained setups may remove support for
these counters. Section <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> shows a list of all <code>Zicntr</code>-related CSRs.
These are available if the <code>Zicntr</code> ISA extensions is enabled via the <a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a> generic.</p>
</div>
<div class="paragraph">
<p>Additional CSRs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_cycleh"><strong><code>cycle[h]</code></strong></a>, <a href="#_mcycleh"><strong><code>mcycle[h]</code></strong></a> - cycle counter</p>
</li>
<li>
<p><a href="#_instreth"><strong><code>instret[h]</code></strong></a>, <a href="#_minstreth"><strong><code>minstret[h]</code></strong></a> - instructions-retired counter</p>
</li>
<li>
<p><a href="#_timeh"><strong><code>time[h]</code></strong></a> - system <em>wall-clock</em> time (driven by the <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Disabling the <code>Zicntr</code> extension does not remove the <code>time[h]</code>-driving <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If the <code>Zicntr</code> ISA extension is disabled, all accesses to the according counter CSRs will raise an illegal instruction exception.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zihpm_hardware_performance_monitors">3.7.12. <strong><code>Zihpm</code></strong> Hardware Performance Monitors</h4>
<div class="paragraph">
<p>In additions to the base cycle, instructions-retired and time counters the NEORV32 CPU provides
up to 29 hardware performance monitors (HPM 3..31), which can be used to benchmark applications. Each HPM consists of an
N-bit wide counter (split in a high-word 32-bit CSR and a low-word 32-bit CSR), where N is defined via the top&#8217;s
<a href="#_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></a> generic (0..64-bit) and a corresponding event configuration CSR. The event configuration
CSR defines the architectural events that lead to an increment of the associated HPM counter. See the
<a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> documentation for a list of available trigger events.</p>
</div>
<div class="paragraph">
<p>The HPM counters are available if the <code>Zihpm</code> ISA extensions is enabled via the <a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> generic.
The actual number of implemented HPM counters is defined by the <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> generic.</p>
</div>
<div class="paragraph">
<p>Additional CSRs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_mhpmevent"><strong><code>mhpmevent</code></strong></a> 3..31 (depending on <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a>) - event configuration CSRs</p>
</li>
<li>
<p><a href="#_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></a> 3..31 (depending on <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a>) - counter CSRs</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The HPM counter CSRs can only be accessed in machine-mode. Hence, the according <a href="#_mcounteren"><strong><code>mcounteren</code></strong></a> CSR bits
are always zero and read-only. Any access from less-privileged modes will raise an illegal instruction
exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Auto-increment of the HPMs can be deactivated individually via the <a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_zifencei_instruction_stream_synchronization">3.7.13. <strong><code>Zifencei</code></strong> Instruction Stream Synchronization</h4>
<div class="paragraph">
<p>The <code>Zifencei</code> CPU extension is implemented if the <a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a> configuration
generic is <em>true</em>. It allows manual synchronization of the instruction stream via the following instruction:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>fence.i</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>fence.i</code> instruction resets the CPU&#8217;s front-end (instruction fetch) and flushes the prefetch buffer.
This allows a clean re-fetch of modified instructions from memory. Also, the top&#8217;s <code>i_bus_fencei_o</code> signal is set
high for one cycle to inform the memory system (like the i-cache to perform a flush/reload.
Any additional flags within the <code>fence.i</code> instruction word are ignore by the hardware.</p>
</div>
</div>
<div class="sect3">
<h4 id="_zxcfu_custom_instructions_extension_cfu">3.7.14. <strong><code>Zxcfu</code></strong> Custom Instructions Extension (CFU)</h4>
<div class="paragraph">
<p>The <code>Zxcfu</code> presents a NEORV32-specific extension to the RISC-V ISA (<code>Z</code> = sub-extension, <code>x</code> = platform-specific
custom extension, <code>cfu</code> = name of the custom extension). When enabled via the <a href="#_cpu_extension_riscv_zxcfu"><em>CPU_EXTENSION_RISCV_Zxcfu</em></a> configuration
generic, this ISA extensions adds the <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a> to the CPU core. The CFU is a module that
allows to add <strong>custom RISC-V instructions</strong> to the processor core.</p>
</div>
<div class="paragraph">
<p>The CPU is implemented as additional ALU co-processor and is integrated right into the CPU&#8217;s pipeline providing minimal
data transfer latency as it has direct access to the core&#8217;s register file. The CFU utilizes the RISC-V <code>custom</code> opcodes
that have been explicitly reserved by the RISC-V spec for custom extensions.</p>
</div>
<div class="paragraph">
<p>Software can utilize the custom instructions by using <em>intrinsic</em>, which are basically inline assembly functions that
behave like regular C functions but that evaluate to a single custom instruction word (not calling overhead at all).</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
For more detailed information regarding the CFU, it&#8217;s hardware and the according software interface
see section <a href="#_custom_functions_unit_cfu">Custom Functions Unit (CFU)</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The CFU module / <code>Zxcfu</code> ISA extension is intended for user-defined <strong>instructions</strong>.
If you like to add more complex accelerators or interfaces that can also operate independently of
the CPU take a look at the memory-mapped <a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_pmp_physical_memory_protection">3.7.15. <strong><code>PMP</code></strong> Physical Memory Protection</h4>
<div class="paragraph">
<p>The NEORV32 physical memory protection (PMP) provides an elementary memory protection mechanism that can be used
to constrain read, write and execute rights of arbitrary memory regions. The NEORV32 PMP is partly compatible
to the RISC-V Privileged Architecture Specifications.</p>
</div>
<div class="paragraph">
<p>In general, the PMP can <strong>grant permissions to U mode</strong>, which by default have none, and
can <strong>revoke permissions from M-mode</strong>, which by default has full permissions.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The NEORV32 PMP only supports <strong>TOR</strong> (top of region) mode, which basically is a "base-and-bound" concept, and only
up to 16 PMP regions.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The physical memory protection logic is implemented if the <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> configuration generic is greater
than zero. This generic also defines the total number of implemented configurable region registers.
The minimal granularity of a protected region is defined by the <a href="#_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></a> generic. Larger
granularity will reduce hardware complexity but will also decrease the resolution.
The default value is 4 bytes, which allows a minimal region size of 4 bytes.</p>
</div>
<div class="paragraph">
<p>If implemented the PMP provides the following additional CSRs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_pmpcfg"><strong><code>pmpcfg</code></strong></a> 0..3 (depending on configuration) - PMP configuration registers, 4 entries per CSR</p>
</li>
<li>
<p><a href="#_pmpaddr"><strong><code>pmpaddr</code></strong></a> 0..15 (depending on configuration) - PMP address registers</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">PMP Example Program</div>
A simple PMP example program can be found in <code>sw/example/demo_pmp</code>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hardware Optimization</div>
Reducing the minimal PMP region size / granularity via the <a href="#_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></a> top entity generic
will reduce hardware utilization and also reduces impact on critical path.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">PMP Rules when in Debug Mode</div>
When in debug-mode all PMP rules are ignored making the debugger have maximum access rights.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sdext_external_debug_support">3.8. <strong>`Sdext</strong> External Debug Support</h3>
<div class="paragraph">
<p>This ISA extension enables the RISC-V-compatible "external debug support" by implementing
the CPU "debug mode", which is required for the on-chip debugger.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_cpu_debug_mode">CPU Debug Mode</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sdtrig_trigger_module">3.9. <strong><code>Sdtrig</code></strong> Trigger Module</h3>
<div class="paragraph">
<p>This ISA extension implements the RISC-V-compatible trigger module.
See section <a href="#_on_chip_debugger_ocd">On-Chip Debugger (OCD)</a> / <a href="#_trigger_module">Trigger Module</a> for more information.</p>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_custom_functions_unit_cfu">3.10. Custom Functions Unit (CFU)</h3>
<div class="paragraph">
<p>The Custom Functions Unit is the central part of the <a href="#_zxcfu_custom_instructions_extension_cfu"><strong><code>Zxcfu</code></strong> Custom Instructions Extension (CFU)</a> and represents
the actual hardware module, which is used to implement <em>custom RISC-V instructions</em>. The concept of the NEORV32
CFU has been highly inspired by <a href="https://github.com/google/CFU-Playground">Google&#8217;s CFU-Playground</a>.</p>
</div>
<div class="paragraph">
<p>The CFU is intended for operations that are inefficient in terms of performance, latency, energy consumption or
program memory requirements when implemented entirely in software. Some potential application fields and exemplary
use-cases might include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>AI:</strong> sub-word / vector / SIMD operations like processing all four bytes of a 32-bit data word in parallel</p>
</li>
<li>
<p><strong>Cryptographic:</strong> bit substitution and permutation</p>
</li>
<li>
<p><strong>Communication:</strong> conversions like binary to gray-code; multiply-add operations</p>
</li>
<li>
<p><strong>Image processing:</strong> look-up-tables for color space transformations</p>
</li>
<li>
<p>implementing instructions from <strong>other RISC-V ISA extensions</strong> that are not yet supported by the NEORV32</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The CFU is not intended for complex and <em>CPU-independent</em> functional units that implement complete accelerators
(like block-based AES encryption). These kind of accelerators should be implemented as memory-mapped
<a href="#_custom_functions_subsystem_cfs">Custom Functions Subsystem (CFS)</a>.
A comparison of all NEORV32-specific chip-internal hardware extension options is provided in the user guide section
<a href="https://stnolting.github.io/neorv32/ug/#_adding_custom_hardware_modules">Adding Custom Hardware Modules</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_cfu_instruction_formats">3.10.1. CFU Instruction Formats</h4>
<div class="paragraph">
<p>The custom instructions executed by the CFU utilize a specific opcode space in the <code>rv32</code> 32-bit instruction
space that has been explicitly reserved for user-defined extensions by the RISC-V specifications ("<em>Guaranteed Non-Standard
Encoding Space</em>"). The NEORV32 CFU uses the <code>custom-x</code> opcodes to identify the instructions implemented
by the CFU and to differentiate between the different instruction formats.
The according binary encoding of these opcodes is shown below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>custom-0</code>: <code>0001011</code> (R3-type instructions, RISC-V standard)</p>
</li>
<li>
<p><code>custom-1</code>: <code>0101011</code> (R4-type instructions, RISC-V standard)</p>
</li>
<li>
<p><code>custom-2</code>: <code>1011011</code> (R5-type instruction A, NEORV32-specific)</p>
</li>
<li>
<p><code>custom-3</code>: <code>1111011</code> (R5-type instruction B, NEORV32-specific)</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CFU Instructions - Exceptions</div>
The CPU control logic only analyzes the opcode of the custom instructions to check if the <em>entire</em>
instruction word is valid. All remaining bit-fields are <strong>not checked</strong> at all.
This also means that the MSBs of the register fields are <strong>not checked</strong> even if the <code>E</code> ISA extension
is enabled (for standard RISC-V instructions this would cause an exception).
Hence, a custom CFU instruction can never raise an illegal instruction exception. If the CFU is not
implemented at all (<code>Zxcfu</code> ISA extension is not enabled) any instruction with <code>custom-x</code> opcode
will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cfu_r3_type_instructions">3.10.2. CFU R3-Type Instructions</h4>
<div class="paragraph">
<p>The R3-type CFU instructions operate on two source registers and return the processing result to the destination register.
The actual operation can be defined by using the <code>funct7</code> and <code>funct3</code> bit fields. These immediates can also be used to
pass additional data to the CFU like offsets, look-up-tables addresses or shift-amounts. However, the actual
functionality is entirely user-defined.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 xnor rs2</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r3type_instruction.png" alt="cfu r3type instruction">
</div>
<div class="title">Figure 8. CFU R3-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>funct7</code>: 7-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0001011</code> (RISC-V "custom-0" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The CFU R3-type instruction format is compliant to the RISC-V ISA specification.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
By using the <code>funct7</code> and <code>funct3</code> bit fields entirely for selecting the actual operation a total of 1024 custom R3-type
instructions can be implemented (7-bit + 3-bit = 10 bit &#8594; 1024 different values).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cfu_r4_type_instructions">3.10.3. CFU R4-Type Instructions</h4>
<div class="paragraph">
<p>The R4-type CFU instructions operate on three source registers and return the processing result to the destination register.
The actual operation can be defined by using the <code>funct3</code> bit field. Alternatively, this immediate can also be used to
pass additional data to the CFU like offsets, look-up-tables addresses or shift-amounts. However, the actual
functionality is entirely user-defined.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; (rs1 * rs2 + rs3)[31:0]</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r4type_instruction.png" alt="cfu r4type instruction">
</div>
<div class="title">Figure 9. CFU R4-type instruction format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rs3</code>: address of third source register (32-bit source data)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>funct3</code>: 3-bit immediate (further operand data or function select)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>0101011</code> (RISC-V "custom-1" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The CFU R4-type instruction format is compliant to the RISC-V ISA specification.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unused instruction bits</div>
The RISC-V ISA specification defines bits [26:25] of the R4-type instruction word to be all-zero. These bits are ignored
by the hardware (CFU and illegal instruction check logic) and should be set to all-zero to preserve compatibility with
future implementations.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
By using the <code>funct3</code> bit field entirely for selecting the actual operation a total of 8 custom R4-type instructions
can be implemented (3-bit &#8594; 8 different values).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_cfu_r5_type_instructions">3.10.4. CFU R5-Type Instructions</h4>
<div class="paragraph">
<p>The R5-type CFU instructions operate on three source registers and return the processing result to the destination register.
As all bits of the instruction word are used to encode the five registers and the opcode, no further immediate bits
are available to specify the actual operation. There are two different R5-type instruction with two different opcodes
available. Hence, only two R5-type operations can be implemented out of the box.</p>
</div>
<div class="paragraph">
<p>Example operation: <code>rd &#8656; rs1 &amp; rs2 &amp; rs3 &amp; rs4</code></p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r5type_instruction_a.png" alt="cfu r5type instruction a">
</div>
<div class="title">Figure 10. CFU R5-type instruction A format</div>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/cfu_r5type_instruction_b.png" alt="cfu r5type instruction b">
</div>
<div class="title">Figure 11. CFU R5-type instruction B format</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rs4.hi</code> &amp; <code>rs4.lo</code>: address of fourth source register (32-bit source data)</p>
</li>
<li>
<p><code>rs3</code>: address of third source register (32-bit source data)</p>
</li>
<li>
<p><code>rs2</code>: address of second source register (32-bit source data)</p>
</li>
<li>
<p><code>rs1</code>: address of first source register (32-bit source data)</p>
</li>
<li>
<p><code>rd</code>: address of destination register (for the 32-bit processing result)</p>
</li>
<li>
<p><code>opcode</code>: <code>1011011</code> (RISC-V "custom-2" opcode) and/or <code>1111011</code> (RISC-V "custom-3" opcode)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RS4 bit field</div>
The <code>rs4</code> bit-field is split into two instruction word fields <code>rs4.hi</code> and <code>rs4.lo</code>. This allows a simple
decoding logic as the location of the remaining register fields is identical to other R-type instructions.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">RISC-V compatibility</div>
The RISC-V ISA specifications does not specify a R5-type instruction format. Hence, this instruction
layout is NEORV32-specific.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Instruction encoding space</div>
There are no immediate fields in the CFU R5-type instruction so the actual operation is specified entirely
by the opcode resulting in just two different operations out of the box. However, another CFU instruction
(like a R3-type instruction) can be used to "program" the actual operation of a R5-type instruction by
writing operation information to a CFU-internal "command" register.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_using_custom_instructions_in_software">3.10.5. Using Custom Instructions in Software</h4>
<div class="paragraph">
<p>The custom instructions provided by the CFU can be used in plain C code by using <strong>intrinsics</strong>. Intrinsics
behave like "normal" functions but under the hood they are a set of macros that hide the complexity of inline assembly.
Using intrinsics removes the need to modify the compiler, built-in libraries or the assembler when including custom
instructions. Each intrinsic will result in a single 32-bit instruction word providing maximum code efficiency.</p>
</div>
<div class="paragraph">
<p>The NEORV32 software framework provides four pre-defined prototypes for custom instructions, which are defined in
<code>sw/lib/include/neorv32_cpu_cfu.h</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 6. CFU instruction prototypes</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_cfu_r3_instr(funct7, funct3, rs1, rs2) // R3-type instructions
neorv32_cfu_r4_instr(funct3, rs1, rs2, rs3)    // R4-type instructions
neorv32_cfu_r5_instr_a(rs1, rs2, rs3, rs4)     // R5-type instruction A
neorv32_cfu_r5_instr_b(rs1, rs2, rs3, rs4)     // R5-type instruction B</code></pre>
</div>
</div>
<div class="paragraph">
<p>The intrinsic functions always return a 32-bit value of type <code>uint32_t</code> (the processing result), which can be discarded
when not needed. Each intrinsic function requires several arguments depending on the instruction type/format:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>funct7</code> - 7-bit immediate (R3-type only)</p>
</li>
<li>
<p><code>funct3</code> - 3-bit immediate (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs1</code> - source operand 1, 32-bit (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs2</code> - source operand 2, 32-bit (R3-type, R4-type)</p>
</li>
<li>
<p><code>rs3</code> - source operand 2, 32-bit (R3-type, R4-type, R5-type)</p>
</li>
<li>
<p><code>rs4</code> - source operand 2, 32-bit (R4-type, R4-type, R5-type)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The <code>funct3</code> and <code>funct7</code> bit-fields are used to pass 3-bit or 7-bit literals to the CFU. The <code>rs1</code>, <code>rs2</code> and <code>rs3</code>
arguments pass the actual data to the CFU. These register arguments can be populated with variables or literals.
The following example shows how to pass arguments when executing both CFU instruction types:</p>
</div>
<div class="listingblock">
<div class="title">Listing 7. CFU instruction usage example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">uint32_t tmp = some_function();
...
uint32_t res = neorv32_cfu_r3_instr(0b0000000, 0b101, tmp, 123);
uint32_t foo = neorv32_cfu_r4_instr(0b011, tmp, res, some_array[i]);
uint32_t bar = neorv32_cfu_r5_instr_a(tmp, res, foo, tmp);</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CFU Example Program</div>
There is an example program for the CFU, which shows how to use the <em>default</em> CFU hardware module.
This example program is located in <code>sw/example/demo_cfu</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_custom_instructions_hardware">3.10.6. Custom Instructions Hardware</h4>
<div class="paragraph">
<p>The actual functionality of the CFU&#8217;s custom instructions is defined by the user-defined logic inside
the CFU hardware module <code>rtl/core/neorv32_cpu_cp_cfu.vhd</code>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CFU Hardware Example &amp; More Details</div>
The default CFU hardware module already implement some exemplary instructions that are used for illustration
by the CFU example program. See the CFU&#8217;s VHDL source file (<code>rtl/core/neorv32_cpu_cp_cfu.vhd</code>), which
is highly commented to explain the available signals and the handshake with the CPU pipeline.
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">CFU hardware resource requirements</div>
Enabling the CFU and actually implementing R4-type and/or R5-type instructions (or more precisely, using
the according operands for the CFU hardware) will add one or two additional read ports to the core&#8217;s
register file increasing resource requirements.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>CFU operations can be entirely combinatorial (like bit-reversal) so the result is available at the end of
the current clock cycle. Operations can also take several clock cycles to complete (like multiplications)
and may also include internal states and memories. The CFU&#8217;s internal controller unit takes care of
interfacing the custom user logic to the CPU&#8217;s pipeline.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">CFU Execution Time</div>
The CFU is not required to finish processing within a bound time. However, you should keep in mind that the
CPU is <em>stalled</em> until the CFU has finished processing. This also means the CPU cannot react to pending
interrupts during this time affecting real-time behavior (interrupt requests will still be queued).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_instruction_timing">3.11. Instruction Timing</h3>
<div class="paragraph">
<p>The instruction timing listed in the table below shows the required clock cycles for executing a certain
instruction. These instruction cycles assume a bus access without additional wait states (memory Latency = 1)
and a filled pipeline.</p>
</div>
<div class="paragraph">
<p>Average CPI (cycles per instructions) values for "real applications" like for executing the CoreMark benchmark for different CPU
configurations are presented in <a href="#_cpu_performance">CPU Performance</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 39. Clock cycles per instruction</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 40%;">
<col style="width: 30%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Class</th>
<th class="tableblock halign-center valign-top">ISA</th>
<th class="tableblock halign-center valign-top">Instruction(s)</th>
<th class="tableblock halign-left valign-top">Execution cycles</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>add[i]</code> <code>slt[i]</code> <code>slt[i]u</code> <code>xor[i]</code> <code>or[i]</code> <code>and[i]</code> <code>sub</code> <code>lui</code> <code>auipc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.addi4spn</code> <code>c.nop</code> <code>c.add[i]</code> <code>c.li</code> <code>c.addi16sp</code> <code>c.lui</code> <code>c.and[i]</code> <code>c.sub</code> <code>c.xor</code> <code>c.or</code> <code>c.mv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sll[i]</code> <code>srl[i]</code> <code>sra[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <em>shift_amount</em>; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALU</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.srli</code> <code>c.srai</code> <code>c.slli</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3 + <em>shift_amount</em>; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>beq</code> <code>bne</code> <code>blt</code> <code>bge</code> <code>bltu</code> <code>bgeu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taken: 6; not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Branches</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.beqz</code> <code>c.bnez</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taken: 6; not taken: 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumps / Calls</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jal[r]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jumps / Calls</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.jal[r]</code> <code>c.j</code> <code>c.jr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>lb</code> <code>lh</code> <code>lw</code> <code>lbu</code> <code>lhu</code> <code>sb</code> <code>sh</code> <code>sw</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.lw</code> <code>c.sw</code> <code>c.lwsp</code> <code>c.swsp</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Memory access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>A</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>lr.w</code> <code>sc.w</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MulDiv</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mul</code> <code>mulh</code> <code>mulhsu</code> <code>mulhu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36; FAST_MUL: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MulDiv</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>M</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>div</code> <code>divu</code> <code>rem</code> <code>remu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>csrrw[i]</code> <code>csrrs[i]</code> <code>csrrc[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ecall</code> <code>ebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code>+<code>C</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>c.break</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>wfi</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">System</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mret</code> <code>dret</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fence</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>I/E</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fence</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zifencei</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fence.i</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fadd.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">110</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fsub.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">112</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - artihmetic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fmul.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - compare</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fmin.s</code> <code>fmax.s</code> <code>feq.s</code> <code>flt.s</code> <code>fle.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - misc</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fsgnj.s</code> <code>fsgnjn.s</code> <code>fsgnjx.s</code> <code>fclass.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - conversion</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fcvt.w.s</code> <code>fcvt.wu.s</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point - conversion</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zfinx</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>fcvt.s.w</code> <code>fcvt.s.wu</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">48</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - arithmetic/logic</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>min[u]</code> <code>max[u]</code> <code>sext.b</code> <code>sext.h</code> <code>andn</code> <code>orn</code> <code>xnor</code> <code>zext</code>(pack) <code>rev8</code>(grevi) <code>orc.b</code>(gorci)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clz</code> <code>ctz</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + 1..32; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cpop</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifts</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbb)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>rol</code> <code>ror[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 + <em>shift_amount</em>; FAST_SHIFT: 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - shifted-add</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zba)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sh1add</code> <code>sh2add</code> <code>sh3add</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - single-bit</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbs)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sbset[i]</code> <code>sbclr[i]</code> <code>sbinv[i]</code> <code>sbext[i]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit-manipulation - carry-less multiply</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>B(Zbc)</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>clmul</code> <code>clmulh</code> <code>clmulr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom instructions (CFU)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zxcfu</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>custom</em> (min. 4)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-center valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Illegal instructions</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The presented values of the <strong>floating-point execution cycles</strong> are average values - obtained from
4096 instruction executions using pseudo-random input values. The execution time for emulating the
instructions (using pure-software libraries) is ~17..140 times higher.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_control_and_status_registers_csrs">3.12. Control and Status Registers (CSRs)</h3>
<div class="paragraph">
<p>The following table shows a summary of all available NEORV32 CSRs. The address field defines the CSR address for
the CSR access instructions. The <strong>[ASM]</strong> name can be used for (inline) assembly code and is directly
understood by the assembler/compiler. The <strong>[C]</strong> names are defined by the NEORV32 core library and can be
used as immediate in plain C code. The <strong>R/W</strong> column shows whether the CSR can be read and/or written.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CSRs that are not Implemented</div>
All CSR bits that are unused / not implemented / not shown are <em>hardwired to zero</em>. All CSRs that are not
implemented, not supported or disabled will raise an illegal instruction exception when being accessed.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">WARL Behavior</div>
All writable CSRs provide <strong>WARL</strong> behavior (write all values; read only legal values). Application software
should always read back a CSR after writing to check if the targeted bits can actually be modified (or are
just read-only).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 40. NEORV32 Control and Status Registers (CSRs)</caption>
<colgroup>
<col style="width: 8.6956%;">
<col style="width: 17.3913%;">
<col style="width: 21.7391%;">
<col style="width: 4.3478%;">
<col style="width: 47.8262%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Address</th>
<th class="tableblock halign-left valign-top">Name [ASM]</th>
<th class="tableblock halign-left valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_floating_point_csrs">Floating-Point CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fflags"><strong><code>fflags</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FFLAGS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point accrued exceptions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_frm"><strong><code>frm</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FRM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point dynamic rounding mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_fcsr"><strong><code>fcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_FCSR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Floating-point control and status (<code>frm</code> + <code>fflags</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_configuration_csrs">Machine Configuration CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfg"><strong><code>menvcfg</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MENVCFG</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_menvcfgh"><strong><code>menvcfgh</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MENVCFGH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine environment configuration register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_setup_csrs">Machine Trap Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatus"><strong><code>mstatus</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_misa"><strong><code>misa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MISA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine CPU ISA and extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mie"><strong><code>mie</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtvec"><strong><code>mtvec</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MTVEC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap-handler base address for ALL traps</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcounteren"><strong><code>mcounteren</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mstatush"><strong><code>mstatush</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSTATUSH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine status register - high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mscratch"><strong><code>mscratch</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MSCRATCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine scratch register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mepc"><strong><code>mepc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MEPC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine exception program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcause"><strong><code>mcause</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCAUSE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine trap cause</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mtval"><strong><code>mtval</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MTVAL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine bad address or instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mip"><strong><code>mip</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine interrupt pending register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_physical_memory_protection_csrs">Machine Physical Memory Protection CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpcfg"><code>pmpcfg0</code></a>   .. <a href="#_pmpcfg"><code>pmpcfg3</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_PMPCFG0</em>  .. <em>CSR_PMPCFG3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection configuration for region 0..15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_pmpaddr"><code>pmpaddr0</code></a> .. <a href="#_pmpaddr"><code>pmpaddr15</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_PMPADDR0</em> .. <em>CSR_PMPADDR15</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Physical memory protection address register region 0..15</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_trigger_module_csrs">Trigger Module CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tselect"><strong><code>tselect</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TSELECT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger select register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata1"><strong><code>tdata1</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TDATA1</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata2"><strong><code>tdata2</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TDATA2</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tdata3"><strong><code>tdata3</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TDATA3</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger data register 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tinfo"><strong><code>tinfo</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TINFO</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger information register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_tcontrol"><strong><code>tcontrol</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TCONTROL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trigger control register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcontext"><strong><code>mcontext</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCONTEXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine context register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_scontext"><strong><code>scontext</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_SCONTEXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Supervisor context register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dcsr"><strong><code>dcsr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dpc"><strong><code>dpc</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug program counter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_dscratch0"><strong><code>dscratch0</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug scratch register 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCYCLE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MINSTRET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcycleh"><code>mcycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCYCLEH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_minstreth"><code>minstreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MINSTRETH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycle</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_CYCLE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_timeh"><code>time</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TIME</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time (from MTIME) low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instret</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_INSTRET</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_cycleh"><code>cycleh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_CYCLEH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cycle counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_timeh"><code>timeh</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_TIMEH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System time (from MTIME) high word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_instreth"><code>instreth</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_INSTRETH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction-retired counter high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x323</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmevent"><code>mhpmevent3</code></a>       ,, <a href="#_mhpmevent"><code>mhpmevent31</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMEVENT3</em>    .. <em>CSR_MHPMEVENT31</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring event select for counter 3..31</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3</code></a>  ,, <a href="#_mhpmcounterh"><code>mhpmcounter31</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMCOUNTER3</em>  .. <em>CSR_MHPMCOUNTER3H</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..31 low word</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhpmcounterh"><code>mhpmcounter3h</code></a> ,, <a href="#_mhpmcounterh"><code>mhpmcounter31h</code></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHPMCOUNTER3H</em> .. <em>CSR_MHPMCOUNTER31H</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine performance-monitoring counter 3..31 high word</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_counter_setup_csrs">Machine Counter Setup CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mcountinhibit"><strong><code>mcountinhibit</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine counter-enable register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_machine_information_csrs">Machine Information CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mvendorid"><strong><code>mvendorid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MVENDORID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Vendor ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_marchid"><strong><code>marchid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MARCHID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Architecture ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mimpid"><strong><code>mimpid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MIMPID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine implementation ID / version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mhartid"><strong><code>mhartid</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MHARTID</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine thread ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mconfigptr"><strong><code>mconfigptr</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MCONFIGPTR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine configuration pointer register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="5"><p class="tableblock"><strong><a href="#_neorv32_specific_csrs">NEORV32-Specific CSRs</a></strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xfc0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="#_mxisa"><strong><code>mxisa</code></strong></a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>CSR_MXISA</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEORV32-specific "extended" machine CPU ISA and extensions</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The following CSR sections provide a "headline" for each CSRs. It shows the 12-bit CSR address, the register&#8217;s ISA/assembly name,
a short description, the reset value and all ISA extension(s) that are required for implementing the according CSR.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
<div class="sect3">
<h4 id="_floating_point_csrs">3.12.1. Floating-Point CSRs</h4>
<div class="sect4">
<h5 id="_fflags"><strong><code>fflags</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x001</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fflags</code> - <strong>Floating-point accrued exceptions</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, writes are ignored; reads always return 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NV</strong>: invalid operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>DZ</strong>: division by zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>OF</strong>: overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>UF</strong>: underflow</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>NX</strong>: inexact</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_frm"><strong><code>frm</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x002</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>frm</code> - <strong>Floating-point dynamic rounding mode</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, writes are ignored; reads always return 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_fcsr"><strong><code>fcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x003</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fcsr</code> - <strong>Floating-point control and status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zfinx</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, writes are ignored; reads always return 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rounding mode (<a href="#_frm"><strong><code>frm</code></strong></a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Accrued exception flags (<a href="#_fflags"><strong><code>fflags</code></strong></a>)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_configuration_csrs">3.12.2. Machine Configuration CSRs</h4>
<div class="sect4">
<h5 id="_menvcfg"><strong><code>menvcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x30a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>menvcfg</code> - <strong>Machine environment configuration register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The features of this CSR are not implemented yet. The register is read-only and always returns zero.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_menvcfgh"><strong><code>menvcfgh</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x31a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>menvcfgh</code> - <strong>Machine environment configuration register - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The features of this CSR are not implemented yet. The register is read-only and always returns zero.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_trap_setup_csrs">3.12.3. Machine Trap Setup CSRs</h4>
<div class="sect4">
<h5 id="_mstatus"><strong><code>mstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x300</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mstatus</code> - <strong>Machine status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MSTATUS_TW</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TW</strong>: Trap on execution of <code>wfi</code> instruction in user mode when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MSTATUS_MPRV</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPRV</strong>: Effective privilege level for load/stores in machine mode; use `MPP&#8217;s as effective privilege level when set; hardwired to zero if user-mode not implemented</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MSTATUS_MPP_H</em> : <em>CSR_MSTATUS_MPP_L</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPP</strong>: Previous machine privilege level, 11 = machine (M) level, 00 = user (U) level</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MSTATUS_MPIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MPIE</strong>: Previous machine global interrupt enable flag state</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MSTATUS_MIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MIE</strong>: Machine global interrupt enable flag</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the core is in user-mode, machine-mode interrupts are globally <strong>enabled</strong> even if <code>mstatus.mie</code> is cleared:
"Interrupts for higher-privilege modes, y&gt;x, are always globally enabled regardless of the setting of the global yIE
bit for the higher-privilege mode." - RISC-V ISA Spec.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_misa"><strong><code>misa</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x301</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>misa</code> - <strong>ISA and extensions</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>DEFINED</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 <code>misa</code> CSR is read-only. Hence, active CPU extensions are entirely defined by pre-synthesis configurations
and cannot be switch on/off during runtime. For compatibility reasons any write access to this CSR is simply ignored and
will <em>not</em> cause an illegal instruction exception.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_MXL_HI_EXT</em> : <em>CSR_MISA_MXL_LO_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MXL</strong>: 32-bit architecture indicator (always <em>01</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_X_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: extension bit is always set to indicate custom non-standard extensions</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_U_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>U</strong>: CPU extension (user mode) available, set when <a href="#_cpu_extension_riscv_u"><em>CPU_EXTENSION_RISCV_U</em></a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_M_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>M</strong>: CPU extension (mul/div) available, set when <a href="#_cpu_extension_riscv_m"><em>CPU_EXTENSION_RISCV_M</em></a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_I_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I</strong>: CPU base ISA, cleared when <a href="#_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_E_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>E</strong>: CPU extension (embedded) available, set when <a href="#_cpu_extension_riscv_e"><em>CPU_EXTENSION_RISCV_E</em></a> enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MISA_C_EXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>C</strong>: CPU extension (compressed instruction) available, set when <a href="#_cpu_extension_riscv_c"><em>CPU_EXTENSION_RISCV_C</em></a> enabled</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Machine-mode software can discover available <code>Z*</code> <em>sub-extensions</em> (like <code>Zicsr</code> or <code>Zfinx</code>) by checking the NEORV32-specific
<a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mie"><strong><code>mie</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x304</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mie</code> - <strong>Machine interrupt-enable register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIE_FIRQ15E</em> : <em>CSR_MIE_FIRQ0E</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Fast interrupt channel 15..0 enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIE_MEIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIE</strong>: Machine <em>external</em> interrupt enable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIE_MTIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIE</strong>: Machine <em>timer</em> interrupt enable (from <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIE_MSIE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIE</strong>: Machine <em>software</em> interrupt enable</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mtvec"><strong><code>mtvec</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x305</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtvec</code> - <strong>Machine trap-handler base address</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>BASE</strong>: 4-byte aligned base address of trap base handler</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MODE</strong>: always zero; BASE defines entry for <em>all</em> traps</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcounteren"><strong><code>mcounteren</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x306</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mcounteren</code> - <strong>Machine counter enable</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>U</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Always zero: user-level code is <strong>not</strong> allowed to read HPM counters</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: User-level code is allowed to read <code>cycle[h]</code> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_TM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>TM</strong>: User-level code is allowed to read <code>time[h]</code> CSRs when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTEREN_CY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: User-level code is allowed to read <code>instret[h]</code> CSRs when set</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If User mode is not implemented this register is read-only and always return zero when read.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">HPM Access</div>
Bits 3 to 31 are used to control user-level access to the <a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a>. In the NEORV32
CPU these bits are hardwired to zero. Hence, user-level software cannot access the HPMs. Accordingly, the
<code>hpmcounter*[h]</code> CSRs are <strong>not</strong> implemented and any access will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mstatush"><strong><code>mstatush</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x310</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mstatush</code> - <strong>Machine status register - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The features of this CSR are not implemented yet. The register is read-only and always returns zero.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_trap_handling_csrs">3.12.4. Machine Trap Handling CSRs</h4>
<div class="sect4">
<h5 id="_mscratch"><strong><code>mscratch</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x340</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mscratch</code> - <strong>Scratch register for machine trap handlers</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>DEFINED</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mepc"><strong><code>mepc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x341</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mepc</code> - <strong>Machine exception program counter</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcause"><strong><code>mcause</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x342</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mcause</code> - <strong>Machine trap cause</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 8.3333%;">
<col style="width: 83.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Interrupt</strong>: <code>1</code> if the trap is caused by an interrupt (<code>0</code> if the trap is caused by an exception)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Exception code</strong>: see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mtval"><strong><code>mtval</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x343</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mtval</code> - <strong>Machine trap value register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Trap cause</th>
<th class="tableblock halign-center valign-top"><code>mtval</code> content</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">misaligned instruction fetch address or instruction fetch access fault</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">address of faulting instruction fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">misaligned load address, load access fault, misaligned store address or store access fault</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">program counter (= address) of faulting instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">everything else (including all interrupts)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">0x00000000 (all-zero)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In case an invalid <strong>compressed instruction</strong> raised an illegal instruction exception, <code>mtval</code> will show the
according de-compressed instruction word. To get the actually 16-bit instruction that caused the exception
perform a memory load using the address stored in <a href="#_mepc"><strong><code>mepc</code></strong></a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
See section <a href="#_traps_exceptions_and_interrupts">Traps, Exceptions and Interrupts</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mip"><strong><code>mip</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x344</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mip</code> - <strong>Machine interrupt pending</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>mip</code> CSR shows the currently <em>pending</em> interrupts.
The bits for the standard RISC-V interrupts are read-only. Hence, these interrupts cannot be cleared using the <code>mip</code> register and must
be cleared/acknowledged within the according interrupt-generating device.
The upper 16 bits represent the status of the CPU&#8217;s fast interrupt request lines (FIRQ). Once triggered, these bit have to be cleared manually by
writing zero to the according <code>mip</code> bits (in the interrupt handler routine) to clear the current interrupt request.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIP_FIRQ15P</em> : <em>CSR_MIP_FIRQ0P</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/c</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>FIRQxP</strong>: Fast interrupt channel 15..0 pending; has to be cleared manually by writing zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIP_MEIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MEIP</strong>: Machine <em>external</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIP_MTIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MTIP</strong>: Machine <em>timer</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MIP_MSIP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>MSIP</strong>: Machine <em>software</em> interrupt pending; <em>cleared by platform-defined mechanism</em></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">RISC-V Standard Interrupts</div>
Pending RISC-V standard machine interrupts (MEI, MTI, MSI) <strong>cannot</strong> be acknowledged/cleared by clearing the according
<code>mip</code> bit. The interrupt source has to keep the interrupt request signal high until explicitly acknowledged (e.g. by writing
to a specific memory-mapped register). However, the RISC-V standard interrupts can be cleared at any time by clearing the
according <a href="#_mip"><strong><code>mip</code></strong></a> bit(s).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">FIRQ Channel Mapping</div>
See section <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a> for the mapping of the FIRQ channels and the according
interrupt-triggering processor module.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_physical_memory_protection_csrs">3.12.5. Machine Physical Memory Protection CSRs</h4>
<div class="paragraph">
<p>The available physical memory protection logic is configured via the <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> and
<a href="#_pmp_min_granularity"><em>PMP_MIN_GRANULARITY</em></a> top entity generics. <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> defines the number of implemented
protection regions and thus, the implementation of the available <em>PMP entries</em>.
See section <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a> for more information.</p>
</div>
<div class="paragraph">
<p>If trying to access an PMP-related CSR beyond <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> <strong>no illegal instruction
exception</strong> is triggered. The according CSRs are read-only (writes are ignored) and always return zero.
However, any access beyond <code>pmpcfg3</code> or <code>pmpaddr15</code>, which are the last physically implemented registers if
<a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> == 16, will raise an illegal instruction exception as these CSRs are not implemented at all.</p>
</div>
<div class="sect4">
<h5 id="_pmpcfg"><strong><code>pmpcfg</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmpcfg0</code> - <strong>Physical memory protection configuration register (region 0-3)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmpcfg3</code> - <strong>Physical memory protection configuration register (region 12-15)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 6.6666%;">
<col style="width: 13.3333%;">
<col style="width: 6.6666%;">
<col style="width: 73.3335%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_L</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>L</strong>: Lock bit, prevents further write accesses, also enforces access rights in machine-mode, can only be cleared by CPU reset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6:5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_A_MSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><strong>A</strong>: Mode configuration; only <strong>OFF</strong> (<code>00</code>) and <strong>TOR</strong> (<code>01</code>) modes are supported, any other value will map back to OFF/TOR
as the MSB is hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_A_LSB</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_X</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>X</strong>: Execute permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_W</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>W</strong>: Write permission</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>PMPCFG_R</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>R</strong>: Read permission</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Setting the lock bit <code>L</code> and setting TOR mode in <code>pmpcfg(i)</code> will also lock write access to <code>pmpaddr(i-1)</code>.
See the RISC-V specs. for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_pmpaddr"><strong><code>pmpaddr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmpaddr0</code> - <strong>Physical memory protection address registers (region 0)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x3bf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>pmpaddr15</code> - <strong>Physical memory protection address registers (region 15)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>PMP</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Physical Address Size</div>
The two MSBs of each <code>pmpaddr</code> are hardwired to zero (= bits 33:32 of the physical address).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_counter_and_timer_csrs">3.12.6. (Machine) Counter and Timer CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Counter Size</div>
When implemented (by enabling the <code>Zicntr</code> ISA extension) the standard CPU counters are always 64-bit wide (low-word + high-word).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Retired Counter Increment</div>
The <code>[m]instret[h]</code> counter always increments when a instruction enters the pipeline&#8217;s execute stage no matter
if this instruction is meant to retire or if it causes an exception.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_cycleh"><strong><code>cycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cycle</code> - <strong>Cycle counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>cycleh</code> - <strong>Cycle counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_timeh"><strong><code>time[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>time</code> - <strong>System time - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>timeh</code> - <strong>System time - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_instreth"><strong><code>instret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instret</code> - <strong>Instructions-retired counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xc82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>instreth</code> - <strong>Instructions-retired counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcycleh"><strong><code>mcycle[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb00</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mcycle</code> - <strong>Machine cycle counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb80</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mcycleh</code> - <strong>Machine cycle counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_minstreth"><strong><code>minstret[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minstret</code> - <strong>Machine instructions-retired counter - low word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>minstreth</code> - <strong>Machine instructions-retired counter - high word</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zicntr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_hardware_performance_monitors_hpm_csrs">3.12.7. Hardware Performance Monitors (HPM) CSRs</h4>
<div class="paragraph">
<p>The actual number of implemented hardware performance monitors is configured via the <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> top entity generic,
Note that always all 28 HPM counter and configuration registers (<code>mhpmcounter*[h]</code> and <code>mhpmevent*</code>) are implemented, but
only the actually configured ones are implemented as "real" physical registers - the remaining ones will be hardwired to zero.</p>
</div>
<div class="paragraph">
<p>If trying to access an HPM-related CSR beyond <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> <strong>no illegal instruction exception is
triggered</strong>. These CSRs are read-only (writes are ignored) and always return zero.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Privilege</div>
The HPM system only allows machine-mode access. Hence, <code>hpmcounter*[h]</code> CSR are not implemented and any access (even
from machine mode) will raise an illegal instruction exception. Furthermore, the according bits of <a href="#_mcounteren"><strong><code>mcounteren</code></strong></a>
used to configure user-mode access to <code>hpmcounter*[h]</code> are hardwired to zero.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The total counter width of the HPMs can be configured before synthesis via the <a href="#_hpm_cnt_width"><em>HPM_CNT_WIDTH</em></a> generic (0..64-bit).
If <a href="#_hpm_num_cnts"><em>HPM_NUM_CNTS</em></a> is less than 64, all remaining MSB-aligned bits are hardwired to zero.</p>
</div>
<div class="sect4">
<h5 id="_mhpmevent"><strong><code>mhpmevent</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 75%;">
<col style="width: 16.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x232</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmevent3</code> - <strong>Machine hardware performance monitor event select (counter 3)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x33f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmevent31</code> - <strong>Machine hardware performance monitor event select (counter 31)</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The value in these CSRs define the architectural events that cause an increment of the according <code>mhpmcounter*[h]</code> counter(s).
All available events are listed in the table below. If more than one event is selected, the according counter will increment if <em>any</em> of
the enabled events is observed (logical OR). Note that the counter will only increment by 1 step per clock
cycle even if more than one trigger event is observed.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, writes are ignored, read always return zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_ILLEGAL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction exception</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_TRAP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entered trap (synchronous exception or interrupt)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_TBRANCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>taken</em> conditional branch</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_BRANCH</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">conditional branch (<em>taken</em> or <em>not taken</em>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_JUMP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">unconditional jump</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_LS</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load/store memory wait cycle: if more than 1 cycle memory latency or high bus traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_STORE</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory data store operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_LOAD</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">memory data load operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_MC</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">multi-cycle ALU operation wait cycle (like iterative shift operation)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_II</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction issue pipeline wait cycle: if more than 1 cycle latency, pipelines flush (like taken branches) / cache miss or high bus traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_WAIT_IF</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction fetch memory wait cycle: if more than 1 cycle memory latency, cache miss or high bus traffic</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_CIR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retired compressed instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">retired instruction (compressed or uncompressed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>not implemented, always read as zero</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>HPMCNT_EVENT_CY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">active clock cycle (CPU not in sleep mode)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mhpmcounterh"><strong><code>mhpmcounter[h]</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 75%;">
<col style="width: 16.6667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmcounter3</code> - <strong>Machine hardware performance monitor - counter 3 low</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb1f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmcounter31</code> - <strong>Machine hardware performance monitor - counter 31 low</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmcounter3h</code> - <strong>Machine hardware performance monitor - counter 3 high</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">&#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xb9f</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhpmcounter31h</code> - <strong>Machine hardware performance monitor - counter 31 high</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>Zihpm</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: all <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_counter_setup_csrs">3.12.8. Machine Counter Setup CSRs</h4>
<div class="sect4">
<h5 id="_mcountinhibit"><strong><code>mcountinhibit</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x320</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mcountinhibit</code> - <strong>Machine counter-inhibit register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_HPM3</em> : <em>CSR_MCOUNTINHIBIT_HPM31</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>HPMx</strong>: The <code>mhpmcount*[h]</code> CSRs will auto-increment according to the configured <code>mhpmevent*</code> selector</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_CY</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>CY</strong>: The <code>[m]cycle[h]</code> CSRs will auto-increment with each clock cycle (if CPU is not in sleep state) when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MCOUNTINHIBIT_IR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>IR</strong>: The <code>[m]instret[h]</code> CSRs will auto-increment with each committed instruction when set</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_machine_information_csrs">3.12.9. Machine Information CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All machine information registers can only be accessed in machine mode and are read-only.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_mvendorid"><strong><code>mvendorid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mvendorid</code> - <strong>Machine vendor ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p>
</div>
</div>
<div class="sect4">
<h5 id="_marchid"><strong><code>marchid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>marchid</code> - <strong>Machine architecture ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000013</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>marchid</code> CSR is read-only and shows the NEORV32 official RISC-V open-source architecture ID
(decimal: 19, 32-bit hexadecimal: 0x00000013).</p>
</div>
</div>
<div class="sect4">
<h5 id="_mimpid"><strong><code>mimpid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mimpid</code> - <strong>Machine implementation ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>DEFINED</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>mimpid</code> CSR is read-only and shows the version of the
NEORV32 as BCD-coded number (example: <code>mimpid</code> = <em>0x01020312</em>  01.02.03.12  version 1.2.3.12).</p>
</div>
</div>
<div class="sect4">
<h5 id="_mhartid"><strong><code>mhartid</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mhartid</code> - <strong>Machine hardware thread ID</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>DEFINED</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>mhartid</code> CSR is read-only and shows the core&#8217;s hart ID, which is assigned via the <a href="#_hw_thread_id"><em>HW_THREAD_ID</em></a> top generic.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mconfigptr"><strong><code>mconfigptr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0xf15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mconfigptr</code> - <strong>Machine configuration pointer register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>zicsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The features of this CSR are not implemented yet. The register is read-only and always returns zero.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_neorv32_specific_csrs">3.12.10. NEORV32-Specific CSRs</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
All NEORV32-specific CSRs are mapped to addresses that are explicitly reserved for custom <strong>Machine-Mode, read-only</strong> CSRs
(assured by the RISC-V privileged specifications). Hence, these CSRs can only be accessed when in machine-mode. Any access
outside of machine-mode will raise an illegal instruction exception.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_mxisa"><strong><code>mxisa</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 66.6666%;">
<col style="width: 25.0001%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7c0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mxisa</code> - <strong>Machine EXTENDED ISA and Extensions register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>Zicsr</code> + <code>X</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>DEFINED</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>NEORV32-specific read-only CSR that helps machine-mode software to discover <code>Z*</code> sub-extensions and CPU options.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 64.2859%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [C]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_FASTSHIFT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast shifts available when set (via top&#8217;s <a href="#_fast_shift_en"><em>FAST_SHIFT_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_FASTMUL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast multiplication available when set (via top&#8217;s <a href="#_fast_mul_en"><em>FAST_MUL_EN</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_IS_SIM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set if CPU is being <strong>simulated</strong> ( not guaranteed)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_SDTRIG</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sdtrig</code> extension (trigger module) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_sdtrig"><em>CPU_EXTENSION_RISCV_Sdtrig</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_SDEXT</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Sdext</code> extension (debug mode) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_sdext"><em>CPU_EXTENSION_RISCV_Sdext</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZIHPM</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zihpm</code> (hardware performance monitors) extension available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zihpm"><em>CPU_EXTENSION_RISCV_Zihpm</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_PMP</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>PMP</code> (physical memory protection) extension available when set (via top&#8217;s <a href="#_pmp_num_regions"><em>PMP_NUM_REGIONS</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZICNTR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicntr</code> extension (<code>I</code> sub-extension) available when set - <code>[m]cycle</code>, <code>[m]instret</code> and <code>[m]time</code> CSRs available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zicntr"><em>CPU_EXTENSION_RISCV_Zicntr</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZFINX</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zfinx</code> extension (<code>F</code> sub-/alternative-extension: FPU using <code>x</code> registers) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zfinx"><em>CPU_EXTENSION_RISCV_Zfinx</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, read as zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZXCFU</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zxcfu</code> extension (custom functions unit for custom RISC-V instructions) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zxcfu"><em>CPU_EXTENSION_RISCV_Zxcfu</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZMMUL</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zmmul</code> extension (<code>M</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zmmul"><em>CPU_EXTENSION_RISCV_Zmmul</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZIFENCEI</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zifencei</code> extension (<code>I</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a> generic)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>CSR_MXISA_ZICSR</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Zicsr</code> extension (<code>I</code> sub-extension) available when set (via top&#8217;s <a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a> generic)</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_traps_exceptions_and_interrupts">3.12.11. Traps, Exceptions and Interrupts</h4>
<div class="paragraph">
<p>In this document the following terminology is used (derived from the RISC-V trace specification
available at <a href="https://github.com/riscv-non-isa/riscv-trace-spec" class="bare">https://github.com/riscv-non-isa/riscv-trace-spec</a>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>exception</strong>: an unusual condition occurring at run time associated (i.e. <em>synchronous</em>) with an
instruction in a RISC-V hart</p>
</li>
<li>
<p><strong>interrupt</strong>: an external <em>asynchronous</em> event that may cause a RISC-V hart to experience an
unexpected transfer of control</p>
</li>
<li>
<p><strong>trap</strong>: the transfer of control to a trap handler caused by either an <em>exception</em> or an <em>interrupt</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Whenever an exception or interrupt is triggered, the CPU switches to machine-mode (if not already in machine-mode)
and transfers control to the address stored in <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR. The cause of the this trap can
be determined via the <a href="#_mcause"><strong><code>mcause</code></strong></a> CSR. A list of all implement <code>mcause</code> values and the according description
can be found below in section <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>. The address that reflects the current program counter when a trap
was taken is stored to <a href="#_mepc"><strong><code>mepc</code></strong></a> CSR. This might be the address of the instruction that actually caused the trap
or that has not been executed yet as it was interrupted by a trap. Additional information regarding the cause
of the trap can be retrieved from the <a href="#_mtval"><strong><code>mtval</code></strong></a> CSR and the processor&#8217;s <a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a>
(for bus access exceptions).</p>
</div>
<div class="paragraph">
<p>The traps are prioritized. If several <em>exceptions</em> occur at once only the one with highest priority is triggered
while all remaining exceptions are ignored. If several <em>interrupts</em> trigger at once, the one with highest priority
is serviced first while the remaining ones stay <em>pending</em>. After completing the interrupt handler the interrupt with
the second highest priority will get serviced and so on until no further interrupts are pending.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupts when in User-Mode</div>
IF the core is currently operating in less privileged user-mode, (machine-mode) interrupts are globally enabled
even if <a href="#_mstatus"><strong><code>mstatus</code></strong></a>`.mie` is cleared.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements - Standard RISC-V Interrupts</div>
All standard RISC-V interrupts request signals are <strong>high-active</strong>. A request has to stay at high-level (=asserted)
until it is explicitly acknowledged by the CPU software (for example by writing to a specific memory-mapped register).
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Signal Requirements - Fast Interrupt Requests</div>
The NEORV32-specific FIRQ request lines are triggered by a one-shot high-level (i.e. rising edge). Each request is buffered in the CPU control
unit until the channel is either disabled (by clearing the according <a href="#_mie"><strong><code>mie</code></strong></a> CSR bit) or the request is explicitly cleared (by writing
zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Instruction Atomicity</div>
All instructions execute as atomic operations - interrupts can only trigger <em>between</em> two instructions.
So even if there is a permanent interrupt request, exactly one instruction from the interrupt program will be executed before
another interrupt handler can start. This allows program progress even if there are permanent interrupt requests.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_memory_access_exceptions">Memory Access Exceptions</h5>
<div class="paragraph">
<p>If a load operation causes any exception, the instruction&#8217;s destination register is
<em>not written</em> at all. Load exceptions caused by a misalignment or a physical memory protection fault do not
trigger a bus/memory read-operation at all. Vice versa, exceptions caused by a store address misalignment or a store physical
memory protection fault do not trigger a bus/memory write-operation at all.</p>
</div>
</div>
<div class="sect4">
<h5 id="_custom_fast_interrupt_request_lines">Custom Fast Interrupt Request Lines</h5>
<div class="paragraph">
<p>As a custom extension, the NEORV32 CPU features 16 fast interrupt request (FIRQ) lines via the <code>firq_i</code> CPU top
entity signals. These interrupts have custom configuration and status flags in the <a href="#_mie"><strong><code>mie</code></strong></a> and <a href="#_mip"><strong><code>mip</code></strong></a> CSRs and also
provide custom trap codes in <a href="#_mcause"><strong><code>mcause</code></strong></a>. These FIRQs are reserved for NEORV32 processor-internal usage only.</p>
</div>
</div>
<div class="sect4">
<h5 id="_neorv32_trap_listing">NEORV32 Trap Listing</h5>
<div class="paragraph">
<p>The following table shows all traps that are currently supported by the NEORV32 CPU. It also shows the prioritization
and the CSR side-effects. A more detailed description of the actual trap triggering events is provided in a further table.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>Asynchronous exceptions</em> (= interrupts) set the MSB of <a href="#_mcause"><strong><code>mcause</code></strong></a> while <em>synchronous exception</em> (= "software exception")
clear the MSB.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Table Annotations</strong></p>
</div>
<div class="paragraph">
<p>The "Prio." column shows the priority of each trap. The highest priority is 1. The &#8220;mcause&#8221; column shows the
cause ID of the according trap that is written to <a href="#_mcause"><strong><code>mcause</code></strong></a> CSR.  The "ID [C]" names are defined by the NEORV32
core library (the runtime environment <em>RTE</em>) and can be used in plain C code. The <a href="#_mepc"><strong><code>mepc</code></strong></a> and <a href="#_mtval"><strong><code>mtval</code></strong></a> columns
show the values written to the according CSRs when a trap is triggered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>I-PC</strong> - address of interrupted instruction (instruction has not been executed yet)</p>
</li>
<li>
<p><strong>PC</strong> - address of instruction that caused the trap (instruction has been executed)</p>
</li>
<li>
<p><strong>ADR</strong> - bad memory access address that caused the trap</p>
</li>
<li>
<p><strong>0</strong> - zero</p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 41. NEORV32 Trap Listing</caption>
<colgroup>
<col style="width: 3.3333%;">
<col style="width: 13.3333%;">
<col style="width: 30%;">
<col style="width: 40%;">
<col style="width: 6.6666%;">
<col style="width: 6.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Prio.</th>
<th class="tableblock halign-left valign-top"><code>mcause</code></th>
<th class="tableblock halign-left valign-top">ID [C]</th>
<th class="tableblock halign-left valign-top">Cause</th>
<th class="tableblock halign-left valign-top"><code>mepc</code></th>
<th class="tableblock halign-left valign-top"><code>mtval</code></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>Exceptions</strong> (synchronous to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction access bus fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ILLEGAL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x0000000B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from M-mode (<code>ecall</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_UENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from U-mode (<code>ecall</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_BREAKPOINT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">software breakpoint (<code>ebreak</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store access bus fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load access bus fault</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>ADR</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="6"><p class="tableblock"><strong>Interrupts</strong> (asynchronous to instruction execution)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_0</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_2</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_3</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_4</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_5</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_6</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_7</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_8</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_9</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_10</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_11</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_12</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_13</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_14</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_15</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt request channel 15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x8000000B</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MEI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (MEI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MSI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (MSI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MTI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (MTI)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>I-PC</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0</strong></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following table provides a summarized description of the actual events for triggering a specific trap.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 42. NEORV32 Trap Description</caption>
<colgroup>
<col style="width: 30%;">
<col style="width: 70%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trap ID [C]</th>
<th class="tableblock halign-left valign-top">Triggered when &#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fetching a 32-bit instruction word that is not 32-bit-aligned (see note below)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout or bus access error during instruction word fetch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_I_ILLEGAL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trying to execute an invalid instruction word (malformed or not supported) or on a privilege violation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_UENV_CALL</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ecall</code> instruction in user-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_BREAKPOINT</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">executing <code>ebreak</code> instruction or if <a href="#_trigger_module">Trigger Module</a> fires</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storing data to an address that is not naturally aligned to the data size (byte, half, word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_MISALIGNED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">loading data from an address that is not naturally aligned to the data size  (byte, half, word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_S_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout or bus access error during load data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_L_ACCESS</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus timeout or bus access error during store data operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_FIRQ_0</em> &#8230;&#8203; <em>TRAP_CODE_FIRQ_15</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">caused by interrupt-condition of processor-internal modules, see <a href="#_neorv32_specific_fast_interrupt_requests">NEORV32-Specific Fast Interrupt Requests</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MEI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt (via dedicated top-entity signal)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MSI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt (via dedicated top-entity signal)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>TRAP_CODE_MTI</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt (internal machine timer or via dedicated top-entity signal)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Resumable Exceptions</div>
Note that not all exceptions are resumable. For example, the "instruction access fault" exception or the "instruction address misaligned"
exception are not resumable in most cases. These exception might indicate a fatal memory hardware failure.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Interrupt Trigger Type</div>
The RISC-V standard interrupts (MEI, MSI and MTI) are <strong>level-triggered and high-active</strong>. Once set the signal has to stay high until
the interrupt request is explicitly acknowledged (e.g. writing to a memory-mapped register). The RISC-V standard interrupts
can <strong>NOT</strong> be acknowledged by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.<br>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>+
In contrast, the NEORV32 fast interrupt request channels become pending after being triggering by <strong>a rising edge</strong>. A pending FIRQ has to
be explicitly cleared by writing zero to the according <a href="#_mip"><strong><code>mip</code></strong></a> CSR bit.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Misaligned Instruction Address Exception</div>
For 32-bit-only instructions (= no <code>C</code> extension) the misaligned instruction exception
is raised if bit 1 of the fetch address is set (i.e. not on a 32-bit boundary). If the <code>C</code> extension is implemented
there will never be a misaligned instruction exception <em>at all</em>.
In both cases bit 0 of the program counter (and all related CSRs) is hardwired to zero.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect3">
<h4 id="_bus_interface">3.12.12. Bus Interface</h4>
<div class="paragraph">
<p>The NEORV32 CPU implements a 32-bit machine with separated instruction and data interfaces making the CPU a
<strong>Harvard Architecture</strong>: the <em>instruction fetch interface</em> (<code>i_bus_*</code>) is used for fetching instructions and the
<em>data access interface</em> (<code>d_bus_*</code>) is used to access data via load and store operations.
Each of these interfaces can access an address space of up to 2<sup>32</sup> bytes (4GB).
The following table shows the signals of the data and instruction interfaces as seen from the CPU (<code>*_o</code> signals are driven
by the CPU / outputs, <code>*_i</code> signals are read by the CPU / inputs). Both interfaces use the same <a href="#_protocol">Protocol</a>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 43. CPU Bus Interface Signals</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 60%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Signal</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_addr_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">access address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_rdata_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data input for read operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_wdata_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">data output for write operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_ben_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">byte enable signal for write operations</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>d_bus_we_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus write access request (one-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_re_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bus read access request (one-shot)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_ack_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessed peripheral indicates a successful completion of the bus transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_err_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">accessed peripheral indicates an error during the bus transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_fence_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">this signal is set for one cycle when the CPU executes an instruction/data fence command</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>i/d_bus_priv_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">shows the effective privilege level of the bus access</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Pipelined Transfers</div>
Currently, there a no pipelined or overlapping operations (within the same bus interface) implemented.
So only a single transfer request can be "in fly" (pending) at once. However, this is no real drawback. The
minimal possible latency for a single access is two cycles, which is equal to the CPU&#8217;s minimal execution latency
for a single instruction.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Unaligned Memory Accesses</div>
Please note that the NEORV32 CPU does <strong>not support the handling of unaligned memory accesses</strong> in hardware. Any
unaligned memory access will raise an exception that can be used to handle unaligned accesses in <em>software</em>
(via emulation).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Signal Stability</div>
All outgoing bus interface signals (driven by the CPU) remain <em>stable</em> until the bus access is completed. This simplifies
the design of the bus interconnection network as well as the architecture of the individual processor modules.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_protocol">Protocol</h5>
<div class="paragraph">
<p>A new bus request is triggered either by the <code>*_bus_re_o</code> signal (for reading data) or by the <code>*_bus_we_o</code> signal
(for writing data). In case of a request, one of these signals is high for exactly one cycle. The transaction is
completed when the accessed peripheral/memory either sets the <code>*_bus_ack_i</code> signal (&#8594; successful completion) or the
<code>*_bus_err_i</code> signal (&#8594; failed completion). These bus response signals have to be also set only for one cycle.
If a bus request is terminated by the <code>*_bus_err_i</code> signal the CPU will raise the according "instruction bus access fault" or
"load/store bus access fault" exception.</p>
</div>
<div class="paragraph">
<p><strong>Minimal Response Latency</strong></p>
</div>
<div class="paragraph">
<p>The transfer can be completed within in the same cycle as it was initiated (asynchronous response) if the accessed module
directly sets <code>*_bus_ack_i</code> or <code>*_bus_err_i</code> high for one cycle. However, in order to shorten the
critical path such an "asynchronous" response should be avoided. The default NEORV32 processor-internal modules use a registered
response with exactly <strong>one cycle delay</strong> between initiation and completion of transfers.</p>
</div>
<div class="paragraph">
<p><strong>Maximal Response Latency</strong></p>
</div>
<div class="paragraph">
<p>The processor-internal modules do not have to respond within one cycle after a bus request has been initiated.
However, the bus transaction has to be completed (= acknowledged) within a certain <strong>response time window</strong>. This time window
is defined by the global <code>max_proc_int_response_time_c</code> constant (default = 15 cycles; defined in the processor&#8217;s VHDL package file
<code>rtl/neorv32_package.vhd</code>). It defines the maximum number of cycles after which an <em>unacknowledged</em> (<code>*<em>bus_ack_i</code> or <code>*_bus_err_i</code>
signals both not set) transfer will time out and will raise a <strong>bus fault exception</strong>. The <a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a> keeps
track of all _internal</em> bus transactions to enforce this time window.</p>
</div>
<div class="paragraph">
<p>If any bus operations times out - for example when accessing "address space holes" - the BUSKEEPER will issue a bus
error to the CPU (via the according <code>*<em>bus_err_i</code> signal) that will raise the according instruction fetch or data access bus exception.
Note that <strong>the bus keeper does not track external accesses via the external memory bus interface</strong>. However,
the external memory bus interface also provides an _optional</em> bus timeout
(see section <a href="#_processor_external_memory_interface_wishbone_axi4_lite">Processor-External Memory Interface (WISHBONE) (AXI4-Lite)</a>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Interface Response</div>
Please note that any CPU access via the data or instruction interface has to be terminated either by asserting the
CPU&#8217;s *_bus_ack_i` or <code>*_bus_err_i</code> signal. Otherwise the CPU will be stalled permanently. The BUSKEEPER ensures that
any kind of access is always properly terminated.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>Exemplary Bus Accesses</strong></p>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 44. Example bus accesses: see read/write access description below</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/cpu_interface_read_long.png" alt="read" width="300" height="150">
</div>
</div></div></td>
<td class="tableblock halign-center valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="img/cpu_interface_write_long.png" alt="write" width="300" height="150">
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">Read access</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">Write access</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Write Access</strong></p>
</div>
<div class="paragraph">
<p>For a write access the according access address (<code>bus_addr_o</code>), the data to-be-written (<code>bus_wdata_o</code>) and the byte
enable identifier (<code>bus_ben_o</code>) are set when <code>bus_we_o</code> goes high. These three signals are kept stable until the
transaction is completed. In the example the accessed peripheral cannot answer directly within the next
cycle. Here, the transaction is successful and the peripheral sets the <code>bus_ack_i</code> signal <em>several</em>
cycles after issuing.</p>
</div>
<div class="paragraph">
<p><strong>Read Access</strong></p>
</div>
<div class="paragraph">
<p>For a read access the according access address (<code>bus_addr_o</code>) is set when <code>bus_re_o</code> goes high. The address is kept
stable until the transaction is completed. In the example the accessed peripheral cannot answer
directly within the next cycle. The peripheral hast to apply the read data right in the same cycle as
the bus transaction is completed (here, the transaction is successful and the peripheral sets the <code>bus_ack_i</code>
signal).</p>
</div>
<div class="paragraph">
<p><strong>Access Boundaries</strong></p>
</div>
<div class="paragraph">
<p>The instruction interface will always access memory on word (= 32-bit) boundaries even if fetching
compressed (16-bit) instructions. The data interface can access memory on byte (= 8-bit), half-word (= 16-
bit) and word (= 32-bit) boundaries, but not all processor module support sub-word accesses.</p>
</div>
<div class="paragraph">
<p><strong>Memory Barriers</strong></p>
</div>
<div class="paragraph">
<p>Whenever the CPU executes a <code>fence</code> instruction, the according interface signal is set high for one cycle
(<code>d_bus_fence_o</code> for a <code>fence</code> instruction; <code>i_bus_fence_o</code> for a <code>fence.i</code> instruction). It is the task of the
memory system to perform the necessary operations (for example a cache flush/reload).</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_software_framework">4. Software Framework</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To make actual use of the NEORV32 processor, the project comes with a complete software ecosystem. This
ecosystem is based on the RISC-V port of the GCC GNU Compiler Collection and consists of the following elementary parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_compiler_toolchain">Compiler Toolchain</a></p>
</li>
<li>
<p><a href="#_core_libraries">Core Libraries</a></p>
</li>
<li>
<p><a href="#_application_makefile">Application Makefile</a></p>
</li>
<li>
<p><a href="#_executable_image_format">Executable Image Format</a></p>
<div class="ulist">
<ul>
<li>
<p><a href="#_linker_script">Linker Script</a></p>
</li>
<li>
<p><a href="#_ram_layout">RAM Layout</a></p>
</li>
<li>
<p><a href="#_c_standard_library">C Standard Library</a></p>
</li>
<li>
<p><a href="#_start_up_code_crt0">Start-Up Code (crt0)</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#_bootloader">Bootloader</a></p>
</li>
<li>
<p><a href="#_neorv32_runtime_environment">NEORV32 Runtime Environment</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A summarizing list of the most important elements of the software framework and their according
files and folders is shown below:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application start-up code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/crt0.S</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application linker script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/neorv32.ld</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Core hardware driver libraries ("HAL")</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/lib/include/</code> &amp; <code>sw/lib/source/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Central application makefile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/common/common.mk</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tool for generating NEORV32 executables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/image_gen/</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default bootloader</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/bootloader/bootloader.c</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Example programs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>sw/example</code></p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Software Documentation</div>
All core libraries and example programs are documented "in-code" using <strong>Doxygen</strong>.
The documentation is automatically built and deployed to GitHub pages and is available online
at <a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Example Programs</div>
A collection of annotated example programs, which show how to use certain CPU functions
and peripheral/IO modules, can be found in <code>sw/example</code>.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_compiler_toolchain">4.1. Compiler Toolchain</h3>
<div class="paragraph">
<p>The toolchain for this project is based on the free RISC-V GCC-port. You can find the compiler sources and
build instructions on the official RISC-V GNU toolchain GitHub page: <a href="https://github.com/riscv/riscv-gnutoolchain" class="bare">https://github.com/riscv/riscv-gnutoolchain</a>.</p>
</div>
<div class="paragraph">
<p>The NEORV32 implements a 32-bit RISC-V architecture and uses a 32-bit integer and soft-float ABI by default.
Make sure the toolchain / toolchain build is configured accordingly.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>MARCH=rv32i</code></p>
</li>
<li>
<p><code>MABI=ilp32</code></p>
</li>
<li>
<p><code>RISCV_PREFIX=riscv32-unknown-elf-</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These default configurations can be override at any times using <a href="#_application_makefile">Application Makefile</a> variables.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
More information regarding the toolchain (building from scratch or downloading the prebuilt ones)
can be found in the user guides' section <a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_core_libraries">4.2. Core Libraries</h3>
<div class="paragraph">
<p>The NEORV32 project provides a set of pre-defined C libraries that allow an easy integration of the processor/CPU features
(also called "HAL" - hardware abstraction layer). All driver and runtime-related files are located in
<code>sw/lib</code>. These are automatically included and linked by adding the following include statement:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">#include &lt;neorv32.h&gt; // NEORV32 HAL, core and runtime libraries</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 26.6666%;">
<col style="width: 53.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">C source file</th>
<th class="tableblock halign-left valign-top">C header file</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">main NEORV32 definitions and library file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cfs.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver (stubs) functions for the custom functions subsystem
<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnotedef_6" title="View footnote.">6</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the NEORV32 <strong>CPU</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_cfu.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_cpu_cfu.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the NEORV32 <strong>CFU</strong> (custom instructions)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gpio.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>GPIO</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_gptmr.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>GPTRM</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_intrinsics.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macros for intrinsics &amp; custom instructions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_mtime.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>MTIME</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_neoled.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>NEOLED</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_onewire.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>ONEWIRE</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_pwm.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>PWM</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_rte.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEORV32 <strong>runtime environment</strong> and helper functions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_slink.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>SLINK</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_spi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>SPI</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_trng.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>TRNG</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_twi.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>TWI</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_uart.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>UART0</strong> and <strong>UART1</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_wdt.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>WDT</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xip.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xip.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>XIP</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>neorv32_xirq.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HW driver functions for the <strong>XIRQ</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>syscalls.c</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newlib "system calls"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>legacy.h</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">backwards compatibility wrappers and functions (do not use for new designs)</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Core Library Documentation</div>
The <em>doxygen</em>-based documentation of the software framework including all core libraries is available online at
<a href="https://stnolting.github.io/neorv32/sw/files.html" class="bare">https://stnolting.github.io/neorv32/sw/files.html</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">CMSIS System View Description File (SVD)</div>
A CMSIS-SVD-compatible <strong>System View Description (SVD)</strong> file including all peripherals is available in <code>sw/svd</code>.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_application_makefile">4.3. Application Makefile</h3>
<div class="paragraph">
<p>Application compilation is based on a single, centralized <strong>GNU makefile</strong> (<code>sw/common/common.mk</code>). Each project in the
<code>sw/example</code> folder provides a makefile that just includes this central makefile.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
When creating a new project, copy an existing project folder or at least the makefile to the new project folder.
It is recommended to create new projects also in <code>sw/example</code> to keep the file dependencies. However, these
dependencies can be manually configured via makefile variables if the new project is located somewhere else.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Before the makefile can be used to compile applications, the RISC-V GCC toolchain needs to be installed and
the compiler&#8217;s <code>bin</code> folder has to be added to the system&#8217;s <code>PATH</code> variable. More information can be found in
<a href="https://stnolting.github.io/neorv32/ug/#_software_toolchain_setup">User Guide: Software Toolchain Setup</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The makefile is invoked by simply executing <code>make</code> in the console. For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">neorv32/sw/example/demo_blink_led$ make</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_targets">4.3.1. Targets</h4>
<div class="paragraph">
<p>Just executing <code>make</code> (or executing <code>make help</code>) will show the help menu listing all available targets.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile">$ make
&lt;&lt;&lt; NEORV32 SW Application Makefile &gt;&gt;&gt;
Make sure to add the bin folder of RISC-V GCC to your PATH variable.

=== Targets ===
 help       - show this text
 check      - check toolchain
 info       - show makefile/toolchain configuration
 asm        - compile and generate &lt;main.asm&gt; assembly listing file for manual debugging
 elf        - compile and generate &lt;main.elf&gt; ELF file
 bin        - compile and generate &lt;neorv32_raw_exe.bin&gt; RAW executable file (binary file, no header)
 hex        - compile and generate &lt;neorv32_raw_exe.hex&gt; RAW executable file (hex char file, no header)
 image      - compile and generate VHDL IMEM boot image (for application, no header) in local folder
 install    - compile, generate and install VHDL IMEM boot image (for application, no header)
 sim        - in-console simulation using default/simple testbench and GHDL
 all        - exe + install + hex + bin + asm
 elf_info   - show ELF layout info
 clean      - clean up project home folder
 clean_all  - clean up whole project, core libraries and image generator
 bl_image   - compile and generate VHDL BOOTROM boot image (for bootloader only, no header) in local folder
 bootloader - compile, generate and install VHDL BOOTROM boot image (for bootloader only, no header)

=== Variables ===
 USER_FLAGS   - Custom toolchain flags [append only], default ""
 EFFORT       - Optimization level, default "-Os"
 MARCH        - Machine architecture, default "rv32i"
 MABI         - Machine binary interface, default "ilp32"
 APP_INC      - C include folder(s) [append only], default "-I ."
 ASM_INC      - ASM include folder(s) [append only], default "-I ."
 RISCV_PREFIX - Toolchain prefix, default "riscv32-unknown-elf-"
 NEORV32_HOME - NEORV32 home folder, default "../../.."</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_configuration">4.3.2. Configuration</h4>
<div class="paragraph">
<p>The compilation flow is configured via variables right at the beginning of the central
makefile (<code>sw/common/common.mk</code>):</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
The makefile configuration variables can be overridden or extended directly when invoking the makefile. For
example <code>$ make MARCH=rv32ic clean_all exe</code> overrides the default <code>MARCH</code> variable definitions.
Permanent modifications/definitions can be made in the project-local makefile
(e.g., <code>sw/example/demo_blink_led/makefile</code>).
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 8. Default Makefile Configuration</div>
<div class="content">
<pre class="highlight"><code class="language-makefile" data-lang="makefile"># *****************************************************************************
# USER CONFIGURATION
# *****************************************************************************
# User's application sources (*.c, *.cpp, *.s, *.S); add additional files here
APP_SRC ?= $(wildcard ./*.c) $(wildcard ./*.s) $(wildcard ./*.cpp) $(wildcard ./*.S)
# User's application include folders (don't forget the '-I' before each entry)
APP_INC ?= -I .
# User's application include folders - for assembly files only (don't forget the '-I' before each
entry)
ASM_INC ?= -I .
# Optimization
EFFORT ?= -Os
# Compiler toolchain
RISCV_PREFIX ?= riscv32-unknown-elf-
# CPU architecture and ABI
MARCH ?= rv32i
MABI  ?= ilp32
# User flags for additional configuration (will be added to compiler flags)
USER_FLAGS ?=
# Relative or absolute path to the NEORV32 home folder
NEORV32_HOME ?= ../../..
# *****************************************************************************</code></pre>
</div>
</div>
<table class="tableblock frame-all grid-none stretch">
<caption class="title">Table 45. Variables Description</caption>
<colgroup>
<col style="width: 23.0769%;">
<col style="width: 76.9231%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APP_SRC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source files of the application (<code><strong>.c</code>, <code></strong>.cpp</code>, <code><strong>.S</code> and <code></strong>.s</code> files are allowed;
files of these types in the project folder are automatically added via wild cards). Additional files can be added separated by white spaces</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>APP_INC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders; separated by white spaces; must be defined with <code>-I</code> prefix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ASM_INC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include file folders that are used only for the assembly source files (<code><strong>.S</code>/<code></strong>.s</code>).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>EFFORT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optimization level, optimize for size (<code>-Os</code>) is default; legal values: <code>-O0</code>, <code>-O1</code>, <code>-O2</code>, <code>-O3</code>, <code>-Os</code>, <code>-Ofast</code>, &#8230;&#8203;</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RISCV_PREFIX</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The toolchain prefix to be used; follows the triplet naming convention <code>[architecture]-[host_system]-[output]-&#8230;&#8203;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MARCH</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The targeted RISC-V architecture/ISA; enable compiler support of optional CPU extension by adding the according extension
name (e.g. <code>rv32im</code> for <code>M</code> CPU extension; see <a href="https://stnolting.github.io/neorv32/ug/#_enabling_risc_v_cpu_extensions">User Guide: Enabling RISC-V CPU Extensions</a>
for more information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MABI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application binary interface (default: 32-bit integer ABI <code>ilp32</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>USER_FLAGS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Additional flags that will be forwarded to the compiler tools</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NEORV32_HOME</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Relative or absolute path to the NEORV32 project home folder; adapt this if the makefile/project is not in the project&#8217;s
default <code>sw/example</code> folder</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_default_compiler_flags">4.3.3. Default Compiler Flags</h4>
<div class="paragraph">
<p>The following default compiler flags are used for compiling an application. These flags are defined via the
<code>CC_OPTS</code> variable.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wall</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enable all compiler warnings.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-ffunction-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Put functions and data segment in independent sections. This allows a code optimization as dead code and unused data can be easily removed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-nostartfiles</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Do not use the default start code. Instead, the NEORV32-specific start-up code (<code>sw/common/crt0.S</code>) is used (pulled-in by the linker script).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-Wl,--gc-sections</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make the linker perform dead code elimination.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lm</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include/link with <code>math.h</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Search for the standard C library when linking.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-lgcc</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Make sure we have no unresolved references to internal GCC library subroutines.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-mno-fdiv</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use built-in software functions for floating-point divisions and square roots (since the according instructions are not supported yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-g</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Include debugging information/symbols in ELF.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_custom_compiler_flags">4.3.4. Custom (Compiler) Flags</h4>
<div class="paragraph">
<p>Custom flags can be <em>appended</em> to the <code>USER_FLAGS</code> variable. This allows to customize the entire software framework while
calling <code>make</code> without the need to change the makefile(s) or the linker script.</p>
</div>
<div class="paragraph">
<p>The following example will add debug symbols to the executable (<code>-g</code>) and will also define the linker script&#8217;s
<code>__neorv32_heap_size</code> setting the maximal heap size to 4096 bytes:</p>
</div>
<div class="listingblock">
<div class="title">Listing 9. Example: using the <code>USER_FLAGS</code> variable for customization</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make USER_FLAGS+="-g -Wl,--__neorv32_heap_size,__heap_size=4096" clean_all exe</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_executable_image_format">4.4. Executable Image Format</h3>
<div class="paragraph">
<p>In order to generate an executable for th processors all source files have to be compiled, linked
and packed into a <em>final executable</em>.</p>
</div>
<div class="sect3">
<h4 id="_linker_script">4.4.1. Linker Script</h4>
<div class="paragraph">
<p>After all the application sources have been compiled, they need to be <em>linked</em>.
For this purpose the makefile uses the NEORV32-specific linker script <code>sw/common/neorv32.ld</code> for
linking all object files that were generated during compilation. In general, the linker script defines
three memory sections: <code>rom</code>, <code>ram</code> and <code>iodev</code>.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 46. Linker script - memory sections</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Memory section</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ram</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data memory address space (processor-internal/external DMEM)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>rom</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Instruction memory address space (processor-internal/external IMEM) <em>or</em> internal bootloader ROM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>iodev</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor-internal memory-mapped IO/peripheral devices address space</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>iodev</code> section is entirely defined by the processor hardware layout and should not be modified at all.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The <code>rom</code> section is automatically re-mapped to the processor-internal <a href="#_bootloader_rom_bootrom">Bootloader ROM (BOOTROM)</a> when (re-)compiling the
bootloader
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Each section has two main attributes: <code>ORIGIN</code> and <code>LENGTH</code>. <code>ORIGIN</code> defines the base address of the according section
while <code>LENGTH</code> defines its size in bytes. The attributes are configured indirectly via variables that provide default values.</p>
</div>
<div class="listingblock">
<div class="title">Listing 10. Linker script - section configuration</div>
<div class="content">
<pre class="highlight"><code>/* Default rom/ram (IMEM/DMEM) sizes */
__neorv32_rom_size = DEFINED(__neorv32_rom_size) ? __neorv32_rom_size : 2048M;
__neorv32_ram_size = DEFINED(__neorv32_ram_size) ? __neorv32_ram_size : 8K;

/* Default section base addresses - do not change this unless the hardware-defined address space layout is changed! */
__neorv32_rom_base = DEFINED(__neorv32_rom_base) ? __neorv32_rom_base : 0x00000000; /* = VHDL package's "ispace_base_c" */
__neorv32_ram_base = DEFINED(__neorv32_ram_base) ? __neorv32_ram_base : 0x80000000; /* = VHDL package's "dspace_base_c" */</code></pre>
</div>
</div>
<div class="paragraph">
<p>Only the region <strong>sizes</strong> should be modified by the user. The base addresses are defined by the processor&#8217;s hardware (see section
<a href="#_address_space">Address Space</a>) and should not be altered at all. The size (and base) configuration can be edited by the user - either by explicitly
changing the default values in the linker script or by overriding them when invoking <code>make</code>:</p>
</div>
<div class="listingblock">
<div class="title">Listing 11. Overriding default rom size configuration (setting 4096 bytes)</div>
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ make USER_FLAGS+="-Wl,--defsym,__neorv32_rom_size=4096" clean_all exe</code></pre>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<code>neorv32_rom_base</code> (= <code>ORIGIN</code> of the <code>ram</code> section) has to be always identical to the processor&#8217;s <code>dspace_base_c</code> hardware configuration.
Also, <code>neorv32_ram_base</code> (= <code>ORIGIN</code> of the <code>rom</code> section) has to be always identical to the processor&#8217;s <code>ispace_base_c</code> hardware configuration.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The default configuration for the <code>rom</code> section assumes a maximum of 2GB <em>logical</em> memory address space. This size does not have
to reflect the <em>actual</em> physical size of the instruction memory (internal IMEM and/or processor-external memory). It just provides a maximum
limit. When uploading a new executable via the bootloader, the bootloader itself checks if sufficient <em>physical</em> instruction memory is available.
If a new executable is embedded right into the internal-IMEM the synthesis tool will check, if the configured instruction memory size
is sufficient (e.g., via the <a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> generic).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The linker maps all the regions from the compiled object files into five final sections: <code>.text</code>, <code>.rodata</code>, <code>.data</code>, <code>.bss</code> and <code>.heap</code>.
These regions contain everything required for the application to run:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 47. Linker script - memory regions</caption>
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Region</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.text</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Executable instructions generated from the start-up code and all application sources.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.rodata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Constants (like strings) from the application; also the initial data for initialized variables.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of fixed (= global) variables only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.bss</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of dynamic memory constructs only.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>.heap</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This section is required for the address generation of dynamic memory constructs only.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The <code>.text</code> and <code>.rodata</code> sections are mapped to processor&#8217;s instruction memory space and the <code>.data</code>,
<code>.bss</code> and <code>heap</code> sections are mapped to the processor&#8217;s data memory space. Finally, the <code>.text</code>, <code>.rodata</code> and <code>.data</code>
sections are extracted and concatenated into a single file <code>main.bin</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Section Alignment</div>
The default NEORV32 linker script aligns <em>all</em> regions so they start and end on a 32-bit (word) boundary. The default
NEORV32 start-up code (crt0) makes use of this alignment by using word-level memory instructions to initialize the <code>.data</code>
section and to clear the <code>.bss</code> section (faster!).
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ram_layout">4.4.2. RAM Layout</h4>
<div class="paragraph">
<p>The default NEORV32 linker script uses all of the defined RAM (linker script memory section <code>ram</code>) to create four areas.
Note that depending on the application some areas might not be existent at all.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/ram_layout.png" alt="400">
</div>
<div class="title">Figure 12. Default RAM Layout</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><strong>Constant data (<code>.data</code>)</strong>: The constant data section is placed right at the beginning of the RAM. For example, this section
contains <em>explicitly initialized</em> global variables. This section is initialized by the executable.</p>
</li>
<li>
<p><strong>Dynamic data (<code>.bss</code>)</strong>: The constant data section is followed by the dynamic data section, which contains <em>uninitialized</em> data
like global variables without explicit initialization. This section is cleared by the start-up code <code>crt0.S</code>.</p>
</li>
<li>
<p><strong>Heap (<code>.heap</code>)</strong>: The heap is used for dynamic memory that is managed by functions like <code>malloc()</code> and <code>free()</code>. The heap
grows upwards. This section is not initialized at all.</p>
</li>
<li>
<p><strong>Stack</strong>: The stack starts at the very end of the RAM at address <code>ORIGIN(ram) + LENGTH(ram) - 4</code>. The stack grows downwards.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>There is <em>no explicit limit</em> for the maximum stack size as this is hard to check. However, a physical memory protection rule could
be used to configure a maximum size by adding a "protection area" between stack and heap (a PMP region without any access rights).</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Heap Size</div>
The maximum size of the heap is defined by the linker script&#8217;s <code><em>neorv32_heap_size</code> variable. This variable has to be
<strong>explicitly defined</strong> in order to define a heap size (and to use dynamic memory allocation at all) other than zero. The user
can define the heap size while invoking the application makefile: <code>$ USER_FLAGS+="-Wl,--defsym,</em>neorv32_heap_size=4k" make clean_all exe</code>
(defines a heap size of 4*1024 bytes).
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Heap-Stack Collisions</div>
Take care when using dynamic memory to avoid collision of the heap and stack memory areas. There is no compile-time protection
mechanism available as the actual heap and stack size are defined by <em>runtime</em> data. Also beware of fragmentation when
using dynamic memory allocation.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_c_standard_library">4.4.3. C Standard Library</h4>
<div class="paragraph">
<p>The NEORV32 is a processor for <em>embedded</em> applications, which is not capable of running desktop OSs like Linux
(at least not without emulation). Hence, the default software framework relies on <strong>newlib</strong> as default C standard library.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">RTOS Support</div>
The NEORV32 CPU and processor <strong>do support</strong> embedded RTOS like FreeRTOS and Zephyr. See the User guide section
<a href="https://stnolting.github.io/neorv32/ug/#_zephyr_rtos_support">Zephyr RTOS Support</a> and
<a href="https://stnolting.github.io/neorv32/ug/#_freertos_support">FreeRTOS Support</a>
for more information.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Newlib provides stubs for common "system calls" (like file handling and standard input/output) that are used by other
C libraries like <code>stdio</code>. These stubs are available in <code>sw/source/syscalls.c</code> and were adapted for the NEORV32 processor.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Standard Console(s)</div>
<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">UART0</a>
is used to implement all the standard input, output and error consoles (<code>STDIN</code>, <code>STDOUT</code> and <code>STDERR</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Constructors and Destructors</div>
Constructors and destructors for plain C code or for C++ applications are supported by the software framework.
See <code>sw/example/hellp_cpp</code> for a minimal example.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Newlib Test/Demo Program</div>
A simple test and demo program, which uses some of newlib&#8217;s core functions (like <code>malloc</code>/<code>free</code> and <code>read</code>/<code>write</code>)
is available in <code>sw/example/demo_newlib</code>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_executable_image_generator">4.4.4. Executable Image Generator</h4>
<div class="paragraph">
<p>The <code>main.bin</code> file is packed by the NEORV32 image generator (<code>sw/image_gen</code>) to generate the final executable file.
The image generator can generate several types of executables selected by a flag when calling the generator:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 10%;">
<col style="width: 90%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable binary file <code>neorv32_exe.bin</code> (including header) for UART uploading via the bootloader.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-app_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image (no header) for the processor-internal IMEM. This option generates the <code>rtl/core/neorv32_application_image.vhd</code> file.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-raw_hex</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a plain ASCII hex-char file <code>neorv32_raw_exe.hex</code> (no header) for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-raw_bin</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates a plain binary file <code>neorv32_raw_exe.bin</code> (no header) for custom purpose.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>-bld_img</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Generates an executable VHDL memory initialization image (no header) for the processor-internal BOOT ROM. This option generates the <code>rtl/core/neorv32_bootloader_image.vhd</code> file.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All these options are managed by the makefile. The "normal application2 compilation flow will generate the <code>neorv32_exe.bin</code>
executable for uploading via UART to the default NEORV32 bootloader.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Image Generator Compilation</div>
The sources of the image generator are automatically compiled when invoking the makefile (requiring a native GCC installation).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Executable Header</div>
The image generator add a small header to the <code>neorv32_exe.bin</code> executable, which consists of three 32-bit words located right at the
beginning of the file. The first word of the executable is the signature word and is always <code>0x4788cafe</code>. Based on this word the bootloader
can identify a valid image file. The next word represents the size in bytes of the actual program
image in bytes. A simple "complement" checksum of the actual program image is given by the third word. This
provides a simple protection against data transmission or storage errors. <strong>Note that this executable format cannot be used for <em>direct</em>
execution (e.g. via XIP or direct memory access).</strong>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_start_up_code_crt0">4.4.5. Start-Up Code (crt0)</h4>
<div class="paragraph">
<p>The CPU and also the processor require a minimal start-up and initialization code to bring the CPU (and the SoC)
into a stable and initialized state and to initialize the C runtime environment before the actual application can be executed.
This start-up code is located in <code>sw/common/crt0.S</code> and is automatically linked <em>every</em> application program
and placed right before the actual application code so it gets executed right after reset.</p>
</div>
<div class="paragraph">
<p>The <code>crt0.S</code> start-up performs the following operations:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>Disable interrupts globally by clearing <a href="#_mstatus"><strong><code>mstatus</code></strong></a> (including <code>mie</code>).</p>
</li>
<li>
<p>Initialize all integer registers <code>x1 - x31</code> (or just <code>x1 - x15</code> when using the <code>E</code> CPU extension is enabled) to a defined value.</p>
</li>
<li>
<p>Initialize all CPU core CSRs and also install a default "dummy" trap handler for <em>all</em> exceptions. This is used for the very early boot
phase where the application might not provide a trap handling yet.</p>
<div class="ulist">
<ul>
<li>
<p>Clear <a href="#_mstatus"><strong><code>mstatus</code></strong></a>`.</p>
</li>
<li>
<p>Clear <a href="#_mie"><strong><code>mie</code></strong></a> disabling all interrupt sources and clearing all pending interrupts.</p>
</li>
<li>
<p>Clear <a href="#_cycleh"><strong><code>cycle[h]</code></strong></a> and <a href="#_instreth"><strong><code>instret[h]</code></strong></a> counter CSRs.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Initialize the global pointer <code>gp</code> and the stack pointer <code>sp</code> according to the <a href="#_ram_layout">RAM Layout</a> provided by the linker script.
during the early boot phase.</p>
</li>
<li>
<p>Clear the <code>.bss</code> section defined by the linker script.</p>
</li>
<li>
<p>Copy read-only data from the <code>.text</code> section to the <code>.data</code> section to set initialized variables.</p>
</li>
<li>
<p>Call and execute all <em>constructors</em> (if there are any).</p>
</li>
<li>
<p>Call the application&#8217;s <code>main</code> function (with no arguments: <code>argc</code> = <code>argv</code> = 0).</p>
</li>
<li>
<p>If <code>main</code> returns:</p>
<div class="ulist">
<ul>
<li>
<p>interrupts are disabled by clearing all IRQ sources &lt;&lt;_mie&gt;.</p>
</li>
<li>
<p>`mains&#8217;s return value is copied to the <a href="#_mscratch"><strong><code>mscratch</code></strong></a> CSR to allow inspection by the on-chip debugger.</p>
</li>
<li>
<p>call and execute all <em>destructors</em> (if there are any).</p>
</li>
<li>
<p>an optional <a href="#_after_main_handler">After-Main Handler</a> is called (if defined at all).</p>
</li>
<li>
<p>the CPU enters sleep mode (using the <code>wfi</code> instruction) or remains in an endless loop (if <code>wfi</code> "returns").</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Bootloader Start-Up Code</div>
The bootloader uses the same start-up code as any "usual" application. However, certain parts are omitted when compiling
<code>crt0</code> for the bootloader (like calling constructors and destructors). See the <code>crt0</code> source code for more information.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_after_main_handler">After-Main Handler</h5>
<div class="paragraph">
<p>If the application&#8217;s <code>main()</code> function actually returns, an <em>after main handler</em> can be executed. This handler is a "normal" function
as the C runtime is still available when executed. If this handler uses any kind of peripheral/IO modules make sure these are
already initialized within the application. Otherwise you have to initialize them <em>inside</em> the handler.</p>
</div>
<div class="listingblock">
<div class="title">Listing 12. After-main handler - function prototype</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void __neorv32_crt0_after_main(int32_t return_code);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The function has exactly one argument (<code>return_code</code>) that provides the <em>return value</em> of the application&#8217;s main function.
For instance, this variable contains <code>-1</code> if the main function returned with <code>return -1;</code>. The after-main handler itself does
not provide a return value.</p>
</div>
<div class="paragraph">
<p>A simple UART output can be used to inform the user when the application&#8217;s main function returns
(this example assumes that UART0 has been already properly configured in the actual application):</p>
</div>
<div class="listingblock">
<div class="title">Listing 13. After-main handler - simple example</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void __neorv32_crt0_after_main(int32_t return_code) {

  neorv32_uart0_printf("\n&lt;RTE&gt; main function returned with exit code %i. &lt;/RTE&gt;\n", return_code); <i class="conum" data-value="1"></i><b>(1)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>&lt;RTE&gt;</code> here to make clear this is a message comes from the runtime environment.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The after-main handler is executed <em>after</em> executing all destructor functions (if there are any at all).
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_bootloader">4.5. Bootloader</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This section refers to the <strong>default</strong> bootloader from the repository. The bootloader can be customized
to target application-specific scenarios using pre-defined options (see User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader">Customizing the Internal Bootloader</a>
) or it can be completely rewritten/replaced for custom purpose.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 bootloader (source code <code>sw/bootloader/bootloader.c</code>) provides an optional build-in firmware that
allows to upload new application executables at <em>any time</em> without the need to re-synthesize the FPGA&#8217;s bitstream.
A UART connection is used to provide a simple text-based user interface that allows to upload executables.</p>
</div>
<div class="paragraph">
<p>Furthermore, the bootloader provides options to store an executable to a processor-external SPI flash.
An "auto boot" feature can optionally fetch this executable right after reset if there is no user interaction
via UART. This allows to build processor setups with <em>non-volatile application storage</em>, which can still be updated at any time.</p>
</div>
<div class="sect3">
<h4 id="_bootloader_soccpu_requirements">4.5.1. Bootloader SoC/CPU Requirements</h4>
<div class="paragraph">
<p>The bootloader relies on certain CPU and SoC extensions and modules to be enabled to allow full functionality.</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader is implemented only if the <a href="#_int_bootloader_en"><em>INT_BOOTLOADER_EN</em></a> is <em>true</em> (default). This will automatically select the CPU&#8217;s <a href="#_indirect_boot">Indirect Boot</a> boot configuration.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader requires the privileged architecture CPU extension (<a href="#_zicsr_control_and_status_register_access_privileged_architecture"><strong><code>Zicsr</code></strong> Control and Status Register Access / Privileged Architecture</a>) to be enabled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least 512 bytes of data memory (processor-internal DMEM or processor-external DMEM) are required for the bootloader&#8217;s stack.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">For user interaction via UART (like uploading executables) the primary UART (<a href="#_primary_universal_asynchronous_receiver_and_transmitter_uart0">Primary Universal Asynchronous Receiver and Transmitter (UART0)</a>) has to be implemented.
Without UART0 the auto-boot via SPI is still supported but the bootloader should be customized (see User Guide).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default bootloader uses bit 0 of the <a href="#_general_purpose_input_and_output_port_gpio">General Purpose Input and Output Port (GPIO)</a> output port to drive a high-active "heart beat" status LED.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>RECOMMENDED</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> is used to control blinking of the status LED and also to automatically trigger the auto-boot sequence.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The SPI controller (<a href="#_serial_peripheral_interface_controller_spi">Serial Peripheral Interface Controller (SPI)</a>) is needed to store/load executable from external flash (for the auto boot feature).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OPTIONAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The XIP controller (<a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a>) is needed to execute code directly from a pre-programmed SPI flash.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_bootloader_flash_requirements">4.5.2. Bootloader Flash Requirements</h4>
<div class="paragraph">
<p>The bootloader can access an SPI-compatible flash via the processor&#8217;s top entity SPI port. By default, the flash
chip-select line is driven by <code>spi_csn_o(0)</code> and the SPI clock uses 1/8 of the processor&#8217;s main clock as clock frequency.
The SPI flash has to support single-byte read and write operations, 24-bit addresses and at least the following standard commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>0x02</code>: Program page (write byte)</p>
</li>
<li>
<p><code>0x03</code>: Read data (byte)</p>
</li>
<li>
<p><code>0x04</code>: Write disable (for volatile status register)</p>
</li>
<li>
<p><code>0x05</code>: Read (first) status register</p>
</li>
<li>
<p><code>0x06</code>: Write enable (for volatile status register)</p>
</li>
<li>
<p><code>0xD8</code>: Block erase (64kB)</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Custom Configuration</div>
Most properties (like chip select line, flash address width, SPI clock frequency, &#8230;&#8203;) of the default bootloader can be reconfigured
without the need to change the source code. Custom configuration can be made using command line switches when recompiling the bootloader.
See the User Guide <a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader" class="bare">https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader</a> for more information.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_bootloader_console">4.5.3. Bootloader Console</h4>
<div class="paragraph">
<p>To interact with the bootloader, connect the primary UART (UART0) signals (<code>uart0_txd_o</code> and
<code>uart0_rxd_o</code>) of the processor&#8217;s top entity via a serial port (-adapter) to your computer (hardware flow control is
not used so the according interface signals can be ignored.), configure your
terminal program using the following settings and perform a reset of the processor.</p>
</div>
<div class="paragraph">
<p>Terminal console settings (<code>19200-8-N-1</code>):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>19200 Baud</p>
</li>
<li>
<p>8 data bits</p>
</li>
<li>
<p>no parity bit</p>
</li>
<li>
<p>1 stop bit</p>
</li>
<li>
<p>newline on <code>\r\n</code> (carriage return, newline)</p>
</li>
<li>
<p>no transfer protocol / control flow protocol - just raw bytes</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<em>Any</em> terminal program that can connect to a serial port should work. However, make sure the program
can transfer data in <em>raw</em> byte mode without any protocol overhead (e.g. XMODEM). Some terminal programs struggle with
transmitting files larger than 4kB (see <a href="https://github.com/stnolting/neorv32/pull/215" class="bare">https://github.com/stnolting/neorv32/pull/215</a>). Try a different terminal program
if uploading of a binary does not work.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The bootloader uses the LSB of the top entity&#8217;s <code>gpio_o</code> output port as high-active status LED. All other
output pins are set to low level and won&#8217;t be altered. After reset, the status LED will start blinking at 2Hz and the
following intro screen shows up:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Jul 11 2022
HWV:  0x01070307
CID:  0x00000000
CLK:  0x05f5e100
ISA:  0x40901104 + 0xc0000783
SOC:  0x7c5f400f
IMEM: 0x00004000 bytes @0x00000000
DMEM: 0x00002000 bytes @0x80000000

Autoboot in 8s. Press any key to abort.</code></pre>
</div>
</div>
<div class="paragraph">
<p>The start-up screen gives some brief information about the bootloader and several system configuration parameters:</p>
</div>
<table class="tableblock frame-all grid-none stretch">
<colgroup>
<col style="width: 11.7647%;">
<col style="width: 88.2353%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>BLDV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bootloader version (built date).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>HWV</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor hardware version (the <a href="#_mimpid"><strong><code>mimpid</code></strong></a> CSR); in BCD format; example: <code>0x01040606</code> = v1.4.6.6).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CID</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Custom user-defined ID (via the <code>CUSTOM_ID</code> register from <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>; defined by the <a href="#_custom_id"><em>CUSTOM_ID</em></a> generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>CLK</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor clock speed in Hz (via the <code>CLK</code> register from <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>; defined by the <a href="#_clock_frequency"><em>CLOCK_FREQUENCY</em></a> generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ISA</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU extensions (<a href="#_misa"><strong><code>misa</code></strong></a> CSR + <a href="#_mxisa"><strong><code>mxisa</code></strong></a> CSR).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>SOC</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor configuration (via the <code>SOC</code> register from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>; mainly defined by the <code>IO_*</code> and <code>MEM_*</code> configuration generics).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>IMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IMEM memory base address and size in byte (via the <code>IMEM_SIZE</code> and <code>ISPACE_BASE</code> registers from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>; defined by the <a href="#_mem_int_imem_size"><em>MEM_INT_IMEM_SIZE</em></a> generic).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>DMEM</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMEM memory base address and size in byte (via the <code>DMEM_SIZE</code> and <code>DSPACE_BASE</code> registers from the <a href="#_system_configuration_information_memory_sysinfo">System Configuration Information Memory (SYSINFO)</a>; defined by the <a href="#_mem_int_dmem_size"><em>MEM_INT_DMEM_SIZE</em></a> generic).</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Now you have 8 seconds to press <em>any</em> key. Otherwise, the bootloader starts the <a href="#_auto_boot_sequence">Auto Boot Sequence</a>. When
you press any key within the 8 seconds, the actual bootloader user console starts:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>&lt;&lt; NEORV32 Bootloader &gt;&gt;

BLDV: Jul 11 2022
HWV:  0x01070307
CLK:  0x05f5e100
ISA:  0x40901104 + 0xc0000783
SOC:  0x7c5f400f
IMEM: 0x00004000 bytes @0x00000000
DMEM: 0x00002000 bytes @0x80000000

Autoboot in 8s. Press any key to abort.
Aborted. <i class="conum" data-value="1"></i><b>(1)</b>

Available commands:
 h: Help
 r: Restart
 u: Upload
 s: Store to flash
 l: Load from flash
 x: Boot from flash (XIP)
 e: Execute
CMD:&gt;</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Auto boot sequence aborted due to user console input.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The auto boot countdown is stopped and the bootloader&#8217;s user console is ready to receive one of the following commands:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>h</code>: Show the help text (again)</p>
</li>
<li>
<p><code>r</code>: Restart the bootloader and the auto-boot sequence</p>
</li>
<li>
<p><code>u</code>: Upload new program executable (<code>neorv32_exe.bin</code>) via UART into the instruction memory</p>
</li>
<li>
<p><code>s</code>: Store executable to SPI flash at <code>spi_csn_o(0)</code> (little-endian byte order)</p>
</li>
<li>
<p><code>l</code>: Load executable from SPI flash at <code>spi_csn_o(0)</code> (little-endian byte order)</p>
</li>
<li>
<p><code>x</code>: Boot program directly from flash via XIP (requires a pre-programmed image)</p>
</li>
<li>
<p><code>e</code>: Start the application, which is currently stored in the instruction memory (IMEM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A new executable can be uploaded via UART by executing the <code>u</code> command. After that, the executable can be directly
executed via the <code>e</code> command. To store the recently uploaded executable to an attached SPI flash press <code>s</code>. To
directly load an executable from the SPI flash press <code>l</code>. The bootloader and the auto-boot sequence can be
manually restarted via the <code>r</code> command.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Booting via XIP</div>
The bootloader allows to execute an application right from flash using the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a> module.
This requires a pre-programmed flash. The bootloader&#8217;s "store" option can <strong>not</strong> be used to program an XIP image.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Default Configuration</div>
More information regarding the default SPI, GPIO, XIP, etc. configuration can be found in the User Guide
section <a href="https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader" class="bare">https://stnolting.github.io/neorv32/ug/#_customizing_the_internal_bootloader</a>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">SPI Flash Programming</div>
For detailed information on using an SPI flash for application storage see User Guide section
<a href="https://stnolting.github.io/neorv32/ug/#_programming_an_external_spi_flash_via_the_bootloader">Programming an External SPI Flash via the Bootloader</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_auto_boot_sequence">4.5.4. Auto Boot Sequence</h4>
<div class="paragraph">
<p>When you reset the NEORV32 processor, the bootloader waits 8 seconds for a UART console input before it
starts the automatic boot sequence. This sequence tries to fetch a valid boot image from the external SPI
flash, connected to SPI chip select <code>spi_csn_o(0)</code>. If a valid boot image is found that can be successfully
transferred into the instruction memory, it is automatically started. If no SPI flash is detected or if there
is no valid boot image found, and error code will be shown.</p>
</div>
</div>
<div class="sect3">
<h4 id="_bootloader_error_codes">4.5.5. Bootloader Error Codes</h4>
<div class="paragraph">
<p>If something goes wrong during bootloader operation an error code and a short message is shown. In this case the processor
is halted, the bootloader status LED is permanently activated and the processor has to be reset manually.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In many cases the error source is just <em>temporary</em> (like some HF spike during an UART upload). Just try again.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_EXE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">If you try to transfer an invalid executable (via UART or from the external SPI flash), this error message shows up. There might be a transfer protocol configuration error in the terminal program or maybe just the wrong file was selected. Also, if no SPI flash was found during an auto-boot attempt, this message will be displayed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_SIZE</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Your program is way too big for the internal processors instructions memory. Increase the memory size or reduce your application code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_CHKS</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This indicates a checksum error. Something went wrong during the transfer of the program image (upload via UART or loading from the external SPI flash). If the error was caused by a UART upload, just try it again. When the error was generated during a flash access, the stored image might be corrupted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_FLSH</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This error occurs if the attached SPI flash cannot be accessed. Make sure you have the right type of flash and that it is properly connected to the NEORV32 SPI port using chip select #0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong><code>ERR_EXC</code></strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The bootloader encountered an unexpected exception during operation. This might be caused when it tries to access peripherals that were not implemented during synthesis. Example: executing commands <code>l</code> or <code>s</code> (SPI flash operations) without the SPI module being implemented.</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
If an unexpected exception has been raised the bootloader prints hexadecimal debug information showing
the <a href="#_mcause"><strong><code>mcause</code></strong></a>, <a href="#_mepc"><strong><code>mepc</code></strong></a> and <a href="#_mtval"><strong><code>mtval</code></strong></a> CSR values.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_neorv32_runtime_environment">4.6. NEORV32 Runtime Environment</h3>
<div class="paragraph">
<p>The NEORV32 software framework provides a minimal runtime environment (<strong>RTE</strong>) that takes care of a stable
and <em>safe</em> execution environment by handling <em>all</em> traps (= exceptions &amp; interrupts). The RTE simplifies trap handling
by wrapping the CPU&#8217;s <em>privileged architecture</em> (i.e. trap-related CSRs) into a unified software API.
The NEORV32 RTE is a software library (<code>sw/lib/source/neorv32_rte.c</code>) that is part of the default processor library set.
It provides public functions via <code>sw/lib/include/neorv32_rte.h</code> for application interaction.</p>
</div>
<div class="paragraph">
<p>Once initialized, the RTE provides <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> that catch all possible traps. These
default handlers just output a message via UART to inform the user when a certain trap has been triggered. The
default handlers can be overridden by the application code to install application-specific handler functions for each trap.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Using the RTE is <strong>optional but highly recommended</strong>. The RTE provides a simple and comfortable way of delegating
traps to application-specific handlers while making sure that all traps (even though they are not explicitly used
by the application) are handled correctly. Performance-optimized applications or embedded operating systems should
not use the RTE for delegating traps.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For the <strong>C standard runtime library</strong> see section <a href="#c_standard_library">[c_standard_library]</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_rte_operation">4.6.1. RTE Operation</h4>
<div class="paragraph">
<p>The RTE handles the trap-related CSRs of the CPU&#8217;s privileged architecture (<a href="#_machine_trap_handling_csrs">Machine Trap Handling CSRs</a>).
It initializes the <a href="#_mtvec"><strong><code>mtvec</code></strong></a> CSR, which provides the base entry point for all trap
handlers. The address stored to this register reflects the <strong>first-level trap handler</strong>, which is provided by the
NEORV32 RTE. Whenever an exception or interrupt is triggered this first-level handler is executed.</p>
</div>
<div class="paragraph">
<p>The first-level handler performs a complete context save, analyzes the source of the trap and
calls the according <strong>second-level trap handler</strong>, which takes care of the actual exception/interrupt
handling. For this, the RTE manages a private look-up table to store the addresses of the according trap
handlers.</p>
</div>
<div class="paragraph">
<p>After the initial RTE setup, each entry in the RTE&#8217;s trap handler look-up table is initialized with a
<a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a>. These default handler do not execute any trap-related operations - they
just output a message via the <strong>primary UART (UART0)</strong> to inform the user that a trap has occurred, that is not
handled by the actual application. After sending this message, the RTE tries to continue executing the user program.</p>
</div>
</div>
<div class="sect3">
<h4 id="_using_the_rte">4.6.2. Using the RTE</h4>
<div class="paragraph">
<p>The NEORV32 is enabled by calling the RTE&#8217;s setup function:</p>
</div>
<div class="listingblock">
<div class="title">Listing 14. Function Prototype: RTE Setup</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void neorv32_rte_setup(void);</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The RTE should be enabled right at the beginning of the application&#8217;s <code>main</code> function.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As mentioned above, <em>all</em> traps will only trigger execution of the RTE&#8217;s <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a>.
To use application-specific handlers, which actually <em>handle</em> a trap, the default handlers can be overridden
by installing user-defined ones:</p>
</div>
<div class="listingblock">
<div class="title">Listing 15. Function Prototype: Installing an Application-Specific Trap Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_handler_install(uint8_t id, void (*handler)(void));</code></pre>
</div>
</div>
<div class="paragraph">
<p>The first argument <code>id</code> defines the "trap ID" (for example a certain interrupt request) that shall be handled
by the user-defined handler. The second argument <code>*handler</code> is the actual function that implements the trap
handler. The function return zero on success and a non-zero value if an error occurred (invalid <code>id</code>). In this
case no modifications to the RTE&#8217;s trap look-up-table will be made.</p>
</div>
<div class="paragraph">
<p>The custom handler functions need to have a specific format without any arguments an with no return value:</p>
</div>
<div class="listingblock">
<div class="title">Listing 16. Function Prototype: Custom Trap Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">void custom_trap_handler_xyz(void) {

  // handle trap...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Custom Trap Handler Attributes</div>
Do NOT use the <code>interrupt</code> attribute for the application trap handler functions! This
will place a <code>mret</code> instruction to the end of it making it impossible to return to the first-level
trap handler of the RTE core, which will cause stack corruption.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The trap identifier <code>id</code> specifies the according trap cause. These can be an <em>asynchronous trap</em> like
an interrupt from one of the processor modules or a <em>synchronous trap</em> triggered by software-caused events
like an illegal instruction or an environment call instruction. The <code>sw/lib/include/neorv32_rte.h</code> library files
provides aliases for trap events supported by the CPU (see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>) that can be used when
installing custom trap handler functions:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 48. RTE Trap ID List</caption>
<colgroup>
<col style="width: 29.4117%;">
<col style="width: 70.5883%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ID alias [C]</th>
<th class="tableblock halign-left valign-top">Description / trap causing event</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">instruction (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_I_ILLEGAL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">illegal instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_BREAKPOINT</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">breakpoint (<code>ebreak</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_L_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_L_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">load (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_S_MISALIGNED</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store address misaligned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_S_ACCESS</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">store (bus) access fault</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from machine mode (<code>ecall</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_UENV_CALL</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">environment call from user mode (<code>ecall</code> instruction)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MTI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine timer interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MEI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine external interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_MSI</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">machine software interrupt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_2</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 2</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_3</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_4</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 4</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_5</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_6</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 6</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_7</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 7</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_8</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_9</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 9</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_10</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 10</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_11</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 11</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_12</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 12</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_13</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 13</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_14</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 14</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RTE_TRAP_FIRQ_15</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">fast interrupt channel 15</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The following example shows how to install a custom handler (<code>custom_mtime_irq_handler</code>) for handling
the RISC-V machine timer (MTIME) interrupt:</p>
</div>
<div class="listingblock">
<div class="title">Listing 17. Example: Installing the MTIME IRQ Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_handler_install(RTE_TRAP_MTI, custom_mtime_irq_handler);</code></pre>
</div>
</div>
<div class="paragraph">
<p>User-defined trap handlers can also be un-installed. This will remove the users trap handler from the RTE core
and will re-install the <a href="#_default_rte_trap_handlers">Default RTE Trap Handlers</a> for the specific trap.</p>
</div>
<div class="listingblock">
<div class="title">Listing 18. Function Prototype: Installing an Application-Specific Trap Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">int neorv32_rte_handler_uninstall(uint8_t id);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The argument <code>id</code> defines the identifier of the according trap that shall be un-installed. The function return zero
on success and a non-zero value if an error occurred (invalid <code>id</code>). In this case no modifications to the RTE&#8217;s trap
look-up-table will be made.</p>
</div>
<div class="paragraph">
<p>The following example shows how to un-install the custom handler <code>custom_mtime_irq_handler</code> from the
RISC-V machine timer (MTIME) interrupt:</p>
</div>
<div class="listingblock">
<div class="title">Listing 19. Example: Removing the Custom MTIME IRQ Handler</div>
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">neorv32_rte_handler_uninstall(RTE_TRAP_MTI);</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_default_rte_trap_handlers">4.6.3. Default RTE Trap Handlers</h4>
<div class="paragraph">
<p>The default RTE trap handlers are executed when a certain trap is triggered that is not (yet) handled by a user-defined
application-specific trap handler. The default handler will output a message giving additional debug information
via UART0 to inform the user and will try to resume normal program execution.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Continuing Execution</div>
In most cases the RTE can successfully continue operation - for example if it catches an <strong>interrupt</strong> request that is not handled
by the actual application program. However, if the RTE catches an un-handled <strong>trap</strong> like a bus access fault
continuing execution will most likely fail making the CPU crash.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Listing 20. RTE Default Trap Handler Output Examples</div>
<div class="content">
<pre class="highlight"><code>&lt;RTE&gt; Illegal instruction @ PC=0x000002d6, INST=0x000000FF &lt;/RTE&gt; <i class="conum" data-value="1"></i><b>(1)</b>
&lt;RTE&gt; Illegal instruction @ PC=0x00000302, INST=0x0000 &lt;/RTE&gt; <i class="conum" data-value="2"></i><b>(2)</b>
&lt;RTE&gt; Load address misaligned @ PC=0x00000440, ADDR=0x80000101 &lt;/RTE&gt; <i class="conum" data-value="3"></i><b>(3)</b>
&lt;RTE&gt; Fast IRQ 0x00000003 @ PC=0x00000820 &lt;/RTE&gt; <i class="conum" data-value="4"></i><b>(4)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Illegal 32-bit instruction at address 0x000002d6.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Illegal 16-bit instruction at address 0x00000302.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Misaligned load access at address 0x00000440 (trying to load a full word from 0x80000101).</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Fast interrupt request from channel 3 before executing instruction at address 0x00000820.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The specific <em>message</em> right at the beginning of the debug trap handler message corresponds to the trap code from the
<a href="#_mcause"><strong><code>mcause</code></strong></a> CSR (see <a href="#_neorv32_trap_listing">NEORV32 Trap Listing</a>). A full list of all messages and the according <code>mcause</code> trap codes is shown below.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 49. RTE Default Trap Handler Messages and According <code>mcause</code> Values</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Trap identifier</th>
<th class="tableblock halign-center valign-top">According <code>mcause</code> CSR value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Instruction address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Instruction access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000001</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Illegal instruction"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000002</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Breakpoint"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Load address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000004</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Load access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000005</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Store address misaligned"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000006</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Store access fault"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000007</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Environment call from U-mode"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x00000008</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Environment call from M-mode"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x0000000b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine software IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000003</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine timer IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000007</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Machine external IRQ"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000000b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000000"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000010</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000001"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000011</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000002"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000012</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000003"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000013</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000004"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000014</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000005"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000015</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000006"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000016</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000007"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000017</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000008"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000018</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x00000009"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x80000019</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000a"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001a</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000b"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001b</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000c"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001c</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000d"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001d</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000e"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001e</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Fast IRQ 0x0000000f"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x8000001f</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">"Unknown trap cause"</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>unknown</em></p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_bus_access_faults">Bus Access Faults</h5>
<div class="paragraph">
<p>For bus access faults the RTE default trap handlers also output the error code from the
<a href="#_internal_bus_monitor_buskeeper">Internal Bus Monitor (BUSKEEPER)</a> to show the cause of the bus fault. One example is shown below.</p>
</div>
<div class="listingblock">
<div class="title">Listing 21. RTE Default Trap Handler Output Example (Load Access Bus Fault)</div>
<div class="content">
<pre class="highlight"><code>&lt;RTE&gt; Load access fault [TIMEOUT_ERR] @ PC=0x00000150, MTVAL=0xFFFFFF70 &lt;/RTE&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The additional message encapsulated in <code>[ ]</code> shows the actual cause of the bus access fault.
Three different messages are possible here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>[TIMEOUT_ERR]</code>: The accessed memory-mapped module did not respond within the valid access time window.
In Most cases this is caused by accessing a module that has not been implemented or when accessing
"address space holes" (unused/unmapped addresses).</p>
</li>
<li>
<p><code>[DEVICE_ERR]</code>: The accesses memory-mapped module asserted it&#8217;s error signal to indicate an invalid access.
For example this can be caused by trying to write to read-only registers or by writing data quantities (like a byte)
to devices that do not support sub-word write accesses.</p>
</li>
<li>
<p><code>[PMP_ERR]</code>: This indicates an access right violation caused by the <a href="#_pmp_physical_memory_protection"><strong><code>PMP</code></strong> Physical Memory Protection</a>.</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_on_chip_debugger_ocd">5. On-Chip Debugger (OCD)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The NEORV32 Processor features an <em>on-chip debugger</em> (OCD) implementing <strong>execution-based debugging</strong> compatible
to the <strong>Minimal RISC-V Debug Specification Version 1.0</strong>. Please refer to this spec for in-deep information.
A copy of the specification is available in <code>docs/references</code>.</p>
</div>
<div class="paragraph">
<p><strong>Section Structure</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a></p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a></p>
</li>
<li>
<p><a href="#_cpu_debug_mode">CPU Debug Mode</a></p>
</li>
<li>
<p><a href="#_trigger_module">Trigger Module</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NEORV32 OCD provides the following key features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JTAG access port</p>
</li>
<li>
<p>run-control of the CPU: halting, single-stepping and resuming</p>
</li>
<li>
<p>executing arbitrary programs during debugging</p>
</li>
<li>
<p>indirect access to all core registers (via program buffer)</p>
</li>
<li>
<p>indirect access to the whole processor address space (via program buffer)</p>
</li>
<li>
<p>trigger module for hardware breakpoints</p>
</li>
<li>
<p>compatible with upstream OpenOCD and GDB</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">OCD Security Note</div>
Access via the OCD is <em>always authenticated</em> (<code>dmstatus.authenticated = 1</code>). Hence, the
<em>whole system</em> can always be accessed via the on-chip debugger. Currently, there is no option
to disable the OCD via software - the OCD can only be disabled by disabling implementation
(setting <a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> generic to <em>false</em>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Hands-On Tutorial</div>
A simple example on how to use NEORV32 on-chip debugger in combination with OpenOCD and the GNU debugger
is shown in section <a href="https://stnolting.github.io/neorv32/ug/#_debugging_using_the_on_chip_debugger">Debugging using the On-Chip Debugger</a>
of the User Guide.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The NEORV32 on-chip debugger complex is based on four hardware modules:</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="img/neorv32_ocd_complex.png" alt="neorv32 ocd complex">
</div>
<div class="title">Figure 13. NEORV32 on-chip debugger complex</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p><a href="#_debug_transport_module_dtm">Debug Transport Module (DTM)</a> (<code>rtl/core/neorv32_debug_dtm.vhd</code>): JTAG access tap to allow an external
adapter to interface with the <em>debug module(DM)</em> using the <em>debug module interface (dmi)</em> - this interface is compatible to
the interface description shown in Appendix 3 of the "RISC-V debug stable" specification.</p>
</li>
<li>
<p><a href="#_debug_module_dm">Debug Module (DM)</a> (<code>rtl/core/neorv32_debug_tm.vhd</code>): Debugger control unit that is configured by the DTM via the
the <em>dmi</em>. From the CPU&#8217;s "point of view" this module behaves as another memory-mapped "peripheral" that can be accessed
via the processor-internal bus. The memory-mapped registers provide an internal <em>data buffer</em> for data transfer
from/to the DM, a <em>code ROM</em> containing the "park loop" code, a <em>program buffer</em> to allow the debugger to
execute small programs defined by the DM and a <em>status register</em> that is used to communicate
<em>exception, _halt</em>, <em>resume</em> and <em>execute</em> requests/acknowledges from/to the DM.</p>
</li>
<li>
<p>CPU <a href="#_cpu_debug_mode">CPU Debug Mode</a> extension (part of <code>rtl/core/neorv32_cpu_control.vhd</code>):
This extension provides the "debug execution mode" which executes the "park loop" code from the DM.
The mode also provides additional CSRs.</p>
</li>
<li>
<p>CPU <a href="#_trigger_module">Trigger Module</a> (also part of <code>rtl/core/neorv32_cpu_control.vhd</code>):
This module provides a single <em>hardware</em> breakpoint, which allows to debug code executed from ROM.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Theory of Operation</strong></p>
</div>
<div class="paragraph">
<p>When debugging the system using the OCD, the debugger issues a halt request to the CPU (via the CPU&#8217;s
<code>db_halt_req_i</code> signal) to make the CPU enter <em>debug mode</em>. In this state, the application-defined architectural
state of the system/CPU is "frozen" so the debugger can monitor if without interfering the actual application.
However, the OCD can also modify the entire architectural state at any time.</p>
</div>
<div class="paragraph">
<p>While in debug mode, the CPU executes the "park loop" code from the <em>code ROM</em> of the DM.
This park loop implements an endless loop, in which the CPU polls the memory-mapped <em>status register</em> that is
controlled by the <em>debug module (DM)</em>. The flags in this register are used to communicate requests from
the DM and to acknowledge them by the CPU: trigger execution of the program buffer or resume the halted
application. Furthermore, the CPU uses this register to signal that the CPU has halted after a halt request
and to signal that an exception has fired while in debug mode.</p>
</div>
<div style="page-break-after: always;"></div>
<div class="sect2">
<h3 id="_debug_transport_module_dtm">5.1. Debug Transport Module (DTM)</h3>
<div class="paragraph">
<p>The debug transport module (VHDL module: <code>rtl/core/neorv32_debug_dtm.vhd</code>) provides a JTAG test access port (TAP).
The DTM is the first entity in the debug system, which connects and external debugger via JTAG to the next debugging
entity - the debug module (DM).
External JTAG access is provided by the following top-level ports.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 50. JTAG top level signals</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Width</th>
<th class="tableblock halign-center valign-top">Direction</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_trst_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TAP reset (low-active); this signal is optional, make sure to pull it <em>high</em> if it is not used by the JTAG adapter</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tck_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial clock</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdi_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data input</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tdo_o</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">out</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">serial data output</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>jtag_tms_i</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">in</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mode select</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Maximum JTAG Clock</div>
All JTAG signals are synchronized to the processor clock domain by oversampling them in the DTM. Hence, no additional
clock domain is required for the DTM. However, this constraints the maximal JTAG clock frequency (<code>jtag_tck_i</code>) to be less
than or equal to <strong>1/5</strong> of the processor clock frequency (<code>clk_i</code>).
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the on-chip debugger is disabled (<a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> = false) the JTAG serial input <code>jtag_tdi_i</code> is directly
connected to the JTAG serial output <code>jtag_tdo_o</code> to maintain the JTAG chain.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 JTAG TAP does not provide a <em>boundary check</em> function (yet?). Hence, physical device pins cannot be accessed.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The DTM uses the "debug module interface (dmi)" to access the actual debug module (DM).
The accesses are controlled by TAP-internal registers, which are selected by the JTAG instruction register (<code>IR</code>)
and accessed through the JTAG data register (<code>DR</code>).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The DTM&#8217;s instruction and data registers can be accessed using OpenOCD&#8217;s <code>irscan</code> and <code>drscan</code> commands.
OpenOCD also provides low-level RISC-V-specific commands for direct DMI accesses (<code>riscv dmi_read</code> &amp; <code>riscv dmi_write</code>).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>JTAG accesses are based on a single <em>instruction register</em> <code>IR</code>, which is 5 bit wide, and several <em>data registers</em> <code>DR</code>
with different sizes. The individual data registers are accessed by writing the according address to the instruction
register. The following table shows the available data registers and their addresses:</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 51. JTAG TAP registers</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 57.1429%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address (via <code>IR</code>)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">Size [bits]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>00001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>IDCODE</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">identifier, default: <code>0x0CAFE001</code> (configurable via package&#8217;s <code>jtag_tap_idcode_*</code> constants)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10000</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DTMCS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug transport module control and status register</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>10001</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>DMI</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">debug module interface (<em>dmi</em>); 6-bit address, 32-bit read/write data, 2-bit operation (<code>00</code> = NOP; <code>10</code> = write; <code>01</code> = read)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">others</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>BYPASS</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">default JTAG bypass register</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 52. <code>DTMCS</code> - DTM Control and Status Register</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 21.4285%;">
<col style="width: 7.1428%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit(s)</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmihardreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will reset the debug module interface; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmireset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">setting this bit will clear the sticky error state; this bit auto-clears</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>reserved</em>, hardwired to zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>idle</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">recommended idle states (= 0, no idle states required)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmistat</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DMI status: <code>00</code> = no error, <code>01</code> = reserved, <code>10</code> = operation failed, <code>11</code> = failed operation during pending DMI operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abits</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of address bits in <code>DMI</code> register (= 6)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code> = DTM is compatible to spec. version 0.13 &amp; 1.0</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>See the <a href="https://github.com/riscv/riscv-debug-spec">RISC-V debug specification</a> for more information regarding the data
registers and operations. A local copy can be found in <code>docs/references</code>.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_debug_module_dm">5.2. Debug Module (DM)</h3>
<div class="paragraph">
<p>According to the RISC-V debug specification, the DM (VHDL module: <code>rtl/core/neorv32_debug_dm.vhd</code>)
acts as a translation interface between abstract operations issued by the debugger (application) and the
platform-specific debugger (circuit) implementation. It supports the following features (excerpt from the debug spec):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gives the debugger necessary information about the implementation.</p>
</li>
<li>
<p>Allows the hart to be halted and resumed and provides status of the current state.</p>
</li>
<li>
<p>Provides abstract read and write access to the halted hart&#8217;s GPRs.</p>
</li>
<li>
<p>Provides access to a reset signal that allows debugging from the very first instruction after reset.</p>
</li>
<li>
<p>Provides a mechanism to allow debugging the hart immediately out of reset. (<em>still experimental</em>)</p>
</li>
<li>
<p>Provides a Program Buffer to force the hart to execute arbitrary instructions.</p>
</li>
<li>
<p>Allows memory access from a hart&#8217;s point of view.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NEORV32 DM follows the "Minimal RISC-V External Debug Specification" to provide full debugging
capabilities while keeping resource/area requirements at a minimum level.
It implements the <strong>execution based debugging scheme</strong> for a single hart and provides the following
hardware features:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>program buffer with 2 entries and implicit <code>ebreak</code> instruction afterwards</p>
</li>
<li>
<p>no <em>direct</em> bus access; indirect bus access via the CPU using the program buffer</p>
</li>
<li>
<p>abstract commands: "access register" plus auto-execution</p>
</li>
<li>
<p>no <em>dedicated</em> halt-on-reset capabilities yet (but can be emulated)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DM provides two access "point of views": accesses from the DTM via the <em>debug module interface (dmi)</em> and
accesses from the CPU via the processor-internal bus. From the DTM&#8217;s point of view, the DM implements a set of
<a href="#_dm_registers">DM Registers</a> that are used to control and monitor the actual debugging. From the CPU&#8217;s point of view, the
DM implements several memory-mapped registers (within the <em>normal</em> address space) that are used for communicating
debugging control and status (<a href="#_dm_cpu_access">DM CPU Access</a>).</p>
</div>
<div class="sect3">
<h4 id="_dm_registers">5.2.1. DM Registers</h4>
<div class="paragraph">
<p>The DM is controlled via a set of registers that are accessed via the DTM&#8217;s <em>dmi</em>.
The "Minimal RISC-V Debug Specification" requires only a subset of the registers specified in the spec.
The following registers are implemented:</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Write accesses to registers that are not implemented are simply ignored and read accesses will always return zero.
Register names that are encapsulated in "( )" are not actually implemented; however, they are listed to explicitly show
their functionality.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 53. Available DM registers</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 25%;">
<col style="width: 58.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x04</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>data0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract data 0, used for data transfer between debugger and processor</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x10</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module control</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x11</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Debug module status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x12</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hart information</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x16</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abstracts</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract control and status</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x17</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>command</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x18</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abstract command auto-execution</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x1d</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<code>nextdm</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base address of <em>next</em> DM; reads as zero to indicate there is only <em>one</em> DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x20</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x21</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0x38</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">(<code>sbcs</code>)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">System bus access control and status; reads as zero to indicate there is no <em>direct</em> system bus access</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_data"><strong><code>data</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x04</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract data 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Basic read/write registers to be used with abstract commands (for example to read/write data from/to CPU GPRs).</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmcontrol"><strong><code>dmcontrol</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Control of the overall debug module and the hart. The following table shows all implemented bits. All remaining bits/bit-fields
are configured as "zero" and are read-only. Writing '1' to these bits/fields will be ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 54. <code>dmcontrol</code> - debug module control register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>haltreq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set/clear hart halt request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>resumereq</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">request hart to resume</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ackhavereset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">write <code>1</code> to clear <code>*havereset</code> flags</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ndmreset</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put whole processor into reset when <code>1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmactive</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DM enable; writing <code>0</code>-<code>1</code> will reset the DM</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dmstatus"><strong><code>dmstatus</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug module status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dmstatus</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00400083</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Current status of the overall debug module and the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 55. <code>dmstatus</code> - debug module status register bits</caption>
<colgroup>
<col style="width: 7.6923%;">
<col style="width: 15.3846%;">
<col style="width: 76.9231%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>impebreak</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; indicates an implicit <code>ebreak</code> instruction after the last program buffer entry</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhavereset</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is in reset</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhavereset</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allresumeack</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart has acknowledged a resume request</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyresumeack</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allnonexistent</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock">always zero to indicate the hart is always existent</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anynonexistent</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allunavail</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the DM is disabled to indicate the hart is unavailable</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyunavail</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allrunning</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is running</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyrunning</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>allhalted</code></p></td>
<td class="tableblock halign-left valign-top" rowspan="2"><p class="tableblock"><code>1</code> when the hart is halted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>anyhalted</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authenticated</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>authbusy</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; there is no authentication</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hasresethaltreq</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; halt-on-reset is not supported (directly)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>confstrptrvalid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0</code>; no configuration string available</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0011</code> - DM is compatible to spec. version 1.0</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_hartinfo"><strong><code>hartinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hart information</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>hartinfo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <em>see below</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This register gives information about the hart. The entire register is read-only.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 56. <code>hartinfo</code> - hart information register bits</caption>
<colgroup>
<col style="width: 9.0909%;">
<col style="width: 18.1818%;">
<col style="width: 72.7273%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nscratch</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of <code>dscratch*</code> CPU registers = 1</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19:17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataccess</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>, the <code>data</code> registers are shadowed in the hart&#8217;s address space</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datasize</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code>, number of 32-bit words in the address space dedicated to shadowing the <code>data</code> registers (1 register)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dataaddr</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">= <code>dm_data_base_c(11:0)</code>, signed base address of <code>data</code> words (see address map in <a href="#_dm_cpu_access">DM CPU Access</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstracts"><strong><code>abstracts</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract control and status</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstracts</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x02000801</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Command execution info and status.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 57. <code>abstracts</code> - abstract control and status register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:29</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">28:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>progbufsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0010</code>: size of the program buffer (<code>progbuf</code>) = 2 entries</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23:11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>busy</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> when a command is being executed</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>relaxedpriv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>1</code>: PMP rules are ignored when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmderr</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">error during command execution (see below); has to be cleared by writing <code>111</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">7:4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved; always zero</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>datacount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">always <code>0001</code>: number of implemented <code>data</code> registers for abstract commands = 1</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Error codes in <code>cmderr</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>000</code> - no error</p>
</li>
<li>
<p><code>100</code> - command cannot be executed since hart is not in expected state</p>
</li>
<li>
<p><code>011</code> - exception during command execution</p>
</li>
<li>
<p><code>010</code> - unsupported command</p>
</li>
<li>
<p><code>001</code> - invalid DM register read/write while command is/was executing</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">PMP Rules</div>
When in debug-mode all PMP rules are ignored making the debugger have maximum access rights.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_command"><strong><code>command</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>command</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Writing this register will trigger the execution of an abstract command. New command can only be executed if
<code>cmderr</code> is zero. The entire register in write-only (reads will return zero).</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The NEORV32 DM only supports <strong>Access Register</strong> abstract commands. These commands can only access the
hart&#8217;s GPRs (abstract command register index <code>0x1000</code> - <code>0x101f</code>).
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 58. <code>command</code> - abstract command register - "access register" commands only</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description / required value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cmdtype</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00000000</code> to indicate "access register" command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">23</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><em>reserved</em></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">reserved, has to be <code>0</code> when writing</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">22:20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarsize</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>010</code> to indicate 32-bit accesses</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>aarpostincrement</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code>, post-increment is not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>postexec</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set the program buffer is executed <em>after</em> the command</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>transfer</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">if set the operation in <code>write</code> is conducted</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>write</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code>: copy <code>data0</code> to <code>[regno]</code>, <code>0</code>: copy <code>[regno]</code> to <code>data0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>regno</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GPR-access only; has to be <code>0x1000</code> - <code>0x101f</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_abstractauto"><strong><code>abstractauto</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Abstract command auto-execution</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>abstractauto</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Register to configure when a read/write access to a DM repeats execution of the last abstract command.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 59. <code>abstractauto</code> - Abstract command auto-execution register bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[1]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf1</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecprogbuf[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>progbuf0</code> will execute <code>command</code> again</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>autoexecdata[0]</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">when set reading/writing from/to <code>data0</code> will execute <code>command</code> again</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_progbuf"><strong><code>progbuf</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Program buffer 1</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>progbuf1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000013</code> ("NOP")</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Program buffer (two entries) for the DM. Note that this register is read-only for the DM (allowed since spec. version 1.0)!</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dm_cpu_access">5.2.2. DM CPU Access</h4>
<div class="paragraph">
<p>From the CPU&#8217;s perspective, the DM behaves as a memory-mapped peripheral that includes the following sub-modules:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a small ROM that contains the code for the "park loop", which is executed when the CPU is <em>in</em> debug mode</p>
</li>
<li>
<p>a program buffer populated by the debugger host to execute small programs</p>
</li>
<li>
<p>a data buffer to transfer data between the processor and the debugger host</p>
</li>
<li>
<p>a status register to communicate debugging requests and status
(see <code>sw/ocd-firmware/README.md</code>).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The DM occupies 256 bytes of the CPU&#8217;s address space starting at address <code>dm_base_c</code> (see table below).
This address space is divided into four sections of 64 bytes each to provide access to the <em>park loop code ROM</em>,
the <em>program buffer</em>, the <em>data buffer</em> and the <em>status register</em>. The program buffer, the data buffer and the
status register do not fully occupy the 64-byte-wide sections. However, the according registers are mirrored
to fill the entire section.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 60. DM CPU access - address map (divided into four sections)</caption>
<colgroup>
<col style="width: 13.3333%;">
<col style="width: 26.6666%;">
<col style="width: 13.3333%;">
<col style="width: 46.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Base address</th>
<th class="tableblock halign-center valign-top">Name [VHDL package]</th>
<th class="tableblock halign-center valign-top">Actual size</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff800</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_code_base_c</code> (= <code>dm_base_c</code>)</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">64 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ROM for the "park loop" code</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff840</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_pbuf_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">16 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Program buffer, provided by DM</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff880</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_data_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data buffer (<code>dm.data0</code>)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>0xfffff8c0</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_sreg_base_c</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Control and status register</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">DM Register Access</div>
All memory-mapped registers of the DM can only be accessed by the CPU if it is actually <em>in</em> debug mode.
Hence, the DM registers are not "visible" for normal CPU operations.
Any CPU access outside of debug mode will raise a bus access fault exception.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Park Loop Code Sources ("OCD Firmware")</div>
The assembly sources of the <strong>park loop code</strong> are available in <code>sw/ocd-firmware/park_loop.S</code>. Please note, that
these sources are not intended to be changed by the user. Hence, the makefile does not provide an automatic option
to compile and "install" the debugger ROM code into the HDL sources and require a manual copy
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_code_rom_entry_points">Code ROM Entry Points</h5>
<div class="paragraph">
<p>The park loop code provides two entry points, where the actual code execution can start. These are used to enter
the park loop either when an explicit request has been issued (for example a halt request) or when an exception
has occurred <em>while executing</em> the park loop itself.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 61. Park Loop Entry Points</caption>
<colgroup>
<col style="width: 60%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Address</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_exc_entry_c</code>  (<code>dm_base_c</code> + 0)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exception entry address</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dm_park_entry_c</code> (<code>dm_base_c</code> + 8)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Normal entry address</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>When the CPU enters or re-enters debug mode (for example via an <code>ebreak</code> in the DM&#8217;s program buffer), it jumps to
address of the <em>normal entry point</em> for the park loop code defined by the <a href="#_cpu_debug_park_addr"><em>CPU_DEBUG_PARK_ADDR</em></a> generic.
By default, this generic is set to <code>dm_park_entry_c</code>, which is defined in main package file.
If an exception is encountered during debug mode, the CPU jumps to the address of the <em>exception entry point</em>
defined  by the <a href="#_cpu_debug_exc_addr"><em>CPU_DEBUG_EXC_ADDR</em></a> generic. By default, this generic is set to <code>dm_exc_entry_c</code>, which is
also defined in main package file.</p>
</div>
</div>
<div class="sect4">
<h5 id="_status_register">Status Register</h5>
<div class="paragraph">
<p>The status register provides a direct communication channel between the CPU&#8217;s debug mode executing the park loop
and the host-controlled debug module (DM). This register is used to communicate <em>requests</em>, which are issued by the
DM. and the according <em>acknowledges</em>, which are generated by the CPU.</p>
</div>
<div class="paragraph">
<p>There are only 4 bits in this register that are used to implement the requests/acknowledges. Each bit is left-aligned
in one sub-byte of the entire 32-bit register. Thus, the CPU can access each bit individually using <em>store-byte</em> and
<em>load-byte</em> instruction. This eliminates the need to perform bit-masking in the park loop code leading to less code size
and faster execution.</p>
</div>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 62. DM Status Register - CPU Access</caption>
<colgroup>
<col style="width: 7.1428%;">
<col style="width: 21.4285%;">
<col style="width: 14.2857%;">
<col style="width: 57.143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name</th>
<th class="tableblock halign-center valign-top">CPU access</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_halt_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>this bit is write-only</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU while it is halted (and executing the park loop)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_resume_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to request the CPU to resume normal operation</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_resume_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU before it starts resuming</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_req</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the DM to request execution of the program buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU before it starts executing the program buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" rowspan="2"><p class="tableblock">24</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">read</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>this bit is write-only</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sreg_execute_ack</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">write</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Set by the CPU if an exception occurs while being in debug mode</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Access Details</div>
The underlaying hardware to implement the CPU access to the status register is highly optimized to provide
fastest access times while requiring minimal code and hardware size: the actual data written by the CPU is irrelevant
as only the sub-byte accesses (so, the actual bus transactions) are tracked by the status register hardware.
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_cpu_debug_mode">5.3. CPU Debug Mode</h3>
<div class="paragraph">
<p>The NEORV32 CPU Debug Mode <code>DB</code> or <code>DEBUG</code> is compatible to the <strong>Minimal RISC-V Debug Specification 1.0</strong>
<code>Sdext</code> (external debug) ISA extension. When enabled via the <a href="#_cpu_extension_riscv_sdext"><em>CPU_EXTENSION_RISCV_Sdext</em></a> generic (CPU) and/or
the <a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> (Processor) it adds a new CPU operation mode ("debug mode"), three additional CSRs
(section <a href="#_cpu_debug_mode_csrs">CPU Debug Mode CSRs</a>) and one additional instruction (<code>dret</code>) to the core.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
The CPU debug mode requires the <code>Zicsr</code> and <code>Zifencei</code> CPU extension to be implemented (top generics
<a href="#_cpu_extension_riscv_zicsr"><em>CPU_EXTENSION_RISCV_Zicsr</em></a> and <a href="#_cpu_extension_riscv_zifencei"><em>CPU_EXTENSION_RISCV_Zifencei</em></a> = true).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The CPU debug-mode is entered when one of the following events appear:</p>
</div>
<div class="olist arabic">
<ol class="arabic" start="1">
<li>
<p>executed <code>ebreak</code> instruction (when in machine-mode and <code>dcsr.ebreakm</code> is set OR when in user-mode and <code>dcsr.ebreaku</code> is set)</p>
</li>
<li>
<p>debug halt request from external DM (via CPU signal <code>db_halt_req_i</code>, high-active, triggering on rising-edge)</p>
</li>
<li>
<p>finished executing of a single instruction while in single-step debugging mode (enabled via <code>dcsr.step</code>)</p>
</li>
<li>
<p>hardware trigger by the <a href="#_trigger_module">Trigger Module</a></p>
</li>
</ol>
</div>
<div class="paragraph">
<p>From a hardware point of view, these "entry conditions" are special traps that are handled transparently by the control logic.</p>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU enters debug-mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>wake-up CPU if it was send to sleep mode by the <code>wfi</code> instruction</p>
</li>
<li>
<p>move <code>pc</code> to <code>dpc</code></p>
</li>
<li>
<p>copy the hart&#8217;s current privilege level to <code>dcsr.prv</code></p>
</li>
<li>
<p>set <code>dcrs.cause</code> according to the cause why debug mode is entered</p>
</li>
<li>
<p><strong>no update</strong> of <code>mtval</code>, <code>mcause</code>, <code>mtval</code> and <code>mstatus</code> CSRs</p>
</li>
<li>
<p>load the address configured via the CPU&#8217;s <a href="#_cpu_debug_park_addr"><em>CPU_DEBUG_PARK_ADDR</em></a> generic to the <code>pc</code> to jump to the
"debugger park loop" code stored in the debug module (DM)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>When the CPU is in debug-mode the following things are important:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>while in debug mode, the CPU executes the parking loop and - if requested by the DM - the program buffer</p>
</li>
<li>
<p>effective CPU privilege level is <code>machine</code> mode; any active physical memory protection (PMP) configuration is bypassed</p>
</li>
<li>
<p>the <code>wfi</code> instruction acts as a <code>nop</code> (also during single-stepping)</p>
</li>
<li>
<p>if an exception occurs while being in debug mode:</p>
<div class="ulist">
<ul>
<li>
<p>if the exception was caused by any debug-mode entry action the CPU jumps to the <em>normal entry point</em>
(defined by <a href="#_cpu_debug_park_addr"><em>CPU_DEBUG_PARK_ADDR</em></a> generic) of the park loop again (for example when executing <code>ebreak</code> while in debug-mode)</p>
</li>
<li>
<p>for all other exception sources the CPU jumps to the <em>exception entry point</em> (defined by <a href="#_cpu_debug_exc_addr"><em>CPU_DEBUG_EXC_ADDR</em></a> generic)
to signal an exception to the DM; the CPU restarts the park loop again afterwards</p>
</li>
</ul>
</div>
</li>
<li>
<p>interrupts are disabled; however, they will remain pending and will get executed after the CPU has left debug mode</p>
</li>
<li>
<p>if the DM makes a resume request, the park loop exits and the CPU leaves debug mode (executing <code>dret</code>)</p>
</li>
<li>
<p>the standard counters <a href="#_machine_counter_and_timer_csrs">(Machine) Counter and Timer CSRs</a> <code>[m]cycle[h]</code> and <code>[m]instret[h]</code> are stopped; note that the
<a href="#_machine_system_timer_mtime">Machine System Timer (MTIME)</a> keep running as well as it&#8217;s shadowed copies in the <code>[m]time[h]</code> CSRs</p>
</li>
<li>
<p>all <a href="#_hardware_performance_monitors_hpm_csrs">Hardware Performance Monitors (HPM) CSRs</a> are stopped</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Debug mode is left either by executing the <code>dret</code> instruction or by performing
a hardware reset of the CPU. Executing <code>dret</code> outside of debug mode will raise an illegal instruction exception.</p>
</div>
<div class="paragraph">
<p><strong>Whenever the CPU leaves debug mode it performs the following operations:</strong></p>
</div>
<div class="ulist">
<ul>
<li>
<p>set the hart&#8217;s current privilege level according to <code>dcsr.prv</code></p>
</li>
<li>
<p>restore <code>pc</code> from <code>dpcs</code></p>
</li>
<li>
<p>resume normal operation at <code>pc</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_cpu_debug_mode_csrs">5.3.1. CPU Debug Mode CSRs</h4>
<div class="paragraph">
<p>Two additional CSRs are required by the <em>Minimal RISC-V Debug Specification</em>: the debug mode control and status register
<code>dcsr</code> and the debug program counter <code>dpc</code>. An additional general purpose scratch register for debug mode only
(<code>dscratch0</code>) allows faster execution by having a fast-accessible backup register.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The debug-mode CSRs are only accessible when the CPU is <em>in</em> debug mode. If these CSRs are accessed outside of debug mode
an illegal instruction exception is raised.
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_dcsr"><strong><code>dcsr</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug control and status register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dcsr</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x40000413</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dcsr</code> CSR is compatible to the RISC-V debug spec. It is used to configure debug mode and provides additional status information.
The following bits are implemented. The reaming bits are read-only and always read as zero.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 63. Debug control and status register <code>dcsr</code> bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>xdebugver</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0100</code> - CPU debug mode is compatible to spec. version 1.0</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000000000000</code> - <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakm</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>machine</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereakh</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - hypervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaks</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - supervisor mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>ebereaku</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>ebreak</code> instructions in <code>user</code> mode will <em>enter</em> debug mode when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stepie</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - IRQs are disabled during single-stepping</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stopcount</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - standard counters and HPMs are stopped when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>stoptime</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - timers increment as usual</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">8:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>cause</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cause identifier - why debug mode was entered (see below)</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">-</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - <em>reserved</em></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>mprven</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - <a href="#_mstatus"><strong><code>mstatus</code></strong></a>`.mprv` is also evaluated when in debug mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>nmip</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - non-maskable interrupt is pending</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>step</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable single-stepping when set</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1:0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>prv</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CPU privilege level before/after debug mode</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Cause codes in <code>dcsr.cause</code> (highest priority first):</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>010</code> - trigger by hardware <a href="#_trigger_module">Trigger Module</a></p>
</li>
<li>
<p><code>001</code> - executed <code>EBREAK</code> instruction</p>
</li>
<li>
<p><code>011</code> - external halt request (from DM)</p>
</li>
<li>
<p><code>100</code> - return from single-stepping</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_dpc"><strong><code>dpc</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug program counter</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dpc</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dcsr</code> CSR is compatible to the RISC-V debug spec. It is used to store the current program counter when
debug mode is entered. The <code>dret</code> instruction will return to <code>dpc</code> by moving <code>dpc</code> to <code>pc</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_dscratch0"><strong><code>dscratch0</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7b2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Debug scratch register 0</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>dscratch0</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">The <code>dscratch0</code> CSR is compatible to the RISC-V debug spec. It provides a general purpose debug mode-only scratch register.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_trigger_module">5.4. Trigger Module</h3>
<div class="paragraph">
<p>The RISC-V <code>Sdtrig</code> ISA extension add a programmable <em>trigger module</em> to the processor when enabled
(via the <a href="#_cpu_extension_riscv_sdtrig"><em>CPU_EXTENSION_RISCV_Sdtrig</em></a>). The NEORV32 trigger module implements a subset of the features
described in the "RISC-V Debug Specification / Trigger Module".</p>
</div>
<div class="paragraph">
<p>The trigger module only provides a <em>single</em> trigger supporting only the "instruction address match" type. This limitation
is granted by the RISC-V specs. and is sufficient to <strong>debug code executed from read-only memory (ROM)</strong>.
"Normal" <em>software</em> breakpoints (using GDB&#8217;s <code>b</code>/<code>break</code> command) are implemented by temporarily replacing the according
instruction word by an <code>ebreak</code> instruction. This is not possible when debugging code that is executed from read-only memory
(for example when debugging programs that are executed via the <a href="#_execute_in_place_module_xip">Execute In Place Module (XIP)</a>).
Therefore, the NEORV32 trigger module provides a single "instruction address match" trigger to enter debug mode when
executing the instruction at a specific address. These "hardware-assisted breakpoints" are used by GDB&#8217;s <code>hb</code>/<code>hbreak</code> command.</p>
</div>
<div class="paragraph">
<p>The trigger module can also be used independently of the CPU debug-mode (so independent of the on-chip debugger).
Machine-mode software can use the trigger module to raise a Break exception when the instruction at a programmable
address gets executed.</p>
</div>
<div class="sect3">
<h4 id="_trigger_module_csrs">5.4.1. Trigger Module CSRs</h4>
<div class="paragraph">
<p>The <code>Sdtrig</code> ISA extension add 8 additional CSRs, which are accessible in debug-mode and also in machine-mode.
Machine-level accesses can be ignore by setting <a href="#_tdata1"><strong><code>tdata1</code></strong></a>`.dmode. This is automatically done by GDB if it uses the trigger module
for implementing a "hardware breakpoint"</p>
</div>
<div class="sect4">
<h5 id="_tselect"><strong><code>tselect</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger select register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tselect</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is hardwired to zero indicating there is only one trigger available. Any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata1"><strong><code>tdata1</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger data register 1 / match control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tdata1</code> / <code>mcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x20040040</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is used to configure the address match trigger. Only one bit is writable, the remaining bits are hardwired (see table below).
Write attempts to the hardwired bits are ignored.</p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-rows stretch">
<caption class="title">Table 64. Match control CSR (<code>tdata1</code>) bits</caption>
<colgroup>
<col style="width: 8.3333%;">
<col style="width: 16.6666%;">
<col style="width: 8.3333%;">
<col style="width: 66.6668%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Bit</th>
<th class="tableblock halign-center valign-top">Name [RISC-V]</th>
<th class="tableblock halign-center valign-top">R/W</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">31:28</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>type</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0010</code> - address match trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>dmode</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to ignore <code>tdata*</code> CSR accesses from machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">26:21</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>maskmax</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>000000</code> - only exact values</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>hit</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - feature not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>select</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - fire trigger on address match</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>timing</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - trigger <strong>after</strong> executing the triggering instruction</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">17:16</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>sizelo</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>00</code> - match against an access of any size</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">15:12</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>action</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0001</code> = enter debug-mode on trigger fire; <code>0000</code> = normal m-mode break exception on trigger fire</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>chain</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - chaining is not supported - there is only one trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">10:6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>match</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0000</code> - only full-address match</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>m</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1</code> - trigger enabled when in machine-mode</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>h</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - hypervisor-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>s</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - supervisor-mode not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>u</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">trigger enabled when in user-mode, set when <code>U</code> ISA extension is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>exe</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/w</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set to enable trigger</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>store</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - store address/data matching not supported</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><code>load</code></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">r/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>0</code> - load address/data matching not supported</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata2"><strong><code>tdata2</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger data register 2</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tdata2</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Since only the "address match trigger" type is supported, this r/w CSR is used to configure the address of the triggering instruction.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tdata3"><strong><code>tdata3</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger data register 3</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tdata3</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is not required for the NEORV32 trigger module. Hence, it is hardwired to zero and any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tinfo"><strong><code>tinfo</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger information register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tinfo</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000004</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is hardwired to "4" indicating there is only an "address match trigger" available. Any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tcontrol"><strong><code>tcontrol</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Trigger control register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>tcontrol</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is not required for the NEORV32 trigger module. Hence, it is hardwired to zero and any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_mcontext"><strong><code>mcontext</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7a8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Machine context register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>mcontext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is not required for the NEORV32 trigger module. Hence, it is hardwired to zero and any write access is ignored.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_scontext"><strong><code>scontext</code></strong></h5>
<table class="tableblock frame-ends grid-none stretch">
<colgroup>
<col style="width: 10.5263%;">
<col style="width: 71.0526%;">
<col style="width: 18.4211%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x7aa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Supervisor context register</strong></p></td>
<td class="tableblock halign-right valign-top"><p class="tableblock"><code>scontext</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">Reset value: <code>0x00000000</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" colspan="3"><p class="tableblock">This CSR is not required for the NEORV32 trigger module. Hence, it is hardwired to zero and any write access is ignored.</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_legal">6. Legal</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_license">License</h3>
<div class="paragraph">
<p><strong>BSD 3-Clause License</strong></p>
</div>
<div class="paragraph">
<p>Copyright (c) 2023, Stephan Nolting. All rights reserved.</p>
</div>
<div class="paragraph">
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that
the following conditions are met:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Redistributions of source code must retain the above copyright notice, this list of conditions and the
following disclaimer.</p>
</li>
<li>
<p>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
the following disclaimer in the documentation and/or other materials provided with the distribution.</p>
</li>
<li>
<p>Neither the name of the copyright holder nor the names of its contributors may be used to endorse or
promote products derived from this software without specific prior written permission.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p><strong>The NEORV32 RISC-V Processor</strong><br>
HQ: <a href="https://github.com/stnolting/neorv32" class="bare">https://github.com/stnolting/neorv32</a><br>
By Dipl.-Ing. (M.Sc.) Stephan Nolting<br>
European Union, Germany<br>
Contact: <a href="mailto:stnolting@gmail.com">stnolting@gmail.com</a></p>
</div>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
<div class="sect2">
<h3 id="_proprietary_notice">Proprietary Notice</h3>
<div class="ulist">
<ul>
<li>
<p>"GitHub" is a Subsidiary of Microsoft Corporation.</p>
</li>
<li>
<p>"Vivado" and "Artix" are trademarks of Xilinx Inc.</p>
</li>
<li>
<p>"AXI", "AXI4-Lite" and "AXI4-Stream" are trademarks of Arm Holdings plc.</p>
</li>
<li>
<p>"ModelSim" is a trademark of Mentor Graphics  A Siemens Business.</p>
</li>
<li>
<p>"Quartus Prime" and "Cyclone" are trademarks of Intel Corporation.</p>
</li>
<li>
<p>"iCE40", "UltraPlus" and "Radiant" are trademarks of Lattice Semiconductor Corporation.</p>
</li>
<li>
<p>"Windows" is a trademark of Microsoft Corporation.</p>
</li>
<li>
<p>"Tera Term" copyright by T. Teranishi.</p>
</li>
<li>
<p>"NeoPixel" is a trademark of Adafruit Industries.</p>
</li>
<li>
<p>Images/figures made with <em>Microsoft Power Point</em>.</p>
</li>
<li>
<p>Timing diagrams made with <em>WaveDrom Editor</em>.</p>
</li>
<li>
<p>Documentation proudly made with <code>asciidoctor</code>.</p>
</li>
<li>
<p>"Segger Embedded Studio" and "J-Link" are trademarks of Segger Microcontroller Systems GmbH.</p>
</li>
<li>
<p>All further/unreferenced products belong to their according copyright holders.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>PDF icons from <a href="https://www.flaticon.com" class="bare">https://www.flaticon.com</a> and made by
<a href="https://www.freepik.com">Freepik</a>, <a href="https://www.flaticon.com/authors/good-ware">Good Ware</a>,
<a href="https://www.flaticon.com/authors/pixel-perfect">Pixel perfect</a>, <a href="https://www.flaticon.com/authors/vectors-market">Vectors Market</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_disclaimer">Disclaimer</h3>
<div class="paragraph">
<p>This project is released under the BSD 3-Clause license. No copyright infringement
intended. Other implied or used projects might have different licensing  see their documentation to get more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="_limitation_of_liability_for_external_links">Limitation of Liability for External Links</h3>
<div class="paragraph">
<p>This document contains links to the websites of third parties ("external links"). As the content of these websites
is not under our control, we cannot assume any liability for such external content. In all cases, the provider of
information of the linked websites is liable for the content and accuracy of the information provided. At the
point in time when the links were placed, no infringements of the law were recognizable to us. As soon as an
infringement of the law becomes known to us, we will immediately remove the link in question.</p>
</div>
</div>
<div class="sect2">
<h3 id="_citing">Citing</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This is an open-source project that is free of charge. Use this project in any way you like
(as long as it complies to the permissive license). Please cite it appropriately. 
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Contributors </div>
Please add as many <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a> as possible to the <code>author</code> field.<br>
This project would not be where it is without them.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you are using the NEORV32 or parts of the project in some kind of publication, please cite it as follows:</p>
</div>
<div class="listingblock">
<div class="title">Listing 22. BibTeX</div>
<div class="content">
<pre class="highlight"><code>@misc{nolting22,
  author       = {Nolting, S. and ...},
  title        = {The NEORV32 RISC-V Processor},
  year         = {2022},
  publisher    = {GitHub},
  journal      = {GitHub repository},
  howpublished = {\url{https://github.com/stnolting/neorv32}}
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">DOI</div>
This project also provides a <em>digital object identifier</em> provided by <a href="https://zenodo.org">zenodo</a>:
<a href="https://doi.org/10.5281/zenodo.5018888"><span class="image"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5018888.svg" alt="zenodo.5018888" title="zenodo"></span></a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_acknowledgments">Acknowledgments</h3>
<div class="paragraph">
<p><strong>A big shout-out to the community and all <a href="https://github.com/stnolting/neorv32/graphs/contributors">contributors</a>,
who helped improving this project! </strong></p>
</div>
<div class="paragraph">
<p><a href="https://riscv.org">RISC-V</a> - instruction sets want to be free!</p>
</div>
<div class="paragraph">
<p>Continuous integration provided by <a href="https://github.com/features/actions">GitHub Actions</a> and powered by <a href="https://github.com/ghdl/ghdl">GHDL</a>.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnotedef_1">
<a href="#_footnoteref_1">1</a>. Pronounced "neo-R-V-thirty-two" or "neo-risc-five-thirty-two" in its long form.
</div>
<div class="footnote" id="_footnotedef_2">
<a href="#_footnoteref_2">2</a>. Resource utilization depends on custom design logic.
</div>
<div class="footnote" id="_footnotedef_3">
<a href="#_footnoteref_3">3</a>. Pull high if not used.
</div>
<div class="footnote" id="_footnotedef_4">
<a href="#_footnoteref_4">4</a>. If the on-chip debugger is not implemented (<a href="#_on_chip_debugger_en"><em>ON_CHIP_DEBUGGER_EN</em></a> = false) <code>jtag_tdi_i</code> is directly forwarded to <code>jtag_tdo_o</code> to maintain the JTAG chain.
</div>
<div class="footnote" id="_footnotedef_5">
<a href="#_footnoteref_5">5</a>. If the <code>Zicsr</code> CPU extension is enabled (implementing the full set of the privileged architecture).
</div>
<div class="footnote" id="_footnotedef_6">
<a href="#_footnoteref_6">6</a>. This driver file only represents a stub, since the real CFS drivers are defined by the actual CFS implementation.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version v1.7.9-r85-g7e385d1f<br>
</div>
</div>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains("stemblock")) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>